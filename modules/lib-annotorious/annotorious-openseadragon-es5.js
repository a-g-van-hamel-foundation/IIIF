"use strict";var _excluded=["id","type","purpose","value","created","modified","creator"],_excluded2=["annotation","created","updated"],_excluded3=["creator","created","modified","body"],_excluded4=["selector","creator","created","updated","updatedBy"],_excluded5=["region"],_excluded6=["chars","padding","resolution","textureWidth","textureHeight"];function _regeneratorRuntime(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */_regeneratorRuntime=function _regeneratorRuntime(){return exports;};var exports={},Op=Object.prototype,hasOwn=Op.hasOwnProperty,defineProperty=Object.defineProperty||function(obj,key,desc){obj[key]=desc.value;},$Symbol="function"==typeof Symbol?Symbol:{},iteratorSymbol=$Symbol.iterator||"@@iterator",asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator",toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";function define(obj,key,value){return Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}),obj[key];}try{define({},"");}catch(err){define=function define(obj,key,value){return obj[key]=value;};}function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator,generator=Object.create(protoGenerator.prototype),context=new Context(tryLocsList||[]);return defineProperty(generator,"_invoke",{value:makeInvokeMethod(innerFn,self,context)}),generator;}function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)};}catch(err){return{type:"throw",arg:err};}}exports.wrap=wrap;var ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var IteratorPrototype={};define(IteratorPrototype,iteratorSymbol,function(){return this;});var getProto=Object.getPrototypeOf,NativeIteratorPrototype=getProto&&getProto(getProto(values([])));NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)&&(IteratorPrototype=NativeIteratorPrototype);var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);function defineIteratorMethods(prototype){["next","throw","return"].forEach(function(method){define(prototype,method,function(arg){return this._invoke(method,arg);});});}function AsyncIterator(generator,PromiseImpl){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if("throw"!==record.type){var result=record.arg,value=result.value;return value&&"object"==_typeof(value)&&hasOwn.call(value,"__await")?PromiseImpl.resolve(value.__await).then(function(value){invoke("next",value,resolve,reject);},function(err){invoke("throw",err,resolve,reject);}):PromiseImpl.resolve(value).then(function(unwrapped){result.value=unwrapped,resolve(result);},function(error){return invoke("throw",error,resolve,reject);});}reject(record.arg);}var previousPromise;defineProperty(this,"_invoke",{value:function value(method,arg){function callInvokeWithMethodAndArg(){return new PromiseImpl(function(resolve,reject){invoke(method,arg,resolve,reject);});}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg();}});}function makeInvokeMethod(innerFn,self,context){var state="suspendedStart";return function(method,arg){if("executing"===state)throw new Error("Generator is already running");if("completed"===state){if("throw"===method)throw arg;return doneResult();}for(context.method=method,context.arg=arg;;){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult;}}if("next"===context.method)context.sent=context._sent=context.arg;else if("throw"===context.method){if("suspendedStart"===state)throw state="completed",context.arg;context.dispatchException(context.arg);}else"return"===context.method&&context.abrupt("return",context.arg);state="executing";var record=tryCatch(innerFn,self,context);if("normal"===record.type){if(state=context.done?"completed":"suspendedYield",record.arg===ContinueSentinel)continue;return{value:record.arg,done:context.done};}"throw"===record.type&&(state="completed",context.method="throw",context.arg=record.arg);}};}function maybeInvokeDelegate(delegate,context){var methodName=context.method,method=delegate.iterator[methodName];if(undefined===method)return context.delegate=null,"throw"===methodName&&delegate.iterator["return"]&&(context.method="return",context.arg=undefined,maybeInvokeDelegate(delegate,context),"throw"===context.method)||"return"!==methodName&&(context.method="throw",context.arg=new TypeError("The iterator does not provide a '"+methodName+"' method")),ContinueSentinel;var record=tryCatch(method,delegate.iterator,context.arg);if("throw"===record.type)return context.method="throw",context.arg=record.arg,context.delegate=null,ContinueSentinel;var info=record.arg;return info?info.done?(context[delegate.resultName]=info.value,context.next=delegate.nextLoc,"return"!==context.method&&(context.method="next",context.arg=undefined),context.delegate=null,ContinueSentinel):info:(context.method="throw",context.arg=new TypeError("iterator result is not an object"),context.delegate=null,ContinueSentinel);}function pushTryEntry(locs){var entry={tryLoc:locs[0]};1 in locs&&(entry.catchLoc=locs[1]),2 in locs&&(entry.finallyLoc=locs[2],entry.afterLoc=locs[3]),this.tryEntries.push(entry);}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal",delete record.arg,entry.completion=record;}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}],tryLocsList.forEach(pushTryEntry,this),this.reset(!0);}function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod)return iteratorMethod.call(iterable);if("function"==typeof iterable.next)return iterable;if(!isNaN(iterable.length)){var i=-1,next=function next(){for(;++i<iterable.length;)if(hasOwn.call(iterable,i))return next.value=iterable[i],next.done=!1,next;return next.value=undefined,next.done=!0,next;};return next.next=next;}}return{next:doneResult};}function doneResult(){return{value:undefined,done:!0};}return GeneratorFunction.prototype=GeneratorFunctionPrototype,defineProperty(Gp,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),defineProperty(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,toStringTagSymbol,"GeneratorFunction"),exports.isGeneratorFunction=function(genFun){var ctor="function"==typeof genFun&&genFun.constructor;return!!ctor&&(ctor===GeneratorFunction||"GeneratorFunction"===(ctor.displayName||ctor.name));},exports.mark=function(genFun){return Object.setPrototypeOf?Object.setPrototypeOf(genFun,GeneratorFunctionPrototype):(genFun.__proto__=GeneratorFunctionPrototype,define(genFun,toStringTagSymbol,"GeneratorFunction")),genFun.prototype=Object.create(Gp),genFun;},exports.awrap=function(arg){return{__await:arg};},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,asyncIteratorSymbol,function(){return this;}),exports.AsyncIterator=AsyncIterator,exports.async=function(innerFn,outerFn,self,tryLocsList,PromiseImpl){void 0===PromiseImpl&&(PromiseImpl=Promise);var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList),PromiseImpl);return exports.isGeneratorFunction(outerFn)?iter:iter.next().then(function(result){return result.done?result.value:iter.next();});},defineIteratorMethods(Gp),define(Gp,toStringTagSymbol,"Generator"),define(Gp,iteratorSymbol,function(){return this;}),define(Gp,"toString",function(){return"[object Generator]";}),exports.keys=function(val){var object=Object(val),keys=[];for(var key in object)keys.push(key);return keys.reverse(),function next(){for(;keys.length;){var key=keys.pop();if(key in object)return next.value=key,next.done=!1,next;}return next.done=!0,next;};},exports.values=values,Context.prototype={constructor:Context,reset:function reset(skipTempReset){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(resetTryEntry),!skipTempReset)for(var name in this)"t"===name.charAt(0)&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))&&(this[name]=undefined);},stop:function stop(){this.done=!0;var rootRecord=this.tryEntries[0].completion;if("throw"===rootRecord.type)throw rootRecord.arg;return this.rval;},dispatchException:function dispatchException(exception){if(this.done)throw exception;var context=this;function handle(loc,caught){return record.type="throw",record.arg=exception,context.next=loc,caught&&(context.method="next",context.arg=undefined),!!caught;}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i],record=entry.completion;if("root"===entry.tryLoc)return handle("end");if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc"),hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc);}else if(hasCatch){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);}else{if(!hasFinally)throw new Error("try statement without catch or finally");if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc);}}}},abrupt:function abrupt(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break;}}finallyEntry&&("break"===type||"continue"===type)&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc&&(finallyEntry=null);var record=finallyEntry?finallyEntry.completion:{};return record.type=type,record.arg=arg,finallyEntry?(this.method="next",this.next=finallyEntry.finallyLoc,ContinueSentinel):this.complete(record);},complete:function complete(record,afterLoc){if("throw"===record.type)throw record.arg;return"break"===record.type||"continue"===record.type?this.next=record.arg:"return"===record.type?(this.rval=this.arg=record.arg,this.method="return",this.next="end"):"normal"===record.type&&afterLoc&&(this.next=afterLoc),ContinueSentinel;},finish:function finish(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc)return this.complete(entry.completion,entry.afterLoc),resetTryEntry(entry),ContinueSentinel;}},"catch":function _catch(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if("throw"===record.type){var thrown=record.arg;resetTryEntry(entry);}return thrown;}}throw new Error("illegal catch attempt");},delegateYield:function delegateYield(iterable,resultName,nextLoc){return this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc},"next"===this.method&&(this.arg=undefined),ContinueSentinel;}},exports;}function _get(){if(typeof Reflect!=="undefined"&&Reflect.get){_get=Reflect.get.bind();}else{_get=function _get(target,property,receiver){var base=_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(arguments.length<3?target:receiver);}return desc.value;};}return _get.apply(this,arguments);}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break;}return object;}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value;}catch(error){reject(error);return;}if(info.done){resolve(value);}else{Promise.resolve(value).then(_next,_throw);}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value);}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err);}_next(undefined);});};}function _objectWithoutProperties(source,excluded){if(source==null)return{};var target=_objectWithoutPropertiesLoose(source,excluded);var key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];if(excluded.indexOf(key)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(source,key))continue;target[key]=source[key];}}return target;}function _objectWithoutPropertiesLoose(source,excluded){if(source==null)return{};var target={};var sourceKeys=Object.keys(source);var key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(excluded.indexOf(key)>=0)continue;target[key]=source[key];}return target;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function");}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});Object.defineProperty(subClass,"prototype",{writable:false});if(superClass)_setPrototypeOf(subClass,superClass);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call;}else if(call!==void 0){throw new TypeError("Derived constructors may only return object or undefined");}return _assertThisInitialized(self);}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf(o);}function _toArray(arr){return _arrayWithHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableRest();}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest();}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _s,_e,_x,_r,_arr=[],_n=!0,_d=!1;try{if(_x=(_i=_i.call(arr)).next,0===i){if(Object(_i)!==_i)return;_n=!1;}else for(;!(_n=(_s=_x.call(_i)).done)&&(_arr.push(_s.value),_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err;}finally{try{if(!_n&&null!=_i["return"]&&(_r=_i["return"](),Object(_r)!==_r))return;}finally{if(_d)throw _e;}}return _arr;}}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr;}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:false});return Constructor;}function _createForOfIteratorHelper(o,allowArrayLike){var it=typeof Symbol!=="undefined"&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};},e:function e(_e18){throw _e18;},f:F};}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion=true,didErr=false,err;return{s:function s(){it=it.call(o);},n:function n(){var step=it.next();normalCompletion=step.done;return step;},e:function e(_e19){didErr=true;err=_e19;},f:function f(){try{if(!normalCompletion&&it["return"]!=null)it["return"]();}finally{if(didErr)throw err;}}};}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread();}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter);}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2;}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;})),keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}return target;}function _defineProperty(obj,key,value){key=_toPropertyKey(key);if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _toPropertyKey(arg){var key=_toPrimitive(arg,"string");return _typeof(key)==="symbol"?key:String(key);}function _toPrimitive(input,hint){if(_typeof(input)!=="object"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||"default");if(_typeof(res)!=="object")return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return(hint==="string"?String:Number)(input);}function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj;}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;},_typeof(obj);}(function(Gt,de){(typeof exports==="undefined"?"undefined":_typeof(exports))=="object"&&(typeof module==="undefined"?"undefined":_typeof(module))<"u"?de(exports,require("openseadragon")):typeof define=="function"&&define.amd?define(["exports","openseadragon"],de):(Gt=(typeof globalThis==="undefined"?"undefined":_typeof(globalThis))<"u"?globalThis:Gt||self,de(Gt.AnnotoriousOSD={},Gt.OpenSeadragon));})(void 0,function(Gt,de){"use strict";var _qg,_c$default,_xw,_lp,_ww,_Aw,_eh,_uS;var CC=Object.defineProperty;var IC=function IC(Gt,de,Zr){return de in Gt?CC(Gt,de,{enumerable:!0,configurable:!0,writable:!0,value:Zr}):Gt[de]=Zr;};var Pt=function Pt(Gt,de,Zr){return IC(Gt,_typeof(de)!="symbol"?de+"":de,Zr);};var Zr=Object.prototype.hasOwnProperty;function Qr(r,t){var e,i;if(r===t)return!0;if(r&&t&&(e=r.constructor)===t.constructor){if(e===Date)return r.getTime()===t.getTime();if(e===RegExp)return r.toString()===t.toString();if(e===Array){if((i=r.length)===t.length)for(;i--&&Qr(r[i],t[i]););return i===-1;}if(!e||_typeof(r)=="object"){i=0;for(e in r)if(Zr.call(r,e)&&++i&&!Zr.call(t,e)||!(e in t)||!Qr(r[e],t[e]))return!1;return Object.keys(t).length===i;}}return r!==r&&t!==t;}var $o=function(r){return r.EDIT="EDIT",r.SELECT="SELECT",r.NONE="NONE",r;}($o||{});var oe=[];for(var r=0;r<256;++r)oe.push((r+256).toString(16).slice(1));function Om(r){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return(oe[r[t+0]]+oe[r[t+1]]+oe[r[t+2]]+oe[r[t+3]]+"-"+oe[r[t+4]]+oe[r[t+5]]+"-"+oe[r[t+6]]+oe[r[t+7]]+"-"+oe[r[t+8]]+oe[r[t+9]]+"-"+oe[r[t+10]]+oe[r[t+11]]+oe[r[t+12]]+oe[r[t+13]]+oe[r[t+14]]+oe[r[t+15]]).toLowerCase();}var Ho;var Nm=new Uint8Array(16);function Dm(){if(!Ho){if((typeof crypto==="undefined"?"undefined":_typeof(crypto))>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Ho=crypto.getRandomValues.bind(crypto);}return Ho(Nm);}var Lm=(typeof crypto==="undefined"?"undefined":_typeof(crypto))<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ph={randomUUID:Lm};function Bm(r,t,e){var _ref,_r$random;var i;if(Ph.randomUUID&&!r)return Ph.randomUUID();r=r||{};var s=(_ref=(_r$random=r.random)!==null&&_r$random!==void 0?_r$random:(i=r.rng)==null?void 0:i.call(r))!==null&&_ref!==void 0?_ref:Dm();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,Om(s);}var Vo=function Vo(r){var t=function t(e){var i=_objectSpread({},e);return e.created&&typeof e.created=="string"&&(i.created=new Date(e.created)),e.updated&&typeof e.updated=="string"&&(i.updated=new Date(e.updated)),i;};return _objectSpread(_objectSpread({},r),{},{bodies:(r.bodies||[]).map(t),target:t(r.target)});},Fm=function Fm(r,t,e,i){return _objectSpread({id:Bm(),annotation:typeof r=="string"?r:r.id,created:e||new Date(),creator:i},t);},Um=function Um(r,t){var e=new Set(r.bodies.map(function(i){return i.id;}));return t.bodies.filter(function(i){return!e.has(i.id);});},km=function km(r,t){var e=new Set(t.bodies.map(function(i){return i.id;}));return r.bodies.filter(function(i){return!e.has(i.id);});},Gm=function Gm(r,t){return t.bodies.map(function(e){var i=r.bodies.find(function(s){return s.id===e.id;});return{newBody:e,oldBody:i&&!Qr(i,e)?i:void 0};}).filter(function(_ref2){var e=_ref2.oldBody;return e;}).map(function(_ref3){var e=_ref3.oldBody,i=_ref3.newBody;return{oldBody:e,newBody:i};});},$m=function $m(r,t){return!Qr(r.target,t.target);},Hm=function Hm(r,t){var e=Um(r,t),i=km(r,t),s=Gm(r,t);return{oldValue:r,newValue:t,bodiesCreated:e.length>0?e:void 0,bodiesDeleted:i.length>0?i:void 0,bodiesUpdated:s.length>0?s:void 0,targetUpdated:$m(r,t)?{oldTarget:r.target,newTarget:t.target}:void 0};};var Rr=function(r){return r.LOCAL="LOCAL",r.REMOTE="REMOTE",r.SILENT="SILENT",r;}(Rr||{});var Vm=function Vm(r,t){var e=new Set((r.created||[]).map(function(c){return c.id;})),i=new Set((r.updated||[]).map(function(_ref4){var c=_ref4.newValue;return c.id;})),s=new Set((t.created||[]).map(function(c){return c.id;})),n=new Set((t.deleted||[]).map(function(c){return c.id;})),o=new Set((t.updated||[]).map(function(_ref5){var c=_ref5.oldValue;return c.id;})),a=new Set((t.updated||[]).filter(function(_ref6){var c=_ref6.oldValue;return e.has(c.id)||i.has(c.id);}).map(function(_ref7){var c=_ref7.oldValue;return c.id;})),l=[].concat(_toConsumableArray((r.created||[]).filter(function(c){return!n.has(c.id);}).map(function(c){return o.has(c.id)?t.updated.find(function(_ref8){var d=_ref8.oldValue;return d.id===c.id;}).newValue:c;})),_toConsumableArray(t.created||[])),h=[].concat(_toConsumableArray((r.deleted||[]).filter(function(c){return!s.has(c.id);})),_toConsumableArray((t.deleted||[]).filter(function(c){return!e.has(c.id);}))),u=[].concat(_toConsumableArray((r.updated||[]).filter(function(_ref9){var c=_ref9.newValue;return!n.has(c.id);}).map(function(c){var d=c.oldValue,p=c.newValue;if(o.has(p.id)){var f=t.updated.find(function(m){return m.oldValue.id===p.id;}).newValue;return Hm(d,f);}else return c;})),_toConsumableArray((t.updated||[]).filter(function(_ref10){var c=_ref10.oldValue;return!a.has(c.id);})));return{created:l,deleted:h,updated:u};};var Xm=function Xm(){return{emit:function emit(r){for(var _len=arguments.length,t=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){t[_key-1]=arguments[_key];}for(var e=this.events[r]||[],i=0,s=e.length;i<s;i++)e[i].apply(e,t);},events:{},on:function on(r,t){var _this=this;var e;return((e=this.events)[r]||(e[r]=[])).push(t),function(){var i;_this.events[r]=(i=_this.events[r])==null?void 0:i.filter(function(s){return t!==s;});};}};};var zm=250,Wm=function Wm(r,t){var e=Xm(),i=(t==null?void 0:t.changes)||[];var s=t?t.pointer:-1,n=!1,o=0;var a=function a(f){if(!n){var m=f.changes,y=performance.now();if(y-o>zm)i.splice(s+1),i.push(m),s=i.length-1;else{var _=i.length-1;i[_]=Vm(i[_],m);}o=y;}n=!1;};r.observe(a,{origin:Rr.LOCAL});var l=function l(f){return f&&f.length>0&&r.bulkDeleteAnnotations(f);},h=function h(f){return f&&f.length>0&&r.bulkAddAnnotations(f,!1);},u=function u(f){return f&&f.length>0&&r.bulkUpdateAnnotations(f.map(function(_ref11){var m=_ref11.oldValue;return m;}));},c=function c(f){return f&&f.length>0&&r.bulkUpdateAnnotations(f.map(function(_ref12){var m=_ref12.newValue;return m;}));},d=function d(f){return f&&f.length>0&&r.bulkAddAnnotations(f,!1);},p=function p(f){return f&&f.length>0&&r.bulkDeleteAnnotations(f);};return{canRedo:function canRedo(){return i.length-1>s;},canUndo:function canUndo(){return s>-1;},destroy:function destroy(){return r.unobserve(a);},getHistory:function getHistory(){return{changes:_toConsumableArray(i),pointer:s};},on:function on(f,m){return e.on(f,m);},redo:function redo(){if(i.length-1>s){n=!0;var _i2=i[s+1],f=_i2.created,m=_i2.updated,y=_i2.deleted;h(f),c(m),p(y),e.emit("redo",i[s+1]),s+=1;}},undo:function undo(){if(s>-1){n=!0;var _i$s=i[s],f=_i$s.created,m=_i$s.updated,y=_i$s.deleted;l(f),u(m),d(y),e.emit("undo",i[s]),s-=1;}}};},Ym=function Ym(r,t,e,i){var s=r.hover,n=r.selection,o=r.store,a=r.viewport,l=new Map();var h=[],u,c;var d=function d(_,v){l.has(_)?l.get(_).push(v):l.set(_,[v]);},p=function p(_,v){var g=l.get(_);if(g){var x=g.indexOf(v);x!==-1&&g.splice(x,1);}},f=function f(_,v,g){l.has(_)&&setTimeout(function(){l.get(_).forEach(function(x){if(e){var b=Array.isArray(v)?v.map(function(w){return e.serialize(w);}):e.serialize(v),S=g?g instanceof PointerEvent?g:e.serialize(g):void 0;x(b,S);}else x(v,g);});},1);},m=function m(){var _=n.selected,v=(_||[]).map(function(_ref13){var g=_ref13.id;return o.getAnnotation(g);});v.forEach(function(g){var x=h.find(function(b){return b.id===g.id;});(!x||!Qr(x,g))&&f("updateAnnotation",g,x);}),h=h.map(function(g){return v.find(function(_ref14){var b=_ref14.id;return b===g.id;})||g;});};n.subscribe(function(_ref15){var _=_ref15.selected;if(!(h.length===0&&_.length===0)){if(h.length===0&&_.length>0)h=_.map(function(_ref16){var v=_ref16.id;return o.getAnnotation(v);});else if(h.length>0&&_.length===0)h.forEach(function(v){var g=o.getAnnotation(v.id);g&&!Qr(g,v)&&f("updateAnnotation",g,v);}),h=[];else{var v=new Set(h.map(function(x){return x.id;})),g=new Set(_.map(function(_ref17){var x=_ref17.id;return x;}));h.filter(function(x){return!g.has(x.id);}).forEach(function(x){var b=o.getAnnotation(x.id);b&&!Qr(b,x)&&f("updateAnnotation",b,x);}),h=[].concat(_toConsumableArray(h.filter(function(x){return g.has(x.id);})),_toConsumableArray(_.filter(function(_ref18){var x=_ref18.id;return!v.has(x);}).map(function(_ref19){var x=_ref19.id;return o.getAnnotation(x);})));}f("selectionChanged",h);}}),s.subscribe(function(_){!u&&_?f("mouseEnterAnnotation",o.getAnnotation(_)):u&&!_?f("mouseLeaveAnnotation",o.getAnnotation(u)):u&&_&&(f("mouseLeaveAnnotation",o.getAnnotation(u)),f("mouseEnterAnnotation",o.getAnnotation(_))),u=_;}),a==null||a.subscribe(function(_){return f("viewportIntersect",_.map(function(v){return o.getAnnotation(v);}));}),o.observe(function(_){i&&(c&&clearTimeout(c),c=setTimeout(m,1e3));var _$changes=_.changes,v=_$changes.created,g=_$changes.deleted;(v||[]).forEach(function(x){return f("createAnnotation",x);}),(g||[]).forEach(function(x){return f("deleteAnnotation",x);}),(_.changes.updated||[]).filter(function(x){return[].concat(_toConsumableArray(x.bodiesCreated||[]),_toConsumableArray(x.bodiesDeleted||[]),_toConsumableArray(x.bodiesUpdated||[])).length>0;}).forEach(function(_ref20){var x=_ref20.oldValue,b=_ref20.newValue;var S=h.find(function(w){return w.id===x.id;})||x;h=h.map(function(w){return w.id===x.id?b:w;}),f("updateAnnotation",b,S);});},{origin:Rr.LOCAL}),o.observe(function(_){if(h){var v=new Set(h.map(function(x){return x.id;})),g=(_.changes.updated||[]).filter(function(_ref21){var x=_ref21.newValue;return v.has(x.id);}).map(function(_ref22){var x=_ref22.newValue;return x;});g.length>0&&(h=h.map(function(x){return g.find(function(S){return S.id===x.id;})||x;}));}},{origin:Rr.REMOTE});var y=function y(_){return function(v){var g=v.updated;_?(g||[]).forEach(function(x){return f("updateAnnotation",x.oldValue,x.newValue);}):(g||[]).forEach(function(x){return f("updateAnnotation",x.newValue,x.oldValue);});};};return t.on("undo",y(!0)),t.on("redo",y(!1)),{on:d,off:p,emit:f};},jm=function jm(r){return function(t){return t.reduce(function(e,i){var _r$parse=r.parse(i),s=_r$parse.parsed,n=_r$parse.error;return n?{parsed:e.parsed,failed:[].concat(_toConsumableArray(e.failed),[i])}:s?{parsed:[].concat(_toConsumableArray(e.parsed),[s]),failed:e.failed}:_objectSpread({},e);},{parsed:[],failed:[]});};},qm=function qm(r,t,e){var i=r.store,s=r.selection,n=function n(_){if(e){var _e$parse=e.parse(_),v=_e$parse.parsed,g=_e$parse.error;v?i.addAnnotation(v,Rr.REMOTE):console.error(g);}else i.addAnnotation(Vo(_),Rr.REMOTE);},o=function o(){return s.clear();},a=function a(){return i.clear();},l=function l(_){var v=i.getAnnotation(_);return e&&v?e.serialize(v):v;},h=function h(){return e?i.all().map(e.serialize):i.all();},u=function u(){var _;var v=(((_=s.selected)==null?void 0:_.map(function(g){return g.id;}))||[]).map(function(g){return i.getAnnotation(g);}).filter(Boolean);return e?v.map(e.serialize):v;},c=function c(_){var v=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!0;return fetch(_).then(function(g){return g.json();}).then(function(g){return p(g,v),g;});},d=function d(_){if(typeof _=="string"){var v=i.getAnnotation(_);if(i.deleteAnnotation(_),v)return e?e.serialize(v):v;}else{var _v2=e?e.parse(_).parsed:_;if(_v2)return i.deleteAnnotation(_v2),_;}},p=function p(_){var v=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!0;if(e){var g=e.parseAll||jm(e),_g2=g(_),x=_g2.parsed,b=_g2.failed;b.length>0&&console.warn("Discarded ".concat(b.length," invalid annotations"),b),i.bulkAddAnnotations(x,v,Rr.REMOTE);}else i.bulkAddAnnotations(_.map(Vo),v,Rr.REMOTE);},f=function f(_,v){_?s.setSelected(_,v):s.clear();},m=function m(_){s.clear(),s.setUserSelectAction(_);},y=function y(_){if(e){var v=e.parse(_).parsed,g=e.serialize(i.getAnnotation(v.id));return i.updateAnnotation(v),g;}else{var _v3=i.getAnnotation(_.id);return i.updateAnnotation(Vo(_)),_v3;}};return{addAnnotation:n,cancelSelected:o,canRedo:t.canRedo,canUndo:t.canUndo,clearAnnotations:a,getAnnotationById:l,getAnnotations:h,getHistory:t.getHistory,getSelected:u,loadAnnotations:c,redo:t.redo,removeAnnotation:d,setAnnotations:p,setSelected:f,setUserSelectAction:m,undo:t.undo,updateAnnotation:y};},Km="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";var Zm=function Zm(r){return crypto.getRandomValues(new Uint8Array(r));},Qm=function Qm(r,t,e){var i=(2<<Math.log2(r.length-1))-1,s=-~(1.6*i*t/r.length);return function(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:t;var o="";for(;;){var a=e(s),l=s|0;for(;l--;)if(o+=r[a[l]&i]||"",o.length>=n)return o;}};},Jm=function Jm(r){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:21;return Qm(r,t|0,Zm);},tg=function tg(){var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:21;var t="",e=crypto.getRandomValues(new Uint8Array(r|=0));for(;r--;)t+=Km[e[r]&63];return t;};var eg=function eg(){return{isGuest:!0,id:Jm("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_",20)()};},rg=["#ff7c00","#1ac938","#e8000b","#8b2be2","#9f4800","#f14cc1","#ffc400","#00d7ff","#023eff"],ig=function ig(){var r=[].concat(rg);return{assignRandomColor:function assignRandomColor(){var t=Math.floor(Math.random()*r.length),e=r[t];return r.splice(t,1),e;},releaseColor:function releaseColor(t){return r.push(t);}};};tg();var sg=Object.defineProperty,ng=function ng(r,t,e){return t in r?sg(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;},Ot=function Ot(r,t,e){return ng(r,_typeof(t)!="symbol"?t+"":t,e);};function Ct(){}function Xo(r,t){for(var e in t)r[e]=t[e];return r;}function Oh(r){return r();}function Nh(){return Object.create(null);}function Ue(r){r.forEach(Oh);}function $t(r){return typeof r=="function";}function te(r,t){return r!=r?t==t:r!==t||r&&_typeof(r)=="object"||typeof r=="function";}function og(r){return Object.keys(r).length===0;}function Dh(r){for(var _len2=arguments.length,t=new Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++){t[_key2-1]=arguments[_key2];}if(r==null){var _iterator=_createForOfIteratorHelper(t),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var i=_step.value;i(void 0);}}catch(err){_iterator.e(err);}finally{_iterator.f();}return Ct;}var e=r.subscribe.apply(r,t);return e.unsubscribe?function(){return e.unsubscribe();}:e;}function zo(r,t,e){r.$$.on_destroy.push(Dh(t,e));}function ag(r,t,e,i){if(r){var s=Lh(r,t,e,i);return r[0](s);}}function Lh(r,t,e,i){return r[1]&&i?Xo(e.ctx.slice(),r[1](i(t))):e.ctx;}function lg(r,t,e,i){if(r[2]&&i){var s=r[2](i(e));if(t.dirty===void 0)return s;if(_typeof(s)=="object"){var n=[],o=Math.max(t.dirty.length,s.length);for(var a=0;a<o;a+=1)n[a]=t.dirty[a]|s[a];return n;}return t.dirty|s;}return t.dirty;}function hg(r,t,e,i,s,n){if(s){var o=Lh(t,e,i,n);r.p(o,s);}}function ug(r){if(r.ctx.length>32){var t=[],e=r.ctx.length/32;for(var i=0;i<e;i++)t[i]=-1;return t;}return-1;}function Bh(r){var t={};for(var e in r)e[0]!=="$"&&(t[e]=r[e]);return t;}function tn(r){return r!==null&&r!==void 0?r:"";}function Oe(r,t){r.appendChild(t);}function ot(r,t,e){r.insertBefore(t,e||null);}function nt(r){r.parentNode&&r.parentNode.removeChild(r);}function Jr(r,t){for(var e=0;e<r.length;e+=1)r[e]&&r[e].d(t);}function mt(r){return document.createElementNS("http://www.w3.org/2000/svg",r);}function Fh(r){return document.createTextNode(r);}function ke(){return Fh(" ");}function Ie(){return Fh("");}function Bt(r,t,e,i){return r.addEventListener(t,e,i),function(){return r.removeEventListener(t,e,i);};}function A(r,t,e){e==null?r.removeAttribute(t):r.getAttribute(t)!==e&&r.setAttribute(t,e);}function cg(r){return Array.from(r.childNodes);}function Mr(r,t,e){r.classList.toggle(t,!!e);}function dg(r,t){var _ref23=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{},_ref23$bubbles=_ref23.bubbles,e=_ref23$bubbles===void 0?!1:_ref23$bubbles,_ref23$cancelable=_ref23.cancelable,i=_ref23$cancelable===void 0?!1:_ref23$cancelable;return new CustomEvent(r,{detail:t,bubbles:e,cancelable:i});}var fs;function ps(r){fs=r;}function Uh(){if(!fs)throw new Error("Function called outside component initialization");return fs;}function ms(r){Uh().$$.on_mount.push(r);}function Si(){var r=Uh();return function(t,e){var _ref24=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{},_ref24$cancelable=_ref24.cancelable,i=_ref24$cancelable===void 0?!1:_ref24$cancelable;var s=r.$$.callbacks[t];if(s){var n=dg(t,e,{cancelable:i});return s.slice().forEach(function(o){o.call(r,n);}),!n.defaultPrevented;}return!0;};}function Ne(r,t){var _this2=this;var e=r.$$.callbacks[t.type];e&&e.slice().forEach(function(i){return i.call(_this2,t);});}var Ci=[],en=[];var Ii=[];var kh=[],fg=Promise.resolve();var Wo=!1;function pg(){Wo||(Wo=!0,fg.then(Gh));}function Yo(r){Ii.push(r);}var jo=new Set();var Ri=0;function Gh(){if(Ri!==0)return;var r=fs;do{try{for(;Ri<Ci.length;){var t=Ci[Ri];Ri++,ps(t),mg(t.$$);}}catch(t){throw Ci.length=0,Ri=0,t;}for(ps(null),Ci.length=0,Ri=0;en.length;)en.pop()();for(var _t2=0;_t2<Ii.length;_t2+=1){var e=Ii[_t2];jo.has(e)||(jo.add(e),e());}Ii.length=0;}while(Ci.length);for(;kh.length;)kh.pop()();Wo=!1,jo.clear(),ps(r);}function mg(r){if(r.fragment!==null){r.update(),Ue(r.before_update);var t=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,t),r.after_update.forEach(Yo);}}function gg(r){var t=[],e=[];Ii.forEach(function(i){return r.indexOf(i)===-1?t.push(i):e.push(i);}),e.forEach(function(i){return i();}),Ii=t;}var rn=new Set();var ti;function xe(){ti={r:0,c:[],p:ti};}function be(){ti.r||Ue(ti.c),ti=ti.p;}function it(r,t){r&&r.i&&(rn["delete"](r),r.i(t));}function dt(r,t,e,i){if(r&&r.o){if(rn.has(r))return;rn.add(r),ti.c.push(function(){rn["delete"](r),i&&(e&&r.d(1),i());}),r.o(t);}else i&&i();}function Ee(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r);}function _e(r){r&&r.c();}function fe(r,t,e){var _r$$$=r.$$,i=_r$$$.fragment,s=_r$$$.after_update;i&&i.m(t,e),Yo(function(){var _r$$$$on_destroy;var n=r.$$.on_mount.map(Oh).filter($t);r.$$.on_destroy?(_r$$$$on_destroy=r.$$.on_destroy).push.apply(_r$$$$on_destroy,_toConsumableArray(n)):Ue(n),r.$$.on_mount=[];}),s.forEach(Yo);}function pe(r,t){var e=r.$$;e.fragment!==null&&(gg(e.after_update),Ue(e.on_destroy),e.fragment&&e.fragment.d(t),e.on_destroy=e.fragment=null,e.ctx=[]);}function yg(r,t){r.$$.dirty[0]===-1&&(Ci.push(r),pg(),r.$$.dirty.fill(0)),r.$$.dirty[t/31|0]|=1<<t%31;}function Te(r,t,e,i,s,n){var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:null;var a=arguments.length>7&&arguments[7]!==undefined?arguments[7]:[-1];var l=fs;ps(r);var h=r.$$={fragment:null,ctx:[],props:n,update:Ct,not_equal:s,bound:Nh(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:Nh(),dirty:a,skip_bound:!1,root:t.target||l.$$.root};o&&o(h.root);var u=!1;if(h.ctx=e?e(r,t.props||{},function(c,d){var f=(arguments.length<=2?0:arguments.length-2)?arguments.length<=2?undefined:arguments[2]:d;return h.ctx&&s(h.ctx[c],h.ctx[c]=f)&&(!h.skip_bound&&h.bound[c]&&h.bound[c](f),u&&yg(r,c)),d;}):[],h.update(),u=!0,Ue(h.before_update),h.fragment=i?i(h.ctx):!1,t.target){if(t.hydrate){var c=cg(t.target);h.fragment&&h.fragment.l(c),c.forEach(nt);}else h.fragment&&h.fragment.c();t.intro&&it(r.$$.fragment),fe(r,t.target,t.anchor),Gh();}ps(l);}var we=/*#__PURE__*/function(){function we(){_classCallCheck(this,we);Ot(this,"$$"),Ot(this,"$$set");}_createClass(we,[{key:"$destroy",value:function $destroy(){pe(this,1),this.$destroy=Ct;}},{key:"$on",value:function $on(t,e){if(!$t(e))return Ct;var i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(e),function(){var s=i.indexOf(e);s!==-1&&i.splice(s,1);};}},{key:"$set",value:function $set(t){this.$$set&&!og(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1);}}]);return we;}();var _g="4";(typeof window==="undefined"?"undefined":_typeof(window))<"u"&&(window.__svelte||(window.__svelte={v:new Set()})).v.add(_g);var vt=function(r){return r.ELLIPSE="ELLIPSE",r.MULTIPOLYGLON="MULTIPOLYGON",r.POLYGON="POLYGON",r.RECTANGLE="RECTANGLE",r;}(vt||{});var qo={},sn=function sn(r,t){return qo[r]=t;},Ko=function Ko(r){return qo[r.type].area(r);},vg=function vg(r,t,e){return qo[r.type].intersects(r,t,e);},_r=function _r(r){var t=1/0,e=1/0,i=-1/0,s=-1/0;return r.forEach(function(_ref25){var _ref26=_slicedToArray(_ref25,2),n=_ref26[0],o=_ref26[1];t=Math.min(t,n),e=Math.min(e,o),i=Math.max(i,n),s=Math.max(s,o);}),{minX:t,minY:e,maxX:i,maxY:s};},Zo=function Zo(r){var t=0,e=r.length-1;for(var i=0;i<r.length;i++)t+=(r[e][0]+r[i][0])*(r[e][1]-r[i][1]),e=i;return Math.abs(.5*t);},Qo=function Qo(r,t,e){var i=!1;for(var s=0,n=r.length-1;s<r.length;n=s++){var o=r[s][0],a=r[s][1],l=r[n][0],h=r[n][1];a>e!=h>e&&t<(l-o)*(e-a)/(h-a)+o&&(i=!i);}return i;},xg=function xg(r){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!0;var e="M ";return r.forEach(function(_ref27,n){var _ref28=_slicedToArray(_ref27,2),i=_ref28[0],s=_ref28[1];n===0?e+="".concat(i,",").concat(s):e+=" L ".concat(i,",").concat(s);}),t&&(e+=" Z"),e;},bg={area:function area(r){return Math.PI*r.geometry.rx*r.geometry.ry;},intersects:function intersects(r,t,e){var _r$geometry=r.geometry,i=_r$geometry.cx,s=_r$geometry.cy,n=_r$geometry.rx,o=_r$geometry.ry,a=0,l=Math.cos(a),h=Math.sin(a),u=t-i,c=e-s,d=l*u+h*c,p=h*u-l*c;return d*d/(n*n)+p*p/(o*o)<=1;}};sn(vt.ELLIPSE,bg);var Eg={area:function area(r){var t=r.geometry.polygons;return t.reduce(function(e,i){var _i$rings=_toArray(i.rings),s=_i$rings[0],n=_i$rings.slice(1),o=Zo(s.points),a=n.reduce(function(l,h){return l+Zo(h.points);},0);return e+o-a;},0);},intersects:function intersects(r,t,e){var i=r.geometry.polygons;var _iterator2=_createForOfIteratorHelper(i),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var s=_step2.value;var _s$rings=_toArray(s.rings),n=_s$rings[0],o=_s$rings.slice(1);if(Qo(n.points,t,e)){var a=!1;var _iterator3=_createForOfIteratorHelper(o),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var l=_step3.value;if(Qo(l.points,t,e)){a=!0;break;}}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}if(!a)return!0;}}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}return!1;}},Tg=function Tg(r){var t=r.reduce(function(e,i){return[].concat(_toConsumableArray(e),_toConsumableArray(i.rings[0].points));},[]);return _r(t);},ei=function ei(r){return r.rings.map(function(t){return xg(t.points);}).join(" ");};sn(vt.MULTIPOLYGLON,Eg);var wg={area:function area(r){var t=r.geometry.points;return Zo(t);},intersects:function intersects(r,t,e){var i=r.geometry.points;return Qo(i,t,e);}};sn(vt.POLYGON,wg);var Ag={area:function area(r){return r.geometry.w*r.geometry.h;},intersects:function intersects(r,t,e){return t>=r.geometry.x&&t<=r.geometry.x+r.geometry.w&&e>=r.geometry.y&&e<=r.geometry.y+r.geometry.h;}};sn(vt.RECTANGLE,Ag);var Ge=function Ge(r){return nn(r.target);},nn=function nn(r){var t,e;return(r==null?void 0:r.annotation)!==void 0&&((e=(t=r==null?void 0:r.selector)==null?void 0:t.geometry)==null?void 0:e.bounds)!==void 0;},Sg=function Sg(r){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!1;var e=typeof r=="string"?r:r.value,i=/(xywh)=(pixel|percent)?:?(.+?),(.+?),(.+?),(.+)*/g,s=_toConsumableArray(e.matchAll(i))[0],_s2=_slicedToArray(s,7),n=_s2[0],o=_s2[1],a=_s2[2],l=_s2[3],h=_s2[4],u=_s2[5],c=_s2[6];if(o!=="xywh")throw new Error("Unsupported MediaFragment: "+e);if(a&&a!=="pixel")throw new Error("Unsupported MediaFragment unit: ".concat(a));var _map=[l,h,u,c].map(parseFloat),_map2=_slicedToArray(_map,4),d=_map2[0],p=_map2[1],f=_map2[2],m=_map2[3];return{type:vt.RECTANGLE,geometry:{x:d,y:p,w:f,h:m,bounds:{minX:d,minY:t?p-m:p,maxX:d+f,maxY:t?p:p+m}}};},Cg=function Cg(r){var t=r.x,e=r.y,i=r.w,s=r.h;return{type:"FragmentSelector",conformsTo:"http://www.w3.org/TR/media-frags/",value:"xywh=pixel:".concat(t,",").concat(e,",").concat(i,",").concat(s)};},$h="http://www.w3.org/2000/svg",Hh=function Hh(r){var t=function t(i){Array.from(i.attributes).forEach(function(s){s.name.startsWith("on")&&i.removeAttribute(s.name);});},e=r.getElementsByTagName("script");return Array.from(e).reverse().forEach(function(i){return i.parentNode.removeChild(i);}),Array.from(r.querySelectorAll("*")).forEach(t),r;},Ig=function Ig(r){var t=new XMLSerializer().serializeToString(r.documentElement).replace("<svg>","<svg xmlns=\"".concat($h,"\">"));return new DOMParser().parseFromString(t,"image/svg+xml").documentElement;},Vh=function Vh(r){var t=new DOMParser().parseFromString(r,"image/svg+xml"),e=t.lookupPrefix($h),i=t.lookupNamespaceURI(null);return e||i?Hh(t).firstChild:Hh(Ig(t)).firstChild;},Xt=" ";function Rg(r){var t="";Array.isArray(r)||(r=[r]);for(var e=0;e<r.length;e++){var i=r[e];if(i.type===B.CLOSE_PATH)t+="z";else if(i.type===B.HORIZ_LINE_TO)t+=(i.relative?"h":"H")+i.x;else if(i.type===B.VERT_LINE_TO)t+=(i.relative?"v":"V")+i.y;else if(i.type===B.MOVE_TO)t+=(i.relative?"m":"M")+i.x+Xt+i.y;else if(i.type===B.LINE_TO)t+=(i.relative?"l":"L")+i.x+Xt+i.y;else if(i.type===B.CURVE_TO)t+=(i.relative?"c":"C")+i.x1+Xt+i.y1+Xt+i.x2+Xt+i.y2+Xt+i.x+Xt+i.y;else if(i.type===B.SMOOTH_CURVE_TO)t+=(i.relative?"s":"S")+i.x2+Xt+i.y2+Xt+i.x+Xt+i.y;else if(i.type===B.QUAD_TO)t+=(i.relative?"q":"Q")+i.x1+Xt+i.y1+Xt+i.x+Xt+i.y;else if(i.type===B.SMOOTH_QUAD_TO)t+=(i.relative?"t":"T")+i.x+Xt+i.y;else if(i.type===B.ARC)t+=(i.relative?"a":"A")+i.rX+Xt+i.rY+Xt+i.xRot+Xt+ +i.lArcFlag+Xt+ +i.sweepFlag+Xt+i.x+Xt+i.y;else throw new Error("Unexpected command type \"".concat(i==null?void 0:i.type,"\" at index ").concat(e,"."));}return t;}function Jo(_ref29,e){var _ref30=_slicedToArray(_ref29,2),r=_ref30[0],t=_ref30[1];return[r*Math.cos(e)-t*Math.sin(e),r*Math.sin(e)+t*Math.cos(e)];}function $e(){for(var _len3=arguments.length,r=new Array(_len3),_key3=0;_key3<_len3;_key3++){r[_key3]=arguments[_key3];}for(var t=0;t<r.length;t++)if(typeof r[t]!="number")throw new Error("assertNumbers arguments[".concat(t,"] is not a number. ").concat(_typeof(r[t])," == typeof ").concat(r[t]));return!0;}var Pr=Math.PI;function ta(r,t,e){r.lArcFlag=r.lArcFlag===0?0:1,r.sweepFlag=r.sweepFlag===0?0:1;var i=r.rX,s=r.rY;var n=r.x,o=r.y;if(Math.abs(i)<1e-10||Math.abs(s)<1e-10){r.rX=0,r.rY=0,r.cX=(t+n)/2,r.cY=(e+o)/2,r.phi1=0,r.phi2=0;return;}i=Math.abs(r.rX),s=Math.abs(r.rY);var a=r.xRot/180*Pr,_Jo=Jo([(t-n)/2,(e-o)/2],-a),_Jo2=_slicedToArray(_Jo,2),l=_Jo2[0],h=_Jo2[1],u=Math.pow(l,2)/Math.pow(i,2)+Math.pow(h,2)/Math.pow(s,2);1<u&&(i*=Math.sqrt(u),s*=Math.sqrt(u)),r.rX=i,r.rY=s;var c=Math.pow(i,2)*Math.pow(h,2)+Math.pow(s,2)*Math.pow(l,2),d=(r.lArcFlag!==r.sweepFlag?1:-1)*Math.sqrt(Math.max(0,(Math.pow(i,2)*Math.pow(s,2)-c)/c)),p=i*h/s*d,f=-s*l/i*d,m=Jo([p,f],a);r.cX=m[0]+(t+n)/2,r.cY=m[1]+(e+o)/2,r.phi1=Math.atan2((h-f)/s,(l-p)/i),r.phi2=Math.atan2((-h-f)/s,(-l-p)/i),r.sweepFlag===0&&r.phi2>r.phi1&&(r.phi2-=2*Pr),r.sweepFlag===1&&r.phi2<r.phi1&&(r.phi2+=2*Pr),r.phi1*=180/Pr,r.phi2*=180/Pr;}function Xh(r,t,e){$e(r,t,e);var i=r*r+t*t-e*e;if(0>i)return[];if(i===0)return[[r*e/(r*r+t*t),t*e/(r*r+t*t)]];var s=Math.sqrt(i);return[[(r*e+t*s)/(r*r+t*t),(t*e-r*s)/(r*r+t*t)],[(r*e-t*s)/(r*r+t*t),(t*e+r*s)/(r*r+t*t)]];}var ri=Math.PI/180;function zh(r,t,e){return(1-e)*r+e*t;}function Wh(r,t,e,i){return r+Math.cos(i/180*Pr)*t+Math.sin(i/180*Pr)*e;}function Yh(r,t,e,i){var s=t-r,n=e-t,o=i-e,a=3*s+3*o-6*n,l=(n-s)*6,h=3*s;return Math.abs(a)<1e-6?Math.abs(l)<1e-6?[]:[-h/l]:Mg(l/a,h/a,1e-6);}function jh(r,t,e,i,s){var n=1-s,o=n*n*n,a=3*n*n*s,l=3*n*s*s,h=s*s*s;return r*o+t*a+e*l+i*h;}function Mg(r,t){var e=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1e-6;var i=r*r/4-t;if(i<-e)return[];if(i<=e)return[-r/2];var s=Math.sqrt(i);return[-(r/2)-s,-(r/2)+s];}function Pg(r,t,e){r.cX||ta(r,t,e);var i=r.xRot/180*Pr;if(Math.abs(r.rX)<1e-10||Math.abs(r.rY)<1e-10)return[{relative:r.relative,type:B.CURVE_TO,x1:t+(r.x-t)/3,y1:e+(r.y-e)/3,x2:t+2*(r.x-t)/3,y2:e+2*(r.y-e)/3,x:r.x,y:r.y}];var s=Math.min(r.phi1,r.phi2),n=Math.max(r.phi1,r.phi2),o=n-s,a=Math.ceil(o/90),l=new Array(a);var h=t,u=e;var c=function c(d,p){var _Jo3=Jo([d*r.rX,p*r.rY],i),_Jo4=_slicedToArray(_Jo3,2),f=_Jo4[0],m=_Jo4[1];return[r.cX+f,r.cY+m];};for(var d=0;d<a;d++){var p=zh(r.phi1,r.phi2,d/a),f=zh(r.phi1,r.phi2,(d+1)/a),m=f-p,y=4/3*Math.tan(m*ri/4),_=Math.cos(p*ri)-y*Math.sin(p*ri),v=Math.sin(p*ri)+y*Math.cos(p*ri),g=Math.cos(f*ri),x=Math.sin(f*ri),b=g+y*x,S=x-y*g,w=c(_,v),T=c(b,S),N=c(g,x),F={relative:r.relative,type:B.CURVE_TO,x:N[0],y:N[1],x1:w[0],y1:w[1],x2:T[0],y2:T[1]};r.relative&&(F.x1-=h,F.y1-=u,F.x2-=h,F.y2-=u,F.x-=h,F.y-=u),h=N[0],u=N[1],l[d]=F;}return l;}function ea(r,t,e){var i=t[0]-r[0],s=t[1]-r[1],n=e[0]-r[0],o=e[1]-r[1],a=i*o-s*n;if(!(Math.abs(a)<1e-10))return!1;var l=i*n+s*o,h=i*i+s*s,u=n*n+o*o;return 0<=l&&l<=u&&h<=u;}function Og(r){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!0;if(r.length<2)return r;var e=zt.INFO(function(n,o,a){var _n$x,_n$y,_n$relative;return _objectSpread(_objectSpread({},n),{},{x:(_n$x=n.x)!==null&&_n$x!==void 0?_n$x:o,y:(_n$y=n.y)!==null&&_n$y!==void 0?_n$y:a,relative:(_n$relative=n.relative)!==null&&_n$relative!==void 0?_n$relative:!1});}),i=[];var s=[];var _iterator4=_createForOfIteratorHelper(r),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var n=_step4.value;var o=e(n);o.type===B.MOVE_TO&&s.length>0&&(t?i.push.apply(i,_toConsumableArray(on(s))):i.unshift.apply(i,_toConsumableArray(on(s))),s=[]),s.push(o);}}catch(err){_iterator4.e(err);}finally{_iterator4.f();}return s.length>0&&(t?i.push.apply(i,_toConsumableArray(on(s))):i.unshift.apply(i,_toConsumableArray(on(s)))),i;}function on(r){var t;var e=((t=r[r.length-1])==null?void 0:t.type)===B.CLOSE_PATH,i=e?r.length-2:r.length-1,s=[{type:B.MOVE_TO,relative:!1,x:r[i].x,y:r[i].y}];for(var n=i;n>0;n--){var o=r[n],a=r[n-1];if(o.relative)throw new Error("Relative command are not supported convert first with `toAbs()`");switch(o.type){case B.HORIZ_LINE_TO:s.push({type:B.HORIZ_LINE_TO,relative:!1,x:a.x});break;case B.VERT_LINE_TO:s.push({type:B.VERT_LINE_TO,relative:!1,y:a.y});break;case B.LINE_TO:case B.MOVE_TO:s.push({type:B.LINE_TO,relative:!1,x:a.x,y:a.y});break;case B.CURVE_TO:s.push({type:B.CURVE_TO,relative:!1,x:a.x,y:a.y,x1:o.x2,y1:o.y2,x2:o.x1,y2:o.y1});break;case B.SMOOTH_CURVE_TO:throw new Error("Unsupported command: S (smooth cubic bezier)");case B.SMOOTH_QUAD_TO:throw new Error("Unsupported command: T (smooth quadratic bezier)");case B.ARC:throw new Error("Unsupported command: A (arc)");case B.QUAD_TO:throw new Error("Unsupported command: Q (quadratic bezier)");}}return e&&s.push({type:B.CLOSE_PATH}),s;}function Ng(){var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1e13;$e(r);function t(e){return Math.round(e*r)/r;}return function(e){return"x1"in e&&_typeof(e.x1)<"u"&&(e.x1=t(e.x1)),"y1"in e&&_typeof(e.y1)<"u"&&(e.y1=t(e.y1)),"x2"in e&&_typeof(e.x2)<"u"&&(e.x2=t(e.x2)),"y2"in e&&_typeof(e.y2)<"u"&&(e.y2=t(e.y2)),"x"in e&&_typeof(e.x)<"u"&&(e.x=t(e.x)),"y"in e&&_typeof(e.y)<"u"&&(e.y=t(e.y)),"rX"in e&&_typeof(e.rX)<"u"&&(e.rX=t(e.rX)),"rY"in e&&_typeof(e.rY)<"u"&&(e.rY=t(e.rY)),e;};}function qh(){return He(function(r,t,e){return r.relative&&(_typeof(r.x1)<"u"&&(r.x1+=t),_typeof(r.y1)<"u"&&(r.y1+=e),_typeof(r.x2)<"u"&&(r.x2+=t),_typeof(r.y2)<"u"&&(r.y2+=e),_typeof(r.x)<"u"&&(r.x+=t),_typeof(r.y)<"u"&&(r.y+=e),r.relative=!1),r;});}function Dg(){return He(function(r,t,e){return r.relative||(_typeof(r.x1)<"u"&&(r.x1-=t),_typeof(r.y1)<"u"&&(r.y1-=e),_typeof(r.x2)<"u"&&(r.x2-=t),_typeof(r.y2)<"u"&&(r.y2-=e),_typeof(r.x)<"u"&&(r.x-=t),_typeof(r.y)<"u"&&(r.y-=e),r.relative=!0),r;});}function Lg(){var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!0;var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!0;var e=arguments.length>2&&arguments[2]!==undefined?arguments[2]:!0;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:!0;return He(function(s,n,o,a,l){if(isNaN(a)&&!(s.type&B.MOVE_TO))throw new Error("path must start with moveto");if(t&&s.type&B.HORIZ_LINE_TO&&(s.type=B.LINE_TO,s.y=s.relative?0:o),e&&s.type&B.VERT_LINE_TO&&(s.type=B.LINE_TO,s.x=s.relative?0:n),r&&s.type&B.CLOSE_PATH&&(s.type=B.LINE_TO,s.x=s.relative?a-n:a,s.y=s.relative?l-o:l),s.type&B.ARC&&(s.rX===0||s.rY===0)&&(s.type=B.LINE_TO,delete s.rX,delete s.rY,delete s.xRot,delete s.lArcFlag,delete s.sweepFlag),i&&s.type&B.QUAD_TO){var h=[n,o],u=s.relative?[n+s.x1,o+s.y1]:[s.x1,s.y1],c=s.relative?[n+s.x,o+s.y]:[s.x,s.y];ea(h,u,c)&&(s.type=B.LINE_TO,delete s.x1,delete s.y1);}if(i&&s.type&B.CURVE_TO){var _h2=[n,o],_u2=s.relative?[n+s.x1,o+s.y1]:[s.x1,s.y1],_c2=s.relative?[n+s.x2,o+s.y2]:[s.x2,s.y2],d=s.relative?[n+s.x,o+s.y]:[s.x,s.y];ea(_h2,_u2,d)&&ea(_h2,_c2,d)&&(s.type=B.LINE_TO,delete s.x1,delete s.y1,delete s.x2,delete s.y2);}return s;});}function Kh(){var r=NaN,t=NaN,e=NaN,i=NaN;return He(function(s,n,o){return s.type&B.SMOOTH_CURVE_TO&&(s.type=B.CURVE_TO,r=isNaN(r)?n:r,t=isNaN(t)?o:t,s.x1=s.relative?n-r:2*n-r,s.y1=s.relative?o-t:2*o-t),s.type&B.CURVE_TO?(r=s.relative?n+s.x2:s.x2,t=s.relative?o+s.y2:s.y2):(r=NaN,t=NaN),s.type&B.SMOOTH_QUAD_TO&&(s.type=B.QUAD_TO,e=isNaN(e)?n:e,i=isNaN(i)?o:i,s.x1=s.relative?n-e:2*n-e,s.y1=s.relative?o-i:2*o-i),s.type&B.QUAD_TO?(e=s.relative?n+s.x1:s.x1,i=s.relative?o+s.y1:s.y1):(e=NaN,i=NaN),s;});}function Zh(){var r=NaN,t=NaN;return He(function(e,i,s){if(e.type&B.SMOOTH_QUAD_TO&&(e.type=B.QUAD_TO,r=isNaN(r)?i:r,t=isNaN(t)?s:t,e.x1=e.relative?i-r:2*i-r,e.y1=e.relative?s-t:2*s-t),e.type&B.QUAD_TO){r=e.relative?i+e.x1:e.x1,t=e.relative?s+e.y1:e.y1;var n=e.x1,o=e.y1;e.type=B.CURVE_TO,e.x1=((e.relative?0:i)+n*2)/3,e.y1=((e.relative?0:s)+o*2)/3,e.x2=(e.x+n*2)/3,e.y2=(e.y+o*2)/3;}else r=NaN,t=NaN;return e;});}function He(r){var t=0,e=0,i=NaN,s=NaN;return function(n){if(isNaN(i)&&!(n.type&B.MOVE_TO))throw new Error("path must start with moveto");var o=r(n,t,e,i,s);return n.type&B.CLOSE_PATH&&(t=i,e=s),"x"in n&&_typeof(n.x)<"u"&&(t=n.relative?t+n.x:n.x),"y"in n&&_typeof(n.y)<"u"&&(e=n.relative?e+n.y:n.y),n.type&B.MOVE_TO&&(i=t,s=e),o;};}function Bg(){var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;$e(r);var t=NaN,e=NaN,i=NaN,s=NaN;return He(function(n,o,a,l,h){var u=Math.abs;var c=!1,d=0,p=0;if(n.type&B.SMOOTH_CURVE_TO&&(d=isNaN(t)?0:o-t,p=isNaN(e)?0:a-e),n.type&(B.CURVE_TO|B.SMOOTH_CURVE_TO)?(t=n.relative?o+n.x2:n.x2,e=n.relative?a+n.y2:n.y2):(t=NaN,e=NaN),n.type&B.SMOOTH_QUAD_TO?(i=isNaN(i)?o:2*o-i,s=isNaN(s)?a:2*a-s):n.type&B.QUAD_TO?(i=n.relative?o+n.x1:n.x1,s=n.relative?a+n.y1:n.y2):(i=NaN,s=NaN),n.type&B.LINE_COMMANDS||n.type&B.ARC&&(n.rX===0||n.rY===0||!n.lArcFlag)||n.type&B.CURVE_TO||n.type&B.SMOOTH_CURVE_TO||n.type&B.QUAD_TO||n.type&B.SMOOTH_QUAD_TO){var f=_typeof(n.x)>"u"?0:n.relative?n.x:n.x-o,m=_typeof(n.y)>"u"?0:n.relative?n.y:n.y-a;d=isNaN(i)?_typeof(n.x1)>"u"?d:n.relative?n.x:n.x1-o:i-o,p=isNaN(s)?_typeof(n.y1)>"u"?p:n.relative?n.y:n.y1-a:s-a;var y=_typeof(n.x2)>"u"?0:n.relative?n.x:n.x2-o,_=_typeof(n.y2)>"u"?0:n.relative?n.y:n.y2-a;u(f)<=r&&u(m)<=r&&u(d)<=r&&u(p)<=r&&u(y)<=r&&u(_)<=r&&(c=!0);}return n.type&B.CLOSE_PATH&&u(o-l)<=r&&u(a-h)<=r&&(c=!0),c?[]:n;});}function Or(r,t,e,i,s,n){return $e(r,t,e,i,s,n),He(function(o,a,l,h){var u=o.x1,c=o.x2,d=o.relative&&!isNaN(h),p=_typeof(o.x)<"u"?o.x:d?0:a,f=_typeof(o.y)<"u"?o.y:d?0:l;o.type&B.HORIZ_LINE_TO&&t!==0&&(o.type=B.LINE_TO,o.y=o.relative?0:l),o.type&B.VERT_LINE_TO&&e!==0&&(o.type=B.LINE_TO,o.x=o.relative?0:a),_typeof(o.x)<"u"&&(o.x=o.x*r+f*e+(d?0:s)),_typeof(o.y)<"u"&&(o.y=p*t+o.y*i+(d?0:n)),_typeof(o.x1)<"u"&&(o.x1=o.x1*r+o.y1*e+(d?0:s)),_typeof(o.y1)<"u"&&(o.y1=u*t+o.y1*i+(d?0:n)),_typeof(o.x2)<"u"&&(o.x2=o.x2*r+o.y2*e+(d?0:s)),_typeof(o.y2)<"u"&&(o.y2=c*t+o.y2*i+(d?0:n));function m(_){return _*_;}var y=r*i-t*e;if(_typeof(o.xRot)<"u"&&(r!==1||t!==0||e!==0||i!==1))if(y===0)delete o.rX,delete o.rY,delete o.xRot,delete o.lArcFlag,delete o.sweepFlag,o.type=B.LINE_TO;else{var _=o.xRot*Math.PI/180,v=Math.sin(_),g=Math.cos(_),x=1/m(o.rX),b=1/m(o.rY),S=m(g)*x+m(v)*b,w=2*v*g*(x-b),T=m(v)*x+m(g)*b,N=S*i*i-w*t*i+T*t*t,F=w*(r*i+t*e)-2*(S*e*i+T*r*t),z=S*e*e-w*r*e+T*r*r,C=(Math.atan2(F,N-z)+Math.PI)%Math.PI/2,E=Math.sin(C),I=Math.cos(C);o.rX=Math.abs(y)/Math.sqrt(N*m(I)+F*E*I+z*m(E)),o.rY=Math.abs(y)/Math.sqrt(N*m(E)-F*E*I+z*m(I)),o.xRot=C*180/Math.PI;}return _typeof(o.sweepFlag)<"u"&&0>y&&(o.sweepFlag=+!o.sweepFlag),o;});}function Fg(r){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var e=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;$e(r,t,e);var i=Math.sin(r),s=Math.cos(r);return Or(s,i,-i,s,t-t*s+e*i,e-t*i-e*s);}function Ug(r){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return $e(r,t),Or(1,0,0,1,r,t);}function kg(r){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:r;return $e(r,t),Or(r,0,0,t,0,0);}function Gg(r){return $e(r),Or(1,0,Math.tan(r),1,0,0);}function $g(r){return $e(r),Or(1,Math.tan(r),0,1,0,0);}function Hg(){var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;return $e(r),Or(-1,0,0,1,r,0);}function Vg(){var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;return $e(r),Or(1,0,0,-1,0,r);}function Xg(){return He(function(r,t,e){return B.ARC===r.type?Pg(r,r.relative?0:t,r.relative?0:e):r;});}function zg(){return He(function(r,t,e){return r.relative&&(t=0,e=0),B.ARC===r.type&&ta(r,t,e),r;});}function Qh(){return function(r){return _objectSpread({},r);};}function Wg(){var r=Qh(),t=qh(),e=Zh(),i=Kh(),s=He(function(n,o,a){var l=i(e(t(r(n))));function h(c){c>s.maxX&&(s.maxX=c),c<s.minX&&(s.minX=c);}function u(c){c>s.maxY&&(s.maxY=c),c<s.minY&&(s.minY=c);}if(l.type&B.DRAWING_COMMANDS&&(h(o),u(a)),l.type&B.HORIZ_LINE_TO&&h(l.x),l.type&B.VERT_LINE_TO&&u(l.y),l.type&B.LINE_TO&&(h(l.x),u(l.y)),l.type&B.CURVE_TO){h(l.x),u(l.y);var c=Yh(o,l.x1,l.x2,l.x);var _iterator5=_createForOfIteratorHelper(c),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var p=_step5.value;0<p&&1>p&&h(jh(o,l.x1,l.x2,l.x,p));}}catch(err){_iterator5.e(err);}finally{_iterator5.f();}var d=Yh(a,l.y1,l.y2,l.y);var _iterator6=_createForOfIteratorHelper(d),_step6;try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var _p2=_step6.value;0<_p2&&1>_p2&&u(jh(a,l.y1,l.y2,l.y,_p2));}}catch(err){_iterator6.e(err);}finally{_iterator6.f();}}if(l.type&B.ARC){h(l.x),u(l.y),ta(l,o,a);var _c3=l.xRot/180*Math.PI,_d2=Math.cos(_c3)*l.rX,_p3=Math.sin(_c3)*l.rX,f=-Math.sin(_c3)*l.rY,m=Math.cos(_c3)*l.rY,_ref31=l.phi1<l.phi2?[l.phi1,l.phi2]:-180>l.phi2?[l.phi2+360,l.phi1+360]:[l.phi2,l.phi1],_ref32=_slicedToArray(_ref31,2),y=_ref32[0],_=_ref32[1],v=function v(_ref33){var _ref34=_slicedToArray(_ref33,2),b=_ref34[0],S=_ref34[1];var w=Math.atan2(S,b)*180/Math.PI;return w<y?w+360:w;},g=Xh(f,-_d2,0).map(v);var _iterator7=_createForOfIteratorHelper(g),_step7;try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){var b=_step7.value;b>y&&b<_&&h(Wh(l.cX,_d2,f,b));}}catch(err){_iterator7.e(err);}finally{_iterator7.f();}var x=Xh(m,-_p3,0).map(v);var _iterator8=_createForOfIteratorHelper(x),_step8;try{for(_iterator8.s();!(_step8=_iterator8.n()).done;){var _b2=_step8.value;_b2>y&&_b2<_&&u(Wh(l.cY,_p3,m,_b2));}}catch(err){_iterator8.e(err);}finally{_iterator8.f();}}return n;});return s.minX=1/0,s.maxX=-1/0,s.minY=1/0,s.maxY=-1/0,s;}var zt={ROUND:Ng,TO_ABS:qh,TO_REL:Dg,NORMALIZE_HVZ:Lg,NORMALIZE_ST:Kh,QT_TO_C:Zh,INFO:He,SANITIZE:Bg,MATRIX:Or,ROTATE:Fg,TRANSLATE:Ug,SCALE:kg,SKEW_X:Gg,SKEW_Y:$g,X_AXIS_SYMMETRY:Hg,Y_AXIS_SYMMETRY:Vg,A_TO_C:Xg,ANNOTATE_ARCS:zg,CLONE:Qh,CALCULATE_BOUNDS:Wg,REVERSE_PATH:Og};var Jh=/*#__PURE__*/function(){function Jh(){_classCallCheck(this,Jh);}_createClass(Jh,[{key:"round",value:function round(t){return this.transform(zt.ROUND(t));}},{key:"toAbs",value:function toAbs(){return this.transform(zt.TO_ABS());}},{key:"toRel",value:function toRel(){return this.transform(zt.TO_REL());}},{key:"normalizeHVZ",value:function normalizeHVZ(t,e,i){return this.transform(zt.NORMALIZE_HVZ(t,e,i));}},{key:"normalizeST",value:function normalizeST(){return this.transform(zt.NORMALIZE_ST());}},{key:"qtToC",value:function qtToC(){return this.transform(zt.QT_TO_C());}},{key:"aToC",value:function aToC(){return this.transform(zt.A_TO_C());}},{key:"sanitize",value:function sanitize(t){return this.transform(zt.SANITIZE(t));}},{key:"translate",value:function translate(t,e){return this.transform(zt.TRANSLATE(t,e));}},{key:"scale",value:function scale(t,e){return this.transform(zt.SCALE(t,e));}},{key:"rotate",value:function rotate(t,e,i){return this.transform(zt.ROTATE(t,e,i));}},{key:"matrix",value:function matrix(t,e,i,s,n,o){return this.transform(zt.MATRIX(t,e,i,s,n,o));}},{key:"skewX",value:function skewX(t){return this.transform(zt.SKEW_X(t));}},{key:"skewY",value:function skewY(t){return this.transform(zt.SKEW_Y(t));}},{key:"xSymmetry",value:function xSymmetry(t){return this.transform(zt.X_AXIS_SYMMETRY(t));}},{key:"ySymmetry",value:function ySymmetry(t){return this.transform(zt.Y_AXIS_SYMMETRY(t));}},{key:"annotateArcs",value:function annotateArcs(){return this.transform(zt.ANNOTATE_ARCS());}}]);return Jh;}();var Yg=function Yg(r){return r===" "||r==="	"||r==="\r"||r==="\n";},tu=function tu(r){return 48<=r.charCodeAt(0)&&r.charCodeAt(0)<=57;};var jg=/*#__PURE__*/function(_Jh){_inherits(jg,_Jh);var _super=_createSuper(jg);function jg(){var _this3;_classCallCheck(this,jg);_this3=_super.call(this),Ot(_assertThisInitialized(_this3),"curNumber",""),Ot(_assertThisInitialized(_this3),"curCommandType",-1),Ot(_assertThisInitialized(_this3),"curCommandRelative",!1),Ot(_assertThisInitialized(_this3),"canParseCommandOrComma",!0),Ot(_assertThisInitialized(_this3),"curNumberHasExp",!1),Ot(_assertThisInitialized(_this3),"curNumberHasExpDigits",!1),Ot(_assertThisInitialized(_this3),"curNumberHasDecimal",!1),Ot(_assertThisInitialized(_this3),"curArgs",[]);return _this3;}_createClass(jg,[{key:"finish",value:function finish(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];if(this.parse(" ",t),this.curArgs.length!==0||!this.canParseCommandOrComma)throw new SyntaxError("Unterminated command at the path end.");return t;}},{key:"parse",value:function parse(t){var _this4=this;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var i=function i(s){e.push(s),_this4.curArgs.length=0,_this4.canParseCommandOrComma=!0;};for(var s=0;s<t.length;s++){var n=t[s],o=this.curCommandType===B.ARC&&(this.curArgs.length===3||this.curArgs.length===4)&&this.curNumber.length===1&&(this.curNumber==="0"||this.curNumber==="1"),a=tu(n)&&(this.curNumber==="0"&&n==="0"||o);if(tu(n)&&!a){this.curNumber+=n,this.curNumberHasExpDigits=this.curNumberHasExp;continue;}if(n==="e"||n==="E"){this.curNumber+=n,this.curNumberHasExp=!0;continue;}if((n==="-"||n==="+")&&this.curNumberHasExp&&!this.curNumberHasExpDigits){this.curNumber+=n;continue;}if(n==="."&&!this.curNumberHasExp&&!this.curNumberHasDecimal&&!o){this.curNumber+=n,this.curNumberHasDecimal=!0;continue;}if(this.curNumber&&this.curCommandType!==-1){var l=Number(this.curNumber);if(isNaN(l))throw new SyntaxError("Invalid number ending at ".concat(s));if(this.curCommandType===B.ARC){if(this.curArgs.length===0||this.curArgs.length===1){if(0>l)throw new SyntaxError("Expected positive number, got \"".concat(l,"\" at index \"").concat(s,"\""));}else if((this.curArgs.length===3||this.curArgs.length===4)&&this.curNumber!=="0"&&this.curNumber!=="1")throw new SyntaxError("Expected a flag, got \"".concat(this.curNumber,"\" at index \"").concat(s,"\""));}this.curArgs.push(l),this.curArgs.length===qg[this.curCommandType]&&(B.HORIZ_LINE_TO===this.curCommandType?i({type:B.HORIZ_LINE_TO,relative:this.curCommandRelative,x:l}):B.VERT_LINE_TO===this.curCommandType?i({type:B.VERT_LINE_TO,relative:this.curCommandRelative,y:l}):this.curCommandType===B.MOVE_TO||this.curCommandType===B.LINE_TO||this.curCommandType===B.SMOOTH_QUAD_TO?(i({type:this.curCommandType,relative:this.curCommandRelative,x:this.curArgs[0],y:this.curArgs[1]}),B.MOVE_TO===this.curCommandType&&(this.curCommandType=B.LINE_TO)):this.curCommandType===B.CURVE_TO?i({type:B.CURVE_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x2:this.curArgs[2],y2:this.curArgs[3],x:this.curArgs[4],y:this.curArgs[5]}):this.curCommandType===B.SMOOTH_CURVE_TO?i({type:B.SMOOTH_CURVE_TO,relative:this.curCommandRelative,x2:this.curArgs[0],y2:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===B.QUAD_TO?i({type:B.QUAD_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===B.ARC&&i({type:B.ARC,relative:this.curCommandRelative,rX:this.curArgs[0],rY:this.curArgs[1],xRot:this.curArgs[2],lArcFlag:this.curArgs[3],sweepFlag:this.curArgs[4],x:this.curArgs[5],y:this.curArgs[6]})),this.curNumber="",this.curNumberHasExpDigits=!1,this.curNumberHasExp=!1,this.curNumberHasDecimal=!1,this.canParseCommandOrComma=!0;}if(!Yg(n)){if(n===","&&this.canParseCommandOrComma){this.canParseCommandOrComma=!1;continue;}if(n==="+"||n==="-"||n==="."){this.curNumber=n,this.curNumberHasDecimal=n===".";continue;}if(a){this.curNumber=n,this.curNumberHasDecimal=!1;continue;}if(this.curArgs.length!==0)throw new SyntaxError("Unterminated command at index ".concat(s,"."));if(!this.canParseCommandOrComma)throw new SyntaxError("Unexpected character \"".concat(n,"\" at index ").concat(s,". Command cannot follow comma"));if(this.canParseCommandOrComma=!1,n==="z"||n==="Z"){e.push({type:B.CLOSE_PATH}),this.canParseCommandOrComma=!0,this.curCommandType=-1;continue;}else if(n==="h"||n==="H")this.curCommandType=B.HORIZ_LINE_TO,this.curCommandRelative=n==="h";else if(n==="v"||n==="V")this.curCommandType=B.VERT_LINE_TO,this.curCommandRelative=n==="v";else if(n==="m"||n==="M")this.curCommandType=B.MOVE_TO,this.curCommandRelative=n==="m";else if(n==="l"||n==="L")this.curCommandType=B.LINE_TO,this.curCommandRelative=n==="l";else if(n==="c"||n==="C")this.curCommandType=B.CURVE_TO,this.curCommandRelative=n==="c";else if(n==="s"||n==="S")this.curCommandType=B.SMOOTH_CURVE_TO,this.curCommandRelative=n==="s";else if(n==="q"||n==="Q")this.curCommandType=B.QUAD_TO,this.curCommandRelative=n==="q";else if(n==="t"||n==="T")this.curCommandType=B.SMOOTH_QUAD_TO,this.curCommandRelative=n==="t";else if(n==="a"||n==="A")this.curCommandType=B.ARC,this.curCommandRelative=n==="a";else throw new SyntaxError("Unexpected character \"".concat(n,"\" at index ").concat(s,"."));}}return e;}},{key:"transform",value:function transform(t){return Object.create(this,{parse:{value:function value(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var s=Object.getPrototypeOf(this).parse.call(this,e);var _iterator9=_createForOfIteratorHelper(s),_step9;try{for(_iterator9.s();!(_step9=_iterator9.n()).done;){var n=_step9.value;var o=t(n);Array.isArray(o)?i.push.apply(i,_toConsumableArray(o)):i.push(o);}}catch(err){_iterator9.e(err);}finally{_iterator9.f();}return i;}}});}}]);return jg;}(Jh);var Mt=/*#__PURE__*/function(_Jh2){_inherits(Th,_Jh2);var _super2=_createSuper(Th);function Th(t){var _this5;_classCallCheck(this,Th);_this5=_super2.call(this),Ot(_assertThisInitialized(_this5),"commands"),typeof t=="string"?_this5.commands=Th.parse(t):_this5.commands=t;return _this5;}_createClass(Th,[{key:"encode",value:function encode(){return Th.encode(this.commands);}},{key:"getBounds",value:function getBounds(){var t=zt.CALCULATE_BOUNDS();return this.transform(t),t;}},{key:"transform",value:function transform(t){var e=[];var _iterator10=_createForOfIteratorHelper(this.commands),_step10;try{for(_iterator10.s();!(_step10=_iterator10.n()).done;){var i=_step10.value;var s=t(i);Array.isArray(s)?e.push.apply(e,_toConsumableArray(s)):e.push(s);}}catch(err){_iterator10.e(err);}finally{_iterator10.f();}return this.commands=e,this;}},{key:"reverse",value:function reverse(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!0;return this.commands=zt.REVERSE_PATH(this.commands,t),this;}}],[{key:"encode",value:function encode(t){return Rg(t);}},{key:"parse",value:function parse(t){var e=new jg(),i=[];return e.parse(t,i),e.finish(i),i;}}]);return Th;}(Jh);Ot(Mt,"CLOSE_PATH",1),Ot(Mt,"MOVE_TO",2),Ot(Mt,"HORIZ_LINE_TO",4),Ot(Mt,"VERT_LINE_TO",8),Ot(Mt,"LINE_TO",16),Ot(Mt,"CURVE_TO",32),Ot(Mt,"SMOOTH_CURVE_TO",64),Ot(Mt,"QUAD_TO",128),Ot(Mt,"SMOOTH_QUAD_TO",256),Ot(Mt,"ARC",512),Ot(Mt,"LINE_COMMANDS",Mt.LINE_TO|Mt.HORIZ_LINE_TO|Mt.VERT_LINE_TO),Ot(Mt,"DRAWING_COMMANDS",Mt.HORIZ_LINE_TO|Mt.VERT_LINE_TO|Mt.LINE_TO|Mt.CURVE_TO|Mt.SMOOTH_CURVE_TO|Mt.QUAD_TO|Mt.SMOOTH_QUAD_TO|Mt.ARC);var B=Mt;var qg=(_qg={},_defineProperty(_qg,B.MOVE_TO,2),_defineProperty(_qg,B.LINE_TO,2),_defineProperty(_qg,B.HORIZ_LINE_TO,1),_defineProperty(_qg,B.VERT_LINE_TO,1),_defineProperty(_qg,B.CLOSE_PATH,0),_defineProperty(_qg,B.QUAD_TO,4),_defineProperty(_qg,B.SMOOTH_QUAD_TO,2),_defineProperty(_qg,B.CURVE_TO,6),_defineProperty(_qg,B.SMOOTH_CURVE_TO,4),_defineProperty(_qg,B.ARC,7),_qg),Kg=function Kg(r){var t=new B(r).toAbs().commands,e=[];var i=[],s=null;var _iterator11=_createForOfIteratorHelper(t),_step11;try{for(_iterator11.s();!(_step11=_iterator11.n()).done;){var _n2=_step11.value;switch(_n2.type){case B.MOVE_TO:i.length>0&&(e.push({points:i}),i=[]),s=[_n2.x,_n2.y],i.push(s);break;case B.LINE_TO:i.push([_n2.x,_n2.y]);break;case B.HORIZ_LINE_TO:var o=i[i.length-1][1];i.push([_n2.x,o]);break;case B.VERT_LINE_TO:var a=i[i.length-1][0];i.push([a,_n2.y]);break;case B.CURVE_TO:case B.SMOOTH_CURVE_TO:case B.QUAD_TO:case B.SMOOTH_QUAD_TO:case B.ARC:i.push([_n2.x,_n2.y]);break;}}}catch(err){_iterator11.e(err);}finally{_iterator11.f();}if(i.length>2&&e.push({points:i}),e.length>0){var n=_r(e[0].points);return{rings:e,bounds:n};}},Zg=function Zg(r){var _ref35=r.match(/(<polygon points=["|'])([^("|')]*)/)||[],_ref36=_slicedToArray(_ref35,3),t=_ref36[0],e=_ref36[1],i=_ref36[2],s=i.split(" ").map(function(n){return n.split(",").map(parseFloat);});return{type:vt.POLYGON,geometry:{points:s,bounds:_r(s)}};},Qg=function Qg(r){var t=Vh(r),e=parseFloat(t.getAttribute("cx")),i=parseFloat(t.getAttribute("cy")),s=parseFloat(t.getAttribute("rx")),n=parseFloat(t.getAttribute("ry")),o={minX:e-s,minY:i-n,maxX:e+s,maxY:i+n};return{type:vt.ELLIPSE,geometry:{cx:e,cy:i,rx:s,ry:n,bounds:o}};},Jg=function Jg(r){var t=Vh(r),e=(t.nodeName==="path"?[t]:Array.from(t.querySelectorAll("path"))).map(function(n){return n.getAttribute("d")||"";}).map(function(n){return Kg(n);}).filter(Boolean),i=e.reduce(function(n,o){return[].concat(_toConsumableArray(n),_toConsumableArray(o.rings[0].points));},[]),s=_r(i);return e.length===1&&e[0].rings.length===1?{type:vt.POLYGON,geometry:{points:i,bounds:s}}:{type:vt.MULTIPOLYGLON,geometry:{polygons:e,bounds:s}};},ty=function ty(r){var t=typeof r=="string"?r:r.value;if(t.includes("<polygon points="))return Zg(t);if(t.includes("<path "))return Jg(t);if(t.includes("<ellipse "))return Qg(t);throw"Unsupported SVG shape: "+t;},ey=function ey(r){return"<g>".concat(r.polygons.map(function(t){return"<path fill-rule=\"evenodd\" d=\"".concat(ei(t),"\" />");}).join(""),"</g>");},ry=function ry(r){var t;if(r.type===vt.POLYGON){var e=r.geometry,i=e.points;t="<svg><polygon points=\"".concat(i.map(function(s){return s.join(",");}).join(" "),"\" /></svg>");}else if(r.type===vt.ELLIPSE){var _e2=r.geometry;t="<svg><ellipse cx=\"".concat(_e2.cx,"\" cy=\"").concat(_e2.cy,"\" rx=\"").concat(_e2.rx,"\" ry=\"").concat(_e2.ry,"\" /></svg>");}else if(r.type===vt.MULTIPOLYGLON){var _e3=r.geometry;t="<svg>".concat(ey(_e3),"</svg>");}if(t)return{type:"SvgSelector",value:t};throw"Unsupported shape type: ".concat(r.type);},ae=[];for(var _r2=0;_r2<256;++_r2)ae.push((_r2+256).toString(16).slice(1));function iy(r){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return(ae[r[t+0]]+ae[r[t+1]]+ae[r[t+2]]+ae[r[t+3]]+"-"+ae[r[t+4]]+ae[r[t+5]]+"-"+ae[r[t+6]]+ae[r[t+7]]+"-"+ae[r[t+8]]+ae[r[t+9]]+"-"+ae[r[t+10]]+ae[r[t+11]]+ae[r[t+12]]+ae[r[t+13]]+ae[r[t+14]]+ae[r[t+15]]).toLowerCase();}var ra;var sy=new Uint8Array(16);function ny(){if(!ra){if((typeof crypto==="undefined"?"undefined":_typeof(crypto))>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ra=crypto.getRandomValues.bind(crypto);}return ra(sy);}var oy=(typeof crypto==="undefined"?"undefined":_typeof(crypto))<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),eu={randomUUID:oy};function ru(r,t,e){var _ref37,_r$random2;var i;if(eu.randomUUID&&!r)return eu.randomUUID();r=r||{};var s=(_ref37=(_r$random2=r.random)!==null&&_r$random2!==void 0?_r$random2:(i=r.rng)==null?void 0:i.call(r))!==null&&_ref37!==void 0?_ref37:ny();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,iy(s);}var iu=Object.prototype.hasOwnProperty;function Nr(r,t){var e,i;if(r===t)return!0;if(r&&t&&(e=r.constructor)===t.constructor){if(e===Date)return r.getTime()===t.getTime();if(e===RegExp)return r.toString()===t.toString();if(e===Array){if((i=r.length)===t.length)for(;i--&&Nr(r[i],t[i]););return i===-1;}if(!e||_typeof(r)=="object"){i=0;for(e in r)if(iu.call(r,e)&&++i&&!iu.call(t,e)||!(e in t)||!Nr(r[e],t[e]))return!1;return Object.keys(t).length===i;}}return r!==r&&t!==t;}function ia(){}function ay(r,t){return r!=r?t==t:r!==t||r&&_typeof(r)=="object"||typeof r=="function";}var Mi=[];function sa(r){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:ia;var e;var i=new Set();function s(a){if(ay(r,a)&&(r=a,e)){var l=!Mi.length;var _iterator12=_createForOfIteratorHelper(i),_step12;try{for(_iterator12.s();!(_step12=_iterator12.n()).done;){var _h3=_step12.value;_h3[1](),Mi.push(_h3,r);}}catch(err){_iterator12.e(err);}finally{_iterator12.f();}if(l){for(var h=0;h<Mi.length;h+=2)Mi[h][0](Mi[h+1]);Mi.length=0;}}}function n(a){s(a(r));}function o(a){var l=arguments.length>1&&arguments[1]!==undefined?arguments[1]:ia;var h=[a,l];return i.add(h),i.size===1&&(e=t(s,n)||ia),a(r),function(){i["delete"](h),i.size===0&&e&&(e(),e=null);};}return{set:s,update:n,subscribe:o};}var ly=function ly(r){var _sa=sa(),t=_sa.subscribe,e=_sa.set;var i;return t(function(s){return i=s;}),r.observe(function(_ref38){var s=_ref38.changes;if(i){(s.deleted||[]).some(function(o){return o.id===i;})&&e(void 0);var n=(s.updated||[]).find(function(_ref39){var o=_ref39.oldValue;return o.id===i;});n&&e(n.newValue.id);}}),{get current(){return i;},subscribe:t,set:e};};var su=function(r){return r.EDIT="EDIT",r.SELECT="SELECT",r.NONE="NONE",r;}(su||{});var an={selected:[]},hy=function hy(r,t,e){var _sa2=sa(an),i=_sa2.subscribe,s=_sa2.set;var n=t,o=an;i(function(f){return o=f;});var a=function a(){Nr(o,an)||s(an);},l=function l(){var f;return((f=o.selected)==null?void 0:f.length)===0;},h=function h(f){if(l())return!1;var m=typeof f=="string"?f:f.id;return o.selected.some(function(y){return y.id===m;});},u=function u(f,m){var y;if(Array.isArray(f)){if(y=f.map(function(v){return r.getAnnotation(v);}).filter(Boolean),y.length<f.length){console.warn("Invalid selection: "+f.filter(function(v){return!y.some(function(g){return g.id===v;});}));return;}}else{var v=r.getAnnotation(f);if(!v){console.warn("Invalid selection: "+f);return;}y=[v];}var _=y.reduce(function(v,g){var x=nu(g,n,e);return x==="EDIT"?[].concat(_toConsumableArray(v),[{id:g.id,editable:!0}]):x==="SELECT"?[].concat(_toConsumableArray(v),[{id:g.id}]):v;},[]);s({selected:_,event:m});},c=function c(f,m){var y=Array.isArray(f)?f:[f],_=y.map(function(v){return r.getAnnotation(v);}).filter(function(v){return!!v;});s({selected:_.map(function(v){var g=m===void 0?nu(v,n,e)==="EDIT":m;return{id:v.id,editable:g};})}),_.length!==y.length&&console.warn("Invalid selection",f);},d=function d(f){if(l())return!1;var _o2=o,m=_o2.selected;m.some(function(_ref40){var y=_ref40.id;return f.includes(y);})&&s({selected:m.filter(function(_ref41){var y=_ref41.id;return!f.includes(y);})});},p=function p(f){n=f,c(o.selected.map(function(_ref42){var m=_ref42.id;return m;}));};return r.observe(function(_ref43){var f=_ref43.changes;return d((f.deleted||[]).map(function(m){return m.id;}));}),{get event(){return o?o.event:null;},get selected(){return o?_toConsumableArray(o.selected):null;},get userSelectAction(){return n;},clear:a,isEmpty:l,isSelected:h,setSelected:c,setUserSelectAction:p,subscribe:i,userSelect:u};},nu=function nu(r,t,e){var i=e?e.serialize(r):r;return typeof t=="function"?t(i):t||"EDIT";},le=[];for(var _r3=0;_r3<256;++_r3)le.push((_r3+256).toString(16).slice(1));function uy(r){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return(le[r[t+0]]+le[r[t+1]]+le[r[t+2]]+le[r[t+3]]+"-"+le[r[t+4]]+le[r[t+5]]+"-"+le[r[t+6]]+le[r[t+7]]+"-"+le[r[t+8]]+le[r[t+9]]+"-"+le[r[t+10]]+le[r[t+11]]+le[r[t+12]]+le[r[t+13]]+le[r[t+14]]+le[r[t+15]]).toLowerCase();}var na;var cy=new Uint8Array(16);function dy(){if(!na){if((typeof crypto==="undefined"?"undefined":_typeof(crypto))>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");na=crypto.getRandomValues.bind(crypto);}return na(cy);}var fy=(typeof crypto==="undefined"?"undefined":_typeof(crypto))<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ou={randomUUID:fy};function py(r,t,e){var _ref44,_r$random3;var i;if(ou.randomUUID&&!r)return ou.randomUUID();r=r||{};var s=(_ref44=(_r$random3=r.random)!==null&&_r$random3!==void 0?_r$random3:(i=r.rng)==null?void 0:i.call(r))!==null&&_ref44!==void 0?_ref44:dy();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,uy(s);}var oa=function oa(r){var t=function t(e){var i=_objectSpread({},e);return e.created&&typeof e.created=="string"&&(i.created=new Date(e.created)),e.updated&&typeof e.updated=="string"&&(i.updated=new Date(e.updated)),i;};return _objectSpread(_objectSpread({},r),{},{bodies:(r.bodies||[]).map(t),target:t(r.target)});},my=function my(r,t){var e=new Set(r.bodies.map(function(i){return i.id;}));return t.bodies.filter(function(i){return!e.has(i.id);});},gy=function gy(r,t){var e=new Set(t.bodies.map(function(i){return i.id;}));return r.bodies.filter(function(i){return!e.has(i.id);});},yy=function yy(r,t){return t.bodies.map(function(e){var i=r.bodies.find(function(s){return s.id===e.id;});return{newBody:e,oldBody:i&&!Nr(i,e)?i:void 0};}).filter(function(_ref45){var e=_ref45.oldBody;return e;}).map(function(_ref46){var e=_ref46.oldBody,i=_ref46.newBody;return{oldBody:e,newBody:i};});},_y=function _y(r,t){return!Nr(r.target,t.target);},au=function au(r,t){var e=my(r,t),i=gy(r,t),s=yy(r,t);return{oldValue:r,newValue:t,bodiesCreated:e.length>0?e:void 0,bodiesDeleted:i.length>0?i:void 0,bodiesUpdated:s.length>0?s:void 0,targetUpdated:_y(r,t)?{oldTarget:r.target,newTarget:t.target}:void 0};};var It=function(r){return r.LOCAL="LOCAL",r.REMOTE="REMOTE",r.SILENT="SILENT",r;}(It||{});var vy=function vy(r,t){var e,i;var s=t.changes,n=t.origin;if(!(r.options.origin?r.options.origin===n:n!=="SILENT"))return!1;if(r.options.ignore){var o=r.options.ignore,a=function a(l){return l&&l.length>0;};if(!(a(s.created)||a(s.deleted))){var l=(e=s.updated)==null?void 0:e.some(function(u){return a(u.bodiesCreated)||a(u.bodiesDeleted)||a(u.bodiesUpdated);}),h=(i=s.updated)==null?void 0:i.some(function(u){return u.targetUpdated;});if(o==="BODY_ONLY"&&l&&!h||o==="TARGET_ONLY"&&h&&!l)return!1;}}if(r.options.annotations){var _o3=new Set([].concat(_toConsumableArray((s.created||[]).map(function(a){return a.id;})),_toConsumableArray((s.deleted||[]).map(function(a){return a.id;})),_toConsumableArray((s.updated||[]).map(function(_ref47){var a=_ref47.oldValue;return a.id;}))));return!!(Array.isArray(r.options.annotations)?r.options.annotations:[r.options.annotations]).find(function(a){return _o3.has(a);});}else return!0;},xy=function xy(r,t){var e=new Set((r.created||[]).map(function(c){return c.id;})),i=new Set((r.updated||[]).map(function(_ref48){var c=_ref48.newValue;return c.id;})),s=new Set((t.created||[]).map(function(c){return c.id;})),n=new Set((t.deleted||[]).map(function(c){return c.id;})),o=new Set((t.updated||[]).map(function(_ref49){var c=_ref49.oldValue;return c.id;})),a=new Set((t.updated||[]).filter(function(_ref50){var c=_ref50.oldValue;return e.has(c.id)||i.has(c.id);}).map(function(_ref51){var c=_ref51.oldValue;return c.id;})),l=[].concat(_toConsumableArray((r.created||[]).filter(function(c){return!n.has(c.id);}).map(function(c){return o.has(c.id)?t.updated.find(function(_ref52){var d=_ref52.oldValue;return d.id===c.id;}).newValue:c;})),_toConsumableArray(t.created||[])),h=[].concat(_toConsumableArray((r.deleted||[]).filter(function(c){return!s.has(c.id);})),_toConsumableArray((t.deleted||[]).filter(function(c){return!e.has(c.id);}))),u=[].concat(_toConsumableArray((r.updated||[]).filter(function(_ref53){var c=_ref53.newValue;return!n.has(c.id);}).map(function(c){var d=c.oldValue,p=c.newValue;if(o.has(p.id)){var f=t.updated.find(function(m){return m.oldValue.id===p.id;}).newValue;return au(d,f);}else return c;})),_toConsumableArray((t.updated||[]).filter(function(_ref54){var c=_ref54.oldValue;return!a.has(c.id);})));return{created:l,deleted:h,updated:u};},ln=function ln(r){var t=r.id===void 0?py():r.id;return _objectSpread(_objectSpread({},r),{},{id:t,bodies:r.bodies===void 0?[]:r.bodies.map(function(e){return _objectSpread(_objectSpread({},e),{},{annotation:t});}),target:_objectSpread(_objectSpread({},r.target),{},{annotation:t})});},by=function by(r){return r.id!==void 0;},Ey=function Ey(){var r=new Map(),t=new Map(),e=[],i=function i(C){var E=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};e.push({onChange:C,options:E});},s=function s(C){var E=e.findIndex(function(I){return I.onChange==C;});E>-1&&e.splice(E,1);},n=function n(C,E){var I={origin:C,changes:{created:E.created||[],updated:E.updated||[],deleted:E.deleted||[]},state:_toConsumableArray(r.values())};e.forEach(function(P){vy(P,I)&&P.onChange(I);});},o=function o(C){var E=arguments.length>1&&arguments[1]!==undefined?arguments[1]:It.LOCAL;if(C.id&&r.get(C.id))throw Error("Cannot add annotation ".concat(C.id," - exists already"));{var I=ln(C);r.set(I.id,I),I.bodies.forEach(function(P){return t.set(P.id,I.id);}),n(E,{created:[I]});}},a=function a(C,E){var I=ln(typeof C=="string"?E:C),P=typeof C=="string"?C:C.id,$=P&&r.get(P);if($){var k=au($,I);return P===I.id?r.set(P,I):(r["delete"](P),r.set(I.id,I)),$.bodies.forEach(function(G){return t["delete"](G.id);}),I.bodies.forEach(function(G){return t.set(G.id,I.id);}),k;}else console.warn("Cannot update annotation ".concat(P," - does not exist"));},l=function l(C){var E=arguments.length>1&&arguments[1]!==undefined?arguments[1]:It.LOCAL;var I=arguments.length>2&&arguments[2]!==undefined?arguments[2]:It.LOCAL;var P=by(E)?I:E,$=a(C,E);$&&n(P,{updated:[$]});},h=function h(C){var E=arguments.length>1&&arguments[1]!==undefined?arguments[1]:It.LOCAL;r.get(C.id)?l(C,E):o(C,E);},u=function u(C){var E=arguments.length>1&&arguments[1]!==undefined?arguments[1]:It.LOCAL;var I=C.reduce(function(P,$){var k=a($);return k?[].concat(_toConsumableArray(P),[k]):P;},[]);I.length>0&&n(E,{updated:I});},c=function c(C){var E=arguments.length>1&&arguments[1]!==undefined?arguments[1]:It.LOCAL;var I=C.map(ln),_I$reduce=I.reduce(function(G,st){return r.get(st.id)?_objectSpread(_objectSpread({},G),{},{toUpdate:[].concat(_toConsumableArray(G.toUpdate),[st])}):_objectSpread(_objectSpread({},G),{},{toAdd:[].concat(_toConsumableArray(G.toAdd),[st])});},{toAdd:[],toUpdate:[]}),P=_I$reduce.toAdd,$=_I$reduce.toUpdate,k=$.map(function(G){return a(G,E);}).filter(Boolean);P.forEach(function(G){r.set(G.id,G),G.bodies.forEach(function(st){return t.set(st.id,G.id);});}),n(E,{created:P,updated:k});},d=function d(C){var E=arguments.length>1&&arguments[1]!==undefined?arguments[1]:It.LOCAL;var I=r.get(C.annotation);if(I){var P=_objectSpread(_objectSpread({},I),{},{bodies:[].concat(_toConsumableArray(I.bodies),[C])});r.set(I.id,P),t.set(C.id,P.id),n(E,{updated:[{oldValue:I,newValue:P,bodiesCreated:[C]}]});}else console.warn("Attempt to add body to missing annotation: ".concat(C.annotation));},p=function p(){return _toConsumableArray(r.values());},f=function f(){var C=arguments.length>0&&arguments[0]!==undefined?arguments[0]:It.LOCAL;var E=_toConsumableArray(r.values());r.clear(),t.clear(),n(C,{deleted:E});},m=function m(C){var E=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!0;var I=arguments.length>2&&arguments[2]!==undefined?arguments[2]:It.LOCAL;var P=C.map(ln);if(E){var $=_toConsumableArray(r.values());r.clear(),t.clear(),P.forEach(function(k){r.set(k.id,k),k.bodies.forEach(function(G){return t.set(G.id,k.id);});}),n(I,{created:P,deleted:$});}else{var _$=C.reduce(function(k,G){var st=G.id&&r.get(G.id);return st?[].concat(_toConsumableArray(k),[st]):k;},[]);if(_$.length>0)throw Error("Bulk insert would overwrite the following annotations: ".concat(_$.map(function(k){return k.id;}).join(", ")));P.forEach(function(k){r.set(k.id,k),k.bodies.forEach(function(G){return t.set(G.id,k.id);});}),n(I,{created:P});}},y=function y(C){var E=typeof C=="string"?C:C.id,I=r.get(E);if(I)return r["delete"](E),I.bodies.forEach(function(P){return t["delete"](P.id);}),I;console.warn("Attempt to delete missing annotation: ".concat(E));},_=function _(C){var E=arguments.length>1&&arguments[1]!==undefined?arguments[1]:It.LOCAL;var I=y(C);I&&n(E,{deleted:[I]});},v=function v(C){var E=arguments.length>1&&arguments[1]!==undefined?arguments[1]:It.LOCAL;var I=C.reduce(function(P,$){var k=y($);return k?[].concat(_toConsumableArray(P),[k]):P;},[]);I.length>0&&n(E,{deleted:I});},g=function g(C){var E=r.get(C.annotation);if(E){var I=E.bodies.find(function(P){return P.id===C.id;});if(I){t["delete"](I.id);var P=_objectSpread(_objectSpread({},E),{},{bodies:E.bodies.filter(function($){return $.id!==C.id;})});return r.set(E.id,P),{oldValue:E,newValue:P,bodiesDeleted:[I]};}else console.warn("Attempt to delete missing body ".concat(C.id," from annotation ").concat(C.annotation));}else console.warn("Attempt to delete body from missing annotation ".concat(C.annotation));},x=function x(C){var E=arguments.length>1&&arguments[1]!==undefined?arguments[1]:It.LOCAL;var I=g(C);I&&n(E,{updated:[I]});},b=function b(C){var E=arguments.length>1&&arguments[1]!==undefined?arguments[1]:It.LOCAL;var I=C.map(function(P){return g(P);}).filter(Boolean);I.length>0&&n(E,{updated:I});},S=function S(C){var E=r.get(C);return E?_objectSpread({},E):void 0;},w=function w(C){var E=t.get(C);if(E){var I=S(E).bodies.find(function(P){return P.id===C;});if(I)return I;console.error("Store integrity error: body ".concat(C," in index, but not in annotation"));}else console.warn("Attempt to retrieve missing body: ".concat(C));},T=function T(C,E){if(C.annotation!==E.annotation)throw"Annotation integrity violation: annotation ID must be the same when updating bodies";var I=r.get(C.annotation);if(I){var P=I.bodies.find(function(k){return k.id===C.id;}),$=_objectSpread(_objectSpread({},I),{},{bodies:I.bodies.map(function(k){return k.id===P.id?E:k;})});return r.set(I.id,$),P.id!==E.id&&(t["delete"](P.id),t.set(E.id,$.id)),{oldValue:I,newValue:$,bodiesUpdated:[{oldBody:P,newBody:E}]};}else console.warn("Attempt to add body to missing annotation ".concat(C.annotation));},N=function N(C,E){var I=arguments.length>2&&arguments[2]!==undefined?arguments[2]:It.LOCAL;var P=T(C,E);P&&n(I,{updated:[P]});},F=function F(C){var E=arguments.length>1&&arguments[1]!==undefined?arguments[1]:It.LOCAL;var I=C.map(function(P){return T({id:P.id,annotation:P.annotation},P);}).filter(Boolean);n(E,{updated:I});},z=function z(C){var E=r.get(C.annotation);if(E){var I=_objectSpread(_objectSpread({},E),{},{target:_objectSpread(_objectSpread({},E.target),C)});return r.set(E.id,I),{oldValue:E,newValue:I,targetUpdated:{oldTarget:E.target,newTarget:C}};}else console.warn("Attempt to update target on missing annotation: ".concat(C.annotation));};return{addAnnotation:o,addBody:d,all:p,bulkAddAnnotations:m,bulkDeleteAnnotations:v,bulkDeleteBodies:b,bulkUpdateAnnotations:u,bulkUpdateBodies:F,bulkUpdateTargets:function bulkUpdateTargets(C){var E=arguments.length>1&&arguments[1]!==undefined?arguments[1]:It.LOCAL;var I=C.map(function(P){return z(P);}).filter(Boolean);I.length>0&&n(E,{updated:I});},bulkUpsertAnnotations:c,clear:f,deleteAnnotation:_,deleteBody:x,getAnnotation:S,getBody:w,observe:i,unobserve:s,updateAnnotation:l,updateBody:N,updateTarget:function updateTarget(C){var E=arguments.length>1&&arguments[1]!==undefined?arguments[1]:It.LOCAL;var I=z(C);I&&n(E,{updated:[I]});},upsertAnnotation:h};},Ty=function Ty(r){return _objectSpread(_objectSpread({},r),{},{subscribe:function subscribe(t){var e=function e(i){return t(i.state);};return r.observe(e),t(r.all()),function(){return r.unobserve(e);};}});};var wy=function wy(){return{emit:function emit(r){for(var _len4=arguments.length,t=new Array(_len4>1?_len4-1:0),_key4=1;_key4<_len4;_key4++){t[_key4-1]=arguments[_key4];}for(var e=this.events[r]||[],i=0,s=e.length;i<s;i++)e[i].apply(e,t);},events:{},on:function on(r,t){var _this6=this;var e;return((e=this.events)[r]||(e[r]=[])).push(t),function(){var i;_this6.events[r]=(i=_this6.events[r])==null?void 0:i.filter(function(s){return t!==s;});};}};};var Ay=250,Sy=function Sy(r,t){var e=wy(),i=(t==null?void 0:t.changes)||[];var s=t?t.pointer:-1,n=!1,o=0;var a=function a(f){if(!n){var m=f.changes,y=performance.now();if(y-o>Ay)i.splice(s+1),i.push(m),s=i.length-1;else{var _=i.length-1;i[_]=xy(i[_],m);}o=y;}n=!1;};r.observe(a,{origin:It.LOCAL});var l=function l(f){return f&&f.length>0&&r.bulkDeleteAnnotations(f);},h=function h(f){return f&&f.length>0&&r.bulkAddAnnotations(f,!1);},u=function u(f){return f&&f.length>0&&r.bulkUpdateAnnotations(f.map(function(_ref55){var m=_ref55.oldValue;return m;}));},c=function c(f){return f&&f.length>0&&r.bulkUpdateAnnotations(f.map(function(_ref56){var m=_ref56.newValue;return m;}));},d=function d(f){return f&&f.length>0&&r.bulkAddAnnotations(f,!1);},p=function p(f){return f&&f.length>0&&r.bulkDeleteAnnotations(f);};return{canRedo:function canRedo(){return i.length-1>s;},canUndo:function canUndo(){return s>-1;},destroy:function destroy(){return r.unobserve(a);},getHistory:function getHistory(){return{changes:_toConsumableArray(i),pointer:s};},on:function on(f,m){return e.on(f,m);},redo:function redo(){if(i.length-1>s){n=!0;var _i3=i[s+1],f=_i3.created,m=_i3.updated,y=_i3.deleted;h(f),c(m),p(y),e.emit("redo",i[s+1]),s+=1;}},undo:function undo(){if(s>-1){n=!0;var _i$s2=i[s],f=_i$s2.created,m=_i$s2.updated,y=_i$s2.deleted;l(f),u(m),d(y),e.emit("undo",i[s]),s-=1;}}};},Cy=function Cy(){var _sa3=sa([]),r=_sa3.subscribe,t=_sa3.set;return{subscribe:r,set:t};},Iy=function Iy(r,t,e,i){var s=r.hover,n=r.selection,o=r.store,a=r.viewport,l=new Map();var h=[],u,c;var d=function d(_,v){l.has(_)?l.get(_).push(v):l.set(_,[v]);},p=function p(_,v){var g=l.get(_);if(g){var x=g.indexOf(v);x!==-1&&g.splice(x,1);}},f=function f(_,v,g){l.has(_)&&setTimeout(function(){l.get(_).forEach(function(x){if(e){var b=Array.isArray(v)?v.map(function(w){return e.serialize(w);}):e.serialize(v),S=g?g instanceof PointerEvent?g:e.serialize(g):void 0;x(b,S);}else x(v,g);});},1);},m=function m(){var _=n.selected,v=(_||[]).map(function(_ref57){var g=_ref57.id;return o.getAnnotation(g);});v.forEach(function(g){var x=h.find(function(b){return b.id===g.id;});(!x||!Nr(x,g))&&f("updateAnnotation",g,x);}),h=h.map(function(g){return v.find(function(_ref58){var x=_ref58.id;return x===g.id;})||g;});};n.subscribe(function(_ref59){var _=_ref59.selected;if(!(h.length===0&&_.length===0)){if(h.length===0&&_.length>0)h=_.map(function(_ref60){var v=_ref60.id;return o.getAnnotation(v);});else if(h.length>0&&_.length===0)h.forEach(function(v){var g=o.getAnnotation(v.id);g&&!Nr(g,v)&&f("updateAnnotation",g,v);}),h=[];else{var v=new Set(h.map(function(x){return x.id;})),g=new Set(_.map(function(_ref61){var x=_ref61.id;return x;}));h.filter(function(x){return!g.has(x.id);}).forEach(function(x){var b=o.getAnnotation(x.id);b&&!Nr(b,x)&&f("updateAnnotation",b,x);}),h=[].concat(_toConsumableArray(h.filter(function(x){return g.has(x.id);})),_toConsumableArray(_.filter(function(_ref62){var x=_ref62.id;return!v.has(x);}).map(function(_ref63){var x=_ref63.id;return o.getAnnotation(x);})));}f("selectionChanged",h);}}),s.subscribe(function(_){!u&&_?f("mouseEnterAnnotation",o.getAnnotation(_)):u&&!_?f("mouseLeaveAnnotation",o.getAnnotation(u)):u&&_&&(f("mouseLeaveAnnotation",o.getAnnotation(u)),f("mouseEnterAnnotation",o.getAnnotation(_))),u=_;}),a==null||a.subscribe(function(_){return f("viewportIntersect",_.map(function(v){return o.getAnnotation(v);}));}),o.observe(function(_){i&&(c&&clearTimeout(c),c=setTimeout(m,1e3));var _$changes2=_.changes,v=_$changes2.created,g=_$changes2.deleted;(v||[]).forEach(function(x){return f("createAnnotation",x);}),(g||[]).forEach(function(x){return f("deleteAnnotation",x);}),(_.changes.updated||[]).filter(function(x){return[].concat(_toConsumableArray(x.bodiesCreated||[]),_toConsumableArray(x.bodiesDeleted||[]),_toConsumableArray(x.bodiesUpdated||[])).length>0;}).forEach(function(_ref64){var x=_ref64.oldValue,b=_ref64.newValue;var S=h.find(function(w){return w.id===x.id;})||x;h=h.map(function(w){return w.id===x.id?b:w;}),f("updateAnnotation",b,S);});},{origin:It.LOCAL}),o.observe(function(_){if(h){var v=new Set(h.map(function(x){return x.id;})),g=(_.changes.updated||[]).filter(function(_ref65){var x=_ref65.newValue;return v.has(x.id);}).map(function(_ref66){var x=_ref66.newValue;return x;});g.length>0&&(h=h.map(function(x){return g.find(function(b){return b.id===x.id;})||x;}));}},{origin:It.REMOTE});var y=function y(_){return function(v){var g=v.updated;_?(g||[]).forEach(function(x){return f("updateAnnotation",x.oldValue,x.newValue);}):(g||[]).forEach(function(x){return f("updateAnnotation",x.newValue,x.oldValue);});};};return t.on("undo",y(!0)),t.on("redo",y(!1)),{on:d,off:p,emit:f};},Ry=function Ry(r){return function(t){return t.reduce(function(e,i){var _r$parse2=r.parse(i),s=_r$parse2.parsed,n=_r$parse2.error;return n?{parsed:e.parsed,failed:[].concat(_toConsumableArray(e.failed),[i])}:s?{parsed:[].concat(_toConsumableArray(e.parsed),[s]),failed:e.failed}:_objectSpread({},e);},{parsed:[],failed:[]});};},My=function My(r,t,e){var i=r.store,s=r.selection,n=function n(_){if(e){var _e$parse2=e.parse(_),v=_e$parse2.parsed,g=_e$parse2.error;v?i.addAnnotation(v,It.REMOTE):console.error(g);}else i.addAnnotation(oa(_),It.REMOTE);},o=function o(){return s.clear();},a=function a(){return i.clear();},l=function l(_){var v=i.getAnnotation(_);return e&&v?e.serialize(v):v;},h=function h(){return e?i.all().map(e.serialize):i.all();},u=function u(){var _;var v=(((_=s.selected)==null?void 0:_.map(function(g){return g.id;}))||[]).map(function(g){return i.getAnnotation(g);}).filter(Boolean);return e?v.map(e.serialize):v;},c=function c(_){var v=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!0;return fetch(_).then(function(g){return g.json();}).then(function(g){return p(g,v),g;});},d=function d(_){if(typeof _=="string"){var v=i.getAnnotation(_);if(i.deleteAnnotation(_),v)return e?e.serialize(v):v;}else{var _v4=e?e.parse(_).parsed:_;if(_v4)return i.deleteAnnotation(_v4),_;}},p=function p(_){var v=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!0;if(e){var g=e.parseAll||Ry(e),_g3=g(_),x=_g3.parsed,b=_g3.failed;b.length>0&&console.warn("Discarded ".concat(b.length," invalid annotations"),b),i.bulkAddAnnotations(x,v,It.REMOTE);}else i.bulkAddAnnotations(_.map(oa),v,It.REMOTE);},f=function f(_,v){_?s.setSelected(_,v):s.clear();},m=function m(_){s.clear(),s.setUserSelectAction(_);},y=function y(_){if(e){var v=e.parse(_).parsed,g=e.serialize(i.getAnnotation(v.id));return i.updateAnnotation(v),g;}else{var _v5=i.getAnnotation(_.id);return i.updateAnnotation(oa(_)),_v5;}};return{addAnnotation:n,cancelSelected:o,canRedo:t.canRedo,canUndo:t.canUndo,clearAnnotations:a,getAnnotationById:l,getAnnotations:h,getHistory:t.getHistory,getSelected:u,loadAnnotations:c,redo:t.redo,removeAnnotation:d,setAnnotations:p,setSelected:f,setUserSelectAction:m,undo:t.undo,updateAnnotation:y};},Py=function Py(r,t,e){return typeof t=="function"?t(r,e):t;},Oy=function Oy(r,t){return typeof r!="function"&&typeof t!="function"?_objectSpread(_objectSpread({},r||{}),t||{}):function(e,i){var s=typeof r=="function"?r(e,i):r,n=typeof t=="function"?t(e,i):t;return _objectSpread(_objectSpread({},s||{}),n||{});};},Ny="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";var Dy=function Dy(r){return crypto.getRandomValues(new Uint8Array(r));},Ly=function Ly(r,t,e){var i=(2<<Math.log2(r.length-1))-1,s=-~(1.6*i*t/r.length);return function(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:t;var o="";for(;;){var a=e(s),l=s|0;for(;l--;)if(o+=r[a[l]&i]||"",o.length>=n)return o;}};},By=function By(r){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:21;return Ly(r,t|0,Dy);},Fy=function Fy(){var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:21;var t="",e=crypto.getRandomValues(new Uint8Array(r|=0));for(;r--;)t+=Ny[e[r]&63];return t;};var Uy=function Uy(){return{isGuest:!0,id:By("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_",20)()};},ky=function ky(r){var t=JSON.stringify(r);var e=0;for(var i=0,s=t.length;i<s;i++){var n=t.charCodeAt(i);e=(e<<5)-e+n,e|=0;}return"".concat(e);},lu=function lu(r){return r?_typeof(r)=="object"?_objectSpread({},r):r:void 0;},Gy=function Gy(r,t){return(Array.isArray(r)?r:[r]).map(function(e){var i=e.id,s=e.type,n=e.purpose,o=e.value,a=e.created,l=e.modified,h=e.creator,u=_objectWithoutProperties(e,_excluded);return _objectSpread({id:i||"temp-".concat(ky(e)),annotation:t,type:s,purpose:n,value:o,creator:lu(h),created:a?new Date(a):void 0,updated:l?new Date(l):void 0},u);});},$y=function $y(r){return r.map(function(t){var e;var i=t.annotation,s=t.created,n=t.updated,o=_objectWithoutProperties(t,_excluded2),a=_objectSpread(_objectSpread({},o),{},{created:s==null?void 0:s.toISOString(),modified:n==null?void 0:n.toISOString()});return(e=a.id)!=null&&e.startsWith("temp-")&&delete a.id,a;});};Fy();var Hy=function Hy(r){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{strict:!0,invertY:!1};return{parse:function parse(e){return Vy(e,t);},serialize:function serialize(e){return Xy(e,r,t);}};},Vy=function Vy(r){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{strict:!0,invertY:!1};var e=r.id||ru(),i=r.creator,s=r.created,n=r.modified,o=r.body,a=_objectWithoutProperties(r,_excluded3),l=Gy(o||[],e),h=Array.isArray(r.target)?r.target[0]:r.target,u=typeof h=="string"?h:Array.isArray(h.selector)?h.selector[0]:h.selector,c=typeof u=="string"||(u==null?void 0:u.type)==="FragmentSelector"?Sg(u,t.invertY):(u==null?void 0:u.type)==="SvgSelector"?ty(u):void 0;return c||!t.strict?{parsed:_objectSpread(_objectSpread({},a),{},{id:e,bodies:l,target:_objectSpread(_objectSpread({created:s?new Date(s):void 0,creator:lu(i),updated:n?new Date(n):void 0},Array.isArray(a.target)?a.target[0]:a.target),{},{annotation:e,selector:c||u})})}:{error:Error("Invalid selector: ".concat(JSON.stringify(u)))};},Xy=function Xy(r,t){var e=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{strict:!0,invertY:!1};var _r$target=r.target,i=_r$target.selector,s=_r$target.creator,n=_r$target.created,o=_r$target.updated,a=_r$target.updatedBy,l=_objectWithoutProperties(_r$target,_excluded4);var h;try{h=i.type==vt.RECTANGLE?Cg(i.geometry):ry(i);}catch(c){if(e.strict)throw c;h=i;}var u=_objectSpread(_objectSpread({},r),{},{"@context":"http://www.w3.org/ns/anno.jsonld",id:r.id,type:"Annotation",body:$y(r.bodies),created:n==null?void 0:n.toISOString(),creator:s,modified:o==null?void 0:o.toISOString(),target:_objectSpread(_objectSpread({},l),{},{source:t,selector:h})});return delete u.bodies,"annotation"in u.target&&delete u.target.annotation,u;};function hu(r,t,e){var i=r.slice();return i[10]=t[e],i[12]=e,i;}function uu(r){var t,e;return t=new Oi({props:{x:r[10][0],y:r[10][1],scale:r[3]}}),t.$on("pointerdown",function(){$t(r[9]("HANDLE-".concat(r[12])))&&r[9]("HANDLE-".concat(r[12])).apply(this,arguments);}),{c:function c(){_e(t.$$.fragment);},m:function m(i,s){fe(t,i,s),e=!0;},p:function p(i,s){r=i;var n={};s&16&&(n.x=r[10][0]),s&16&&(n.y=r[10][1]),s&8&&(n.scale=r[3]),t.$set(n);},i:function i(_i4){e||(it(t.$$.fragment,_i4),e=!0);},o:function o(i){dt(t.$$.fragment,i),e=!1;},d:function d(i){pe(t,i);}};}function zy(r){var t,e,i,s,n,o,a,l,h,u,c,d=Ee(r[4].points),_p4=[];for(var m=0;m<d.length;m+=1)_p4[m]=uu(hu(r,d,m));var f=function f(m){return dt(_p4[m],1,1,function(){_p4[m]=null;});};return{c:function c(){t=mt("polygon"),s=ke(),n=mt("polygon"),a=ke();for(var _m2=0;_m2<_p4.length;_m2+=1)_p4[_m2].c();l=Ie(),A(t,"class","a9s-outer"),A(t,"style",e=r[1]?"display:none;":void 0),A(t,"points",i=r[4].points.map(cu).join(" ")),A(n,"class","a9s-inner a9s-shape-handle"),A(n,"style",r[1]),A(n,"points",o=r[4].points.map(du).join(" "));},m:function m(_m3,y){ot(_m3,t,y),ot(_m3,s,y),ot(_m3,n,y),ot(_m3,a,y);for(var _=0;_<_p4.length;_+=1)_p4[_]&&_p4[_].m(_m3,y);ot(_m3,l,y),h=!0,u||(c=[Bt(t,"pointerdown",function(){$t(r[9]("SHAPE"))&&r[9]("SHAPE").apply(this,arguments);}),Bt(n,"pointerdown",function(){$t(r[9]("SHAPE"))&&r[9]("SHAPE").apply(this,arguments);})],u=!0);},p:function p(m,y){if(r=m,(!h||y&2&&e!==(e=r[1]?"display:none;":void 0))&&A(t,"style",e),(!h||y&16&&i!==(i=r[4].points.map(cu).join(" ")))&&A(t,"points",i),(!h||y&2)&&A(n,"style",r[1]),(!h||y&16&&o!==(o=r[4].points.map(du).join(" ")))&&A(n,"points",o),y&536){d=Ee(r[4].points);var _;for(_=0;_<d.length;_+=1){var v=hu(r,d,_);_p4[_]?(_p4[_].p(v,y),it(_p4[_],1)):(_p4[_]=uu(v),_p4[_].c(),it(_p4[_],1),_p4[_].m(l.parentNode,l));}for(xe(),_=d.length;_<_p4.length;_+=1)f(_);be();}},i:function i(m){if(!h){for(var y=0;y<d.length;y+=1)it(_p4[y]);h=!0;}},o:function o(m){_p4=_p4.filter(Boolean);for(var y=0;y<_p4.length;y+=1)dt(_p4[y]);h=!1;},d:function d(m){m&&(nt(t),nt(s),nt(n),nt(a),nt(l)),Jr(_p4,m),u=!1,Ue(c);}};}function Wy(r){var t,e;return t=new la({props:{shape:r[0],transform:r[2],editor:r[5],$$slots:{"default":[zy,function(_ref67){var i=_ref67.grab;return{9:i};},function(_ref68){var i=_ref68.grab;return i?512:0;}]},$$scope:{ctx:r}}}),t.$on("change",r[6]),t.$on("grab",r[7]),t.$on("release",r[8]),{c:function c(){_e(t.$$.fragment);},m:function m(i,s){fe(t,i,s),e=!0;},p:function p(i,_ref69){var _ref70=_slicedToArray(_ref69,1),s=_ref70[0];var n={};s&1&&(n.shape=i[0]),s&4&&(n.transform=i[2]),s&8730&&(n.$$scope={dirty:s,ctx:i}),t.$set(n);},i:function i(_i5){e||(it(t.$$.fragment,_i5),e=!0);},o:function o(i){dt(t.$$.fragment,i),e=!1;},d:function d(i){pe(t,i);}};}var cu=function cu(r){return r.join(",");},du=function du(r){return r.join(",");};function Yy(r,t,e){var i,s=t.shape,n=t.computedStyle,o=t.transform,_t$viewportScale=t.viewportScale,a=_t$viewportScale===void 0?1:_t$viewportScale;var l=function l(d,p,f){var m;var y=d.geometry;p==="SHAPE"?m=y.points.map(function(_ref71){var _ref72=_slicedToArray(_ref71,2),v=_ref72[0],g=_ref72[1];return[v+f[0],g+f[1]];}):m=y.points.map(function(_ref73,x){var _ref74=_slicedToArray(_ref73,2),v=_ref74[0],g=_ref74[1];return p==="HANDLE-".concat(x)?[v+f[0],g+f[1]]:[v,g];});var _=_r(m);return _objectSpread(_objectSpread({},d),{},{geometry:{points:m,bounds:_}});};function h(d){Ne.call(this,r,d);}function u(d){Ne.call(this,r,d);}function c(d){Ne.call(this,r,d);}return r.$$set=function(d){"shape"in d&&e(0,s=d.shape),"computedStyle"in d&&e(1,n=d.computedStyle),"transform"in d&&e(2,o=d.transform),"viewportScale"in d&&e(3,a=d.viewportScale);},r.$$.update=function(){r.$$.dirty&1&&e(4,i=s.geometry);},[s,n,o,a,i,l,h,u,c];}var jy=/*#__PURE__*/function(_we){_inherits(jy,_we);var _super3=_createSuper(jy);function jy(t){var _this7;_classCallCheck(this,jy);_this7=_super3.call(this),Te(_assertThisInitialized(_this7),t,Yy,Wy,te,{shape:0,computedStyle:1,transform:2,viewportScale:3});return _this7;}return _createClass(jy);}(we);var aa=function aa(r,t){var e=Math.abs(t[0]-r[0]),i=Math.abs(t[1]-r[1]);return Math.sqrt(Math.pow(e,2)+Math.pow(i,2));},Pi=[];function qy(r){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Ct;var e;var i=new Set();function s(a){if(te(r,a)&&(r=a,e)){var l=!Pi.length;var _iterator13=_createForOfIteratorHelper(i),_step13;try{for(_iterator13.s();!(_step13=_iterator13.n()).done;){var _h4=_step13.value;_h4[1](),Pi.push(_h4,r);}}catch(err){_iterator13.e(err);}finally{_iterator13.f();}if(l){for(var h=0;h<Pi.length;h+=2)Pi[h][0](Pi[h+1]);Pi.length=0;}}}function n(a){s(a(r));}function o(a){var l=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Ct;var h=[a,l];return i.add(h),i.size===1&&(e=t(s,n)||Ct),a(r),function(){i["delete"](h),i.size===0&&e&&(e(),e=null);};}return{set:s,update:n,subscribe:o};}var Ky=function Ky(r,t){var e=r.naturalWidth,i=r.naturalHeight;if(!e&&!i){var s=r.width,n=r.height;t.setAttribute("viewBox","0 0 ".concat(s," ").concat(n)),r.addEventListener("load",function(o){var a=o.target;t.setAttribute("viewBox","0 0 ".concat(a.naturalWidth," ").concat(a.naturalHeight));});}else t.setAttribute("viewBox","0 0 ".concat(e," ").concat(i));},Zy=function Zy(r,t){Ky(r,t);var _qy=qy(1),e=_qy.subscribe,i=_qy.set;var s;return window.ResizeObserver&&(s=new ResizeObserver(function(){var n=t.getBoundingClientRect(),_t$viewBox$baseVal=t.viewBox.baseVal,o=_t$viewBox$baseVal.width,a=_t$viewBox$baseVal.height,l=Math.max(n.width/o,n.height/a);i(l);}),s.observe(t.parentElement)),{destroy:function destroy(){s&&s.disconnect();},subscribe:e};},fu=(typeof window==="undefined"?"undefined":_typeof(window))>"u"||(typeof navigator==="undefined"?"undefined":_typeof(navigator))>"u"?!1:"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;function Qy(r){var t,e,i,s,n,o;return{c:function c(){t=mt("rect"),A(t,"class",e=tn("a9s-handle ".concat(r[8]["class"]||"").trim())+" svelte-1sgkh33"),A(t,"x",i=r[0]-r[5]/2),A(t,"y",s=r[1]-r[5]/2),A(t,"width",r[5]),A(t,"height",r[5]);},m:function m(a,l){ot(a,t,l),n||(o=Bt(t,"pointerdown",r[11]),n=!0);},p:function p(a,l){l&256&&e!==(e=tn("a9s-handle ".concat(a[8]["class"]||"").trim())+" svelte-1sgkh33")&&A(t,"class",e),l&33&&i!==(i=a[0]-a[5]/2)&&A(t,"x",i),l&34&&s!==(s=a[1]-a[5]/2)&&A(t,"y",s),l&32&&A(t,"width",a[5]),l&32&&A(t,"height",a[5]);},d:function d(a){a&&nt(t),n=!1,o();}};}function Jy(r){var t,e,i,s,n,o,a,l,h;return{c:function c(){t=mt("g"),e=mt("circle"),s=mt("rect"),A(e,"cx",r[0]),A(e,"cy",r[1]),A(e,"r",i=r[3]/r[2]),A(e,"class","a9s-touch-halo svelte-1sgkh33"),Mr(e,"touched",r[4]),A(s,"class",n=tn("a9s-handle ".concat(r[8]["class"]||"").trim())+" svelte-1sgkh33"),A(s,"x",o=r[0]-r[5]/2),A(s,"y",a=r[1]-r[5]/2),A(s,"width",r[5]),A(s,"height",r[5]),A(t,"class","a9s-touch-handle");},m:function m(u,c){ot(u,t,c),Oe(t,e),Oe(t,s),l||(h=[Bt(e,"pointerdown",r[10]),Bt(e,"pointerdown",r[6]),Bt(e,"pointerup",r[7]),Bt(s,"pointerdown",r[9]),Bt(s,"pointerdown",r[6]),Bt(s,"pointerup",r[7])],l=!0);},p:function p(u,c){c&1&&A(e,"cx",u[0]),c&2&&A(e,"cy",u[1]),c&12&&i!==(i=u[3]/u[2])&&A(e,"r",i),c&16&&Mr(e,"touched",u[4]),c&256&&n!==(n=tn("a9s-handle ".concat(u[8]["class"]||"").trim())+" svelte-1sgkh33")&&A(s,"class",n),c&33&&o!==(o=u[0]-u[5]/2)&&A(s,"x",o),c&34&&a!==(a=u[1]-u[5]/2)&&A(s,"y",a),c&32&&A(s,"width",u[5]),c&32&&A(s,"height",u[5]);},d:function d(u){u&&nt(t),l=!1,Ue(h);}};}function t_(r){var t;function e(s,n){return fu?Jy:Qy;}var i=e()(r);return{c:function c(){i.c(),t=Ie();},m:function m(s,n){i.m(s,n),ot(s,t,n);},p:function p(s,_ref75){var _ref76=_slicedToArray(_ref75,1),n=_ref76[0];i.p(s,n);},i:Ct,o:Ct,d:function d(s){s&&nt(t),i.d(s);}};}function e_(r,t,e){var i,_t3=t,s=_t3.x,_t4=t,n=_t4.y,_t5=t,o=_t5.scale,_t6=t,_t6$radius=_t6.radius,a=_t6$radius===void 0?30:_t6$radius,l=!1;var h=function h(f){f.pointerType==="touch"&&e(4,l=!0);},u=function u(){return e(4,l=!1);};function c(f){Ne.call(this,r,f);}function d(f){Ne.call(this,r,f);}function p(f){Ne.call(this,r,f);}return r.$$set=function(f){e(8,t=Xo(Xo({},t),Bh(f))),"x"in f&&e(0,s=f.x),"y"in f&&e(1,n=f.y),"scale"in f&&e(2,o=f.scale),"radius"in f&&e(3,a=f.radius);},r.$$.update=function(){r.$$.dirty&4&&e(5,i=10/o);},t=Bh(t),[s,n,o,a,l,i,h,u,t,c,d,p];}var Oi=/*#__PURE__*/function(_we2){_inherits(Oi,_we2);var _super4=_createSuper(Oi);function Oi(t){var _this8;_classCallCheck(this,Oi);_this8=_super4.call(this),Te(_assertThisInitialized(_this8),t,e_,t_,te,{x:0,y:1,scale:2,radius:3});return _this8;}return _createClass(Oi);}(we);function r_(r){var t,e,i,s,n,o,a,l,h,u,_c4,d,p,f,m,y,_,v,g,x,b,S,w,T,N,F,z,C,E,I,P,$,k,G,st,M,L,V,rt,Q,X,_t,St;return G=new Oi({props:{"class":"a9s-corner-handle-topleft",x:r[4].x,y:r[4].y,scale:r[3]}}),G.$on("pointerdown",function(){$t(r[9]("TOP_LEFT"))&&r[9]("TOP_LEFT").apply(this,arguments);}),M=new Oi({props:{"class":"a9s-corner-handle-topright",x:r[4].x+r[4].w,y:r[4].y,scale:r[3]}}),M.$on("pointerdown",function(){$t(r[9]("TOP_RIGHT"))&&r[9]("TOP_RIGHT").apply(this,arguments);}),V=new Oi({props:{"class":"a9s-corner-handle-bottomright",x:r[4].x+r[4].w,y:r[4].y+r[4].h,scale:r[3]}}),V.$on("pointerdown",function(){$t(r[9]("BOTTOM_RIGHT"))&&r[9]("BOTTOM_RIGHT").apply(this,arguments);}),Q=new Oi({props:{"class":"a9s-corner-handle-bottomleft",x:r[4].x,y:r[4].y+r[4].h,scale:r[3]}}),Q.$on("pointerdown",function(){$t(r[9]("BOTTOM_LEFT"))&&r[9]("BOTTOM_LEFT").apply(this,arguments);}),{c:function c(){t=mt("rect"),a=ke(),l=mt("rect"),p=ke(),f=mt("rect"),v=ke(),g=mt("rect"),w=ke(),T=mt("rect"),C=ke(),E=mt("rect"),k=ke(),_e(G.$$.fragment),st=ke(),_e(M.$$.fragment),L=ke(),_e(V.$$.fragment),rt=ke(),_e(Q.$$.fragment),A(t,"class","a9s-outer"),A(t,"style",e=r[1]?"display:none;":void 0),A(t,"x",i=r[4].x),A(t,"y",s=r[4].y),A(t,"width",n=r[4].w),A(t,"height",o=r[4].h),A(l,"class","a9s-inner a9s-shape-handle"),A(l,"style",r[1]),A(l,"x",h=r[4].x),A(l,"y",u=r[4].y),A(l,"width",_c4=r[4].w),A(l,"height",d=r[4].h),A(f,"class","a9s-edge-handle a9s-edge-handle-top"),A(f,"x",m=r[4].x),A(f,"y",y=r[4].y),A(f,"height",1),A(f,"width",_=r[4].w),A(g,"class","a9s-edge-handle a9s-edge-handle-right"),A(g,"x",x=r[4].x+r[4].w),A(g,"y",b=r[4].y),A(g,"height",S=r[4].h),A(g,"width",1),A(T,"class","a9s-edge-handle a9s-edge-handle-bottom"),A(T,"x",N=r[4].x),A(T,"y",F=r[4].y+r[4].h),A(T,"height",1),A(T,"width",z=r[4].w),A(E,"class","a9s-edge-handle a9s-edge-handle-left"),A(E,"x",I=r[4].x),A(E,"y",P=r[4].y),A(E,"height",$=r[4].h),A(E,"width",1);},m:function m(O,D){ot(O,t,D),ot(O,a,D),ot(O,l,D),ot(O,p,D),ot(O,f,D),ot(O,v,D),ot(O,g,D),ot(O,w,D),ot(O,T,D),ot(O,C,D),ot(O,E,D),ot(O,k,D),fe(G,O,D),ot(O,st,D),fe(M,O,D),ot(O,L,D),fe(V,O,D),ot(O,rt,D),fe(Q,O,D),X=!0,_t||(St=[Bt(t,"pointerdown",function(){$t(r[9]("SHAPE"))&&r[9]("SHAPE").apply(this,arguments);}),Bt(l,"pointerdown",function(){$t(r[9]("SHAPE"))&&r[9]("SHAPE").apply(this,arguments);}),Bt(f,"pointerdown",function(){$t(r[9]("TOP"))&&r[9]("TOP").apply(this,arguments);}),Bt(g,"pointerdown",function(){$t(r[9]("RIGHT"))&&r[9]("RIGHT").apply(this,arguments);}),Bt(T,"pointerdown",function(){$t(r[9]("BOTTOM"))&&r[9]("BOTTOM").apply(this,arguments);}),Bt(E,"pointerdown",function(){$t(r[9]("LEFT"))&&r[9]("LEFT").apply(this,arguments);})],_t=!0);},p:function p(O,D){r=O,(!X||D&2&&e!==(e=r[1]?"display:none;":void 0))&&A(t,"style",e),(!X||D&16&&i!==(i=r[4].x))&&A(t,"x",i),(!X||D&16&&s!==(s=r[4].y))&&A(t,"y",s),(!X||D&16&&n!==(n=r[4].w))&&A(t,"width",n),(!X||D&16&&o!==(o=r[4].h))&&A(t,"height",o),(!X||D&2)&&A(l,"style",r[1]),(!X||D&16&&h!==(h=r[4].x))&&A(l,"x",h),(!X||D&16&&u!==(u=r[4].y))&&A(l,"y",u),(!X||D&16&&_c4!==(_c4=r[4].w))&&A(l,"width",_c4),(!X||D&16&&d!==(d=r[4].h))&&A(l,"height",d),(!X||D&16&&m!==(m=r[4].x))&&A(f,"x",m),(!X||D&16&&y!==(y=r[4].y))&&A(f,"y",y),(!X||D&16&&_!==(_=r[4].w))&&A(f,"width",_),(!X||D&16&&x!==(x=r[4].x+r[4].w))&&A(g,"x",x),(!X||D&16&&b!==(b=r[4].y))&&A(g,"y",b),(!X||D&16&&S!==(S=r[4].h))&&A(g,"height",S),(!X||D&16&&N!==(N=r[4].x))&&A(T,"x",N),(!X||D&16&&F!==(F=r[4].y+r[4].h))&&A(T,"y",F),(!X||D&16&&z!==(z=r[4].w))&&A(T,"width",z),(!X||D&16&&I!==(I=r[4].x))&&A(E,"x",I),(!X||D&16&&P!==(P=r[4].y))&&A(E,"y",P),(!X||D&16&&$!==($=r[4].h))&&A(E,"height",$);var ut={};D&16&&(ut.x=r[4].x),D&16&&(ut.y=r[4].y),D&8&&(ut.scale=r[3]),G.$set(ut);var lt={};D&16&&(lt.x=r[4].x+r[4].w),D&16&&(lt.y=r[4].y),D&8&&(lt.scale=r[3]),M.$set(lt);var Et={};D&16&&(Et.x=r[4].x+r[4].w),D&16&&(Et.y=r[4].y+r[4].h),D&8&&(Et.scale=r[3]),V.$set(Et);var Tt={};D&16&&(Tt.x=r[4].x),D&16&&(Tt.y=r[4].y+r[4].h),D&8&&(Tt.scale=r[3]),Q.$set(Tt);},i:function i(O){X||(it(G.$$.fragment,O),it(M.$$.fragment,O),it(V.$$.fragment,O),it(Q.$$.fragment,O),X=!0);},o:function o(O){dt(G.$$.fragment,O),dt(M.$$.fragment,O),dt(V.$$.fragment,O),dt(Q.$$.fragment,O),X=!1;},d:function d(O){O&&(nt(t),nt(a),nt(l),nt(p),nt(f),nt(v),nt(g),nt(w),nt(T),nt(C),nt(E),nt(k),nt(st),nt(L),nt(rt)),pe(G,O),pe(M,O),pe(V,O),pe(Q,O),_t=!1,Ue(St);}};}function i_(r){var t,e;return t=new la({props:{shape:r[0],transform:r[2],editor:r[5],$$slots:{"default":[r_,function(_ref77){var i=_ref77.grab;return{9:i};},function(_ref78){var i=_ref78.grab;return i?512:0;}]},$$scope:{ctx:r}}}),t.$on("grab",r[6]),t.$on("change",r[7]),t.$on("release",r[8]),{c:function c(){_e(t.$$.fragment);},m:function m(i,s){fe(t,i,s),e=!0;},p:function p(i,_ref79){var _ref80=_slicedToArray(_ref79,1),s=_ref80[0];var n={};s&1&&(n.shape=i[0]),s&4&&(n.transform=i[2]),s&1562&&(n.$$scope={dirty:s,ctx:i}),t.$set(n);},i:function i(_i6){e||(it(t.$$.fragment,_i6),e=!0);},o:function o(i){dt(t.$$.fragment,i),e=!1;},d:function d(i){pe(t,i);}};}function s_(r,t,e){var i,s=t.shape,n=t.computedStyle,o=t.transform,_t$viewportScale2=t.viewportScale,a=_t$viewportScale2===void 0?1:_t$viewportScale2;var l=function l(d,p,f){var m=d.geometry.bounds;var _ref81=[m.minX,m.minY],y=_ref81[0],_=_ref81[1],_ref82=[m.maxX,m.maxY],v=_ref82[0],g=_ref82[1];var _f2=_slicedToArray(f,2),x=_f2[0],b=_f2[1];if(p==="SHAPE")y+=x,v+=x,_+=b,g+=b;else{switch(p){case"TOP":case"TOP_LEFT":case"TOP_RIGHT":{_+=b;break;}case"BOTTOM":case"BOTTOM_LEFT":case"BOTTOM_RIGHT":{g+=b;break;}}switch(p){case"LEFT":case"TOP_LEFT":case"BOTTOM_LEFT":{y+=x;break;}case"RIGHT":case"TOP_RIGHT":case"BOTTOM_RIGHT":{v+=x;break;}}}var S=Math.min(y,v),w=Math.min(_,g),T=Math.abs(v-y),N=Math.abs(g-_);return _objectSpread(_objectSpread({},d),{},{geometry:{x:S,y:w,w:T,h:N,bounds:{minX:S,minY:w,maxX:S+T,maxY:w+N}}});};function h(d){Ne.call(this,r,d);}function u(d){Ne.call(this,r,d);}function c(d){Ne.call(this,r,d);}return r.$$set=function(d){"shape"in d&&e(0,s=d.shape),"computedStyle"in d&&e(1,n=d.computedStyle),"transform"in d&&e(2,o=d.transform),"viewportScale"in d&&e(3,a=d.viewportScale);},r.$$.update=function(){r.$$.dirty&1&&e(4,i=s.geometry);},[s,n,o,a,i,l,h,u,c];}var n_=/*#__PURE__*/function(_we3){_inherits(n_,_we3);var _super5=_createSuper(n_);function n_(t){var _this9;_classCallCheck(this,n_);_this9=_super5.call(this),Te(_assertThisInitialized(_this9),t,s_,i_,te,{shape:0,computedStyle:1,transform:2,viewportScale:3});return _this9;}return _createClass(n_);}(we);function pu(r,t,e){var i=r.slice();return i[10]=t[e],i[12]=e,i;}function mu(r,t,e){var i=r.slice();return i[13]=t[e],i[15]=e,i;}function gu(r,t,e){var i=r.slice();return i[16]=t[e],i[18]=e,i;}function yu(r){var t,e;return t=new Oi({props:{x:r[16][0],y:r[16][1],scale:r[3]}}),t.$on("pointerdown",function(){$t(r[9]("HANDLE-".concat(r[12],"-").concat(r[15],"-").concat(r[18])))&&r[9]("HANDLE-".concat(r[12],"-").concat(r[15],"-").concat(r[18])).apply(this,arguments);}),{c:function c(){_e(t.$$.fragment);},m:function m(i,s){fe(t,i,s),e=!0;},p:function p(i,s){r=i;var n={};s&16&&(n.x=r[16][0]),s&16&&(n.y=r[16][1]),s&8&&(n.scale=r[3]),t.$set(n);},i:function i(_i7){e||(it(t.$$.fragment,_i7),e=!0);},o:function o(i){dt(t.$$.fragment,i),e=!1;},d:function d(i){pe(t,i);}};}function _u(r){var t,e,_i8=Ee(r[13].points),s=[];for(var o=0;o<_i8.length;o+=1)s[o]=yu(gu(r,_i8,o));var n=function n(o){return dt(s[o],1,1,function(){s[o]=null;});};return{c:function c(){for(var _o4=0;_o4<s.length;_o4+=1)s[_o4].c();t=Ie();},m:function m(o,a){for(var l=0;l<s.length;l+=1)s[l]&&s[l].m(o,a);ot(o,t,a),e=!0;},p:function p(o,a){if(a&536){_i8=Ee(o[13].points);var l;for(l=0;l<_i8.length;l+=1){var h=gu(o,_i8,l);s[l]?(s[l].p(h,a),it(s[l],1)):(s[l]=yu(h),s[l].c(),it(s[l],1),s[l].m(t.parentNode,t));}for(xe(),l=_i8.length;l<s.length;l+=1)n(l);be();}},i:function i(o){if(!e){for(var a=0;a<_i8.length;a+=1)it(s[a]);e=!0;}},o:function o(_o5){s=s.filter(Boolean);for(var a=0;a<s.length;a+=1)dt(s[a]);e=!1;},d:function d(o){o&&nt(t),Jr(s,o);}};}function vu(r){var t,e,i,s,n,o,a,l,h,u=Ee(r[10].rings),_c5=[];for(var p=0;p<u.length;p+=1)_c5[p]=_u(mu(r,u,p));var d=function d(p){return dt(_c5[p],1,1,function(){_c5[p]=null;});};return{c:function c(){t=mt("g"),e=mt("path"),n=mt("path");for(var _p5=0;_p5<_c5.length;_p5+=1)_c5[_p5].c();A(e,"class","a9s-outer"),A(e,"style",i=r[1]?"display:none;":void 0),A(e,"fill-rule","evenodd"),A(e,"d",s=ei(r[10])),A(n,"class","a9s-inner"),A(n,"style",r[1]),A(n,"fill-rule","evenodd"),A(n,"d",o=ei(r[10]));},m:function m(p,f){ot(p,t,f),Oe(t,e),Oe(t,n);for(var m=0;m<_c5.length;m+=1)_c5[m]&&_c5[m].m(t,null);a=!0,l||(h=[Bt(e,"pointerdown",function(){$t(r[9]("SHAPE"))&&r[9]("SHAPE").apply(this,arguments);}),Bt(n,"pointerdown",function(){$t(r[9]("SHAPE"))&&r[9]("SHAPE").apply(this,arguments);})],l=!0);},p:function p(_p6,f){if(r=_p6,(!a||f&2&&i!==(i=r[1]?"display:none;":void 0))&&A(e,"style",i),(!a||f&16&&s!==(s=ei(r[10])))&&A(e,"d",s),(!a||f&2)&&A(n,"style",r[1]),(!a||f&16&&o!==(o=ei(r[10])))&&A(n,"d",o),f&536){u=Ee(r[10].rings);var m;for(m=0;m<u.length;m+=1){var y=mu(r,u,m);_c5[m]?(_c5[m].p(y,f),it(_c5[m],1)):(_c5[m]=_u(y),_c5[m].c(),it(_c5[m],1),_c5[m].m(t,null));}for(xe(),m=u.length;m<_c5.length;m+=1)d(m);be();}},i:function i(p){if(!a){for(var f=0;f<u.length;f+=1)it(_c5[f]);a=!0;}},o:function o(p){_c5=_c5.filter(Boolean);for(var f=0;f<_c5.length;f+=1)dt(_c5[f]);a=!1;},d:function d(p){p&&nt(t),Jr(_c5,p),l=!1,Ue(h);}};}function o_(r){var t,e,_i9=Ee(r[4].polygons),s=[];for(var o=0;o<_i9.length;o+=1)s[o]=vu(pu(r,_i9,o));var n=function n(o){return dt(s[o],1,1,function(){s[o]=null;});};return{c:function c(){for(var _o6=0;_o6<s.length;_o6+=1)s[_o6].c();t=Ie();},m:function m(o,a){for(var l=0;l<s.length;l+=1)s[l]&&s[l].m(o,a);ot(o,t,a),e=!0;},p:function p(o,a){if(a&538){_i9=Ee(o[4].polygons);var l;for(l=0;l<_i9.length;l+=1){var h=pu(o,_i9,l);s[l]?(s[l].p(h,a),it(s[l],1)):(s[l]=vu(h),s[l].c(),it(s[l],1),s[l].m(t.parentNode,t));}for(xe(),l=_i9.length;l<s.length;l+=1)n(l);be();}},i:function i(o){if(!e){for(var a=0;a<_i9.length;a+=1)it(s[a]);e=!0;}},o:function o(_o7){s=s.filter(Boolean);for(var a=0;a<s.length;a+=1)dt(s[a]);e=!1;},d:function d(o){o&&nt(t),Jr(s,o);}};}function a_(r){var t,e;return t=new la({props:{shape:r[0],transform:r[2],editor:r[5],$$slots:{"default":[o_,function(_ref83){var i=_ref83.grab;return{9:i};},function(_ref84){var i=_ref84.grab;return i?512:0;}]},$$scope:{ctx:r}}}),t.$on("change",r[6]),t.$on("grab",r[7]),t.$on("release",r[8]),{c:function c(){_e(t.$$.fragment);},m:function m(i,s){fe(t,i,s),e=!0;},p:function p(i,_ref85){var _ref86=_slicedToArray(_ref85,1),s=_ref86[0];var n={};s&1&&(n.shape=i[0]),s&4&&(n.transform=i[2]),s&524826&&(n.$$scope={dirty:s,ctx:i}),t.$set(n);},i:function i(_i10){e||(it(t.$$.fragment,_i10),e=!0);},o:function o(i){dt(t.$$.fragment,i),e=!1;},d:function d(i){pe(t,i);}};}function l_(r,t,e){var i,s=t.shape,n=t.computedStyle,o=t.transform,_t$viewportScale3=t.viewportScale,a=_t$viewportScale3===void 0?1:_t$viewportScale3;var l=function l(d,p,f){var m=d.geometry.polygons;var y;if(p==="SHAPE")y=m.map(function(_){var v=_.rings.map(function(x,b){return{points:x.points.map(function(S,w){return[S[0]+f[0],S[1]+f[1]];})};}),g=_r(v[0].points);return{rings:v,bounds:g};});else{var _p$split$map=p.split("-").map(function(b){return parseInt(b);}),_p$split$map2=_slicedToArray(_p$split$map,4),_=_p$split$map2[0],v=_p$split$map2[1],g=_p$split$map2[2],x=_p$split$map2[3];y=m.map(function(b,S){if(S===v){var w=b.rings.map(function(N,F){return F===g?{points:N.points.map(function(z,C){return C===x?[z[0]+f[0],z[1]+f[1]]:z;})}:N;}),T=_r(w[0].points);return{rings:w,bounds:T};}else return b;});}return _objectSpread(_objectSpread({},d),{},{geometry:{polygons:y,bounds:Tg(y)}});};function h(d){Ne.call(this,r,d);}function u(d){Ne.call(this,r,d);}function c(d){Ne.call(this,r,d);}return r.$$set=function(d){"shape"in d&&e(0,s=d.shape),"computedStyle"in d&&e(1,n=d.computedStyle),"transform"in d&&e(2,o=d.transform),"viewportScale"in d&&e(3,a=d.viewportScale);},r.$$.update=function(){r.$$.dirty&1&&e(4,i=s.geometry);},[s,n,o,a,i,l,h,u,c];}var h_=/*#__PURE__*/function(_we4){_inherits(h_,_we4);var _super6=_createSuper(h_);function h_(t){var _this10;_classCallCheck(this,h_);_this10=_super6.call(this),Te(_assertThisInitialized(_this10),t,l_,a_,te,{shape:0,computedStyle:1,transform:2,viewportScale:3});return _this10;}return _createClass(h_);}(we);var xu=new Map([[vt.RECTANGLE,n_],[vt.POLYGON,jy],[vt.MULTIPOLYGLON,h_]]),bu=function bu(r){return xu.get(r.type);},Eu=function Eu(r,t){return xu.set(r,t);},u_=function u_(r){return{};},Tu=function Tu(r){return{grab:r[0]};};function c_(r){var t,e,i,s;var n=r[7]["default"],_o8=ag(n,r,r[6],Tu);return{c:function c(){t=mt("g"),_o8&&_o8.c(),A(t,"class","a9s-annotation selected");},m:function m(a,l){ot(a,t,l),_o8&&_o8.m(t,null),e=!0,i||(s=[Bt(t,"pointerup",r[2]),Bt(t,"pointermove",r[1])],i=!0);},p:function p(a,_ref87){var _ref88=_slicedToArray(_ref87,1),l=_ref88[0];_o8&&_o8.p&&(!e||l&64)&&hg(_o8,n,a,a[6],e?lg(n,a[6],l,u_):ug(a[6]),Tu);},i:function i(a){e||(it(_o8,a),e=!0);},o:function o(a){dt(_o8,a),e=!1;},d:function d(a){a&&nt(t),_o8&&_o8.d(a),i=!1,Ue(s);}};}function d_(r,t,e){var _t$$$slots=t.$$slots,i=_t$$$slots===void 0?{}:_t$$$slots,s=t.$$scope;var n=Si();var o=t.shape,a=t.editor,l=t.transform,h,u,c;var d=function d(m){return function(y){h=m,u=l.elementToImage(y.offsetX,y.offsetY),c=o,y.target.setPointerCapture(y.pointerId),n("grab",y);};},p=function p(m){if(h){var _l$elementToImage=l.elementToImage(m.offsetX,m.offsetY),_l$elementToImage2=_slicedToArray(_l$elementToImage,2),y=_l$elementToImage2[0],_=_l$elementToImage2[1],v=[y-u[0],_-u[1]];e(3,o=a(c,h,v)),n("change",o);}},f=function f(m){m.target.releasePointerCapture(m.pointerId),h=void 0,c=o,n("release",m);};return r.$$set=function(m){"shape"in m&&e(3,o=m.shape),"editor"in m&&e(4,a=m.editor),"transform"in m&&e(5,l=m.transform),"$$scope"in m&&e(6,s=m.$$scope);},[d,p,f,o,a,l,s,i];}var la=/*#__PURE__*/function(_we5){_inherits(la,_we5);var _super7=_createSuper(la);function la(t){var _this11;_classCallCheck(this,la);_this11=_super7.call(this),Te(_assertThisInitialized(_this11),t,d_,c_,te,{shape:3,editor:4,transform:5});return _this11;}return _createClass(la);}(we);var gs=function gs(r,t){var e=typeof t=="function"?t(r):t;if(e){var i=e.fill,s=e.fillOpacity,n=e.stroke,o=e.strokeWidth,a=e.strokeOpacity;var l="";return i&&(l+="fill:".concat(i,";"),l+="fill-opacity:".concat(s||"0.25",";")),n&&(l+="stroke:".concat(n,";"),l+="stroke-width:".concat(o||"1",";"),l+="stroke-opacity:".concat(a||"1",";")),l;}};function f_(r,t,e){var i;var s=Si();var n=t.annotation,o=t.editor,a=t.style,l=t.target,h=t.transform,u=t.viewportScale,c;return ms(function(){return e(6,c=new o({target:l,props:{shape:n.target.selector,computedStyle:i,transform:h,viewportScale:u}})),c.$on("change",function(d){c.$$set({shape:d.detail}),s("change",d.detail);}),c.$on("grab",function(d){return s("grab",d.detail);}),c.$on("release",function(d){return s("release",d.detail);}),function(){c.$destroy();};}),r.$$set=function(d){"annotation"in d&&e(0,n=d.annotation),"editor"in d&&e(1,o=d.editor),"style"in d&&e(2,a=d.style),"target"in d&&e(3,l=d.target),"transform"in d&&e(4,h=d.transform),"viewportScale"in d&&e(5,u=d.viewportScale);},r.$$.update=function(){r.$$.dirty&5&&e(7,i=gs(n,a)),r.$$.dirty&65&&n&&(c==null||c.$set({shape:n.target.selector})),r.$$.dirty&80&&c&&c.$set({transform:h}),r.$$.dirty&96&&c&&c.$set({viewportScale:u}),r.$$.dirty&192&&c&&i&&c.$set({computedStyle:i});},[n,o,a,l,h,u,c,i];}var p_=/*#__PURE__*/function(_we6){_inherits(p_,_we6);var _super8=_createSuper(p_);function p_(t){var _this12;_classCallCheck(this,p_);_this12=_super8.call(this),Te(_assertThisInitialized(_this12),t,f_,null,te,{annotation:0,editor:1,style:2,target:3,transform:4,viewportScale:5});return _this12;}return _createClass(p_);}(we);function m_(r,t,e){var i=Si();var s=t.drawingMode,n=t.target,o=t.tool,a=t.transform,l=t.viewportScale,h;return ms(function(){var u=n.closest("svg"),c=[],d=function d(p,f,m){u==null||u.addEventListener(p,f,m),c.push(function(){return u==null?void 0:u.removeEventListener(p,f,m);});};return e(5,h=new o({target:n,props:{addEventListener:d,drawingMode:s,transform:a,viewportScale:l}})),h.$on("create",function(p){return i("create",p.detail);}),function(){c.forEach(function(p){return p();}),h.$destroy();};}),r.$$set=function(u){"drawingMode"in u&&e(0,s=u.drawingMode),"target"in u&&e(1,n=u.target),"tool"in u&&e(2,o=u.tool),"transform"in u&&e(3,a=u.transform),"viewportScale"in u&&e(4,l=u.viewportScale);},r.$$.update=function(){r.$$.dirty&40&&h&&h.$set({transform:a}),r.$$.dirty&48&&h&&h.$set({viewportScale:l});},[s,n,o,a,l,h];}var g_=/*#__PURE__*/function(_we7){_inherits(g_,_we7);var _super9=_createSuper(g_);function g_(t){var _this13;_classCallCheck(this,g_);_this13=_super9.call(this),Te(_assertThisInitialized(_this13),t,m_,null,te,{drawingMode:0,target:1,tool:2,transform:3,viewportScale:4});return _this13;}return _createClass(g_);}(we);function wu(r){var t,e;return{c:function c(){t=mt("rect"),e=mt("rect"),A(t,"class","a9s-outer"),A(t,"x",r[1]),A(t,"y",r[2]),A(t,"width",r[3]),A(t,"height",r[4]),A(e,"class","a9s-inner"),A(e,"x",r[1]),A(e,"y",r[2]),A(e,"width",r[3]),A(e,"height",r[4]);},m:function m(i,s){ot(i,t,s),ot(i,e,s);},p:function p(i,s){s&2&&A(t,"x",i[1]),s&4&&A(t,"y",i[2]),s&8&&A(t,"width",i[3]),s&16&&A(t,"height",i[4]),s&2&&A(e,"x",i[1]),s&4&&A(e,"y",i[2]),s&8&&A(e,"width",i[3]),s&16&&A(e,"height",i[4]);},d:function d(i){i&&(nt(t),nt(e));}};}function y_(r){var t,e=r[0]&&wu(r);return{c:function c(){t=mt("g"),e&&e.c(),A(t,"class","a9s-annotation a9s-rubberband");},m:function m(i,s){ot(i,t,s),e&&e.m(t,null);},p:function p(i,_ref89){var _ref90=_slicedToArray(_ref89,1),s=_ref90[0];i[0]?e?e.p(i,s):(e=wu(i),e.c(),e.m(t,null)):e&&(e.d(1),e=null);},i:Ct,o:Ct,d:function d(i){i&&nt(t),e&&e.d();}};}function __(r,t,e){var i=Si();var s=t.addEventListener,n=t.drawingMode,o=t.transform,a,l,h,u,c,d,p;var f=function f(v){var g=v;a=performance.now(),n==="drag"&&(e(0,l=o.elementToImage(g.offsetX,g.offsetY)),h=l,e(1,u=l[0]),e(2,c=l[1]),e(3,d=1),e(4,p=1));},m=function m(v){var g=v;l&&(h=o.elementToImage(g.offsetX,g.offsetY),e(1,u=Math.min(h[0],l[0])),e(2,c=Math.min(h[1],l[1])),e(3,d=Math.abs(h[0]-l[0])),e(4,p=Math.abs(h[1]-l[1])));},y=function y(v){var g=v,x=performance.now()-a;if(n==="click"){if(x>300)return;l?_():(e(0,l=o.elementToImage(g.offsetX,g.offsetY)),h=l,e(1,u=l[0]),e(2,c=l[1]),e(3,d=1),e(4,p=1));}else l&&(x>300||d*p>100?(g.stopPropagation(),_()):(e(0,l=void 0),h=void 0));},_=function _(){if(d*p>15){var v={type:vt.RECTANGLE,geometry:{bounds:{minX:u,minY:c,maxX:u+d,maxY:c+p},x:u,y:c,w:d,h:p}};i("create",v);}e(0,l=void 0),h=void 0;};return ms(function(){s("pointerdown",f),s("pointermove",m),s("pointerup",y,!0);}),r.$$set=function(v){"addEventListener"in v&&e(5,s=v.addEventListener),"drawingMode"in v&&e(6,n=v.drawingMode),"transform"in v&&e(7,o=v.transform);},[l,u,c,d,p,s,n,o];}var v_=/*#__PURE__*/function(_we8){_inherits(v_,_we8);var _super10=_createSuper(v_);function v_(t){var _this14;_classCallCheck(this,v_);_this14=_super10.call(this),Te(_assertThisInitialized(_this14),t,__,y_,te,{addEventListener:5,drawingMode:6,transform:7});return _this14;}return _createClass(v_);}(we);function ha(r){var t=r.slice(),e=(t[2]?t[0]:[].concat(_toConsumableArray(t[0]),[t[1]])).map(function(i){return i.join(",");}).join(" ");return t[16]=e,t;}function Au(r){var t,e,i,s,n,o=r[2]&&Su(r);return{c:function c(){t=mt("polygon"),i=mt("polygon"),o&&o.c(),n=Ie(),A(t,"class","a9s-outer"),A(t,"points",e=r[16]),A(i,"class","a9s-inner"),A(i,"points",s=r[16]);},m:function m(a,l){ot(a,t,l),ot(a,i,l),o&&o.m(a,l),ot(a,n,l);},p:function p(a,l){l&7&&e!==(e=a[16])&&A(t,"points",e),l&7&&s!==(s=a[16])&&A(i,"points",s),a[2]?o?o.p(a,l):(o=Su(a),o.c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null);},d:function d(a){a&&(nt(t),nt(i),nt(n)),o&&o.d(a);}};}function Su(r){var t,e,i;return{c:function c(){t=mt("rect"),A(t,"class","a9s-handle"),A(t,"x",e=r[0][0][0]-r[3]/2),A(t,"y",i=r[0][0][1]-r[3]/2),A(t,"height",r[3]),A(t,"width",r[3]);},m:function m(s,n){ot(s,t,n);},p:function p(s,n){n&9&&e!==(e=s[0][0][0]-s[3]/2)&&A(t,"x",e),n&9&&i!==(i=s[0][0][1]-s[3]/2)&&A(t,"y",i),n&8&&A(t,"height",s[3]),n&8&&A(t,"width",s[3]);},d:function d(s){s&&nt(t);}};}function x_(r){var t,e=r[1]&&Au(ha(r));return{c:function c(){t=mt("g"),e&&e.c(),A(t,"class","a9s-annotation a9s-rubberband");},m:function m(i,s){ot(i,t,s),e&&e.m(t,null);},p:function p(i,_ref91){var _ref92=_slicedToArray(_ref91,1),s=_ref92[0];i[1]?e?e.p(ha(i),s):(e=Au(ha(i)),e.c(),e.m(t,null)):e&&(e.d(1),e=null);},i:Ct,o:Ct,d:function d(i){i&&nt(t),e&&e.d();}};}var b_=20,E_=1500;function T_(r,t,e){var i;var s=Si();var n=t.addEventListener,o=t.drawingMode,a=t.transform,_t$viewportScale4=t.viewportScale,l=_t$viewportScale4===void 0?1:_t$viewportScale4,h,u=[],c,d,p=!1;var f=function f(g){var x=g,b=x.timeStamp,S=x.offsetX,w=x.offsetY;if(h={timeStamp:b,offsetX:S,offsetY:w},o==="drag"&&u.length===0){var T=a.elementToImage(x.offsetX,x.offsetY);u.push(T),e(1,c=T);}},m=function m(g){var x=g;if(d&&clearTimeout(d),u.length>0){if(e(1,c=a.elementToImage(x.offsetX,x.offsetY)),u.length>2){var b=aa(c,u[0])*l;e(2,p=b<b_);}x.pointerType==="touch"&&(d=setTimeout(function(){_();},E_));}},y=function y(g){var x=g;if(d&&clearTimeout(d),o==="click"){var b=x.timeStamp-h.timeStamp,S=aa([h.offsetX,h.offsetY],[x.offsetX,x.offsetY]);if(b>300||S>15)return;if(p)v();else if(u.length===0){var w=a.elementToImage(x.offsetX,x.offsetY);u.push(w),e(1,c=w);}else u.push(c);}else{if(u.length===1&&aa(u[0],c)<=4){e(0,u=[]),e(1,c=void 0);return;}x.stopImmediatePropagation(),p?v():u.push(c);}},_=function _(){if(!c)return;var g=u.slice(0,-1);if(g.length<3)return;var x={type:vt.POLYGON,geometry:{bounds:_r(u),points:g}};Ko(x)>4&&(e(0,u=[]),e(1,c=void 0),s("create",x));},v=function v(){var g={type:vt.POLYGON,geometry:{bounds:_r(u),points:_toConsumableArray(u)}};e(0,u=[]),e(1,c=void 0),s("create",g);};return ms(function(){n("pointerdown",f,!0),n("pointermove",m),n("pointerup",y,!0),n("dblclick",_,!0);}),r.$$set=function(g){"addEventListener"in g&&e(4,n=g.addEventListener),"drawingMode"in g&&e(5,o=g.drawingMode),"transform"in g&&e(6,a=g.transform),"viewportScale"in g&&e(7,l=g.viewportScale);},r.$$.update=function(){r.$$.dirty&128&&e(3,i=10/l);},[u,c,p,i,n,o,a,l];}var w_=/*#__PURE__*/function(_we9){_inherits(w_,_we9);var _super11=_createSuper(w_);function w_(t){var _this15;_classCallCheck(this,w_);_this15=_super11.call(this),Te(_assertThisInitialized(_this15),t,T_,x_,te,{addEventListener:4,drawingMode:5,transform:6,viewportScale:7});return _this15;}return _createClass(w_);}(we);var ua=new Map([["rectangle",{tool:v_}],["polygon",{tool:w_}]]),hn=function hn(){return _toConsumableArray(ua.keys());},un=function un(r){return ua.get(r);},Cu=function Cu(r,t,e){return ua.set(r,{tool:t,opts:e});};function A_(r){var t,e,i,s,n;return{c:function c(){t=mt("g"),e=mt("ellipse"),s=mt("ellipse"),A(e,"class","a9s-outer"),A(e,"style",i=r[1]?"display:none;":void 0),A(e,"cx",r[2]),A(e,"cy",r[3]),A(e,"rx",r[4]),A(e,"ry",r[5]),A(s,"class","a9s-inner"),A(s,"style",r[1]),A(s,"cx",r[2]),A(s,"cy",r[3]),A(s,"rx",r[4]),A(s,"ry",r[5]),A(t,"class","a9s-annotation"),A(t,"data-id",n=r[0].id);},m:function m(o,a){ot(o,t,a),Oe(t,e),Oe(t,s);},p:function p(o,_ref93){var _ref94=_slicedToArray(_ref93,1),a=_ref94[0];a&2&&i!==(i=o[1]?"display:none;":void 0)&&A(e,"style",i),a&2&&A(s,"style",o[1]),a&1&&n!==(n=o[0].id)&&A(t,"data-id",n);},i:Ct,o:Ct,d:function d(o){o&&nt(t);}};}function S_(r,t,e){var i,s=t.annotation,n=t.geom,o=t.style;var _n3=n,a=_n3.cx,l=_n3.cy,h=_n3.rx,u=_n3.ry;return r.$$set=function(c){"annotation"in c&&e(0,s=c.annotation),"geom"in c&&e(6,n=c.geom),"style"in c&&e(7,o=c.style);},r.$$.update=function(){r.$$.dirty&129&&e(1,i=gs(s,o));},[s,i,a,l,h,u,n,o];}var C_=/*#__PURE__*/function(_we10){_inherits(C_,_we10);var _super12=_createSuper(C_);function C_(t){var _this16;_classCallCheck(this,C_);_this16=_super12.call(this),Te(_assertThisInitialized(_this16),t,S_,A_,te,{annotation:0,geom:6,style:7});return _this16;}return _createClass(C_);}(we);function Iu(r,t,e){var i=r.slice();return i[5]=t[e],i;}function Ru(r){var t,e,i;return{c:function c(){t=mt("path"),i=mt("path"),A(t,"class","a9s-outer"),A(t,"style",e=r[1]?"display:none;":void 0),A(t,"fill-rule","evenodd"),A(t,"d",ei(r[5])),A(i,"class","a9s-inner"),A(i,"style",r[1]),A(i,"fill-rule","evenodd"),A(i,"d",ei(r[5]));},m:function m(s,n){ot(s,t,n),ot(s,i,n);},p:function p(s,n){n&2&&e!==(e=s[1]?"display:none;":void 0)&&A(t,"style",e),n&2&&A(i,"style",s[1]);},d:function d(s){s&&(nt(t),nt(i));}};}function I_(r){var t,e,i=Ee(r[2]),s=[];for(var n=0;n<i.length;n+=1)s[n]=Ru(Iu(r,i,n));return{c:function c(){t=mt("g");for(var _n4=0;_n4<s.length;_n4+=1)s[_n4].c();A(t,"class","a9s-annotation"),A(t,"data-id",e=r[0].id);},m:function m(n,o){ot(n,t,o);for(var a=0;a<s.length;a+=1)s[a]&&s[a].m(t,null);},p:function p(n,_ref95){var _ref96=_slicedToArray(_ref95,1),o=_ref96[0];if(o&6){i=Ee(n[2]);var a;for(a=0;a<i.length;a+=1){var l=Iu(n,i,a);s[a]?s[a].p(l,o):(s[a]=Ru(l),s[a].c(),s[a].m(t,null));}for(;a<s.length;a+=1)s[a].d(1);s.length=i.length;}o&1&&e!==(e=n[0].id)&&A(t,"data-id",e);},i:Ct,o:Ct,d:function d(n){n&&nt(t),Jr(s,n);}};}function R_(r,t,e){var i,s=t.annotation,n=t.geom,o=t.style;var _n5=n,a=_n5.polygons;return r.$$set=function(l){"annotation"in l&&e(0,s=l.annotation),"geom"in l&&e(3,n=l.geom),"style"in l&&e(4,o=l.style);},r.$$.update=function(){r.$$.dirty&17&&e(1,i=gs(s,o));},[s,i,a,n,o];}var M_=/*#__PURE__*/function(_we11){_inherits(M_,_we11);var _super13=_createSuper(M_);function M_(t){var _this17;_classCallCheck(this,M_);_this17=_super13.call(this),Te(_assertThisInitialized(_this17),t,R_,I_,te,{annotation:0,geom:3,style:4});return _this17;}return _createClass(M_);}(we);function P_(r){var t,e,i,s,n;return{c:function c(){t=mt("g"),e=mt("polygon"),s=mt("polygon"),A(e,"class","a9s-outer"),A(e,"style",i=r[1]?"display:none;":void 0),A(e,"points",r[2].map(O_).join(" ")),A(s,"class","a9s-inner"),A(s,"style",r[1]),A(s,"points",r[2].map(N_).join(" ")),A(t,"class","a9s-annotation"),A(t,"data-id",n=r[0].id);},m:function m(o,a){ot(o,t,a),Oe(t,e),Oe(t,s);},p:function p(o,_ref97){var _ref98=_slicedToArray(_ref97,1),a=_ref98[0];a&2&&i!==(i=o[1]?"display:none;":void 0)&&A(e,"style",i),a&2&&A(s,"style",o[1]),a&1&&n!==(n=o[0].id)&&A(t,"data-id",n);},i:Ct,o:Ct,d:function d(o){o&&nt(t);}};}var O_=function O_(r){return r.join(",");},N_=function N_(r){return r.join(",");};function D_(r,t,e){var i,s=t.annotation,n=t.geom,o=t.style;var _n6=n,a=_n6.points;return r.$$set=function(l){"annotation"in l&&e(0,s=l.annotation),"geom"in l&&e(3,n=l.geom),"style"in l&&e(4,o=l.style);},r.$$.update=function(){r.$$.dirty&17&&e(1,i=gs(s,o));},[s,i,a,n,o];}var L_=/*#__PURE__*/function(_we12){_inherits(L_,_we12);var _super14=_createSuper(L_);function L_(t){var _this18;_classCallCheck(this,L_);_this18=_super14.call(this),Te(_assertThisInitialized(_this18),t,D_,P_,te,{annotation:0,geom:3,style:4});return _this18;}return _createClass(L_);}(we);function B_(r){var t,e,i,s,n;return{c:function c(){t=mt("g"),e=mt("rect"),s=mt("rect"),A(e,"class","a9s-outer"),A(e,"style",i=r[5]?"display:none;":void 0),A(e,"x",r[4]),A(e,"y",r[3]),A(e,"width",r[2]),A(e,"height",r[1]),A(s,"class","a9s-inner"),A(s,"style",r[5]),A(s,"x",r[4]),A(s,"y",r[3]),A(s,"width",r[2]),A(s,"height",r[1]),A(t,"class","a9s-annotation"),A(t,"data-id",n=r[0].id);},m:function m(o,a){ot(o,t,a),Oe(t,e),Oe(t,s);},p:function p(o,_ref99){var _ref100=_slicedToArray(_ref99,1),a=_ref100[0];a&32&&i!==(i=o[5]?"display:none;":void 0)&&A(e,"style",i),a&16&&A(e,"x",o[4]),a&8&&A(e,"y",o[3]),a&4&&A(e,"width",o[2]),a&2&&A(e,"height",o[1]),a&32&&A(s,"style",o[5]),a&16&&A(s,"x",o[4]),a&8&&A(s,"y",o[3]),a&4&&A(s,"width",o[2]),a&2&&A(s,"height",o[1]),a&1&&n!==(n=o[0].id)&&A(t,"data-id",n);},i:Ct,o:Ct,d:function d(o){o&&nt(t);}};}function F_(r,t,e){var i,s,n,o,a,l=t.annotation,h=t.geom,u=t.style;return r.$$set=function(c){"annotation"in c&&e(0,l=c.annotation),"geom"in c&&e(6,h=c.geom),"style"in c&&e(7,u=c.style);},r.$$.update=function(){var _h5;r.$$.dirty&129&&e(5,i=gs(l,u)),r.$$.dirty&64&&e(4,(_h5=h,s=_h5.x,n=_h5.y,o=_h5.w,a=_h5.h,_h5),s,(e(3,n),e(6,h)),(e(2,o),e(6,h)),(e(1,a),e(6,h)));},[l,a,o,n,s,i,h,u];}var U_=/*#__PURE__*/function(_we13){_inherits(U_,_we13);var _super15=_createSuper(U_);function U_(t){var _this19;_classCallCheck(this,U_);_this19=_super15.call(this),Te(_assertThisInitialized(_this19),t,F_,B_,te,{annotation:0,geom:6,style:7});return _this19;}return _createClass(U_);}(we);var k_=function k_(r){return{elementToImage:function elementToImage(t,e){var i=r.getBoundingClientRect(),s=r.createSVGPoint();s.x=t+i.x,s.y=e+i.y;var _s$matrixTransform=s.matrixTransform(r.getScreenCTM().inverse()),n=_s$matrixTransform.x,o=_s$matrixTransform.y;return[n,o];}};},G_=250,$_=function $_(r,t){var e=Si();var i;return{onPointerDown:function onPointerDown(){return i=performance.now();},onPointerUp:function onPointerUp(s){if(performance.now()-i<G_){var _Mu=Mu(s,r),n=_Mu.x,o=_Mu.y,a=t.getAt(n,o);a?e("click",{originalEvent:s,annotation:a}):e("click",{originalEvent:s});}}};},Mu=function Mu(r,t){var e=t.createSVGPoint(),i=t.getBoundingClientRect(),s=r.clientX-i.x,n=r.clientY-i.y,_t$getBoundingClientR=t.getBoundingClientRect(),o=_t$getBoundingClientR.left,a=_t$getBoundingClientR.top;return e.x=s+o,e.y=n+a,e.matrixTransform(t.getScreenCTM().inverse());};function Pu(r,t,e){var i=r.slice();i[39]=t[e];var s=i[24](i[39].target.selector);return i[40]=s,i;}function Ou(r,t,e){var i=r.slice();return i[43]=t[e],i;}function ca(r){var t=r.slice(),e=t[43].target.selector;return t[46]=e,t;}function Nu(r){var t=r[43],e,_i11,s=Du(r);return{c:function c(){s.c(),e=Ie();},m:function m(n,o){s.m(n,o),ot(n,e,o),_i11=!0;},p:function p(n,o){o[0]&65536&&te(t,t=n[43])?(xe(),dt(s,1,1,Ct),be(),s=Du(n),s.c(),it(s,1),s.m(e.parentNode,e)):s.p(n,o);},i:function i(n){_i11||(it(s),_i11=!0);},o:function o(n){dt(s),_i11=!1;},d:function d(n){n&&nt(e),s.d(n);}};}function H_(r){var t,e;return t=new M_({props:{annotation:r[43],geom:r[46].geometry,style:r[1]}}),{c:function c(){_e(t.$$.fragment);},m:function m(i,s){fe(t,i,s),e=!0;},p:function p(i,s){var n={};s[0]&65536&&(n.annotation=i[43]),s[0]&65536&&(n.geom=i[46].geometry),s[0]&2&&(n.style=i[1]),t.$set(n);},i:function i(_i12){e||(it(t.$$.fragment,_i12),e=!0);},o:function o(i){dt(t.$$.fragment,i),e=!1;},d:function d(i){pe(t,i);}};}function V_(r){var t,e;return t=new L_({props:{annotation:r[43],geom:r[46].geometry,style:r[1]}}),{c:function c(){_e(t.$$.fragment);},m:function m(i,s){fe(t,i,s),e=!0;},p:function p(i,s){var n={};s[0]&65536&&(n.annotation=i[43]),s[0]&65536&&(n.geom=i[46].geometry),s[0]&2&&(n.style=i[1]),t.$set(n);},i:function i(_i13){e||(it(t.$$.fragment,_i13),e=!0);},o:function o(i){dt(t.$$.fragment,i),e=!1;},d:function d(i){pe(t,i);}};}function X_(r){var t,e;return t=new U_({props:{annotation:r[43],geom:r[46].geometry,style:r[1]}}),{c:function c(){_e(t.$$.fragment);},m:function m(i,s){fe(t,i,s),e=!0;},p:function p(i,s){var n={};s[0]&65536&&(n.annotation=i[43]),s[0]&65536&&(n.geom=i[46].geometry),s[0]&2&&(n.style=i[1]),t.$set(n);},i:function i(_i14){e||(it(t.$$.fragment,_i14),e=!0);},o:function o(i){dt(t.$$.fragment,i),e=!1;},d:function d(i){pe(t,i);}};}function z_(r){var t;var e,_i15;return e=new C_({props:{annotation:r[43],geom:(t=r[46])==null?void 0:t.geometry,style:r[1]}}),{c:function c(){_e(e.$$.fragment);},m:function m(s,n){fe(e,s,n),_i15=!0;},p:function p(s,n){var o;var a={};n[0]&65536&&(a.annotation=s[43]),n[0]&65536&&(a.geom=(o=s[46])==null?void 0:o.geometry),n[0]&2&&(a.style=s[1]),e.$set(a);},i:function i(s){_i15||(it(e.$$.fragment,s),_i15=!0);},o:function o(s){dt(e.$$.fragment,s),_i15=!1;},d:function d(s){pe(e,s);}};}function Du(r){var t,e,i,s;var n=[z_,X_,V_,H_],o=[];function a(l,h){var u,c,d,p;return((u=l[46])==null?void 0:u.type)===vt.ELLIPSE?0:((c=l[46])==null?void 0:c.type)===vt.RECTANGLE?1:((d=l[46])==null?void 0:d.type)===vt.POLYGON?2:((p=l[46])==null?void 0:p.type)===vt.MULTIPOLYGLON?3:-1;}return~(t=a(r))&&(e=o[t]=n[t](r)),{c:function c(){e&&e.c(),i=Ie();},m:function m(l,h){~t&&o[t].m(l,h),ot(l,i,h),s=!0;},p:function p(l,h){var u=t;t=a(l),t===u?~t&&o[t].p(l,h):(e&&(xe(),dt(o[u],1,1,function(){o[u]=null;}),be()),~t?(e=o[t],e?e.p(l,h):(e=o[t]=n[t](l),e.c()),it(e,1),e.m(i.parentNode,i)):e=null);},i:function i(l){s||(it(e),s=!0);},o:function o(l){dt(e),s=!1;},d:function d(l){l&&nt(i),~t&&o[t].d(l);}};}function Lu(r){var t=Ge(r[43])&&!r[9](r[43]),e,_i16,s=t&&Nu(ca(r));return{c:function c(){s&&s.c(),e=Ie();},m:function m(n,o){s&&s.m(n,o),ot(n,e,o),_i16=!0;},p:function p(n,o){o[0]&66048&&(t=Ge(n[43])&&!n[9](n[43])),t?s?(s.p(ca(n),o),o[0]&66048&&it(s,1)):(s=Nu(ca(n)),s.c(),it(s,1),s.m(e.parentNode,e)):s&&(xe(),dt(s,1,1,function(){s=null;}),be());},i:function i(n){_i16||(it(s),_i16=!0);},o:function o(n){dt(s),_i16=!1;},d:function d(n){n&&nt(e),s&&s.d(n);}};}function Bu(r){var t,e,i,s;var n=[Y_,W_],o=[];function a(l,h){return l[8]?0:l[14]&&l[0]?1:-1;}return~(t=a(r))&&(e=o[t]=n[t](r)),{c:function c(){e&&e.c(),i=Ie();},m:function m(l,h){~t&&o[t].m(l,h),ot(l,i,h),s=!0;},p:function p(l,h){var u=t;t=a(l),t===u?~t&&o[t].p(l,h):(e&&(xe(),dt(o[u],1,1,function(){o[u]=null;}),be()),~t?(e=o[t],e?e.p(l,h):(e=o[t]=n[t](l),e.c()),it(e,1),e.m(i.parentNode,i)):e=null);},i:function i(l){s||(it(e),s=!0);},o:function o(l){dt(e),s=!1;},d:function d(l){l&&nt(i),~t&&o[t].d(l);}};}function W_(r){var t="".concat(r[2],"-").concat(r[5]),e,_i17,s=Fu(r);return{c:function c(){s.c(),e=Ie();},m:function m(n,o){s.m(n,o),ot(n,e,o),_i17=!0;},p:function p(n,o){o[0]&36&&te(t,t="".concat(n[2],"-").concat(n[5]))?(xe(),dt(s,1,1,Ct),be(),s=Fu(n),s.c(),it(s,1),s.m(e.parentNode,e)):s.p(n,o);},i:function i(n){_i17||(it(s),_i17=!0);},o:function o(n){dt(s),_i17=!1;},d:function d(n){n&&nt(e),s.d(n);}};}function Y_(r){var t,e,_i18=Ee(r[8]),s=[];for(var o=0;o<_i18.length;o+=1)s[o]=Gu(Pu(r,_i18,o));var n=function n(o){return dt(s[o],1,1,function(){s[o]=null;});};return{c:function c(){for(var _o9=0;_o9<s.length;_o9+=1)s[_o9].c();t=Ie();},m:function m(o,a){for(var l=0;l<s.length;l+=1)s[l]&&s[l].m(o,a);ot(o,t,a),e=!0;},p:function p(o,a){if(a[0]&21107010){_i18=Ee(o[8]);var l;for(l=0;l<_i18.length;l+=1){var h=Pu(o,_i18,l);s[l]?(s[l].p(h,a),it(s[l],1)):(s[l]=Gu(h),s[l].c(),it(s[l],1),s[l].m(t.parentNode,t));}for(xe(),l=_i18.length;l<s.length;l+=1)n(l);be();}},i:function i(o){if(!e){for(var a=0;a<_i18.length;a+=1)it(s[a]);e=!0;}},o:function o(_o10){s=s.filter(Boolean);for(var a=0;a<s.length;a+=1)dt(s[a]);e=!1;},d:function d(o){o&&nt(t),Jr(s,o);}};}function Fu(r){var t,e;return t=new g_({props:{target:r[6],tool:r[14],drawingMode:r[13],transform:r[12],viewportScale:r[17]}}),t.$on("create",r[21]),{c:function c(){_e(t.$$.fragment);},m:function m(i,s){fe(t,i,s),e=!0;},p:function p(i,s){var n={};s[0]&64&&(n.target=i[6]),s[0]&16384&&(n.tool=i[14]),s[0]&8192&&(n.drawingMode=i[13]),s[0]&4096&&(n.transform=i[12]),s[0]&131072&&(n.viewportScale=i[17]),t.$set(n);},i:function i(_i19){e||(it(t.$$.fragment,_i19),e=!0);},o:function o(i){dt(t.$$.fragment,i),e=!1;},d:function d(i){pe(t,i);}};}function Uu(r){var t=r[39].id,e,_i20,s=ku(r);return{c:function c(){s.c(),e=Ie();},m:function m(n,o){s.m(n,o),ot(n,e,o),_i20=!0;},p:function p(n,o){o[0]&256&&te(t,t=n[39].id)?(xe(),dt(s,1,1,Ct),be(),s=ku(n),s.c(),it(s,1),s.m(e.parentNode,e)):s.p(n,o);},i:function i(n){_i20||(it(s),_i20=!0);},o:function o(n){dt(s),_i20=!1;},d:function d(n){n&&nt(e),s.d(n);}};}function ku(r){var t,e;return t=new p_({props:{target:r[6],editor:r[24](r[39].target.selector),annotation:r[39],style:r[1],transform:r[12],viewportScale:r[17]}}),t.$on("change",function(){$t(r[22](r[39]))&&r[22](r[39]).apply(this,arguments);}),{c:function c(){_e(t.$$.fragment);},m:function m(i,s){fe(t,i,s),e=!0;},p:function p(i,s){r=i;var n={};s[0]&64&&(n.target=r[6]),s[0]&256&&(n.editor=r[24](r[39].target.selector)),s[0]&256&&(n.annotation=r[39]),s[0]&2&&(n.style=r[1]),s[0]&4096&&(n.transform=r[12]),s[0]&131072&&(n.viewportScale=r[17]),t.$set(n);},i:function i(_i21){e||(it(t.$$.fragment,_i21),e=!0);},o:function o(i){dt(t.$$.fragment,i),e=!1;},d:function d(i){pe(t,i);}};}function Gu(r){var t,e,_i22=r[40]&&Uu(r);return{c:function c(){_i22&&_i22.c(),t=Ie();},m:function m(s,n){_i22&&_i22.m(s,n),ot(s,t,n),e=!0;},p:function p(s,n){s[40]?_i22?(_i22.p(s,n),n[0]&256&&it(_i22,1)):(_i22=Uu(s),_i22.c(),it(_i22,1),_i22.m(t.parentNode,t)):_i22&&(xe(),dt(_i22,1,1,function(){_i22=null;}),be());},i:function i(s){e||(it(_i22),e=!0);},o:function o(s){dt(_i22),e=!1;},d:function d(s){s&&nt(t),_i22&&_i22.d(s);}};}function j_(r){var t,e,i,s,n,o,a=Ee(r[16].filter(r[34])),l=[];for(var c=0;c<a.length;c+=1)l[c]=Lu(Ou(r,a,c));var h=function h(c){return dt(l[c],1,1,function(){l[c]=null;});};var u=r[6]&&Bu(r);return{c:function c(){t=mt("svg"),e=mt("g");for(var _c6=0;_c6<l.length;_c6+=1)l[_c6].c();i=mt("g"),u&&u.c(),A(i,"class","drawing"),A(t,"class","a9s-annotationlayer"),Mr(t,"drawing",r[14]),Mr(t,"hidden",!r[3]),Mr(t,"hover",r[15]);},m:function m(c,d){ot(c,t,d),Oe(t,e);for(var p=0;p<l.length;p+=1)l[p]&&l[p].m(e,null);Oe(t,i),u&&u.m(i,null),r[35](i),r[36](t),s=!0,n||(o=[Bt(t,"pointerup",function(){$t(r[10])&&r[10].apply(this,arguments);}),Bt(t,"pointerdown",function(){$t(r[11])&&r[11].apply(this,arguments);}),Bt(t,"pointermove",r[23])],n=!0);},p:function p(c,d){if(r=c,d[0]&66050){a=Ee(r[16].filter(r[34]));var p;for(p=0;p<a.length;p+=1){var f=Ou(r,a,p);l[p]?(l[p].p(f,d),it(l[p],1)):(l[p]=Lu(f),l[p].c(),it(l[p],1),l[p].m(e,null));}for(xe(),p=a.length;p<l.length;p+=1)h(p);be();}r[6]?u?(u.p(r,d),d[0]&64&&it(u,1)):(u=Bu(r),u.c(),it(u,1),u.m(i,null)):u&&(xe(),dt(u,1,1,function(){u=null;}),be()),(!s||d[0]&16384)&&Mr(t,"drawing",r[14]),(!s||d[0]&8)&&Mr(t,"hidden",!r[3]),(!s||d[0]&32768)&&Mr(t,"hover",r[15]);},i:function i(c){if(!s){for(var d=0;d<a.length;d+=1)it(l[d]);it(u),s=!0;}},o:function o(c){l=l.filter(Boolean);for(var d=0;d<l.length;d+=1)dt(l[d]);dt(u),s=!1;},d:function d(c){c&&nt(t),Jr(l,c),u&&u.d(),r[35](null),r[36](null),n=!1,Ue(o);}};}function q_(r,t,e){var i,s,n,o,a,l,h,u,c,d,p,f=Ct,m=function m(){return f(),f=Dh(I,function(O){return e(17,p=O);}),I;};r.$$.on_destroy.push(function(){return f();});var y=t.drawingEnabled,_=t.image,v=t.preferredDrawingMode,g=t.state,_t$style=t.style,x=_t$style===void 0?void 0:_t$style,_t$toolName=t.toolName,b=_t$toolName===void 0?hn()[0]:_t$toolName,S=t.user,_t$visible=t.visible,w=_t$visible===void 0?!0:_t$visible,T=0;var N=function N(){return e(5,T+=1);},F=function F(){return b;},z=function z(){return y;};var C,E,I;ms(function(){return m(e(7,I=Zy(_,E)));});var _g4=g,P=_g4.hover,$=_g4.selection,k=_g4.store;zo(r,P,function(O){return e(15,u=O);}),zo(r,$,function(O){return e(33,c=O);}),zo(r,k,function(O){return e(16,d=O);});var G,st;var M=function M(O){G&&k.unobserve(G);var D=O.filter(function(_ref101){var ut=_ref101.editable;return ut;}).map(function(_ref102){var ut=_ref102.id;return ut;});D.length>0?(e(8,st=D.map(function(ut){return k.getAnnotation(ut);}).filter(function(ut){return ut&&Ge(ut);})),G=function G(ut){var lt=ut.changes.updated;e(8,st=lt==null?void 0:lt.map(function(Et){return Et.newValue;}));},k.observe(G,{annotations:D})):e(8,st=void 0);},L=function L(O){var D=ru(),ut={id:D,bodies:[],target:{annotation:D,selector:O.detail,creator:S,created:new Date()}};k.addAnnotation(ut),$.setSelected(ut.id);},V=function V(O){return function(D){var ut;var lt=O.target,Et=10*60*1e3,Tt=((ut=lt.creator)==null?void 0:ut.id)!==S.id||!lt.created||new Date().getTime()-lt.created.getTime()>Et;k.updateTarget(_objectSpread(_objectSpread({},lt),{},{selector:D.detail,created:Tt?lt.created:new Date(),updated:Tt?new Date():void 0,updatedBy:Tt?S:void 0}));};},rt=function rt(O){var _Mu2=Mu(O,E),D=_Mu2.x,ut=_Mu2.y,lt=k.getAt(D,ut);lt?u!==lt.id&&P.set(lt.id):P.set(void 0);},Q=function Q(O){return bu(O);},X=function X(O){return Ge(O);};function _t(O){en[O?"unshift":"push"](function(){C=O,e(6,C);});}function St(O){en[O?"unshift":"push"](function(){E=O,e(4,E);});}return r.$$set=function(O){"drawingEnabled"in O&&e(0,y=O.drawingEnabled),"image"in O&&e(25,_=O.image),"preferredDrawingMode"in O&&e(26,v=O.preferredDrawingMode),"state"in O&&e(27,g=O.state),"style"in O&&e(1,x=O.style),"toolName"in O&&e(2,b=O.toolName),"user"in O&&e(28,S=O.user),"visible"in O&&e(3,w=O.visible);},r.$$.update=function(){var _ref103,_$_;r.$$.dirty[0]&4&&e(14,(_ref103=un(b)||{tool:void 0,opts:void 0},i=_ref103.tool,s=_ref103.opts,_ref103),i,(e(32,s),e(2,b))),r.$$.dirty[0]&67108864|r.$$.dirty[1]&2&&e(13,n=(s==null?void 0:s.drawingMode)||v),r.$$.dirty[0]&16&&e(12,o=k_(E)),r.$$.dirty[0]&16&&e(11,(_$_=$_(E,k),a=_$_.onPointerDown,l=_$_.onPointerUp,_$_),a,(e(10,l),e(4,E))),r.$$.dirty[1]&4&&e(9,h=function h(O){return c.selected.find(function(D){return D.id===O.id&&D.editable;});}),r.$$.dirty[1]&4&&M(c.selected);},[y,x,b,w,E,T,C,I,st,h,l,a,o,n,i,u,d,p,P,$,k,L,V,rt,Q,_,v,g,S,N,F,z,s,c,X,_t,St];}var K_=/*#__PURE__*/function(_we14){_inherits(K_,_we14);var _super16=_createSuper(K_);function K_(t){var _this20;_classCallCheck(this,K_);_this20=_super16.call(this),Te(_assertThisInitialized(_this20),t,q_,j_,te,{drawingEnabled:0,image:25,preferredDrawingMode:26,state:27,style:1,toolName:2,user:28,visible:3,cancelDrawing:29,getDrawingTool:30,isDrawingEnabled:31},null,[-1,-1]);return _this20;}_createClass(K_,[{key:"cancelDrawing",get:function get(){return this.$$.ctx[29];}},{key:"getDrawingTool",get:function get(){return this.$$.ctx[30];}},{key:"isDrawingEnabled",get:function get(){return this.$$.ctx[31];}}]);return K_;}(we);function $u(r,t){var e=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:r.length-1;var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:Z_;for(;i>e;){if(i-e>600){var l=i-e+1,h=t-e+1,u=Math.log(l),c=.5*Math.exp(2*u/3),d=.5*Math.sqrt(u*c*(l-c)/l)*(h-l/2<0?-1:1),p=Math.max(e,Math.floor(t-h*c/l+d)),f=Math.min(i,Math.floor(t+(l-h)*c/l+d));$u(r,t,p,f,s);}var n=r[t];var o=e,a=i;for(ys(r,e,t),s(r[i],n)>0&&ys(r,e,i);o<a;){for(ys(r,o,a),o++,a--;s(r[o],n)<0;)o++;for(;s(r[a],n)>0;)a--;}s(r[e],n)===0?ys(r,e,a):(a++,ys(r,a,i)),a<=t&&(e=a+1),t<=a&&(i=a-1);}}function ys(r,t,e){var i=r[t];r[t]=r[e],r[e]=i;}function Z_(r,t){return r<t?-1:r>t?1:0;}var Q_=/*#__PURE__*/function(){function Q_(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:9;_classCallCheck(this,Q_);this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear();}_createClass(Q_,[{key:"all",value:function all(){return this._all(this.data,[]);}},{key:"search",value:function search(t){var e=this.data;var i=[];if(!dn(t,e))return i;var s=this.toBBox,n=[];for(;e;){for(var o=0;o<e.children.length;o++){var a=e.children[o],l=e.leaf?s(a):a;dn(t,l)&&(e.leaf?i.push(a):fa(t,l)?this._all(a,i):n.push(a));}e=n.pop();}return i;}},{key:"collides",value:function collides(t){var e=this.data;if(!dn(t,e))return!1;var i=[];for(;e;){for(var s=0;s<e.children.length;s++){var n=e.children[s],o=e.leaf?this.toBBox(n):n;if(dn(t,o)){if(e.leaf||fa(t,o))return!0;i.push(n);}}e=i.pop();}return!1;}},{key:"load",value:function load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(var i=0;i<t.length;i++)this.insert(t[i]);return this;}var e=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){var _i23=this.data;this.data=e,e=_i23;}this._insert(e,this.data.height-e.height-1,!0);}return this;}},{key:"insert",value:function insert(t){return t&&this._insert(t,this.data.height-1),this;}},{key:"clear",value:function clear(){return this.data=Di([]),this;}},{key:"remove",value:function remove(t,e){if(!t)return this;var i=this.data;var s=this.toBBox(t),n=[],o=[];var a,l,h;for(;i||n.length;){if(i||(i=n.pop(),l=n[n.length-1],a=o.pop(),h=!0),i.leaf){var u=J_(t,i.children,e);if(u!==-1)return i.children.splice(u,1),n.push(i),this._condense(n),this;}!h&&!i.leaf&&fa(i,s)?(n.push(i),o.push(a),a=0,l=i,i=i.children[0]):l?(a++,i=l.children[a],h=!1):i=null;}return this;}},{key:"toBBox",value:function toBBox(t){return t;}},{key:"compareMinX",value:function compareMinX(t,e){return t.minX-e.minX;}},{key:"compareMinY",value:function compareMinY(t,e){return t.minY-e.minY;}},{key:"toJSON",value:function toJSON(){return this.data;}},{key:"fromJSON",value:function fromJSON(t){return this.data=t,this;}},{key:"_all",value:function _all(t,e){var i=[];for(;t;)t.leaf?e.push.apply(e,_toConsumableArray(t.children)):i.push.apply(i,_toConsumableArray(t.children)),t=i.pop();return e;}},{key:"_build",value:function _build(t,e,i,s){var n=i-e+1;var o=this._maxEntries,a;if(n<=o)return a=Di(t.slice(e,i+1)),Ni(a,this.toBBox),a;s||(s=Math.ceil(Math.log(n)/Math.log(o)),o=Math.ceil(n/Math.pow(o,s-1))),a=Di([]),a.leaf=!1,a.height=s;var l=Math.ceil(n/o),h=l*Math.ceil(Math.sqrt(o));Hu(t,e,i,h,this.compareMinX);for(var u=e;u<=i;u+=h){var c=Math.min(u+h-1,i);Hu(t,u,c,l,this.compareMinY);for(var d=u;d<=c;d+=l){var p=Math.min(d+l-1,c);a.children.push(this._build(t,d,p,s-1));}}return Ni(a,this.toBBox),a;}},{key:"_chooseSubtree",value:function _chooseSubtree(t,e,i,s){for(;s.push(e),!(e.leaf||s.length-1===i);){var n=1/0,o=1/0,a=void 0;for(var l=0;l<e.children.length;l++){var h=e.children[l],u=da(h),c=r0(t,h)-u;c<o?(o=c,n=u<n?u:n,a=h):c===o&&u<n&&(n=u,a=h);}e=a||e.children[0];}return e;}},{key:"_insert",value:function _insert(t,e,i){var s=i?t:this.toBBox(t),n=[],o=this._chooseSubtree(s,this.data,e,n);for(o.children.push(t),vs(o,s);e>=0&&n[e].children.length>this._maxEntries;)this._split(n,e),e--;this._adjustParentBBoxes(s,n,e);}},{key:"_split",value:function _split(t,e){var i=t[e],s=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,s);var o=this._chooseSplitIndex(i,n,s),a=Di(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,Ni(i,this.toBBox),Ni(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(i,a);}},{key:"_splitRoot",value:function _splitRoot(t,e){this.data=Di([t,e]),this.data.height=t.height+1,this.data.leaf=!1,Ni(this.data,this.toBBox);}},{key:"_chooseSplitIndex",value:function _chooseSplitIndex(t,e,i){var s,n=1/0,o=1/0;for(var a=e;a<=i-e;a++){var l=_s(t,0,a,this.toBBox),h=_s(t,a,i,this.toBBox),u=i0(l,h),c=da(l)+da(h);u<n?(n=u,s=a,o=c<o?c:o):u===n&&c<o&&(o=c,s=a);}return s||i-e;}},{key:"_chooseSplitAxis",value:function _chooseSplitAxis(t,e,i){var s=t.leaf?this.compareMinX:t0,n=t.leaf?this.compareMinY:e0,o=this._allDistMargin(t,e,i,s),a=this._allDistMargin(t,e,i,n);o<a&&t.children.sort(s);}},{key:"_allDistMargin",value:function _allDistMargin(t,e,i,s){t.children.sort(s);var n=this.toBBox,o=_s(t,0,e,n),a=_s(t,i-e,i,n);var l=cn(o)+cn(a);for(var h=e;h<i-e;h++){var u=t.children[h];vs(o,t.leaf?n(u):u),l+=cn(o);}for(var _h6=i-e-1;_h6>=e;_h6--){var _u3=t.children[_h6];vs(a,t.leaf?n(_u3):_u3),l+=cn(a);}return l;}},{key:"_adjustParentBBoxes",value:function _adjustParentBBoxes(t,e,i){for(var s=i;s>=0;s--)vs(e[s],t);}},{key:"_condense",value:function _condense(t){for(var e=t.length-1,i;e>=0;e--)t[e].children.length===0?e>0?(i=t[e-1].children,i.splice(i.indexOf(t[e]),1)):this.clear():Ni(t[e],this.toBBox);}}]);return Q_;}();function J_(r,t,e){if(!e)return t.indexOf(r);for(var i=0;i<t.length;i++)if(e(r,t[i]))return i;return-1;}function Ni(r,t){_s(r,0,r.children.length,t,r);}function _s(r,t,e,i,s){s||(s=Di(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(var n=t;n<e;n++){var o=r.children[n];vs(s,r.leaf?i(o):o);}return s;}function vs(r,t){return r.minX=Math.min(r.minX,t.minX),r.minY=Math.min(r.minY,t.minY),r.maxX=Math.max(r.maxX,t.maxX),r.maxY=Math.max(r.maxY,t.maxY),r;}function t0(r,t){return r.minX-t.minX;}function e0(r,t){return r.minY-t.minY;}function da(r){return(r.maxX-r.minX)*(r.maxY-r.minY);}function cn(r){return r.maxX-r.minX+(r.maxY-r.minY);}function r0(r,t){return(Math.max(t.maxX,r.maxX)-Math.min(t.minX,r.minX))*(Math.max(t.maxY,r.maxY)-Math.min(t.minY,r.minY));}function i0(r,t){var e=Math.max(r.minX,t.minX),i=Math.max(r.minY,t.minY),s=Math.min(r.maxX,t.maxX),n=Math.min(r.maxY,t.maxY);return Math.max(0,s-e)*Math.max(0,n-i);}function fa(r,t){return r.minX<=t.minX&&r.minY<=t.minY&&t.maxX<=r.maxX&&t.maxY<=r.maxY;}function dn(r,t){return t.minX<=r.maxX&&t.minY<=r.maxY&&t.maxX>=r.minX&&t.maxY>=r.minY;}function Di(r){return{children:r,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};}function Hu(r,t,e,i,s){var n=[t,e];for(;n.length;){if(e=n.pop(),t=n.pop(),e-t<=i)continue;var o=t+Math.ceil((e-t)/i/2)*i;$u(r,o,t,e,s),n.push(t,o,o,e);}}var s0=function s0(){var r=new Q_(),t=new Map(),e=function e(){return _toConsumableArray(t.values());},i=function i(){r.clear(),t.clear();},s=function s(o){if(!nn(o))return;var _o$selector$geometry$=o.selector.geometry.bounds,a=_o$selector$geometry$.minX,l=_o$selector$geometry$.minY,h=_o$selector$geometry$.maxX,u=_o$selector$geometry$.maxY,c={minX:a,minY:l,maxX:h,maxY:u,target:o};r.insert(c),t.set(o.annotation,c);},n=function n(o){if(!nn(o))return;var a=t.get(o.annotation);a&&r.remove(a),t["delete"](o.annotation);};return{all:e,clear:i,getAt:function getAt(o,a){var l=r.search({minX:o,minY:a,maxX:o,maxY:a}).map(function(h){return h.target;}).filter(function(h){return h.selector.type===vt.RECTANGLE||vg(h.selector,o,a);});if(l.length>0)return l.sort(function(h,u){return Ko(h.selector)-Ko(u.selector);}),l[0];},getIntersecting:function getIntersecting(o,a,l,h){return r.search({minX:o,minY:a,maxX:o+l,maxY:a+h}).map(function(u){return u.target;});},insert:s,remove:n,set:function set(o){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!0;a&&i();var l=o.reduce(function(h,u){if(nn(u)){var _u$selector$geometry$=u.selector.geometry.bounds,c=_u$selector$geometry$.minX,d=_u$selector$geometry$.minY,p=_u$selector$geometry$.maxX,f=_u$selector$geometry$.maxY;return[].concat(_toConsumableArray(h),[{minX:c,minY:d,maxX:p,maxY:f,target:u}]);}else return h;},[]);l.forEach(function(h){return t.set(h.target.annotation,h);}),r.load(l);},size:function size(){return r.all().length;},update:function update(o,a){n(o),s(a);}};},Vu=function Vu(r){var t=Ey(),e=s0(),i=hy(t,r.userSelectAction,r.adapter),s=ly(t),n=Cy();return t.observe(function(_ref104){var o=_ref104.changes;e.set((o.created||[]).map(function(a){return a.target;}),!1),(o.deleted||[]).forEach(function(a){return e.remove(a.target);}),(o.updated||[]).forEach(function(_ref105){var a=_ref105.oldValue,l=_ref105.newValue;return e.update(a.target,l.target);});}),{store:_objectSpread(_objectSpread({},t),{},{getAt:function getAt(o,a){var l=e.getAt(o,a);return l?t.getAnnotation(l.annotation):void 0;},getIntersecting:function getIntersecting(o,a,l,h){return e.getIntersecting(o,a,l,h).map(function(u){return t.getAnnotation(u.annotation);});}}),selection:i,hover:s,viewport:n};},n0=function n0(r){var t=Vu(r);return _objectSpread(_objectSpread({},t),{},{store:Ty(t.store)});},o0=function o0(r){var t,e;if(r.nodeName==="CANVAS")t=r,e=t.getContext("2d",{willReadFrequently:!0});else{var s=r;t=document.createElement("canvas"),t.width=s.width,t.height=s.height,e=t.getContext("2d",{willReadFrequently:!0}),e.drawImage(s,0,0,s.width,s.height);}var i=0;for(var _s3=1;_s3<10;_s3++)for(var n=1;n<10;n++){var o=Math.round(n*t.width/10),a=Math.round(_s3*t.height/10),l=e.getImageData(o,a,1,1).data,h=(.299*l[0]+.587*l[1]+.114*l[2])/255;i+=h;}return i/81;},Xu=function Xu(r){var t=o0(r),e=t>.6?"dark":"light";return console.log("[Annotorious] Image brightness: ".concat(t.toFixed(1),". Setting ").concat(e," theme.")),e;},zu=function zu(r,t,e){return t.setAttribute("data-theme",e==="auto"?Xu(r):e);},Wu=function Wu(r,t){return _objectSpread(_objectSpread({},r),{},{drawingEnabled:r.drawingEnabled===void 0?t.drawingEnabled:r.drawingEnabled,drawingMode:r.drawingMode||t.drawingMode,userSelectAction:r.userSelectAction||t.userSelectAction,theme:r.theme||t.theme});},Yu=(typeof navigator==="undefined"?"undefined":_typeof(navigator))>"u"?!1:navigator.userAgent.indexOf("Mac OS X")!==-1,ju=function ju(r,t){var e=t||document,i=function i(o){var a=o;a.key==="z"&&a.ctrlKey?r.undo():a.key==="y"&&a.ctrlKey&&r.redo();},s=function s(o){var a=o;a.key==="z"&&a.metaKey&&(a.shiftKey?r.redo():r.undo());},n=function n(){Yu?e.removeEventListener("keydown",s):e.removeEventListener("keydown",i);};return Yu?e.addEventListener("keydown",s):e.addEventListener("keydown",i),{destroy:n};},a0=function a0(r){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!r)throw"Missing argument: image";var e=typeof r=="string"?document.getElementById(r):r,i=Wu(t,{drawingEnabled:!0,drawingMode:"drag",userSelectAction:su.EDIT,theme:"light"}),s=n0(i),n=s.selection,o=s.store,a=Sy(o,i.initialHistory),l=Iy(s,a,i.adapter,i.autoSave),h=document.createElement("DIV");h.style.position="relative",h.style.display="inline-block",e.style.display="block",e.parentNode.insertBefore(h,e),h.appendChild(e);var u=ju(a);var c=Uy();zu(e,h,i.theme);var d=new K_({target:h,props:{drawingEnabled:!!i.drawingEnabled,image:e,preferredDrawingMode:i.drawingMode,state:s,style:i.style,user:c}});d.$on("click",function(C){var _C$detail=C.detail,E=_C$detail.originalEvent,I=_C$detail.annotation;I?n.userSelect(I.id,E):n.isEmpty()||n.clear();});var p=My(s,a,i.adapter),f=function f(){return d.cancelDrawing();},m=function m(){d.$destroy(),h.parentNode.insertBefore(e,h),h.parentNode.removeChild(h),u.destroy(),a.destroy();},y=function y(){return d.getDrawingTool();},_=function _(){return c;},v=function v(){return d.isDrawingEnabled();},g=function g(C,E,I){return Cu(C,E,I);},x=function x(C,E){return Eu(C,E);},b=function b(C){if(!un(C))throw"No drawing tool named ".concat(C);d.$set({toolName:C});},S=function S(C){return d.$set({drawingEnabled:C});},w=function w(C){console.warn("Filter not implemented yet");},T=function T(C){return d.$set({style:C});},N=function N(C){return zu(e,h,C);},F=function F(C){c=C,d.$set({user:C});},z=function z(C){return d.$set({visible:C});};return _objectSpread(_objectSpread({},p),{},{cancelDrawing:f,destroy:m,getDrawingTool:y,getUser:_,isDrawingEnabled:v,listDrawingTools:hn,on:l.on,off:l.off,registerDrawingTool:g,registerShapeEditor:x,setDrawingEnabled:S,setDrawingTool:b,setFilter:w,setStyle:T,setTheme:N,setUser:F,setVisible:z,element:h,state:s});};function me(){}function pa(r,t){for(var e in t)r[e]=t[e];return r;}function qu(r){return r();}function Ku(){return Object.create(null);}function er(r){r.forEach(qu);}function Kt(r){return typeof r=="function";}function Wt(r,t){return r!=r?t==t:r!==t||r&&_typeof(r)=="object"||typeof r=="function";}function l0(r){return Object.keys(r).length===0;}function h0(r){for(var _len5=arguments.length,t=new Array(_len5>1?_len5-1:0),_key5=1;_key5<_len5;_key5++){t[_key5-1]=arguments[_key5];}if(r==null){var _iterator14=_createForOfIteratorHelper(t),_step14;try{for(_iterator14.s();!(_step14=_iterator14.n()).done;){var i=_step14.value;i(void 0);}}catch(err){_iterator14.e(err);}finally{_iterator14.f();}return me;}var e=r.subscribe.apply(r,t);return e.unsubscribe?function(){return e.unsubscribe();}:e;}function fn(r,t,e){r.$$.on_destroy.push(h0(t,e));}function Zu(r,t,e,i){if(r){var s=Qu(r,t,e,i);return r[0](s);}}function Qu(r,t,e,i){return r[1]&&i?pa(e.ctx.slice(),r[1](i(t))):e.ctx;}function Ju(r,t,e,i){if(r[2]&&i){var s=r[2](i(e));if(t.dirty===void 0)return s;if(_typeof(s)=="object"){var n=[],o=Math.max(t.dirty.length,s.length);for(var a=0;a<o;a+=1)n[a]=t.dirty[a]|s[a];return n;}return t.dirty|s;}return t.dirty;}function tc(r,t,e,i,s,n){if(s){var o=Qu(t,e,i,n);r.p(o,s);}}function ec(r){if(r.ctx.length>32){var t=[],e=r.ctx.length/32;for(var i=0;i<e;i++)t[i]=-1;return t;}return-1;}function rc(r){var t={};for(var e in r)e[0]!=="$"&&(t[e]=r[e]);return t;}function pn(r){return r!==null&&r!==void 0?r:"";}var ic=(typeof window==="undefined"?"undefined":_typeof(window))<"u"?window:(typeof globalThis==="undefined"?"undefined":_typeof(globalThis))<"u"?globalThis:global;function Ae(r,t){r.appendChild(t);}function ct(r,t,e){r.insertBefore(t,e||null);}function ht(r){r.parentNode&&r.parentNode.removeChild(r);}function ii(r,t){for(var e=0;e<r.length;e+=1)r[e]&&r[e].d(t);}function xt(r){return document.createElementNS("http://www.w3.org/2000/svg",r);}function ma(r){return document.createTextNode(r);}function Ve(){return ma(" ");}function Re(){return ma("");}function Zt(r,t,e,i){return r.addEventListener(t,e,i),function(){return r.removeEventListener(t,e,i);};}function R(r,t,e){e==null?r.removeAttribute(t):r.getAttribute(t)!==e&&r.setAttribute(t,e);}function u0(r){return Array.from(r.childNodes);}function c0(r,t){t=""+t,r.data!==t&&(r.data=t);}function mn(r,t,e){r.classList.toggle(t,!!e);}function d0(r,t){var _ref106=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{},_ref106$bubbles=_ref106.bubbles,e=_ref106$bubbles===void 0?!1:_ref106$bubbles,_ref106$cancelable=_ref106.cancelable,i=_ref106$cancelable===void 0?!1:_ref106$cancelable;return new CustomEvent(r,{detail:t,bubbles:e,cancelable:i});}var xs;function bs(r){xs=r;}function ga(){if(!xs)throw new Error("Function called outside component initialization");return xs;}function gn(r){ga().$$.on_mount.push(r);}function f0(r){ga().$$.on_destroy.push(r);}function yn(){var r=ga();return function(t,e){var _ref107=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{},_ref107$cancelable=_ref107.cancelable,i=_ref107$cancelable===void 0?!1:_ref107$cancelable;var s=r.$$.callbacks[t];if(s){var n=d0(t,e,{cancelable:i});return s.slice().forEach(function(o){o.call(r,n);}),!n.defaultPrevented;}return!0;};}function De(r,t){var _this21=this;var e=r.$$.callbacks[t.type];e&&e.slice().forEach(function(i){return i.call(_this21,t);});}var Li=[],_n=[];var Bi=[];var sc=[],p0=Promise.resolve();var ya=!1;function m0(){ya||(ya=!0,p0.then(nc));}function _a(r){Bi.push(r);}var va=new Set();var Fi=0;function nc(){if(Fi!==0)return;var r=xs;do{try{for(;Fi<Li.length;){var t=Li[Fi];Fi++,bs(t),g0(t.$$);}}catch(t){throw Li.length=0,Fi=0,t;}for(bs(null),Li.length=0,Fi=0;_n.length;)_n.pop()();for(var _t7=0;_t7<Bi.length;_t7+=1){var e=Bi[_t7];va.has(e)||(va.add(e),e());}Bi.length=0;}while(Li.length);for(;sc.length;)sc.pop()();ya=!1,va.clear(),bs(r);}function g0(r){if(r.fragment!==null){r.update(),er(r.before_update);var t=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,t),r.after_update.forEach(_a);}}function y0(r){var t=[],e=[];Bi.forEach(function(i){return r.indexOf(i)===-1?t.push(i):e.push(i);}),e.forEach(function(i){return i();}),Bi=t;}var vn=new Set();var si;function ge(){si={r:0,c:[],p:si};}function ye(){si.r||er(si.c),si=si.p;}function q(r,t){r&&r.i&&(vn["delete"](r),r.i(t));}function et(r,t,e,i){if(r&&r.o){if(vn.has(r))return;vn.add(r),si.c.push(function(){vn["delete"](r),i&&(e&&r.d(1),i());}),r.o(t);}else i&&i();}function Se(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r);}function Ht(r){r&&r.c();}function Ft(r,t,e){var _r$$$2=r.$$,i=_r$$$2.fragment,s=_r$$$2.after_update;i&&i.m(t,e),_a(function(){var _r$$$$on_destroy2;var n=r.$$.on_mount.map(qu).filter(Kt);r.$$.on_destroy?(_r$$$$on_destroy2=r.$$.on_destroy).push.apply(_r$$$$on_destroy2,_toConsumableArray(n)):er(n),r.$$.on_mount=[];}),s.forEach(_a);}function Ut(r,t){var e=r.$$;e.fragment!==null&&(y0(e.after_update),er(e.on_destroy),e.fragment&&e.fragment.d(t),e.on_destroy=e.fragment=null,e.ctx=[]);}function _0(r,t){r.$$.dirty[0]===-1&&(Li.push(r),m0(),r.$$.dirty.fill(0)),r.$$.dirty[t/31|0]|=1<<t%31;}function ee(r,t,e,i,s,n){var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:null;var a=arguments.length>7&&arguments[7]!==undefined?arguments[7]:[-1];var l=xs;bs(r);var h=r.$$={fragment:null,ctx:[],props:n,update:me,not_equal:s,bound:Ku(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:Ku(),dirty:a,skip_bound:!1,root:t.target||l.$$.root};o&&o(h.root);var u=!1;if(h.ctx=e?e(r,t.props||{},function(c,d){var f=(arguments.length<=2?0:arguments.length-2)?arguments.length<=2?undefined:arguments[2]:d;return h.ctx&&s(h.ctx[c],h.ctx[c]=f)&&(!h.skip_bound&&h.bound[c]&&h.bound[c](f),u&&_0(r,c)),d;}):[],h.update(),u=!0,er(h.before_update),h.fragment=i?i(h.ctx):!1,t.target){if(t.hydrate){var c=u0(t.target);h.fragment&&h.fragment.l(c),c.forEach(ht);}else h.fragment&&h.fragment.c();t.intro&&q(r.$$.fragment),Ft(r,t.target,t.anchor),nc();}bs(l);}var re=/*#__PURE__*/function(){function re(){_classCallCheck(this,re);Pt(this,"$$");Pt(this,"$$set");}_createClass(re,[{key:"$destroy",value:function $destroy(){Ut(this,1),this.$destroy=me;}},{key:"$on",value:function $on(t,e){if(!Kt(e))return me;var i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(e),function(){var s=i.indexOf(e);s!==-1&&i.splice(s,1);};}},{key:"$set",value:function $set(t){this.$$set&&!l0(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1);}}]);return re;}();var v0="4";(typeof window==="undefined"?"undefined":_typeof(window))<"u"&&(window.__svelte||(window.__svelte={v:new Set()})).v.add(v0);var ni=function(r){return r[r.WEBGL_LEGACY=0]="WEBGL_LEGACY",r[r.WEBGL=1]="WEBGL",r[r.WEBGL2=2]="WEBGL2",r;}(ni||{}),oc=function(r){return r[r.UNKNOWN=0]="UNKNOWN",r[r.WEBGL=1]="WEBGL",r[r.CANVAS=2]="CANVAS",r;}(oc||{}),xa=function(r){return r[r.COLOR=16384]="COLOR",r[r.DEPTH=256]="DEPTH",r[r.STENCIL=1024]="STENCIL",r;}(xa||{}),at=function(r){return r[r.NORMAL=0]="NORMAL",r[r.ADD=1]="ADD",r[r.MULTIPLY=2]="MULTIPLY",r[r.SCREEN=3]="SCREEN",r[r.OVERLAY=4]="OVERLAY",r[r.DARKEN=5]="DARKEN",r[r.LIGHTEN=6]="LIGHTEN",r[r.COLOR_DODGE=7]="COLOR_DODGE",r[r.COLOR_BURN=8]="COLOR_BURN",r[r.HARD_LIGHT=9]="HARD_LIGHT",r[r.SOFT_LIGHT=10]="SOFT_LIGHT",r[r.DIFFERENCE=11]="DIFFERENCE",r[r.EXCLUSION=12]="EXCLUSION",r[r.HUE=13]="HUE",r[r.SATURATION=14]="SATURATION",r[r.COLOR=15]="COLOR",r[r.LUMINOSITY=16]="LUMINOSITY",r[r.NORMAL_NPM=17]="NORMAL_NPM",r[r.ADD_NPM=18]="ADD_NPM",r[r.SCREEN_NPM=19]="SCREEN_NPM",r[r.NONE=20]="NONE",r[r.SRC_OVER=0]="SRC_OVER",r[r.SRC_IN=21]="SRC_IN",r[r.SRC_OUT=22]="SRC_OUT",r[r.SRC_ATOP=23]="SRC_ATOP",r[r.DST_OVER=24]="DST_OVER",r[r.DST_IN=25]="DST_IN",r[r.DST_OUT=26]="DST_OUT",r[r.DST_ATOP=27]="DST_ATOP",r[r.ERASE=26]="ERASE",r[r.SUBTRACT=28]="SUBTRACT",r[r.XOR=29]="XOR",r;}(at||{}),rr=function(r){return r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN",r;}(rr||{}),H=function(r){return r[r.RGBA=6408]="RGBA",r[r.RGB=6407]="RGB",r[r.RG=33319]="RG",r[r.RED=6403]="RED",r[r.RGBA_INTEGER=36249]="RGBA_INTEGER",r[r.RGB_INTEGER=36248]="RGB_INTEGER",r[r.RG_INTEGER=33320]="RG_INTEGER",r[r.RED_INTEGER=36244]="RED_INTEGER",r[r.ALPHA=6406]="ALPHA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL",r;}(H||{}),Ui=function(r){return r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",r;}(Ui||{}),tt=function(r){return r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",r[r.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",r[r.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",r[r.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",r[r.BYTE=5120]="BYTE",r[r.SHORT=5122]="SHORT",r[r.INT=5124]="INT",r[r.FLOAT=5126]="FLOAT",r[r.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",r[r.HALF_FLOAT=36193]="HALF_FLOAT",r;}(tt||{}),Y=function(r){return r[r.FLOAT=0]="FLOAT",r[r.INT=1]="INT",r[r.UINT=2]="UINT",r;}(Y||{}),vr=function(r){return r[r.NEAREST=0]="NEAREST",r[r.LINEAR=1]="LINEAR",r;}(vr||{}),Dr=function(r){return r[r.CLAMP=33071]="CLAMP",r[r.REPEAT=10497]="REPEAT",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r;}(Dr||{}),ir=function(r){return r[r.OFF=0]="OFF",r[r.POW2=1]="POW2",r[r.ON=2]="ON",r[r.ON_MANUAL=3]="ON_MANUAL",r;}(ir||{}),Ce=function(r){return r[r.NPM=0]="NPM",r[r.UNPACK=1]="UNPACK",r[r.PMA=2]="PMA",r[r.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",r[r.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",r[r.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",r;}(Ce||{}),sr=function(r){return r[r.NO=0]="NO",r[r.YES=1]="YES",r[r.AUTO=2]="AUTO",r[r.BLEND=0]="BLEND",r[r.CLEAR=1]="CLEAR",r[r.BLIT=2]="BLIT",r;}(sr||{}),ba=function(r){return r[r.AUTO=0]="AUTO",r[r.MANUAL=1]="MANUAL",r;}(ba||{}),Le=function(r){return r.LOW="lowp",r.MEDIUM="mediump",r.HIGH="highp",r;}(Le||{}),Qt=function(r){return r[r.NONE=0]="NONE",r[r.SCISSOR=1]="SCISSOR",r[r.STENCIL=2]="STENCIL",r[r.SPRITE=3]="SPRITE",r[r.COLOR=4]="COLOR",r;}(Qt||{}),Yt=function(r){return r[r.NONE=0]="NONE",r[r.LOW=2]="LOW",r[r.MEDIUM=4]="MEDIUM",r[r.HIGH=8]="HIGH",r;}(Yt||{}),nr=function(r){return r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",r;}(nr||{});var j={ADAPTER:{createCanvas:function createCanvas(r,t){var e=document.createElement("canvas");return e.width=r,e.height=t,e;},getCanvasRenderingContext2D:function getCanvasRenderingContext2D(){return CanvasRenderingContext2D;},getWebGLRenderingContext:function getWebGLRenderingContext(){return WebGLRenderingContext;},getNavigator:function getNavigator(){return navigator;},getBaseUrl:function getBaseUrl(){var _document$baseURI;return(_document$baseURI=document.baseURI)!==null&&_document$baseURI!==void 0?_document$baseURI:window.location.href;},getFontFaceSet:function getFontFaceSet(){return document.fonts;},fetch:function(_fetch){function fetch(_x2,_x3){return _fetch.apply(this,arguments);}fetch.toString=function(){return _fetch.toString();};return fetch;}(function(r,t){return fetch(r,t);}),parseXML:function parseXML(r){return new DOMParser().parseFromString(r,"text/xml");}},RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var Ea=/iPhone/i,ac=/iPod/i,lc=/iPad/i,hc=/\biOS-universal(?:.+)Mac\b/i,Ta=/\bAndroid(?:.+)Mobile\b/i,uc=/Android/i,ki=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,xn=/Silk/i,xr=/Windows Phone/i,cc=/\bWindows(?:.+)ARM\b/i,dc=/BlackBerry/i,fc=/BB10/i,pc=/Opera Mini/i,mc=/\b(CriOS|Chrome)(?:.+)Mobile/i,gc=/Mobile(?:.+)Firefox\b/i,yc=function yc(r){return _typeof(r)<"u"&&r.platform==="MacIntel"&&typeof r.maxTouchPoints=="number"&&r.maxTouchPoints>1&&(typeof MSStream==="undefined"?"undefined":_typeof(MSStream))>"u";};function x0(r){return function(t){return t.test(r);};}function _c(r){var t={userAgent:"",platform:"",maxTouchPoints:0};!r&&(typeof navigator==="undefined"?"undefined":_typeof(navigator))<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof r=="string"?t.userAgent=r:r&&r.userAgent&&(t={userAgent:r.userAgent,platform:r.platform,maxTouchPoints:r.maxTouchPoints||0});var e=t.userAgent,i=e.split("[FBAN");_typeof(i[1])<"u"&&(e=i[0]),i=e.split("Twitter"),_typeof(i[1])<"u"&&(e=i[0]);var s=x0(e),n={apple:{phone:s(Ea)&&!s(xr),ipod:s(ac),tablet:!s(Ea)&&(s(lc)||yc(t))&&!s(xr),universal:s(hc),device:(s(Ea)||s(ac)||s(lc)||s(hc)||yc(t))&&!s(xr)},amazon:{phone:s(ki),tablet:!s(ki)&&s(xn),device:s(ki)||s(xn)},android:{phone:!s(xr)&&s(ki)||!s(xr)&&s(Ta),tablet:!s(xr)&&!s(ki)&&!s(Ta)&&(s(xn)||s(uc)),device:!s(xr)&&(s(ki)||s(xn)||s(Ta)||s(uc))||s(/\bokhttp\b/i)},windows:{phone:s(xr),tablet:s(cc),device:s(xr)||s(cc)},other:{blackberry:s(dc),blackberry10:s(fc),opera:s(pc),firefox:s(gc),chrome:s(mc),device:s(dc)||s(fc)||s(pc)||s(gc)||s(mc)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n;}var b0=(_c$default=_c["default"])!==null&&_c$default!==void 0?_c$default:_c,br=b0(globalThis.navigator);j.RETINA_PREFIX=/@([0-9\.]+)x/,j.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Es=(typeof globalThis==="undefined"?"undefined":_typeof(globalThis))<"u"?globalThis:(typeof window==="undefined"?"undefined":_typeof(window))<"u"?window:(typeof global==="undefined"?"undefined":_typeof(global))<"u"?global:(typeof self==="undefined"?"undefined":_typeof(self))<"u"?self:{};function vc(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r["default"]:r;}function E0(r){if(r.__esModule)return r;var t=r["default"];if(typeof t=="function"){var e=function i(){return this instanceof i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments);};e.prototype=t.prototype;}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(r).forEach(function(i){var s=Object.getOwnPropertyDescriptor(r,i);Object.defineProperty(e,i,s.get?s:{enumerable:!0,get:function get(){return r[i];}});}),e;}var xc={exports:{}};(function(r){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function s(l,h,u){this.fn=l,this.context=h,this.once=u||!1;}function n(l,h,u,c,d){if(typeof u!="function")throw new TypeError("The listener must be a function");var p=new s(u,c||l,d),f=e?e+h:h;return l._events[f]?l._events[f].fn?l._events[f]=[l._events[f],p]:l._events[f].push(p):(l._events[f]=p,l._eventsCount++),l;}function o(l,h){--l._eventsCount===0?l._events=new i():delete l._events[h];}function a(){this._events=new i(),this._eventsCount=0;}a.prototype.eventNames=function(){var h=[],u,c;if(this._eventsCount===0)return h;for(c in u=this._events)t.call(u,c)&&h.push(e?c.slice(1):c);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(u)):h;},a.prototype.listeners=function(h){var u=e?e+h:h,c=this._events[u];if(!c)return[];if(c.fn)return[c.fn];for(var d=0,p=c.length,f=new Array(p);d<p;d++)f[d]=c[d].fn;return f;},a.prototype.listenerCount=function(h){var u=e?e+h:h,c=this._events[u];return c?c.fn?1:c.length:0;},a.prototype.emit=function(h,u,c,d,p,f){var m=e?e+h:h;if(!this._events[m])return!1;var y=this._events[m],_=arguments.length,v,g;if(y.fn){switch(y.once&&this.removeListener(h,y.fn,void 0,!0),_){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,u),!0;case 3:return y.fn.call(y.context,u,c),!0;case 4:return y.fn.call(y.context,u,c,d),!0;case 5:return y.fn.call(y.context,u,c,d,p),!0;case 6:return y.fn.call(y.context,u,c,d,p,f),!0;}for(g=1,v=new Array(_-1);g<_;g++)v[g-1]=arguments[g];y.fn.apply(y.context,v);}else{var x=y.length,b;for(g=0;g<x;g++)switch(y[g].once&&this.removeListener(h,y[g].fn,void 0,!0),_){case 1:y[g].fn.call(y[g].context);break;case 2:y[g].fn.call(y[g].context,u);break;case 3:y[g].fn.call(y[g].context,u,c);break;case 4:y[g].fn.call(y[g].context,u,c,d);break;default:if(!v)for(b=1,v=new Array(_-1);b<_;b++)v[b-1]=arguments[b];y[g].fn.apply(y[g].context,v);}}return!0;},a.prototype.on=function(h,u,c){return n(this,h,u,c,!1);},a.prototype.once=function(h,u,c){return n(this,h,u,c,!0);},a.prototype.removeListener=function(h,u,c,d){var p=e?e+h:h;if(!this._events[p])return this;if(!u)return o(this,p),this;var f=this._events[p];if(f.fn)f.fn===u&&(!d||f.once)&&(!c||f.context===c)&&o(this,p);else{for(var m=0,y=[],_=f.length;m<_;m++)(f[m].fn!==u||d&&!f[m].once||c&&f[m].context!==c)&&y.push(f[m]);y.length?this._events[p]=y.length===1?y[0]:y:o(this,p);}return this;},a.prototype.removeAllListeners=function(h){var u;return h?(u=e?e+h:h,this._events[u]&&o(this,u)):(this._events=new i(),this._eventsCount=0),this;},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=e,a.EventEmitter=a,r.exports=a;})(xc);var T0=xc.exports;var Ts=vc(T0);var wa={exports:{}};wa.exports=bn,wa.exports["default"]=bn;function bn(r,t,e){e=e||2;var i=t&&t.length,s=i?t[0]*e:r.length,n=bc(r,0,s,e,!0),o=[];if(!n||n.next===n.prev)return o;var a,l,h,u,c,d,p;if(i&&(n=I0(r,t,n,e)),r.length>80*e){a=h=r[0],l=u=r[1];for(var f=e;f<s;f+=e)c=r[f],d=r[f+1],c<a&&(a=c),d<l&&(l=d),c>h&&(h=c),d>u&&(u=d);p=Math.max(h-a,u-l),p=p!==0?32767/p:0;}return ws(n,o,e,a,l,p,0),o;}function bc(r,t,e,i,s){var n,o;if(s===Ca(r,t,e,i)>0)for(n=t;n<e;n+=i)o=wc(n,r[n],r[n+1],o);else for(n=e-i;n>=t;n-=i)o=wc(n,r[n],r[n+1],o);return o&&En(o,o.next)&&(Ss(o),o=o.next),o;}function oi(r,t){if(!r)return r;t||(t=r);var e=r,i;do if(i=!1,!e.steiner&&(En(e,e.next)||Nt(e.prev,e,e.next)===0)){if(Ss(e),e=t=e.prev,e===e.next)break;i=!0;}else e=e.next;while(i||e!==t);return t;}function ws(r,t,e,i,s,n,o){if(r){!o&&n&&N0(r,i,s,n);for(var a=r,l,h;r.prev!==r.next;){if(l=r.prev,h=r.next,n?A0(r,i,s,n):w0(r)){t.push(l.i/e|0),t.push(r.i/e|0),t.push(h.i/e|0),Ss(r),r=h.next,a=h.next;continue;}if(r=h,r===a){o?o===1?(r=S0(oi(r),t,e),ws(r,t,e,i,s,n,2)):o===2&&C0(r,t,e,i,s,n):ws(oi(r),t,e,i,s,n,1);break;}}}}function w0(r){var t=r.prev,e=r,i=r.next;if(Nt(t,e,i)>=0)return!1;for(var s=t.x,n=e.x,o=i.x,a=t.y,l=e.y,h=i.y,u=s<n?s<o?s:o:n<o?n:o,c=a<l?a<h?a:h:l<h?l:h,d=s>n?s>o?s:o:n>o?n:o,p=a>l?a>h?a:h:l>h?l:h,f=i.next;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=c&&f.y<=p&&Gi(s,a,n,l,o,h,f.x,f.y)&&Nt(f.prev,f,f.next)>=0)return!1;f=f.next;}return!0;}function A0(r,t,e,i){var s=r.prev,n=r,o=r.next;if(Nt(s,n,o)>=0)return!1;for(var a=s.x,l=n.x,h=o.x,u=s.y,c=n.y,d=o.y,p=a<l?a<h?a:h:l<h?l:h,f=u<c?u<d?u:d:c<d?c:d,m=a>l?a>h?a:h:l>h?l:h,y=u>c?u>d?u:d:c>d?c:d,_=Aa(p,f,t,e,i),v=Aa(m,y,t,e,i),g=r.prevZ,x=r.nextZ;g&&g.z>=_&&x&&x.z<=v;){if(g.x>=p&&g.x<=m&&g.y>=f&&g.y<=y&&g!==s&&g!==o&&Gi(a,u,l,c,h,d,g.x,g.y)&&Nt(g.prev,g,g.next)>=0||(g=g.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=y&&x!==s&&x!==o&&Gi(a,u,l,c,h,d,x.x,x.y)&&Nt(x.prev,x,x.next)>=0))return!1;x=x.nextZ;}for(;g&&g.z>=_;){if(g.x>=p&&g.x<=m&&g.y>=f&&g.y<=y&&g!==s&&g!==o&&Gi(a,u,l,c,h,d,g.x,g.y)&&Nt(g.prev,g,g.next)>=0)return!1;g=g.prevZ;}for(;x&&x.z<=v;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=y&&x!==s&&x!==o&&Gi(a,u,l,c,h,d,x.x,x.y)&&Nt(x.prev,x,x.next)>=0)return!1;x=x.nextZ;}return!0;}function S0(r,t,e){var i=r;do{var s=i.prev,n=i.next.next;!En(s,n)&&Ec(s,i,i.next,n)&&As(s,n)&&As(n,s)&&(t.push(s.i/e|0),t.push(i.i/e|0),t.push(n.i/e|0),Ss(i),Ss(i.next),i=r=n),i=i.next;}while(i!==r);return oi(i);}function C0(r,t,e,i,s,n){var o=r;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&B0(o,a)){var l=Tc(o,a);o=oi(o,o.next),l=oi(l,l.next),ws(o,t,e,i,s,n,0),ws(l,t,e,i,s,n,0);return;}a=a.next;}o=o.next;}while(o!==r);}function I0(r,t,e,i){var s=[],n,o,a,l,h;for(n=0,o=t.length;n<o;n++)a=t[n]*i,l=n<o-1?t[n+1]*i:r.length,h=bc(r,a,l,i,!1),h===h.next&&(h.steiner=!0),s.push(L0(h));for(s.sort(R0),n=0;n<s.length;n++)e=M0(s[n],e);return e;}function R0(r,t){return r.x-t.x;}function M0(r,t){var e=P0(r,t);if(!e)return t;var i=Tc(e,r);return oi(i,i.next),oi(e,e.next);}function P0(r,t){var e=t,i=r.x,s=r.y,n=-1/0,o;do{if(s<=e.y&&s>=e.next.y&&e.next.y!==e.y){var a=e.x+(s-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(a<=i&&a>n&&(n=a,o=e.x<e.next.x?e:e.next,a===i))return o;}e=e.next;}while(e!==t);if(!o)return null;var l=o,h=o.x,u=o.y,c=1/0,d;e=o;do i>=e.x&&e.x>=h&&i!==e.x&&Gi(s<u?i:n,s,h,u,s<u?n:i,s,e.x,e.y)&&(d=Math.abs(s-e.y)/(i-e.x),As(e,r)&&(d<c||d===c&&(e.x>o.x||e.x===o.x&&O0(o,e)))&&(o=e,c=d)),e=e.next;while(e!==l);return o;}function O0(r,t){return Nt(r.prev,r,t.prev)<0&&Nt(t.next,r,r.next)<0;}function N0(r,t,e,i){var s=r;do s.z===0&&(s.z=Aa(s.x,s.y,t,e,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==r);s.prevZ.nextZ=null,s.prevZ=null,D0(s);}function D0(r){var t,e,i,s,n,o,a,l,h=1;do{for(e=r,r=null,n=null,o=0;e;){for(o++,i=e,a=0,t=0;t<h&&(a++,i=i.nextZ,!!i);t++);for(l=h;a>0||l>0&&i;)a!==0&&(l===0||!i||e.z<=i.z)?(s=e,e=e.nextZ,a--):(s=i,i=i.nextZ,l--),n?n.nextZ=s:r=s,s.prevZ=n,n=s;e=i;}n.nextZ=null,h*=2;}while(o>1);return r;}function Aa(r,t,e,i,s){return r=(r-e)*s|0,t=(t-i)*s|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,r|t<<1;}function L0(r){var t=r,e=r;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==r);return e;}function Gi(r,t,e,i,s,n,o,a){return(s-o)*(t-a)>=(r-o)*(n-a)&&(r-o)*(i-a)>=(e-o)*(t-a)&&(e-o)*(n-a)>=(s-o)*(i-a);}function B0(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!F0(r,t)&&(As(r,t)&&As(t,r)&&U0(r,t)&&(Nt(r.prev,r,t.prev)||Nt(r,t.prev,t))||En(r,t)&&Nt(r.prev,r,r.next)>0&&Nt(t.prev,t,t.next)>0);}function Nt(r,t,e){return(t.y-r.y)*(e.x-t.x)-(t.x-r.x)*(e.y-t.y);}function En(r,t){return r.x===t.x&&r.y===t.y;}function Ec(r,t,e,i){var s=wn(Nt(r,t,e)),n=wn(Nt(r,t,i)),o=wn(Nt(e,i,r)),a=wn(Nt(e,i,t));return!!(s!==n&&o!==a||s===0&&Tn(r,e,t)||n===0&&Tn(r,i,t)||o===0&&Tn(e,r,i)||a===0&&Tn(e,t,i));}function Tn(r,t,e){return t.x<=Math.max(r.x,e.x)&&t.x>=Math.min(r.x,e.x)&&t.y<=Math.max(r.y,e.y)&&t.y>=Math.min(r.y,e.y);}function wn(r){return r>0?1:r<0?-1:0;}function F0(r,t){var e=r;do{if(e.i!==r.i&&e.next.i!==r.i&&e.i!==t.i&&e.next.i!==t.i&&Ec(e,e.next,r,t))return!0;e=e.next;}while(e!==r);return!1;}function As(r,t){return Nt(r.prev,r,r.next)<0?Nt(r,t,r.next)>=0&&Nt(r,r.prev,t)>=0:Nt(r,t,r.prev)<0||Nt(r,r.next,t)<0;}function U0(r,t){var e=r,i=!1,s=(r.x+t.x)/2,n=(r.y+t.y)/2;do e.y>n!=e.next.y>n&&e.next.y!==e.y&&s<(e.next.x-e.x)*(n-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next;while(e!==r);return i;}function Tc(r,t){var e=new Sa(r.i,r.x,r.y),i=new Sa(t.i,t.x,t.y),s=r.next,n=t.prev;return r.next=t,t.prev=r,e.next=s,s.prev=e,i.next=e,e.prev=i,n.next=i,i.prev=n,i;}function wc(r,t,e,i){var s=new Sa(r,t,e);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s;}function Ss(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ);}function Sa(r,t,e){this.i=r,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1;}bn.deviation=function(r,t,e,i){var s=t&&t.length,n=s?t[0]*e:r.length,o=Math.abs(Ca(r,0,n,e));if(s)for(var a=0,l=t.length;a<l;a++){var h=t[a]*e,u=a<l-1?t[a+1]*e:r.length;o-=Math.abs(Ca(r,h,u,e));}var c=0;for(a=0;a<i.length;a+=3){var d=i[a]*e,p=i[a+1]*e,f=i[a+2]*e;c+=Math.abs((r[d]-r[f])*(r[p+1]-r[d+1])-(r[d]-r[p])*(r[f+1]-r[d+1]));}return o===0&&c===0?0:Math.abs((c-o)/o);};function Ca(r,t,e,i){for(var s=0,n=t,o=e-i;n<e;n+=i)s+=(r[o]-r[n])*(r[n+1]+r[o+1]),o=n;return s;}bn.flatten=function(r){for(var t=r[0][0].length,e={vertices:[],holes:[],dimensions:t},i=0,s=0;s<r.length;s++){for(var n=0;n<r[s].length;n++)for(var o=0;o<t;o++)e.vertices.push(r[s][n][o]);s>0&&(i+=r[s-1].length,e.holes.push(i));}return e;};var k0=wa.exports;var G0=vc(k0);var An={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */An.exports,function(r,t){(function(e){var i=t&&!t.nodeType&&t,s=r&&!r.nodeType&&r,n=_typeof(Es)=="object"&&Es;(n.global===n||n.window===n||n.self===n)&&(e=n);var o,a=2147483647,l=36,h=1,u=26,c=38,d=700,p=72,f=128,m="-",y=/^xn--/,_=/[^\x20-\x7E]/,v=/[\x2E\u3002\uFF0E\uFF61]/g,g={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=l-h,b=Math.floor,S=String.fromCharCode,w;function T(M){throw new RangeError(g[M]);}function N(M,L){for(var V=M.length,rt=[];V--;)rt[V]=L(M[V]);return rt;}function F(M,L){var V=M.split("@"),rt="";V.length>1&&(rt=V[0]+"@",M=V[1]),M=M.replace(v,".");var Q=M.split("."),X=N(Q,L).join(".");return rt+X;}function z(M){for(var L=[],V=0,rt=M.length,Q,X;V<rt;)Q=M.charCodeAt(V++),Q>=55296&&Q<=56319&&V<rt?(X=M.charCodeAt(V++),(X&64512)==56320?L.push(((Q&1023)<<10)+(X&1023)+65536):(L.push(Q),V--)):L.push(Q);return L;}function C(M){return N(M,function(L){var V="";return L>65535&&(L-=65536,V+=S(L>>>10&1023|55296),L=56320|L&1023),V+=S(L),V;}).join("");}function E(M){return M-48<10?M-22:M-65<26?M-65:M-97<26?M-97:l;}function I(M,L){return M+22+75*(M<26)-((L!=0)<<5);}function P(M,L,V){var rt=0;for(M=V?b(M/d):M>>1,M+=b(M/L);M>x*u>>1;rt+=l)M=b(M/x);return b(rt+(x+1)*M/(M+c));}function $(M){var L=[],V=M.length,rt,Q=0,X=f,_t=p,St,O,D,ut,lt,Et,Tt,mr,gr;for(St=M.lastIndexOf(m),St<0&&(St=0),O=0;O<St;++O)M.charCodeAt(O)>=128&&T("not-basic"),L.push(M.charCodeAt(O));for(D=St>0?St+1:0;D<V;){for(ut=Q,lt=1,Et=l;D>=V&&T("invalid-input"),Tt=E(M.charCodeAt(D++)),(Tt>=l||Tt>b((a-Q)/lt))&&T("overflow"),Q+=Tt*lt,mr=Et<=_t?h:Et>=_t+u?u:Et-_t,!(Tt<mr);Et+=l)gr=l-mr,lt>b(a/gr)&&T("overflow"),lt*=gr;rt=L.length+1,_t=P(Q-ut,rt,ut==0),b(Q/rt)>a-X&&T("overflow"),X+=b(Q/rt),Q%=rt,L.splice(Q++,0,X);}return C(L);}function k(M){var L,V,rt,Q,X,_t,St,O,D,ut,lt,Et=[],Tt,mr,gr,js;for(M=z(M),Tt=M.length,L=f,V=0,X=p,_t=0;_t<Tt;++_t)lt=M[_t],lt<128&&Et.push(S(lt));for(rt=Q=Et.length,Q&&Et.push(m);rt<Tt;){for(St=a,_t=0;_t<Tt;++_t)lt=M[_t],lt>=L&&lt<St&&(St=lt);for(mr=rt+1,St-L>b((a-V)/mr)&&T("overflow"),V+=(St-L)*mr,L=St,_t=0;_t<Tt;++_t)if(lt=M[_t],lt<L&&++V>a&&T("overflow"),lt==L){for(O=V,D=l;ut=D<=X?h:D>=X+u?u:D-X,!(O<ut);D+=l)js=O-ut,gr=l-ut,Et.push(S(I(ut+js%gr,0))),O=b(js/gr);Et.push(S(I(O,0))),X=P(V,mr,rt==Q),V=0,++rt;}++V,++L;}return Et.join("");}function G(M){return F(M,function(L){return y.test(L)?$(L.slice(4).toLowerCase()):L;});}function st(M){return F(M,function(L){return _.test(L)?"xn--"+k(L):L;});}if(o={version:"1.4.1",ucs2:{decode:z,encode:C},decode:$,encode:k,toASCII:st,toUnicode:G},i&&s){if(r.exports==i)s.exports=o;else for(w in o)o.hasOwnProperty(w)&&(i[w]=o[w]);}else e.punycode=o;})(Es);}(An,An.exports);var $0=An.exports,$i=TypeError;var H0=E0(Object.freeze(Object.defineProperty({__proto__:null,"default":{}},Symbol.toStringTag,{value:"Module"})));var Ia=typeof Map=="function"&&Map.prototype,Ra=Object.getOwnPropertyDescriptor&&Ia?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Sn=Ia&&Ra&&typeof Ra.get=="function"?Ra.get:null,Ac=Ia&&Map.prototype.forEach,Ma=typeof Set=="function"&&Set.prototype,Pa=Object.getOwnPropertyDescriptor&&Ma?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Cn=Ma&&Pa&&typeof Pa.get=="function"?Pa.get:null,Sc=Ma&&Set.prototype.forEach,V0=typeof WeakMap=="function"&&WeakMap.prototype,Cs=V0?WeakMap.prototype.has:null,X0=typeof WeakSet=="function"&&WeakSet.prototype,Is=X0?WeakSet.prototype.has:null,z0=typeof WeakRef=="function"&&WeakRef.prototype,Cc=z0?WeakRef.prototype.deref:null,W0=Boolean.prototype.valueOf,Y0=Object.prototype.toString,j0=Function.prototype.toString,q0=String.prototype.match,Oa=String.prototype.slice,Lr=String.prototype.replace,K0=String.prototype.toUpperCase,Ic=String.prototype.toLowerCase,Rc=RegExp.prototype.test,Mc=Array.prototype.concat,or=Array.prototype.join,Z0=Array.prototype.slice,Pc=Math.floor,Na=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Da=Object.getOwnPropertySymbols,La=typeof Symbol=="function"&&_typeof(Symbol.iterator)=="symbol"?Symbol.prototype.toString:null,Hi=typeof Symbol=="function"&&_typeof(Symbol.iterator)=="object",Rs=typeof Symbol=="function"&&Symbol.toStringTag&&(_typeof(Symbol.toStringTag)===Hi||!0)?Symbol.toStringTag:null,Oc=Object.prototype.propertyIsEnumerable,Nc=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(r){return r.__proto__;}:null);function Dc(r,t){if(r===1/0||r===-1/0||r!==r||r&&r>-1e3&&r<1e3||Rc.call(/e/,t))return t;var e=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof r=="number"){var i=r<0?-Pc(-r):Pc(r);if(i!==r){var s=String(i),n=Oa.call(t,s.length+1);return Lr.call(s,e,"$&_")+"."+Lr.call(Lr.call(n,/([0-9]{3})/g,"$&_"),/_$/,"");}}return Lr.call(t,e,"$&_");}var Ba=H0,Lc=Ba.custom,Bc=Gc(Lc)?Lc:null,Fc={__proto__:null,"double":'"',single:"'"},Q0={__proto__:null,"double":/(["\\])/g,single:/(['\\])/g},In=function r(t,e,i,s){var n=e||{};if(Er(n,"quoteStyle")&&!Er(Fc,n.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Er(n,"maxStringLength")&&(typeof n.maxStringLength=="number"?n.maxStringLength<0&&n.maxStringLength!==1/0:n.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var o=Er(n,"customInspect")?n.customInspect:!0;if(typeof o!="boolean"&&o!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Er(n,"indent")&&n.indent!==null&&n.indent!=="	"&&!(parseInt(n.indent,10)===n.indent&&n.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Er(n,"numericSeparator")&&typeof n.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var a=n.numericSeparator;if(_typeof(t)>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return Hc(t,n);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var l=String(t);return a?Dc(t,l):l;}if(typeof t=="bigint"){var h=String(t)+"n";return a?Dc(t,h):h;}var u=_typeof(n.depth)>"u"?5:n.depth;if(_typeof(i)>"u"&&(i=0),i>=u&&u>0&&_typeof(t)=="object")return Fa(t)?"[Array]":"[Object]";var c=gv(n,i);if(_typeof(s)>"u")s=[];else if($c(s,t)>=0)return"[Circular]";function d(E,I,P){if(I&&(s=Z0.call(s),s.push(I)),P){var $={depth:n.depth};return Er(n,"quoteStyle")&&($.quoteStyle=n.quoteStyle),r(E,$,i+1,s);}return r(E,n,i+1,s);}if(typeof t=="function"&&!kc(t)){var p=av(t),f=Rn(t,d);return"[Function"+(p?": "+p:" (anonymous)")+"]"+(f.length>0?" { "+or.call(f,", ")+" }":"");}if(Gc(t)){var m=Hi?Lr.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):La.call(t);return _typeof(t)=="object"&&!Hi?Ms(m):m;}if(fv(t)){for(var y="<"+Ic.call(String(t.nodeName)),_=t.attributes||[],v=0;v<_.length;v++)y+=" "+_[v].name+"="+Uc(J0(_[v].value),"double",n);return y+=">",t.childNodes&&t.childNodes.length&&(y+="..."),y+="</"+Ic.call(String(t.nodeName))+">",y;}if(Fa(t)){if(t.length===0)return"[]";var g=Rn(t,d);return c&&!mv(g)?"["+ka(g,c)+"]":"[ "+or.call(g,", ")+" ]";}if(ev(t)){var x=Rn(t,d);return!("cause"in Error.prototype)&&"cause"in t&&!Oc.call(t,"cause")?"{ ["+String(t)+"] "+or.call(Mc.call("[cause]: "+d(t.cause),x),", ")+" }":x.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+or.call(x,", ")+" }";}if(_typeof(t)=="object"&&o){if(Bc&&typeof t[Bc]=="function"&&Ba)return Ba(t,{depth:u-i});if(o!=="symbol"&&typeof t.inspect=="function")return t.inspect();}if(lv(t)){var b=[];return Ac&&Ac.call(t,function(E,I){b.push(d(I,t,!0)+" => "+d(E,t));}),Vc("Map",Sn.call(t),b,c);}if(cv(t)){var S=[];return Sc&&Sc.call(t,function(E){S.push(d(E,t));}),Vc("Set",Cn.call(t),S,c);}if(hv(t))return Ua("WeakMap");if(dv(t))return Ua("WeakSet");if(uv(t))return Ua("WeakRef");if(iv(t))return Ms(d(Number(t)));if(nv(t))return Ms(d(Na.call(t)));if(sv(t))return Ms(W0.call(t));if(rv(t))return Ms(d(String(t)));if((typeof window==="undefined"?"undefined":_typeof(window))<"u"&&t===window)return"{ [object Window] }";if((typeof globalThis==="undefined"?"undefined":_typeof(globalThis))<"u"&&t===globalThis||_typeof(Es)<"u"&&t===Es)return"{ [object globalThis] }";if(!tv(t)&&!kc(t)){var w=Rn(t,d),T=Nc?Nc(t)===Object.prototype:t instanceof Object||t.constructor===Object,N=t instanceof Object?"":"null prototype",F=!T&&Rs&&Object(t)===t&&Rs in t?Oa.call(Br(t),8,-1):N?"Object":"",z=T||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",C=z+(F||N?"["+or.call(Mc.call([],F||[],N||[]),": ")+"] ":"");return w.length===0?C+"{}":c?C+"{"+ka(w,c)+"}":C+"{ "+or.call(w,", ")+" }";}return String(t);};function Uc(r,t,e){var i=e.quoteStyle||t,s=Fc[i];return s+r+s;}function J0(r){return Lr.call(String(r),/"/g,"&quot;");}function ai(r){return!Rs||!(_typeof(r)=="object"&&(Rs in r||_typeof(r[Rs])<"u"));}function Fa(r){return Br(r)==="[object Array]"&&ai(r);}function tv(r){return Br(r)==="[object Date]"&&ai(r);}function kc(r){return Br(r)==="[object RegExp]"&&ai(r);}function ev(r){return Br(r)==="[object Error]"&&ai(r);}function rv(r){return Br(r)==="[object String]"&&ai(r);}function iv(r){return Br(r)==="[object Number]"&&ai(r);}function sv(r){return Br(r)==="[object Boolean]"&&ai(r);}function Gc(r){if(Hi)return r&&_typeof(r)=="object"&&r instanceof Symbol;if(_typeof(r)=="symbol")return!0;if(!r||_typeof(r)!="object"||!La)return!1;try{return La.call(r),!0;}catch(_unused){}return!1;}function nv(r){if(!r||_typeof(r)!="object"||!Na)return!1;try{return Na.call(r),!0;}catch(_unused2){}return!1;}var ov=Object.prototype.hasOwnProperty||function(r){return r in this;};function Er(r,t){return ov.call(r,t);}function Br(r){return Y0.call(r);}function av(r){if(r.name)return r.name;var t=q0.call(j0.call(r),/^function\s*([\w$]+)/);return t?t[1]:null;}function $c(r,t){if(r.indexOf)return r.indexOf(t);for(var e=0,i=r.length;e<i;e++)if(r[e]===t)return e;return-1;}function lv(r){if(!Sn||!r||_typeof(r)!="object")return!1;try{Sn.call(r);try{Cn.call(r);}catch(_unused3){return!0;}return r instanceof Map;}catch(_unused4){}return!1;}function hv(r){if(!Cs||!r||_typeof(r)!="object")return!1;try{Cs.call(r,Cs);try{Is.call(r,Is);}catch(_unused5){return!0;}return r instanceof WeakMap;}catch(_unused6){}return!1;}function uv(r){if(!Cc||!r||_typeof(r)!="object")return!1;try{return Cc.call(r),!0;}catch(_unused7){}return!1;}function cv(r){if(!Cn||!r||_typeof(r)!="object")return!1;try{Cn.call(r);try{Sn.call(r);}catch(_unused8){return!0;}return r instanceof Set;}catch(_unused9){}return!1;}function dv(r){if(!Is||!r||_typeof(r)!="object")return!1;try{Is.call(r,Is);try{Cs.call(r,Cs);}catch(_unused10){return!0;}return r instanceof WeakSet;}catch(_unused11){}return!1;}function fv(r){return!r||_typeof(r)!="object"?!1:(typeof HTMLElement==="undefined"?"undefined":_typeof(HTMLElement))<"u"&&r instanceof HTMLElement?!0:typeof r.nodeName=="string"&&typeof r.getAttribute=="function";}function Hc(r,t){if(r.length>t.maxStringLength){var e=r.length-t.maxStringLength,i="... "+e+" more character"+(e>1?"s":"");return Hc(Oa.call(r,0,t.maxStringLength),t)+i;}var s=Q0[t.quoteStyle||"single"];s.lastIndex=0;var n=Lr.call(Lr.call(r,s,"\\$1"),/[\x00-\x1f]/g,pv);return Uc(n,"single",t);}function pv(r){var t=r.charCodeAt(0),e={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return e?"\\"+e:"\\x"+(t<16?"0":"")+K0.call(t.toString(16));}function Ms(r){return"Object("+r+")";}function Ua(r){return r+" { ? }";}function Vc(r,t,e,i){var s=i?ka(e,i):or.call(e,", ");return r+" ("+t+") {"+s+"}";}function mv(r){for(var t=0;t<r.length;t++)if($c(r[t],"\n")>=0)return!1;return!0;}function gv(r,t){var e;if(r.indent==="	")e="	";else if(typeof r.indent=="number"&&r.indent>0)e=or.call(Array(r.indent+1)," ");else return null;return{base:e,prev:or.call(Array(t+1),e)};}function ka(r,t){if(r.length===0)return"";var e="\n"+t.prev+t.base;return e+or.call(r,","+e)+"\n"+t.prev;}function Rn(r,t){var e=Fa(r),i=[];if(e){i.length=r.length;for(var s=0;s<r.length;s++)i[s]=Er(r,s)?t(r[s],r):"";}var n=typeof Da=="function"?Da(r):[],o;if(Hi){o={};for(var a=0;a<n.length;a++)o["$"+n[a]]=n[a];}for(var l in r)Er(r,l)&&(e&&String(Number(l))===l&&l<r.length||Hi&&o["$"+l]instanceof Symbol||(Rc.call(/[^\w$]/,l)?i.push(t(l,r)+": "+t(r[l],r)):i.push(l+": "+t(r[l],r))));if(typeof Da=="function")for(var h=0;h<n.length;h++)Oc.call(r,n[h])&&i.push("["+t(n[h])+"]: "+t(r[n[h]],r));return i;}var yv=In,_v=$i,Mn=function Mn(r,t,e){for(var i=r,s;(s=i.next)!=null;i=s)if(s.key===t)return i.next=s.next,e||(s.next=r.next,r.next=s),s;},vv=function vv(r,t){if(r){var e=Mn(r,t);return e&&e.value;}},xv=function xv(r,t,e){var i=Mn(r,t);i?i.value=e:r.next={key:t,next:r.next,value:e};},bv=function bv(r,t){return r?!!Mn(r,t):!1;},Ev=function Ev(r,t){if(r)return Mn(r,t,!0);},Tv=function Tv(){var t,e={assert:function assert(i){if(!e.has(i))throw new _v("Side channel does not contain "+yv(i));},"delete":function _delete(i){var s=t&&t.next,n=Ev(t,i);return n&&s&&s===n&&(t=void 0),!!n;},get:function get(i){return vv(t,i);},has:function has(i){return bv(t,i);},set:function set(i,s){t||(t={next:void 0}),xv(t,i,s);}};return e;},Xc=Object,wv=Error,Av=EvalError,Sv=RangeError,Cv=ReferenceError,Iv=SyntaxError,Rv=URIError,Mv=Math.abs,Pv=Math.floor,Ov=Math.max,Nv=Math.min,Dv=Math.pow,Lv=Math.round,Bv=Number.isNaN||function(t){return t!==t;},Fv=Bv,Uv=function Uv(t){return Fv(t)||t===0?t:t<0?-1:1;},kv=Object.getOwnPropertyDescriptor,Pn=kv;if(Pn)try{Pn([],"length");}catch(_unused12){Pn=null;}var zc=Pn,On=Object.defineProperty||!1;if(On)try{On({},"a",{value:1});}catch(_unused13){On=!1;}var Gv=On,Ga,Wc;function $v(){return Wc||(Wc=1,Ga=function Ga(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(_typeof(Symbol.iterator)=="symbol")return!0;var t={},e=Symbol("test"),i=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(i)!=="[object Symbol]")return!1;var s=42;t[e]=s;for(var n in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var o=Object.getOwnPropertySymbols(t);if(o.length!==1||o[0]!==e||!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(t,e);if(a.value!==s||a.enumerable!==!0)return!1;}return!0;}),Ga;}var $a,Yc;function Hv(){if(Yc)return $a;Yc=1;var r=(typeof Symbol==="undefined"?"undefined":_typeof(Symbol))<"u"&&Symbol,t=$v();return $a=function $a(){return typeof r!="function"||typeof Symbol!="function"||_typeof(r("foo"))!="symbol"||_typeof(Symbol("bar"))!="symbol"?!1:t();},$a;}var Ha,jc;function qc(){return jc||(jc=1,Ha=(typeof Reflect==="undefined"?"undefined":_typeof(Reflect))<"u"&&Reflect.getPrototypeOf||null),Ha;}var Va,Kc;function Zc(){if(Kc)return Va;Kc=1;var r=Xc;return Va=r.getPrototypeOf||null,Va;}var Vv="Function.prototype.bind called on incompatible ",Xv=Object.prototype.toString,zv=Math.max,Wv="[object Function]",Qc=function Qc(t,e){for(var i=[],s=0;s<t.length;s+=1)i[s]=t[s];for(var n=0;n<e.length;n+=1)i[n+t.length]=e[n];return i;},Yv=function Yv(t,e){for(var i=[],s=e,n=0;s<t.length;s+=1,n+=1)i[n]=t[s];return i;},jv=function jv(r,t){for(var e="",i=0;i<r.length;i+=1)e+=r[i],i+1<r.length&&(e+=t);return e;},qv=function qv(t){var e=this;if(typeof e!="function"||Xv.apply(e)!==Wv)throw new TypeError(Vv+e);for(var i=Yv(arguments,1),s,n=function n(){if(this instanceof s){var u=e.apply(this,Qc(i,arguments));return Object(u)===u?u:this;}return e.apply(t,Qc(i,arguments));},o=zv(0,e.length-i.length),a=[],l=0;l<o;l++)a[l]="$"+l;if(s=Function("binder","return function ("+jv(a,",")+"){ return binder.apply(this,arguments); }")(n),e.prototype){var h=function h(){};h.prototype=e.prototype,s.prototype=new h(),h.prototype=null;}return s;},Kv=qv,Nn=Function.prototype.bind||Kv,Xa=Function.prototype.call,Jc=Function.prototype.apply,Zv=(typeof Reflect==="undefined"?"undefined":_typeof(Reflect))<"u"&&Reflect&&Reflect.apply,Qv=Nn,Jv=Jc,t1=Xa,e1=Zv,r1=e1||Qv.call(t1,Jv),i1=Nn,s1=$i,n1=Xa,o1=r1,td=function td(t){if(t.length<1||typeof t[0]!="function")throw new s1("a function is required");return o1(i1,n1,t);},za,ed;function a1(){if(ed)return za;ed=1;var r=td,t=zc,e;try{e=[].__proto__===Array.prototype;}catch(o){if(!o||_typeof(o)!="object"||!("code"in o)||o.code!=="ERR_PROTO_ACCESS")throw o;}var i=!!e&&t&&t(Object.prototype,"__proto__"),s=Object,n=s.getPrototypeOf;return za=i&&typeof i.get=="function"?r([i.get]):typeof n=="function"?function(a){return n(a==null?a:s(a));}:!1,za;}var Wa,rd;function l1(){if(rd)return Wa;rd=1;var r=qc(),t=Zc(),e=a1();return Wa=r?function(s){return r(s);}:t?function(s){if(!s||_typeof(s)!="object"&&typeof s!="function")throw new TypeError("getProto: not an object");return t(s);}:e?function(s){return e(s);}:null,Wa;}var Ya,id;function h1(){if(id)return Ya;id=1;var r=Function.prototype.call,t=Object.prototype.hasOwnProperty,e=Nn;return Ya=e.call(r,t),Ya;}var yt,u1=Xc,c1=wv,d1=Av,f1=Sv,p1=Cv,Vi=Iv,Xi=$i,m1=Rv,g1=Mv,y1=Pv,_1=Ov,v1=Nv,x1=Dv,b1=Lv,E1=Uv,sd=Function,ja=function ja(r){try{return sd('"use strict"; return ('+r+").constructor;")();}catch(_unused14){}},Ps=zc,T1=Gv,qa=function qa(){throw new Xi();},w1=Ps?function(){try{return arguments.callee,qa;}catch(_unused15){try{return Ps(arguments,"callee").get;}catch(_unused16){return qa;}}}():qa,zi=Hv()(),ie=l1(),A1=Zc(),S1=qc(),nd=Jc,Os=Xa,Wi={},C1=(typeof Uint8Array==="undefined"?"undefined":_typeof(Uint8Array))>"u"||!ie?yt:ie(Uint8Array),li={__proto__:null,"%AggregateError%":(typeof AggregateError==="undefined"?"undefined":_typeof(AggregateError))>"u"?yt:AggregateError,"%Array%":Array,"%ArrayBuffer%":(typeof ArrayBuffer==="undefined"?"undefined":_typeof(ArrayBuffer))>"u"?yt:ArrayBuffer,"%ArrayIteratorPrototype%":zi&&ie?ie([][Symbol.iterator]()):yt,"%AsyncFromSyncIteratorPrototype%":yt,"%AsyncFunction%":Wi,"%AsyncGenerator%":Wi,"%AsyncGeneratorFunction%":Wi,"%AsyncIteratorPrototype%":Wi,"%Atomics%":(typeof Atomics==="undefined"?"undefined":_typeof(Atomics))>"u"?yt:Atomics,"%BigInt%":(typeof BigInt==="undefined"?"undefined":_typeof(BigInt))>"u"?yt:BigInt,"%BigInt64Array%":(typeof BigInt64Array==="undefined"?"undefined":_typeof(BigInt64Array))>"u"?yt:BigInt64Array,"%BigUint64Array%":(typeof BigUint64Array==="undefined"?"undefined":_typeof(BigUint64Array))>"u"?yt:BigUint64Array,"%Boolean%":Boolean,"%DataView%":(typeof DataView==="undefined"?"undefined":_typeof(DataView))>"u"?yt:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":c1,"%eval%":eval,"%EvalError%":d1,"%Float16Array%":(typeof Float16Array==="undefined"?"undefined":_typeof(Float16Array))>"u"?yt:Float16Array,"%Float32Array%":(typeof Float32Array==="undefined"?"undefined":_typeof(Float32Array))>"u"?yt:Float32Array,"%Float64Array%":(typeof Float64Array==="undefined"?"undefined":_typeof(Float64Array))>"u"?yt:Float64Array,"%FinalizationRegistry%":(typeof FinalizationRegistry==="undefined"?"undefined":_typeof(FinalizationRegistry))>"u"?yt:FinalizationRegistry,"%Function%":sd,"%GeneratorFunction%":Wi,"%Int8Array%":(typeof Int8Array==="undefined"?"undefined":_typeof(Int8Array))>"u"?yt:Int8Array,"%Int16Array%":(typeof Int16Array==="undefined"?"undefined":_typeof(Int16Array))>"u"?yt:Int16Array,"%Int32Array%":(typeof Int32Array==="undefined"?"undefined":_typeof(Int32Array))>"u"?yt:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":zi&&ie?ie(ie([][Symbol.iterator]())):yt,"%JSON%":(typeof JSON==="undefined"?"undefined":_typeof(JSON))=="object"?JSON:yt,"%Map%":(typeof Map==="undefined"?"undefined":_typeof(Map))>"u"?yt:Map,"%MapIteratorPrototype%":(typeof Map==="undefined"?"undefined":_typeof(Map))>"u"||!zi||!ie?yt:ie(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":u1,"%Object.getOwnPropertyDescriptor%":Ps,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":(typeof Promise==="undefined"?"undefined":_typeof(Promise))>"u"?yt:Promise,"%Proxy%":(typeof Proxy==="undefined"?"undefined":_typeof(Proxy))>"u"?yt:Proxy,"%RangeError%":f1,"%ReferenceError%":p1,"%Reflect%":(typeof Reflect==="undefined"?"undefined":_typeof(Reflect))>"u"?yt:Reflect,"%RegExp%":RegExp,"%Set%":(typeof Set==="undefined"?"undefined":_typeof(Set))>"u"?yt:Set,"%SetIteratorPrototype%":(typeof Set==="undefined"?"undefined":_typeof(Set))>"u"||!zi||!ie?yt:ie(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":(typeof SharedArrayBuffer==="undefined"?"undefined":_typeof(SharedArrayBuffer))>"u"?yt:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":zi&&ie?ie(""[Symbol.iterator]()):yt,"%Symbol%":zi?Symbol:yt,"%SyntaxError%":Vi,"%ThrowTypeError%":w1,"%TypedArray%":C1,"%TypeError%":Xi,"%Uint8Array%":(typeof Uint8Array==="undefined"?"undefined":_typeof(Uint8Array))>"u"?yt:Uint8Array,"%Uint8ClampedArray%":(typeof Uint8ClampedArray==="undefined"?"undefined":_typeof(Uint8ClampedArray))>"u"?yt:Uint8ClampedArray,"%Uint16Array%":(typeof Uint16Array==="undefined"?"undefined":_typeof(Uint16Array))>"u"?yt:Uint16Array,"%Uint32Array%":(typeof Uint32Array==="undefined"?"undefined":_typeof(Uint32Array))>"u"?yt:Uint32Array,"%URIError%":m1,"%WeakMap%":(typeof WeakMap==="undefined"?"undefined":_typeof(WeakMap))>"u"?yt:WeakMap,"%WeakRef%":(typeof WeakRef==="undefined"?"undefined":_typeof(WeakRef))>"u"?yt:WeakRef,"%WeakSet%":(typeof WeakSet==="undefined"?"undefined":_typeof(WeakSet))>"u"?yt:WeakSet,"%Function.prototype.call%":Os,"%Function.prototype.apply%":nd,"%Object.defineProperty%":T1,"%Object.getPrototypeOf%":A1,"%Math.abs%":g1,"%Math.floor%":y1,"%Math.max%":_1,"%Math.min%":v1,"%Math.pow%":x1,"%Math.round%":b1,"%Math.sign%":E1,"%Reflect.getPrototypeOf%":S1};if(ie)try{null.error;}catch(r){var I1=ie(ie(r));li["%Error.prototype%"]=I1;}var R1=function r(t){var e;if(t==="%AsyncFunction%")e=ja("async function () {}");else if(t==="%GeneratorFunction%")e=ja("function* () {}");else if(t==="%AsyncGeneratorFunction%")e=ja("async function* () {}");else if(t==="%AsyncGenerator%"){var i=r("%AsyncGeneratorFunction%");i&&(e=i.prototype);}else if(t==="%AsyncIteratorPrototype%"){var s=r("%AsyncGenerator%");s&&ie&&(e=ie(s.prototype));}return li[t]=e,e;},od={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Ns=Nn,Dn=h1(),M1=Ns.call(Os,Array.prototype.concat),P1=Ns.call(nd,Array.prototype.splice),ad=Ns.call(Os,String.prototype.replace),Ln=Ns.call(Os,String.prototype.slice),O1=Ns.call(Os,RegExp.prototype.exec),N1=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,D1=/\\(\\)?/g,L1=function L1(t){var e=Ln(t,0,1),i=Ln(t,-1);if(e==="%"&&i!=="%")throw new Vi("invalid intrinsic syntax, expected closing `%`");if(i==="%"&&e!=="%")throw new Vi("invalid intrinsic syntax, expected opening `%`");var s=[];return ad(t,N1,function(n,o,a,l){s[s.length]=a?ad(l,D1,"$1"):o||n;}),s;},B1=function B1(t,e){var i=t,s;if(Dn(od,i)&&(s=od[i],i="%"+s[0]+"%"),Dn(li,i)){var n=li[i];if(n===Wi&&(n=R1(i)),_typeof(n)>"u"&&!e)throw new Xi("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:s,name:i,value:n};}throw new Vi("intrinsic "+t+" does not exist!");},Ka=function Ka(t,e){if(typeof t!="string"||t.length===0)throw new Xi("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof e!="boolean")throw new Xi('"allowMissing" argument must be a boolean');if(O1(/^%?[^%]*%?$/,t)===null)throw new Vi("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=L1(t),s=i.length>0?i[0]:"",n=B1("%"+s+"%",e),o=n.name,a=n.value,l=!1,h=n.alias;h&&(s=h[0],P1(i,M1([0,1],h)));for(var u=1,c=!0;u<i.length;u+=1){var d=i[u],p=Ln(d,0,1),f=Ln(d,-1);if((p==='"'||p==="'"||p==="`"||f==='"'||f==="'"||f==="`")&&p!==f)throw new Vi("property names with quotes must have matching quotes");if((d==="constructor"||!c)&&(l=!0),s+="."+d,o="%"+s+"%",Dn(li,o))a=li[o];else if(a!=null){if(!(d in a)){if(!e)throw new Xi("base intrinsic for "+t+" exists, but the property is not available.");return;}if(Ps&&u+1>=i.length){var m=Ps(a,d);c=!!m,c&&"get"in m&&!("originalValue"in m.get)?a=m.get:a=a[d];}else c=Dn(a,d),a=a[d];c&&!l&&(li[o]=a);}}return a;},ld=Ka,hd=td,F1=hd([ld("%String.prototype.indexOf%")]),ud=function ud(t,e){var i=ld(t,!!e);return typeof i=="function"&&F1(t,".prototype.")>-1?hd([i]):i;},U1=Ka,Ds=ud,k1=In,G1=$i,cd=U1("%Map%",!0),$1=Ds("Map.prototype.get",!0),H1=Ds("Map.prototype.set",!0),V1=Ds("Map.prototype.has",!0),X1=Ds("Map.prototype.delete",!0),z1=Ds("Map.prototype.size",!0),dd=!!cd&&function(){var t,e={assert:function assert(i){if(!e.has(i))throw new G1("Side channel does not contain "+k1(i));},"delete":function _delete(i){if(t){var s=X1(t,i);return z1(t)===0&&(t=void 0),s;}return!1;},get:function get(i){if(t)return $1(t,i);},has:function has(i){return t?V1(t,i):!1;},set:function set(i,s){t||(t=new cd()),H1(t,i,s);}};return e;},W1=Ka,Bn=ud,Y1=In,Fn=dd,j1=$i,Yi=W1("%WeakMap%",!0),q1=Bn("WeakMap.prototype.get",!0),K1=Bn("WeakMap.prototype.set",!0),Z1=Bn("WeakMap.prototype.has",!0),Q1=Bn("WeakMap.prototype.delete",!0),J1=Yi?function(){var t,e,i={assert:function assert(s){if(!i.has(s))throw new j1("Side channel does not contain "+Y1(s));},"delete":function _delete(s){if(Yi&&s&&(_typeof(s)=="object"||typeof s=="function")){if(t)return Q1(t,s);}else if(Fn&&e)return e["delete"](s);return!1;},get:function get(s){return Yi&&s&&(_typeof(s)=="object"||typeof s=="function")&&t?q1(t,s):e&&e.get(s);},has:function has(s){return Yi&&s&&(_typeof(s)=="object"||typeof s=="function")&&t?Z1(t,s):!!e&&e.has(s);},set:function set(s,n){Yi&&s&&(_typeof(s)=="object"||typeof s=="function")?(t||(t=new Yi()),K1(t,s,n)):Fn&&(e||(e=Fn()),e.set(s,n));}};return i;}:Fn,tx=$i,ex=In,rx=Tv,ix=dd,sx=J1,nx=sx||ix||rx,ox=function ox(){var t,e={assert:function assert(i){if(!e.has(i))throw new tx("Side channel does not contain "+ex(i));},"delete":function _delete(i){return!!t&&t["delete"](i);},get:function get(i){return t&&t.get(i);},has:function has(i){return!!t&&t.has(i);},set:function set(i,s){t||(t=nx()),t.set(i,s);}};return e;},ax=String.prototype.replace,lx=/%20/g,Za={RFC1738:"RFC1738",RFC3986:"RFC3986"},Qa={"default":Za.RFC3986,formatters:{RFC1738:function RFC1738(r){return ax.call(r,lx,"+");},RFC3986:function RFC3986(r){return String(r);}},RFC1738:Za.RFC1738,RFC3986:Za.RFC3986},hx=Qa,Ja=Object.prototype.hasOwnProperty,hi=Array.isArray,ar=function(){for(var r=[],t=0;t<256;++t)r.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return r;}(),ux=function ux(t){for(;t.length>1;){var e=t.pop(),i=e.obj[e.prop];if(hi(i)){for(var s=[],n=0;n<i.length;++n)_typeof(i[n])<"u"&&s.push(i[n]);e.obj[e.prop]=s;}}},fd=function fd(t,e){for(var i=e&&e.plainObjects?{__proto__:null}:{},s=0;s<t.length;++s)_typeof(t[s])<"u"&&(i[s]=t[s]);return i;},cx=function r(t,e,i){if(!e)return t;if(_typeof(e)!="object"&&typeof e!="function"){if(hi(t))t.push(e);else if(t&&_typeof(t)=="object")(i&&(i.plainObjects||i.allowPrototypes)||!Ja.call(Object.prototype,e))&&(t[e]=!0);else return[t,e];return t;}if(!t||_typeof(t)!="object")return[t].concat(e);var s=t;return hi(t)&&!hi(e)&&(s=fd(t,i)),hi(t)&&hi(e)?(e.forEach(function(n,o){if(Ja.call(t,o)){var a=t[o];a&&_typeof(a)=="object"&&n&&_typeof(n)=="object"?t[o]=r(a,n,i):t.push(n);}else t[o]=n;}),t):Object.keys(e).reduce(function(n,o){var a=e[o];return Ja.call(n,o)?n[o]=r(n[o],a,i):n[o]=a,n;},s);},dx=function dx(t,e){return Object.keys(e).reduce(function(i,s){return i[s]=e[s],i;},t);},fx=function fx(r,t,e){var i=r.replace(/\+/g," ");if(e==="iso-8859-1")return i.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(i);}catch(_unused17){return i;}},tl=1024,px=function px(t,e,i,s,n){if(t.length===0)return t;var o=t;if(_typeof(t)=="symbol"?o=Symbol.prototype.toString.call(t):typeof t!="string"&&(o=String(t)),i==="iso-8859-1")return escape(o).replace(/%u[0-9a-f]{4}/gi,function(p){return"%26%23"+parseInt(p.slice(2),16)+"%3B";});for(var a="",l=0;l<o.length;l+=tl){for(var h=o.length>=tl?o.slice(l,l+tl):o,u=[],c=0;c<h.length;++c){var d=h.charCodeAt(c);if(d===45||d===46||d===95||d===126||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||n===hx.RFC1738&&(d===40||d===41)){u[u.length]=h.charAt(c);continue;}if(d<128){u[u.length]=ar[d];continue;}if(d<2048){u[u.length]=ar[192|d>>6]+ar[128|d&63];continue;}if(d<55296||d>=57344){u[u.length]=ar[224|d>>12]+ar[128|d>>6&63]+ar[128|d&63];continue;}c+=1,d=65536+((d&1023)<<10|h.charCodeAt(c)&1023),u[u.length]=ar[240|d>>18]+ar[128|d>>12&63]+ar[128|d>>6&63]+ar[128|d&63];}a+=u.join("");}return a;},mx=function mx(t){for(var e=[{obj:{o:t},prop:"o"}],i=[],s=0;s<e.length;++s)for(var n=e[s],o=n.obj[n.prop],a=Object.keys(o),l=0;l<a.length;++l){var h=a[l],u=o[h];_typeof(u)=="object"&&u!==null&&i.indexOf(u)===-1&&(e.push({obj:o,prop:h}),i.push(u));}return ux(e),t;},gx=function gx(t){return Object.prototype.toString.call(t)==="[object RegExp]";},yx=function yx(t){return!t||_typeof(t)!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t));},_x=function _x(t,e){return[].concat(t,e);},vx=function vx(t,e){if(hi(t)){for(var i=[],s=0;s<t.length;s+=1)i.push(e(t[s]));return i;}return e(t);},pd={arrayToObject:fd,assign:dx,combine:_x,compact:mx,decode:fx,encode:px,isBuffer:yx,isRegExp:gx,maybeMap:vx,merge:cx},md=ox,Un=pd,Ls=Qa,xx=Object.prototype.hasOwnProperty,gd={brackets:function brackets(t){return t+"[]";},comma:"comma",indices:function indices(t,e){return t+"["+e+"]";},repeat:function repeat(t){return t;}},lr=Array.isArray,bx=Array.prototype.push,yd=function yd(r,t){bx.apply(r,lr(t)?t:[t]);},Ex=Date.prototype.toISOString,_d=Ls["default"],Jt={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Un.encode,encodeValuesOnly:!1,filter:void 0,format:_d,formatter:Ls.formatters[_d],indices:!1,serializeDate:function serializeDate(t){return Ex.call(t);},skipNulls:!1,strictNullHandling:!1},Tx=function Tx(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||_typeof(t)=="symbol"||typeof t=="bigint";},el={},wx=function r(t,e,i,s,n,o,a,l,h,u,c,d,p,f,m,y,_,v){for(var g=t,x=v,b=0,S=!1;(x=x.get(el))!==void 0&&!S;){var w=x.get(t);if(b+=1,_typeof(w)<"u"){if(w===b)throw new RangeError("Cyclic object value");S=!0;}_typeof(x.get(el))>"u"&&(b=0);}if(typeof u=="function"?g=u(e,g):g instanceof Date?g=p(g):i==="comma"&&lr(g)&&(g=Un.maybeMap(g,function(M){return M instanceof Date?p(M):M;})),g===null){if(o)return h&&!y?h(e,Jt.encoder,_,"key",f):e;g="";}if(Tx(g)||Un.isBuffer(g)){if(h){var T=y?e:h(e,Jt.encoder,_,"key",f);return[m(T)+"="+m(h(g,Jt.encoder,_,"value",f))];}return[m(e)+"="+m(String(g))];}var N=[];if(_typeof(g)>"u")return N;var F;if(i==="comma"&&lr(g))y&&h&&(g=Un.maybeMap(g,h)),F=[{value:g.length>0?g.join(",")||null:void 0}];else if(lr(u))F=u;else{var z=Object.keys(g);F=c?z.sort(c):z;}var C=l?String(e).replace(/\./g,"%2E"):String(e),E=s&&lr(g)&&g.length===1?C+"[]":C;if(n&&lr(g)&&g.length===0)return E+"[]";for(var I=0;I<F.length;++I){var P=F[I],$=_typeof(P)=="object"&&P&&_typeof(P.value)<"u"?P.value:g[P];if(!(a&&$===null)){var k=d&&l?String(P).replace(/\./g,"%2E"):String(P),G=lr(g)?typeof i=="function"?i(E,k):E:E+(d?"."+k:"["+k+"]");v.set(t,b);var st=md();st.set(el,v),yd(N,r($,G,i,s,n,o,a,l,i==="comma"&&y&&lr(g)?null:h,u,c,d,p,f,m,y,_,st));}}return N;},Ax=function Ax(t){if(!t)return Jt;if(_typeof(t.allowEmptyArrays)<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(_typeof(t.encodeDotInKeys)<"u"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&_typeof(t.encoder)<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");var e=t.charset||Jt.charset;if(_typeof(t.charset)<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var i=Ls["default"];if(_typeof(t.format)<"u"){if(!xx.call(Ls.formatters,t.format))throw new TypeError("Unknown format option provided.");i=t.format;}var s=Ls.formatters[i],n=Jt.filter;(typeof t.filter=="function"||lr(t.filter))&&(n=t.filter);var o;if(t.arrayFormat in gd?o=t.arrayFormat:"indices"in t?o=t.indices?"indices":"repeat":o=Jt.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var a=_typeof(t.allowDots)>"u"?t.encodeDotInKeys===!0?!0:Jt.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:Jt.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:Jt.allowEmptyArrays,arrayFormat:o,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:Jt.charsetSentinel,commaRoundTrip:!!t.commaRoundTrip,delimiter:_typeof(t.delimiter)>"u"?Jt.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:Jt.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:Jt.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:Jt.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:Jt.encodeValuesOnly,filter:n,format:i,formatter:s,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:Jt.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:Jt.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:Jt.strictNullHandling};},Sx=function Sx(r,t){var e=r,i=Ax(t),s,n;typeof i.filter=="function"?(n=i.filter,e=n("",e)):lr(i.filter)&&(n=i.filter,s=n);var o=[];if(_typeof(e)!="object"||e===null)return"";var a=gd[i.arrayFormat],l=a==="comma"&&i.commaRoundTrip;s||(s=Object.keys(e)),i.sort&&s.sort(i.sort);for(var h=md(),u=0;u<s.length;++u){var c=s[u],d=e[c];i.skipNulls&&d===null||yd(o,wx(d,c,a,l,i.allowEmptyArrays,i.strictNullHandling,i.skipNulls,i.encodeDotInKeys,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset,h));}var p=o.join(i.delimiter),f=i.addQueryPrefix===!0?"?":"";return i.charsetSentinel&&(i.charset==="iso-8859-1"?f+="utf8=%26%2310003%3B&":f+="utf8=%E2%9C%93&"),p.length>0?f+p:"";},ui=pd,rl=Object.prototype.hasOwnProperty,vd=Array.isArray,kt={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:ui.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},Cx=function Cx(r){return r.replace(/&#(\d+);/g,function(t,e){return String.fromCharCode(parseInt(e,10));});},xd=function xd(r,t,e){if(r&&typeof r=="string"&&t.comma&&r.indexOf(",")>-1)return r.split(",");if(t.throwOnLimitExceeded&&e>=t.arrayLimit)throw new RangeError("Array limit exceeded. Only "+t.arrayLimit+" element"+(t.arrayLimit===1?"":"s")+" allowed in an array.");return r;},Ix="utf8=%26%2310003%3B",Rx="utf8=%E2%9C%93",Mx=function Mx(t,e){var i={__proto__:null},s=e.ignoreQueryPrefix?t.replace(/^\?/,""):t;s=s.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var n=e.parameterLimit===1/0?void 0:e.parameterLimit,o=s.split(e.delimiter,e.throwOnLimitExceeded?n+1:n);if(e.throwOnLimitExceeded&&o.length>n)throw new RangeError("Parameter limit exceeded. Only "+n+" parameter"+(n===1?"":"s")+" allowed.");var a=-1,l,h=e.charset;if(e.charsetSentinel)for(l=0;l<o.length;++l)o[l].indexOf("utf8=")===0&&(o[l]===Rx?h="utf-8":o[l]===Ix&&(h="iso-8859-1"),a=l,l=o.length);for(l=0;l<o.length;++l)if(l!==a){var u=o[l],c=u.indexOf("]="),d=c===-1?u.indexOf("="):c+1,p,f;d===-1?(p=e.decoder(u,kt.decoder,h,"key"),f=e.strictNullHandling?null:""):(p=e.decoder(u.slice(0,d),kt.decoder,h,"key"),f=ui.maybeMap(xd(u.slice(d+1),e,vd(i[p])?i[p].length:0),function(y){return e.decoder(y,kt.decoder,h,"value");})),f&&e.interpretNumericEntities&&h==="iso-8859-1"&&(f=Cx(String(f))),u.indexOf("[]=")>-1&&(f=vd(f)?[f]:f);var m=rl.call(i,p);m&&e.duplicates==="combine"?i[p]=ui.combine(i[p],f):(!m||e.duplicates==="last")&&(i[p]=f);}return i;},Px=function Px(r,t,e,i){var s=0;if(r.length>0&&r[r.length-1]==="[]"){var n=r.slice(0,-1).join("");s=Array.isArray(t)&&t[n]?t[n].length:0;}for(var o=i?t:xd(t,e,s),a=r.length-1;a>=0;--a){var l,h=r[a];if(h==="[]"&&e.parseArrays)l=e.allowEmptyArrays&&(o===""||e.strictNullHandling&&o===null)?[]:ui.combine([],o);else{l=e.plainObjects?{__proto__:null}:{};var u=h.charAt(0)==="["&&h.charAt(h.length-1)==="]"?h.slice(1,-1):h,c=e.decodeDotInKeys?u.replace(/%2E/g,"."):u,d=parseInt(c,10);!e.parseArrays&&c===""?l={0:o}:!isNaN(d)&&h!==c&&String(d)===c&&d>=0&&e.parseArrays&&d<=e.arrayLimit?(l=[],l[d]=o):c!=="__proto__"&&(l[c]=o);}o=l;}return o;},Ox=function Ox(t,e,i,s){if(t){var n=i.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,o=/(\[[^[\]]*])/,a=/(\[[^[\]]*])/g,l=i.depth>0&&o.exec(n),h=l?n.slice(0,l.index):n,u=[];if(h){if(!i.plainObjects&&rl.call(Object.prototype,h)&&!i.allowPrototypes)return;u.push(h);}for(var c=0;i.depth>0&&(l=a.exec(n))!==null&&c<i.depth;){if(c+=1,!i.plainObjects&&rl.call(Object.prototype,l[1].slice(1,-1))&&!i.allowPrototypes)return;u.push(l[1]);}if(l){if(i.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+i.depth+" and strictDepth is true");u.push("["+n.slice(l.index)+"]");}return Px(u,e,i,s);}},Nx=function Nx(t){if(!t)return kt;if(_typeof(t.allowEmptyArrays)<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(_typeof(t.decodeDotInKeys)<"u"&&typeof t.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(t.decoder!==null&&_typeof(t.decoder)<"u"&&typeof t.decoder!="function")throw new TypeError("Decoder has to be a function.");if(_typeof(t.charset)<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(_typeof(t.throwOnLimitExceeded)<"u"&&typeof t.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var e=_typeof(t.charset)>"u"?kt.charset:t.charset,i=_typeof(t.duplicates)>"u"?kt.duplicates:t.duplicates;if(i!=="combine"&&i!=="first"&&i!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var s=_typeof(t.allowDots)>"u"?t.decodeDotInKeys===!0?!0:kt.allowDots:!!t.allowDots;return{allowDots:s,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:kt.allowEmptyArrays,allowPrototypes:typeof t.allowPrototypes=="boolean"?t.allowPrototypes:kt.allowPrototypes,allowSparse:typeof t.allowSparse=="boolean"?t.allowSparse:kt.allowSparse,arrayLimit:typeof t.arrayLimit=="number"?t.arrayLimit:kt.arrayLimit,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:kt.charsetSentinel,comma:typeof t.comma=="boolean"?t.comma:kt.comma,decodeDotInKeys:typeof t.decodeDotInKeys=="boolean"?t.decodeDotInKeys:kt.decodeDotInKeys,decoder:typeof t.decoder=="function"?t.decoder:kt.decoder,delimiter:typeof t.delimiter=="string"||ui.isRegExp(t.delimiter)?t.delimiter:kt.delimiter,depth:typeof t.depth=="number"||t.depth===!1?+t.depth:kt.depth,duplicates:i,ignoreQueryPrefix:t.ignoreQueryPrefix===!0,interpretNumericEntities:typeof t.interpretNumericEntities=="boolean"?t.interpretNumericEntities:kt.interpretNumericEntities,parameterLimit:typeof t.parameterLimit=="number"?t.parameterLimit:kt.parameterLimit,parseArrays:t.parseArrays!==!1,plainObjects:typeof t.plainObjects=="boolean"?t.plainObjects:kt.plainObjects,strictDepth:typeof t.strictDepth=="boolean"?!!t.strictDepth:kt.strictDepth,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:kt.strictNullHandling,throwOnLimitExceeded:typeof t.throwOnLimitExceeded=="boolean"?t.throwOnLimitExceeded:!1};},Dx=function Dx(r,t){var e=Nx(t);if(r===""||r===null||_typeof(r)>"u")return e.plainObjects?{__proto__:null}:{};for(var i=typeof r=="string"?Mx(r,e):r,s=e.plainObjects?{__proto__:null}:{},n=Object.keys(i),o=0;o<n.length;++o){var a=n[o],l=Ox(a,i[a],e,typeof r=="string");s=ui.merge(s,l,e);}return e.allowSparse===!0?s:ui.compact(s);},Lx=Sx,Bx=Dx,Fx=Qa,Ux={formats:Fx,parse:Bx,stringify:Lx},kx=$0;function Tr(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null;}var Gx=/^([a-z0-9.+-]+:)/i,$x=/:[0-9]*$/,Hx=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,Vx=["<",">",'"',"`"," ","\r","\n","	"],Xx=["{","}","|","\\","^","`"].concat(Vx),il=["'"].concat(Xx),bd=["%","/","?",";","#"].concat(il),Ed=["/","?","#"],zx=255,Td=/^[+a-z0-9A-Z_-]{0,63}$/,Wx=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,Yx={javascript:!0,"javascript:":!0},sl={javascript:!0,"javascript:":!0},ji={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},nl=Ux;function jx(r,t,e){if(r&&_typeof(r)=="object"&&r instanceof Tr)return r;var i=new Tr();return i.parse(r,t,e),i;}Tr.prototype.parse=function(r,t,e){if(typeof r!="string")throw new TypeError("Parameter 'url' must be a string, not "+_typeof(r));var i=r.indexOf("?"),s=i!==-1&&i<r.indexOf("#")?"?":"#",n=r.split(s),o=/\\/g;n[0]=n[0].replace(o,"/"),r=n.join(s);var a=r;if(a=a.trim(),!e&&r.split("#").length===1){var l=Hx.exec(a);if(l)return this.path=a,this.href=a,this.pathname=l[1],l[2]?(this.search=l[2],t?this.query=nl.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this;}var h=Gx.exec(a);if(h){h=h[0];var u=h.toLowerCase();this.protocol=u,a=a.substr(h.length);}if(e||h||a.match(/^\/\/[^@/]+@[^@/]+/)){var c=a.substr(0,2)==="//";c&&!(h&&sl[h])&&(a=a.substr(2),this.slashes=!0);}if(!sl[h]&&(c||h&&!ji[h])){for(var d=-1,p=0;p<Ed.length;p++){var f=a.indexOf(Ed[p]);f!==-1&&(d===-1||f<d)&&(d=f);}var m,y;d===-1?y=a.lastIndexOf("@"):y=a.lastIndexOf("@",d),y!==-1&&(m=a.slice(0,y),a=a.slice(y+1),this.auth=decodeURIComponent(m)),d=-1;for(var p=0;p<bd.length;p++){var f=a.indexOf(bd[p]);f!==-1&&(d===-1||f<d)&&(d=f);}d===-1&&(d=a.length),this.host=a.slice(0,d),a=a.slice(d),this.parseHost(),this.hostname=this.hostname||"";var _=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!_)for(var v=this.hostname.split(/\./),p=0,g=v.length;p<g;p++){var x=v[p];if(x&&!x.match(Td)){for(var b="",S=0,w=x.length;S<w;S++)x.charCodeAt(S)>127?b+="x":b+=x[S];if(!b.match(Td)){var T=v.slice(0,p),N=v.slice(p+1),F=x.match(Wx);F&&(T.push(F[1]),N.unshift(F[2])),N.length&&(a="/"+N.join(".")+a),this.hostname=T.join(".");break;}}}this.hostname.length>zx?this.hostname="":this.hostname=this.hostname.toLowerCase(),_||(this.hostname=kx.toASCII(this.hostname));var z=this.port?":"+this.port:"",C=this.hostname||"";this.host=C+z,this.href+=this.host,_&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),a[0]!=="/"&&(a="/"+a));}if(!Yx[u])for(var p=0,g=il.length;p<g;p++){var E=il[p];if(a.indexOf(E)!==-1){var I=encodeURIComponent(E);I===E&&(I=escape(E)),a=a.split(E).join(I);}}var P=a.indexOf("#");P!==-1&&(this.hash=a.substr(P),a=a.slice(0,P));var $=a.indexOf("?");if($!==-1?(this.search=a.substr($),this.query=a.substr($+1),t&&(this.query=nl.parse(this.query)),a=a.slice(0,$)):t&&(this.search="",this.query={}),a&&(this.pathname=a),ji[u]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var z=this.pathname||"",k=this.search||"";this.path=z+k;}return this.href=this.format(),this;},Tr.prototype.format=function(){var r=this.auth||"";r&&(r=encodeURIComponent(r),r=r.replace(/%3A/i,":"),r+="@");var t=this.protocol||"",e=this.pathname||"",i=this.hash||"",s=!1,n="";this.host?s=r+this.host:this.hostname&&(s=r+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(s+=":"+this.port)),this.query&&_typeof(this.query)=="object"&&Object.keys(this.query).length&&(n=nl.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var o=this.search||n&&"?"+n||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||ji[t])&&s!==!1?(s="//"+(s||""),e&&e.charAt(0)!=="/"&&(e="/"+e)):s||(s=""),i&&i.charAt(0)!=="#"&&(i="#"+i),o&&o.charAt(0)!=="?"&&(o="?"+o),e=e.replace(/[?#]/g,function(a){return encodeURIComponent(a);}),o=o.replace("#","%23"),t+s+e+o+i;},Tr.prototype.resolve=function(r){return this.resolveObject(jx(r,!1,!0)).format();},Tr.prototype.resolveObject=function(r){if(typeof r=="string"){var t=new Tr();t.parse(r,!1,!0),r=t;}for(var e=new Tr(),i=Object.keys(this),s=0;s<i.length;s++){var n=i[s];e[n]=this[n];}if(e.hash=r.hash,r.href==="")return e.href=e.format(),e;if(r.slashes&&!r.protocol){for(var o=Object.keys(r),a=0;a<o.length;a++){var l=o[a];l!=="protocol"&&(e[l]=r[l]);}return ji[e.protocol]&&e.hostname&&!e.pathname&&(e.pathname="/",e.path=e.pathname),e.href=e.format(),e;}if(r.protocol&&r.protocol!==e.protocol){if(!ji[r.protocol]){for(var h=Object.keys(r),u=0;u<h.length;u++){var c=h[u];e[c]=r[c];}return e.href=e.format(),e;}if(e.protocol=r.protocol,!r.host&&!sl[r.protocol]){for(var g=(r.pathname||"").split("/");g.length&&!(r.host=g.shift()););r.host||(r.host=""),r.hostname||(r.hostname=""),g[0]!==""&&g.unshift(""),g.length<2&&g.unshift(""),e.pathname=g.join("/");}else e.pathname=r.pathname;if(e.search=r.search,e.query=r.query,e.host=r.host||"",e.auth=r.auth,e.hostname=r.hostname||r.host,e.port=r.port,e.pathname||e.search){var d=e.pathname||"",p=e.search||"";e.path=d+p;}return e.slashes=e.slashes||r.slashes,e.href=e.format(),e;}var f=e.pathname&&e.pathname.charAt(0)==="/",m=r.host||r.pathname&&r.pathname.charAt(0)==="/",y=m||f||e.host&&r.pathname,_=y,v=e.pathname&&e.pathname.split("/")||[],g=r.pathname&&r.pathname.split("/")||[],x=e.protocol&&!ji[e.protocol];if(x&&(e.hostname="",e.port=null,e.host&&(v[0]===""?v[0]=e.host:v.unshift(e.host)),e.host="",r.protocol&&(r.hostname=null,r.port=null,r.host&&(g[0]===""?g[0]=r.host:g.unshift(r.host)),r.host=null),y=y&&(g[0]===""||v[0]==="")),m)e.host=r.host||r.host===""?r.host:e.host,e.hostname=r.hostname||r.hostname===""?r.hostname:e.hostname,e.search=r.search,e.query=r.query,v=g;else if(g.length)v||(v=[]),v.pop(),v=v.concat(g),e.search=r.search,e.query=r.query;else if(r.search!=null){if(x){e.host=v.shift(),e.hostname=e.host;var b=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;b&&(e.auth=b.shift(),e.hostname=b.shift(),e.host=e.hostname);}return e.search=r.search,e.query=r.query,(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=e.format(),e;}if(!v.length)return e.pathname=null,e.search?e.path="/"+e.search:e.path=null,e.href=e.format(),e;for(var S=v.slice(-1)[0],w=(e.host||r.host||v.length>1)&&(S==="."||S==="..")||S==="",T=0,N=v.length;N>=0;N--)S=v[N],S==="."?v.splice(N,1):S===".."?(v.splice(N,1),T++):T&&(v.splice(N,1),T--);if(!y&&!_)for(;T--;T)v.unshift("..");y&&v[0]!==""&&(!v[0]||v[0].charAt(0)!=="/")&&v.unshift(""),w&&v.join("/").substr(-1)!=="/"&&v.push("");var F=v[0]===""||v[0]&&v[0].charAt(0)==="/";if(x){e.hostname=F?"":v.length?v.shift():"",e.host=e.hostname;var b=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;b&&(e.auth=b.shift(),e.hostname=b.shift(),e.host=e.hostname);}return y=y||e.host&&v.length,y&&!F&&v.unshift(""),v.length>0?e.pathname=v.join("/"):(e.pathname=null,e.path=null),(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.auth=r.auth||e.auth,e.slashes=e.slashes||r.slashes,e.href=e.format(),e;},Tr.prototype.parseHost=function(){var r=this.host,t=$x.exec(r);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),r=r.substr(0,r.length-t.length)),r&&(this.hostname=r);};var wd={};function gt(r,t){var e=arguments.length>2&&arguments[2]!==undefined?arguments[2]:3;if(wd[t])return;var i=new Error().stack;_typeof(i)>"u"?console.warn("PixiJS Deprecation Warning: ","".concat(t,"\nDeprecated since v").concat(r)):(i=i.split("\n").splice(e).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6","".concat(t,"\nDeprecated since v").concat(r)),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ","".concat(t,"\nDeprecated since v").concat(r)),console.warn(i))),wd[t]=!0;}function Xe(r){if(typeof r!="string")throw new TypeError("Path must be a string. Received ".concat(JSON.stringify(r)));}function Bs(r){return r.split("?")[0].split("#")[0];}function qx(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");}function Kx(r,t,e){return r.replace(new RegExp(qx(t),"g"),e);}function Zx(r,t){var e="",i=0,s=-1,n=0,o=-1;for(var a=0;a<=r.length;++a){if(a<r.length)o=r.charCodeAt(a);else{if(o===47)break;o=47;}if(o===47){if(!(s===a-1||n===1))if(s!==a-1&&n===2){if(e.length<2||i!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){var l=e.lastIndexOf("/");if(l!==e.length-1){l===-1?(e="",i=0):(e=e.slice(0,l),i=e.length-1-e.lastIndexOf("/")),s=a,n=0;continue;}}else if(e.length===2||e.length===1){e="",i=0,s=a,n=0;continue;}}}else e.length>0?e+="/".concat(r.slice(s+1,a)):e=r.slice(s+1,a),i=a-s-1;s=a,n=0;}else o===46&&n!==-1?++n:n=-1;}return e;}var se={toPosix:function toPosix(r){return Kx(r,"\\","/");},isUrl:function isUrl(r){return /^https?:/.test(this.toPosix(r));},isDataUrl:function isDataUrl(r){return /^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(r);},isBlobUrl:function isBlobUrl(r){return r.startsWith("blob:");},hasProtocol:function hasProtocol(r){return /^[^/:]+:/.test(this.toPosix(r));},getProtocol:function getProtocol(r){Xe(r),r=this.toPosix(r);var t=/^file:\/\/\//.exec(r);if(t)return t[0];var e=/^[^/:]+:\/{0,2}/.exec(r);return e?e[0]:"";},toAbsolute:function toAbsolute(r,t,e){if(Xe(r),this.isDataUrl(r)||this.isBlobUrl(r))return r;var i=Bs(this.toPosix(t!==null&&t!==void 0?t:j.ADAPTER.getBaseUrl())),s=Bs(this.toPosix(e!==null&&e!==void 0?e:this.rootname(i)));return r=this.toPosix(r),r.startsWith("/")?se.join(s,r.slice(1)):this.isAbsolute(r)?r:this.join(i,r);},normalize:function normalize(r){if(Xe(r),r.length===0)return".";if(this.isDataUrl(r)||this.isBlobUrl(r))return r;r=this.toPosix(r);var t="";var e=r.startsWith("/");this.hasProtocol(r)&&(t=this.rootname(r),r=r.slice(t.length));var i=r.endsWith("/");return r=Zx(r),r.length>0&&i&&(r+="/"),e?"/".concat(r):t+r;},isAbsolute:function isAbsolute(r){return Xe(r),r=this.toPosix(r),this.hasProtocol(r)?!0:r.startsWith("/");},join:function join(){if(arguments.length===0)return".";var t;for(var e=0;e<arguments.length;++e){var i=e<0||arguments.length<=e?undefined:arguments[e];if(Xe(i),i.length>0)if(t===void 0)t=i;else{var _ref108;var s=(_ref108=e-1<0||arguments.length<=e-1?undefined:arguments[e-1])!==null&&_ref108!==void 0?_ref108:"";this.joinExtensions.includes(this.extname(s).toLowerCase())?t+="/../".concat(i):t+="/".concat(i);}}return t===void 0?".":this.normalize(t);},dirname:function dirname(r){if(Xe(r),r.length===0)return".";r=this.toPosix(r);var t=r.charCodeAt(0);var e=t===47;var i=-1,s=!0;var n=this.getProtocol(r),o=r;r=r.slice(n.length);for(var a=r.length-1;a>=1;--a)if(t=r.charCodeAt(a),t===47){if(!s){i=a;break;}}else s=!1;return i===-1?e?"/":this.isUrl(o)?n+r:n:e&&i===1?"//":n+r.slice(0,i);},rootname:function rootname(r){Xe(r),r=this.toPosix(r);var t="";if(r.startsWith("/")?t="/":t=this.getProtocol(r),this.isUrl(r)){var e=r.indexOf("/",t.length);e!==-1?t=r.slice(0,e):t=r,t.endsWith("/")||(t+="/");}return t;},basename:function basename(r,t){Xe(r),t&&Xe(t),r=Bs(this.toPosix(r));var e=0,i=-1,s=!0,n;if(t!==void 0&&t.length>0&&t.length<=r.length){if(t.length===r.length&&t===r)return"";var o=t.length-1,a=-1;for(n=r.length-1;n>=0;--n){var l=r.charCodeAt(n);if(l===47){if(!s){e=n+1;break;}}else a===-1&&(s=!1,a=n+1),o>=0&&(l===t.charCodeAt(o)?--o===-1&&(i=n):(o=-1,i=a));}return e===i?i=a:i===-1&&(i=r.length),r.slice(e,i);}for(n=r.length-1;n>=0;--n)if(r.charCodeAt(n)===47){if(!s){e=n+1;break;}}else i===-1&&(s=!1,i=n+1);return i===-1?"":r.slice(e,i);},extname:function extname(r){Xe(r),r=Bs(this.toPosix(r));var t=-1,e=0,i=-1,s=!0,n=0;for(var o=r.length-1;o>=0;--o){var a=r.charCodeAt(o);if(a===47){if(!s){e=o+1;break;}continue;}i===-1&&(s=!1,i=o+1),a===46?t===-1?t=o:n!==1&&(n=1):t!==-1&&(n=-1);}return t===-1||i===-1||n===0||n===1&&t===i-1&&t===e+1?"":r.slice(t,i);},parse:function parse(r){Xe(r);var t={root:"",dir:"",base:"",ext:"",name:""};if(r.length===0)return t;r=Bs(this.toPosix(r));var e=r.charCodeAt(0);var i=this.isAbsolute(r);var s;t.root=this.rootname(r),i||this.hasProtocol(r)?s=1:s=0;var n=-1,o=0,a=-1,l=!0,h=r.length-1,u=0;for(;h>=s;--h){if(e=r.charCodeAt(h),e===47){if(!l){o=h+1;break;}continue;}a===-1&&(l=!1,a=h+1),e===46?n===-1?n=h:u!==1&&(u=1):n!==-1&&(u=-1);}return n===-1||a===-1||u===0||u===1&&n===a-1&&n===o+1?a!==-1&&(o===0&&i?t.base=t.name=r.slice(1,a):t.base=t.name=r.slice(o,a)):(o===0&&i?(t.name=r.slice(1,n),t.base=r.slice(1,a)):(t.name=r.slice(o,n),t.base=r.slice(o,a)),t.ext=r.slice(n,a)),t.dir=this.dirname(r),t;},sep:"/",delimiter:":",joinExtensions:[".html"]};var ol;function Qx(){return _Qx.apply(this,arguments);}function _Qx(){_Qx=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee62(){var _ol;return _regeneratorRuntime().wrap(function _callee62$(_context62){while(1)switch(_context62.prev=_context62.next){case 0:return _context62.abrupt("return",((_ol=ol)!==null&&_ol!==void 0?_ol:ol=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee61(){var n,r,t,e,i,s;return _regeneratorRuntime().wrap(function _callee61$(_context61){while(1)switch(_context61.prev=_context61.next){case 0:r=document.createElement("canvas").getContext("webgl");if(r){_context61.next=3;break;}return _context61.abrupt("return",Ce.UNPACK);case 3:_context61.next=5;return new Promise(function(o){var a=document.createElement("video");a.onloadeddata=function(){return o(a);},a.onerror=function(){return o(null);},a.autoplay=!1,a.crossOrigin="anonymous",a.preload="auto",a.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",a.load();});case 5:t=_context61.sent;if(t){_context61.next=8;break;}return _context61.abrupt("return",Ce.UNPACK);case 8:e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);i=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,i),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.NONE),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t);s=new Uint8Array(4);return _context61.abrupt("return",(r.readPixels(0,0,1,1,r.RGBA,r.UNSIGNED_BYTE,s),r.deleteFramebuffer(i),r.deleteTexture(e),(n=r.getExtension("WEBGL_lose_context"))==null||n.loseContext(),s[0]<=s[3]?Ce.PMA:Ce.UNPACK));case 14:case"end":return _context61.stop();}},_callee61);}))(),ol));case 1:case"end":return _context62.stop();}},_callee62);}));return _Qx.apply(this,arguments);}var al;function Jx(){return _typeof(al)>"u"&&(al=function(){var t;var r={stencil:!0,failIfMajorPerformanceCaveat:j.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!j.ADAPTER.getWebGLRenderingContext())return!1;var e=j.ADAPTER.createCanvas();var i=e.getContext("webgl",r)||e.getContext("experimental-webgl",r);var s=!!((t=i==null?void 0:i.getContextAttributes())!=null&&t.stencil);if(i){var n=i.getExtension("WEBGL_lose_context");n&&n.loseContext();}return i=null,s;}catch(_unused18){return!1;}}()),al;}var tb={grad:.9,turn:360,rad:360/(2*Math.PI)},wr=function wr(r){return typeof r=="string"?r.length>0:typeof r=="number";},ne=function ne(r,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*r)/e+0;},Be=function Be(r,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),r>e?e:r>t?r:t;},Ad=function Ad(r){return(r=isFinite(r)?r%360:0)>0?r:r+360;},Sd=function Sd(r){return{r:Be(r.r,0,255),g:Be(r.g,0,255),b:Be(r.b,0,255),a:Be(r.a)};},ll=function ll(r){return{r:ne(r.r),g:ne(r.g),b:ne(r.b),a:ne(r.a,3)};},eb=/^#([0-9a-f]{3,8})$/i,kn=function kn(r){var t=r.toString(16);return t.length<2?"0"+t:t;},Cd=function Cd(r){var t=r.r,e=r.g,i=r.b,s=r.a,n=Math.max(t,e,i),o=n-Math.min(t,e,i),a=o?n===t?(e-i)/o:n===e?2+(i-t)/o:4+(t-e)/o:0;return{h:60*(a<0?a+6:a),s:n?o/n*100:0,v:n/255*100,a:s};},Id=function Id(r){var t=r.h,e=r.s,i=r.v,s=r.a;t=t/360*6,e/=100,i/=100;var n=Math.floor(t),o=i*(1-e),a=i*(1-(t-n)*e),l=i*(1-(1-t+n)*e),h=n%6;return{r:255*[i,a,o,o,l,i][h],g:255*[l,i,i,a,o,o][h],b:255*[o,o,l,i,i,a][h],a:s};},Rd=function Rd(r){return{h:Ad(r.h),s:Be(r.s,0,100),l:Be(r.l,0,100),a:Be(r.a)};},Md=function Md(r){return{h:ne(r.h),s:ne(r.s),l:ne(r.l),a:ne(r.a,3)};},Pd=function Pd(r){return Id((e=(t=r).s,{h:t.h,s:(e*=((i=t.l)<50?i:100-i)/100)>0?2*e/(i+e)*100:0,v:i+e,a:t.a}));var t,e,i;},Fs=function Fs(r){return{h:(t=Cd(r)).h,s:(s=(200-(e=t.s))*(i=t.v)/100)>0&&s<200?e*i/100/(s<=100?s:200-s)*100:0,l:s/2,a:t.a};var t,e,i,s;},rb=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ib=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,sb=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,nb=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,hl={string:[[function(r){var t=eb.exec(r);return t?(r=t[1]).length<=4?{r:parseInt(r[0]+r[0],16),g:parseInt(r[1]+r[1],16),b:parseInt(r[2]+r[2],16),a:r.length===4?ne(parseInt(r[3]+r[3],16)/255,2):1}:r.length===6||r.length===8?{r:parseInt(r.substr(0,2),16),g:parseInt(r.substr(2,2),16),b:parseInt(r.substr(4,2),16),a:r.length===8?ne(parseInt(r.substr(6,2),16)/255,2):1}:null:null;},"hex"],[function(r){var t=sb.exec(r)||nb.exec(r);return t?t[2]!==t[4]||t[4]!==t[6]?null:Sd({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null;},"rgb"],[function(r){var t=rb.exec(r)||ib.exec(r);if(!t)return null;var e,i,s=Rd({h:(e=t[1],i=t[2],i===void 0&&(i="deg"),Number(e)*(tb[i]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return Pd(s);},"hsl"]],object:[[function(r){var t=r.r,e=r.g,i=r.b,s=r.a,n=s===void 0?1:s;return wr(t)&&wr(e)&&wr(i)?Sd({r:Number(t),g:Number(e),b:Number(i),a:Number(n)}):null;},"rgb"],[function(r){var t=r.h,e=r.s,i=r.l,s=r.a,n=s===void 0?1:s;if(!wr(t)||!wr(e)||!wr(i))return null;var o=Rd({h:Number(t),s:Number(e),l:Number(i),a:Number(n)});return Pd(o);},"hsl"],[function(r){var t=r.h,e=r.s,i=r.v,s=r.a,n=s===void 0?1:s;if(!wr(t)||!wr(e)||!wr(i))return null;var o=function(a){return{h:Ad(a.h),s:Be(a.s,0,100),v:Be(a.v,0,100),a:Be(a.a)};}({h:Number(t),s:Number(e),v:Number(i),a:Number(n)});return Id(o);},"hsv"]]},Od=function Od(r,t){for(var e=0;e<t.length;e++){var i=t[e][0](r);if(i)return[i,t[e][1]];}return[null,void 0];},ob=function ob(r){return typeof r=="string"?Od(r.trim(),hl.string):_typeof(r)=="object"&&r!==null?Od(r,hl.object):[null,void 0];},ul=function ul(r,t){var e=Fs(r);return{h:e.h,s:Be(e.s+100*t,0,100),l:e.l,a:e.a};},cl=function cl(r){return(299*r.r+587*r.g+114*r.b)/1e3/255;},Nd=function Nd(r,t){var e=Fs(r);return{h:e.h,s:e.s,l:Be(e.l+100*t,0,100),a:e.a};},dl=function(){function r(t){this.parsed=ob(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1};}return r.prototype.isValid=function(){return this.parsed!==null;},r.prototype.brightness=function(){return ne(cl(this.rgba),2);},r.prototype.isDark=function(){return cl(this.rgba)<.5;},r.prototype.isLight=function(){return cl(this.rgba)>=.5;},r.prototype.toHex=function(){return t=ll(this.rgba),e=t.r,i=t.g,s=t.b,o=(n=t.a)<1?kn(ne(255*n)):"","#"+kn(e)+kn(i)+kn(s)+o;var t,e,i,s,n,o;},r.prototype.toRgb=function(){return ll(this.rgba);},r.prototype.toRgbString=function(){return t=ll(this.rgba),e=t.r,i=t.g,s=t.b,(n=t.a)<1?"rgba("+e+", "+i+", "+s+", "+n+")":"rgb("+e+", "+i+", "+s+")";var t,e,i,s,n;},r.prototype.toHsl=function(){return Md(Fs(this.rgba));},r.prototype.toHslString=function(){return t=Md(Fs(this.rgba)),e=t.h,i=t.s,s=t.l,(n=t.a)<1?"hsla("+e+", "+i+"%, "+s+"%, "+n+")":"hsl("+e+", "+i+"%, "+s+"%)";var t,e,i,s,n;},r.prototype.toHsv=function(){return t=Cd(this.rgba),{h:ne(t.h),s:ne(t.s),v:ne(t.v),a:ne(t.a,3)};var t;},r.prototype.invert=function(){return hr({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t;},r.prototype.saturate=function(t){return t===void 0&&(t=.1),hr(ul(this.rgba,t));},r.prototype.desaturate=function(t){return t===void 0&&(t=.1),hr(ul(this.rgba,-t));},r.prototype.grayscale=function(){return hr(ul(this.rgba,-1));},r.prototype.lighten=function(t){return t===void 0&&(t=.1),hr(Nd(this.rgba,t));},r.prototype.darken=function(t){return t===void 0&&(t=.1),hr(Nd(this.rgba,-t));},r.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t);},r.prototype.alpha=function(t){return typeof t=="number"?hr({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):ne(this.rgba.a,3);var e;},r.prototype.hue=function(t){var e=Fs(this.rgba);return typeof t=="number"?hr({h:t,s:e.s,l:e.l,a:e.a}):ne(e.h);},r.prototype.isEqual=function(t){return this.toHex()===hr(t).toHex();},r;}(),hr=function hr(r){return r instanceof dl?r:new dl(r);},Dd=[],ab=function ab(r){r.forEach(function(t){Dd.indexOf(t)<0&&(t(dl,hl),Dd.push(t));});};function lb(r,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var s in e)i[e[s]]=s;var n={};r.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,l,h=i[this.toHex()];if(h)return h;if(o!=null&&o.closest){var u=this.toRgb(),c=1/0,d="black";if(!n.length)for(var p in e)n[p]=new r(e[p]).toRgb();for(var f in e){var m=(a=u,l=n[f],Math.pow(a.r-l.r,2)+Math.pow(a.g-l.g,2)+Math.pow(a.b-l.b,2));m<c&&(c=m,d=f);}return d;}},t.string.push([function(o){var a=o.toLowerCase(),l=a==="transparent"?"#0000":e[a];return l?new r(l).toRgb():null;},"name"]);}ab([lb]);var qi=/*#__PURE__*/function(){function Bo(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:16777215;_classCallCheck(this,Bo);this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t;}_createClass(Bo,[{key:"red",get:function get(){return this._components[0];}},{key:"green",get:function get(){return this._components[1];}},{key:"blue",get:function get(){return this._components[2];}},{key:"alpha",get:function get(){return this._components[3];}},{key:"setValue",value:function setValue(t){return this.value=t,this;}},{key:"value",get:function get(){return this._value;},set:function set(t){if(t instanceof Bo)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,t))&&(this.normalize(t),this._value=this.cloneSource(t));}}},{key:"cloneSource",value:function cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):_typeof(t)=="object"&&t!==null?_objectSpread({},t):t;}},{key:"isSourceEqual",value:function isSourceEqual(t,e){var i=_typeof(t);if(i!==_typeof(e))return!1;if(i==="number"||i==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every(function(s,n){return s===e[n];});if(t!==null&&e!==null){var s=Object.keys(t),n=Object.keys(e);return s.length!==n.length?!1:s.every(function(o){return t[o]===e[o];});}return t===e;}},{key:"toRgba",value:function toRgba(){var _this$_components=_slicedToArray(this._components,4),t=_this$_components[0],e=_this$_components[1],i=_this$_components[2],s=_this$_components[3];return{r:t,g:e,b:i,a:s};}},{key:"toRgb",value:function toRgb(){var _this$_components2=_slicedToArray(this._components,3),t=_this$_components2[0],e=_this$_components2[1],i=_this$_components2[2];return{r:t,g:e,b:i};}},{key:"toRgbaString",value:function toRgbaString(){var _this$toUint8RgbArray=this.toUint8RgbArray(),_this$toUint8RgbArray2=_slicedToArray(_this$toUint8RgbArray,3),t=_this$toUint8RgbArray2[0],e=_this$toUint8RgbArray2[1],i=_this$toUint8RgbArray2[2];return"rgba(".concat(t,",").concat(e,",").concat(i,",").concat(this.alpha,")");}},{key:"toUint8RgbArray",value:function toUint8RgbArray(t){var _t8;var _this$_components3=_slicedToArray(this._components,3),e=_this$_components3[0],i=_this$_components3[1],s=_this$_components3[2];return t=(_t8=t)!==null&&_t8!==void 0?_t8:[],t[0]=Math.round(e*255),t[1]=Math.round(i*255),t[2]=Math.round(s*255),t;}},{key:"toRgbArray",value:function toRgbArray(t){var _t9;t=(_t9=t)!==null&&_t9!==void 0?_t9:[];var _this$_components4=_slicedToArray(this._components,3),e=_this$_components4[0],i=_this$_components4[1],s=_this$_components4[2];return t[0]=e,t[1]=i,t[2]=s,t;}},{key:"toNumber",value:function toNumber(){return this._int;}},{key:"toLittleEndianNumber",value:function toLittleEndianNumber(){var t=this._int;return(t>>16)+(t&65280)+((t&255)<<16);}},{key:"multiply",value:function multiply(t){var _Bo$temp$setValue$_co=_slicedToArray(Bo.temp.setValue(t)._components,4),e=_Bo$temp$setValue$_co[0],i=_Bo$temp$setValue$_co[1],s=_Bo$temp$setValue$_co[2],n=_Bo$temp$setValue$_co[3];return this._components[0]*=e,this._components[1]*=i,this._components[2]*=s,this._components[3]*=n,this.refreshInt(),this._value=null,this;}},{key:"premultiply",value:function premultiply(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!0;return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this;}},{key:"toPremultiplied",value:function toPremultiplied(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!0;if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;var i=this._int>>16&255,s=this._int>>8&255,n=this._int&255;return e&&(i=i*t+.5|0,s=s*t+.5|0,n=n*t+.5|0),(t*255<<24)+(i<<16)+(s<<8)+n;}},{key:"toHex",value:function toHex(){var t=this._int.toString(16);return"#".concat("000000".substring(0,6-t.length)+t);}},{key:"toHexa",value:function toHexa(){var t=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t;}},{key:"setAlpha",value:function setAlpha(t){return this._components[3]=this._clamp(t),this;}},{key:"round",value:function round(t){var _this$_components5=_slicedToArray(this._components,3),e=_this$_components5[0],i=_this$_components5[1],s=_this$_components5[2];return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(i*t)/t,this._components[2]=Math.round(s*t)/t,this.refreshInt(),this._value=null,this;}},{key:"toArray",value:function toArray(t){var _t10;t=(_t10=t)!==null&&_t10!==void 0?_t10:[];var _this$_components6=_slicedToArray(this._components,4),e=_this$_components6[0],i=_this$_components6[1],s=_this$_components6[2],n=_this$_components6[3];return t[0]=e,t[1]=i,t[2]=s,t[3]=n,t;}},{key:"normalize",value:function normalize(t){var _t11,_t12,_t12$,_t13,_t14,_t14$;var e,i,s,n;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){var o=t;e=(o>>16&255)/255,i=(o>>8&255)/255,s=(o&255)/255,n=1;}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),(_t11=t,_t12=_slicedToArray(_t11,4),e=_t12[0],i=_t12[1],s=_t12[2],_t12$=_t12[3],n=_t12$===void 0?1:_t12$);else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),(_t13=t,_t14=_slicedToArray(_t13,4),e=_t14[0],i=_t14[1],s=_t14[2],_t14$=_t14[3],n=_t14$===void 0?255:_t14$),e/=255,i/=255,s/=255,n/=255;else if(typeof t=="string"||_typeof(t)=="object"){var _o11$rgba;if(typeof t=="string"){var a=Bo.HEX_PATTERN.exec(t);a&&(t="#".concat(a[2]));}var _o11=hr(t);_o11.isValid()&&((_o11$rgba=_o11.rgba,e=_o11$rgba.r,i=_o11$rgba.g,s=_o11$rgba.b,n=_o11$rgba.a),e/=255,i/=255,s/=255);}if(e!==void 0)this._components[0]=e,this._components[1]=i,this._components[2]=s,this._components[3]=n,this.refreshInt();else throw new Error("Unable to convert color ".concat(t));}},{key:"refreshInt",value:function refreshInt(){this._clamp(this._components);var _this$_components7=_slicedToArray(this._components,3),t=_this$_components7[0],e=_this$_components7[1],i=_this$_components7[2];this._int=(t*255<<16)+(e*255<<8)+(i*255|0);}},{key:"_clamp",value:function _clamp(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;return typeof t=="number"?Math.min(Math.max(t,e),i):(t.forEach(function(s,n){t[n]=Math.min(Math.max(s,e),i);}),t);}}]);return Bo;}();qi.shared=new qi(),qi.temp=new qi(),qi.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;var wt=qi;function hb(r){return gt("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),wt.shared.setValue(r).toHex();}function ub(r){return gt("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),wt.shared.setValue(r).toNumber();}function cb(){var r=[],t=[];for(var i=0;i<32;i++)r[i]=i,t[i]=i;r[at.NORMAL_NPM]=at.NORMAL,r[at.ADD_NPM]=at.ADD,r[at.SCREEN_NPM]=at.SCREEN,t[at.NORMAL]=at.NORMAL_NPM,t[at.ADD]=at.ADD_NPM,t[at.SCREEN]=at.SCREEN_NPM;var e=[];return e.push(t),e.push(r),e;}var Ld=cb();function Bd(r,t){return Ld[t?1:0][r];}function db(r){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var e=r*6;if(t=t||new Uint16Array(e),t.length!==e)throw new Error("Out buffer length is incorrect, got ".concat(t.length," and expected ").concat(e));for(var i=0,s=0;i<e;i+=6,s+=4)t[i+0]=s+0,t[i+1]=s+1,t[i+2]=s+2,t[i+3]=s+0,t[i+4]=s+2,t[i+5]=s+3;return t;}function Fd(r){if(r.BYTES_PER_ELEMENT===4)return r instanceof Float32Array?"Float32Array":r instanceof Uint32Array?"Uint32Array":"Int32Array";if(r.BYTES_PER_ELEMENT===2){if(r instanceof Uint16Array)return"Uint16Array";}else if(r.BYTES_PER_ELEMENT===1&&r instanceof Uint8Array)return"Uint8Array";return null;}function Gn(r){return r+=r===0?1:0,--r,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r+1;}function Ud(r){return!(r&r-1)&&!!r;}function kd(r){var t=(r>65535?1:0)<<4;r>>>=t;var e=(r>255?1:0)<<3;return r>>>=e,t|=e,e=(r>15?1:0)<<2,r>>>=e,t|=e,e=(r>3?1:0)<<1,r>>>=e,t|=e,t|r>>1;}function Ki(r,t,e){var i=r.length;var s;if(t>=i||e===0)return;e=t+e>i?i-t:e;var n=i-e;for(s=t;s<n;++s)r[s]=r[s+e];r.length=n;}function Fr(r){return r===0?0:r<0?-1:1;}var fb=0;function ci(){return++fb;}var fl=/*#__PURE__*/function(){function fl(r,t,e,i){_classCallCheck(this,fl);this.left=r,this.top=t,this.right=e,this.bottom=i;}_createClass(fl,[{key:"width",get:function get(){return this.right-this.left;}},{key:"height",get:function get(){return this.bottom-this.top;}},{key:"isEmpty",value:function isEmpty(){return this.left===this.right||this.top===this.bottom;}}]);return fl;}();fl.EMPTY=new fl(0,0,0,0);var Gd=fl;var $d={},ur=Object.create(null),Ur=Object.create(null);var pb=/*#__PURE__*/function(){function pb(t,e,i){_classCallCheck(this,pb);this._canvas=j.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=i||j.RESOLUTION,this.resize(t,e);}_createClass(pb,[{key:"clear",value:function clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height);}},{key:"resize",value:function resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution);}},{key:"destroy",value:function destroy(){this._context=null,this._canvas=null;}},{key:"width",get:function get(){return this._checkDestroyed(),this._canvas.width;},set:function set(t){this._checkDestroyed(),this._canvas.width=Math.round(t);}},{key:"height",get:function get(){return this._checkDestroyed(),this._canvas.height;},set:function set(t){this._checkDestroyed(),this._canvas.height=Math.round(t);}},{key:"canvas",get:function get(){return this._checkDestroyed(),this._canvas;}},{key:"context",get:function get(){return this._checkDestroyed(),this._context;}},{key:"_checkDestroyed",value:function _checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed");}}]);return pb;}();function Hd(r,t,e){for(var i=0,s=4*e*t;i<t;++i,s+=4)if(r[s+3]!==0)return!1;return!0;}function Vd(r,t,e,i,s){var n=4*t;for(var o=i,a=i*n+4*e;o<=s;++o,a+=n)if(r[a+3]!==0)return!1;return!0;}function mb(r){var t=r.width,e=r.height,i=r.getContext("2d",{willReadFrequently:!0});if(i===null)throw new TypeError("Failed to get canvas 2D context");var s=i.getImageData(0,0,t,e).data;var n=0,o=0,a=t-1,l=e-1;for(;o<e&&Hd(s,t,o);)++o;if(o===e)return Gd.EMPTY;for(;Hd(s,t,l);)--l;for(;Vd(s,t,n,o,l);)++n;for(;Vd(s,t,a,o,l);)--a;return++a,++l,new Gd(n,o,a,l);}function gb(r){var t=mb(r),e=t.width,i=t.height;var s=null;if(!t.isEmpty()){var n=r.getContext("2d");if(n===null)throw new TypeError("Failed to get canvas 2D context");s=n.getImageData(t.left,t.top,e,i);}return{width:e,height:i,data:s};}function yb(r){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:globalThis.location;if(r.startsWith("data:"))return"";t=t||globalThis.location;var e=new URL(r,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?"anonymous":"";}function Ar(r){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var i;var e=(i=j.RETINA_PREFIX)==null?void 0:i.exec(r);return e?parseFloat(e[1]):t;}var W=function(r){return r.Renderer="renderer",r.Application="application",r.RendererSystem="renderer-webgl-system",r.RendererPlugin="renderer-webgl-plugin",r.CanvasRendererSystem="renderer-canvas-system",r.CanvasRendererPlugin="renderer-canvas-plugin",r.Asset="asset",r.LoadParser="load-parser",r.ResolveParser="resolve-parser",r.CacheParser="cache-parser",r.DetectionParser="detection-parser",r;}(W||{});var pl=function pl(r){if(typeof r=="function"||_typeof(r)=="object"&&r.extension){if(!r.extension)throw new Error("Extension class must have an extension object");r=_objectSpread(_objectSpread({},_typeof(r.extension)!="object"?{type:r.extension}:r.extension),{},{ref:r});}if(_typeof(r)=="object")r=_objectSpread({},r);else throw new Error("Invalid extension type");return typeof r.type=="string"&&(r.type=[r.type]),r;},Xd=function Xd(r,t){var _pl$priority;return(_pl$priority=pl(r).priority)!==null&&_pl$priority!==void 0?_pl$priority:t;},K={_addHandlers:{},_removeHandlers:{},_queue:{},remove:function remove(){var _this22=this;for(var _len6=arguments.length,r=new Array(_len6),_key6=0;_key6<_len6;_key6++){r[_key6]=arguments[_key6];}return r.map(pl).forEach(function(t){t.type.forEach(function(e){var i,s;return(s=(i=_this22._removeHandlers)[e])==null?void 0:s.call(i,t);});}),this;},add:function add(){var _this23=this;for(var _len7=arguments.length,r=new Array(_len7),_key7=0;_key7<_len7;_key7++){r[_key7]=arguments[_key7];}return r.map(pl).forEach(function(t){t.type.forEach(function(e){var n,o;var i=_this23._addHandlers,s=_this23._queue;i[e]?(n=i[e])==null||n.call(i,t):(s[e]=s[e]||[],(o=s[e])==null||o.push(t));});}),this;},handle:function handle(r,t,e){var o;var i=this._addHandlers,s=this._removeHandlers;if(i[r]||s[r])throw new Error("Extension type ".concat(r," already has a handler"));i[r]=t,s[r]=e;var n=this._queue;return n[r]&&((o=n[r])==null||o.forEach(function(a){return t(a);}),delete n[r]),this;},handleByMap:function handleByMap(r,t){return this.handle(r,function(e){e.name&&(t[e.name]=e.ref);},function(e){e.name&&delete t[e.name];});},handleByList:function handleByList(r,t){var e=arguments.length>2&&arguments[2]!==undefined?arguments[2]:-1;return this.handle(r,function(i){t.includes(i.ref)||(t.push(i.ref),t.sort(function(s,n){return Xd(n,e)-Xd(s,e);}));},function(i){var s=t.indexOf(i.ref);s!==-1&&t.splice(s,1);});}};var ml=/*#__PURE__*/function(){function ml(t){_classCallCheck(this,ml);typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData);}_createClass(ml,[{key:"int8View",get:function get(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View;}},{key:"uint8View",get:function get(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View;}},{key:"int16View",get:function get(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View;}},{key:"uint16View",get:function get(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View;}},{key:"int32View",get:function get(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View;}},{key:"view",value:function view(t){return this["".concat(t,"View")];}},{key:"destroy",value:function destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null;}}],[{key:"sizeOf",value:function sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error("".concat(t," isn't a valid view type"));}}}]);return ml;}();var _b=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function vb(r){var t="";for(var e=0;e<r;++e)e>0&&(t+="\nelse "),e<r-1&&(t+="if(test == ".concat(e,".0){}"));return t;}function xb(r,t){if(r===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");var e=t.createShader(t.FRAGMENT_SHADER);for(;;){var i=_b.replace(/%forloop%/gi,vb(r));if(t.shaderSource(e,i),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))r=r/2|0;else break;}return r;}var gl=0,yl=1,_l=2,vl=3,xl=4,bl=5;var cr=/*#__PURE__*/function(){function cr(){_classCallCheck(this,cr);this.data=0,this.blendMode=at.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0;}_createClass(cr,[{key:"blend",get:function get(){return!!(this.data&1<<gl);},set:function set(t){!!(this.data&1<<gl)!==t&&(this.data^=1<<gl);}},{key:"offsets",get:function get(){return!!(this.data&1<<yl);},set:function set(t){!!(this.data&1<<yl)!==t&&(this.data^=1<<yl);}},{key:"culling",get:function get(){return!!(this.data&1<<_l);},set:function set(t){!!(this.data&1<<_l)!==t&&(this.data^=1<<_l);}},{key:"depthTest",get:function get(){return!!(this.data&1<<vl);},set:function set(t){!!(this.data&1<<vl)!==t&&(this.data^=1<<vl);}},{key:"depthMask",get:function get(){return!!(this.data&1<<bl);},set:function set(t){!!(this.data&1<<bl)!==t&&(this.data^=1<<bl);}},{key:"clockwiseFrontFace",get:function get(){return!!(this.data&1<<xl);},set:function set(t){!!(this.data&1<<xl)!==t&&(this.data^=1<<xl);}},{key:"blendMode",get:function get(){return this._blendMode;},set:function set(t){this.blend=t!==at.NONE,this._blendMode=t;}},{key:"polygonOffset",get:function get(){return this._polygonOffset;},set:function set(t){this.offsets=!!t,this._polygonOffset=t;}}],[{key:"for2d",value:function for2d(){var t=new cr();return t.depthTest=!1,t.blend=!0,t;}}]);return cr;}();cr.prototype.toString=function(){return"[@pixi/core:State blendMode=".concat(this.blendMode," clockwiseFrontFace=").concat(this.clockwiseFrontFace," culling=").concat(this.culling," depthMask=").concat(this.depthMask," polygonOffset=").concat(this.polygonOffset,"]");};var El=[];function zd(r,t){if(!r)return null;var e="";if(typeof r=="string"){var i=/\.(\w{3,4})(?:$|\?|#)/i.exec(r);i&&(e=i[1].toLowerCase());}for(var _i24=El.length-1;_i24>=0;--_i24){var s=El[_i24];if(s.test&&s.test(r,e))return new s(r,t);}throw new Error("Unrecognized source type to auto-detect Resource");}var ze=/*#__PURE__*/function(){function ze(t){_classCallCheck(this,ze);this.items=[],this._name=t,this._aliasCount=0;}_createClass(ze,[{key:"emit",value:function emit(t,e,i,s,n,o,a,l){if(arguments.length>8)throw new Error("max arguments reached");var h=this.name,u=this.items;this._aliasCount++;for(var c=0,d=u.length;c<d;c++)u[c][h](t,e,i,s,n,o,a,l);return u===this.items&&this._aliasCount--,this;}},{key:"ensureNonAliasedItems",value:function ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0));}},{key:"add",value:function add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this;}},{key:"remove",value:function remove(t){var e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this;}},{key:"contains",value:function contains(t){return this.items.includes(t);}},{key:"removeAll",value:function removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this;}},{key:"destroy",value:function destroy(){this.removeAll(),this.items.length=0,this._name="";}},{key:"empty",get:function get(){return this.items.length===0;}},{key:"name",get:function get(){return this._name;}}]);return ze;}();Object.defineProperties(ze.prototype,{dispatch:{value:ze.prototype.emit},run:{value:ze.prototype.emit}});var Us=/*#__PURE__*/function(){function Us(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;_classCallCheck(this,Us);this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new ze("setRealSize"),this.onUpdate=new ze("update"),this.onError=new ze("onError");}_createClass(Us,[{key:"bind",value:function bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height);}},{key:"unbind",value:function unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t);}},{key:"resize",value:function resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e));}},{key:"valid",get:function get(){return!!this._width&&!!this._height;}},{key:"update",value:function update(){this.destroyed||this.onUpdate.emit();}},{key:"load",value:function load(){return Promise.resolve(this);}},{key:"width",get:function get(){return this._width;}},{key:"height",get:function get(){return this._height;}},{key:"style",value:function style(t,e,i){return!1;}},{key:"dispose",value:function dispose(){}},{key:"destroy",value:function destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null);}}],[{key:"test",value:function test(t,e){return!1;}}]);return Us;}();var $n=/*#__PURE__*/function(_Us){_inherits($n,_Us);var _super17=_createSuper($n);function $n(t,e){var _e$unpackAlignment;var _this24;_classCallCheck(this,$n);var _ref109=e||{},i=_ref109.width,s=_ref109.height;if(!i||!s)throw new Error("BufferResource width or height invalid");_this24=_super17.call(this,i,s),_this24.data=t,_this24.unpackAlignment=(_e$unpackAlignment=e.unpackAlignment)!==null&&_e$unpackAlignment!==void 0?_e$unpackAlignment:4;return _this24;}_createClass($n,[{key:"upload",value:function upload(t,e,i){var s=t.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,this.unpackAlignment),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Ce.UNPACK);var n=e.realWidth,o=e.realHeight;return i.width===n&&i.height===o?s.texSubImage2D(e.target,0,0,0,n,o,e.format,i.type,this.data):(i.width=n,i.height=o,s.texImage2D(e.target,0,i.internalFormat,n,o,0,e.format,i.type,this.data)),!0;}},{key:"dispose",value:function dispose(){this.data=null;}}],[{key:"test",value:function test(t){return t===null||t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array;}}]);return $n;}(Us);var bb={scaleMode:vr.NEAREST,alphaMode:Ce.NPM},Tl=/*#__PURE__*/function(_Ts){_inherits(hs,_Ts);var _super18=_createSuper(hs);function hs(){var _this25;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;_classCallCheck(this,hs);_this25=_super18.call(this),e=Object.assign({},hs.defaultOptions,e);var _e4=e,i=_e4.alphaMode,s=_e4.mipmap,n=_e4.anisotropicLevel,o=_e4.scaleMode,a=_e4.width,l=_e4.height,h=_e4.wrapMode,u=_e4.format,c=_e4.type,d=_e4.target,p=_e4.resolution,f=_e4.resourceOptions;t&&!(t instanceof Us)&&(t=zd(t,f),t.internal=!0),_this25.resolution=p||j.RESOLUTION,_this25.width=Math.round((a||0)*_this25.resolution)/_this25.resolution,_this25.height=Math.round((l||0)*_this25.resolution)/_this25.resolution,_this25._mipmap=s,_this25.anisotropicLevel=n,_this25._wrapMode=h,_this25._scaleMode=o,_this25.format=u,_this25.type=c,_this25.target=d,_this25.alphaMode=i,_this25.uid=ci(),_this25.touched=0,_this25.isPowerOfTwo=!1,_this25._refreshPOT(),_this25._glTextures={},_this25.dirtyId=0,_this25.dirtyStyleId=0,_this25.cacheId=null,_this25.valid=a>0&&l>0,_this25.textureCacheIds=[],_this25.destroyed=!1,_this25.resource=null,_this25._batchEnabled=0,_this25._batchLocation=0,_this25.parentTextureArray=null,_this25.setResource(t);return _this25;}_createClass(hs,[{key:"realWidth",get:function get(){return Math.round(this.width*this.resolution);}},{key:"realHeight",get:function get(){return Math.round(this.height*this.resolution);}},{key:"mipmap",get:function get(){return this._mipmap;},set:function set(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++);}},{key:"scaleMode",get:function get(){return this._scaleMode;},set:function set(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++);}},{key:"wrapMode",get:function get(){return this._wrapMode;},set:function set(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++);}},{key:"setStyle",value:function setStyle(t,e){var i;return t!==void 0&&t!==this.scaleMode&&(this.scaleMode=t,i=!0),e!==void 0&&e!==this.mipmap&&(this.mipmap=e,i=!0),i&&this.dirtyStyleId++,this;}},{key:"setSize",value:function setSize(t,e,i){return i=i||this.resolution,this.setRealSize(t*i,e*i,i);}},{key:"setRealSize",value:function setRealSize(t,e,i){return this.resolution=i||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this;}},{key:"_refreshPOT",value:function _refreshPOT(){this.isPowerOfTwo=Ud(this.realWidth)&&Ud(this.realHeight);}},{key:"setResolution",value:function setResolution(t){var e=this.resolution;return e===t?this:(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT(),this);}},{key:"setResource",value:function setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this;}},{key:"update",value:function update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this));}},{key:"onError",value:function onError(t){this.emit("error",this,t);}},{key:"destroy",value:function destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Ur[this.cacheId],delete ur[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),hs.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners();}},{key:"dispose",value:function dispose(){this.emit("dispose",this);}},{key:"castToBaseTexture",value:function castToBaseTexture(){return this;}}],[{key:"from",value:function from(t,e){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:j.STRICT_TEXTURE_CACHE;var s=typeof t=="string";var n=null;if(s)n=t;else{if(!t._pixiId){var a=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId="".concat(a,"_").concat(ci());}n=t._pixiId;}var o=Ur[n];if(s&&i&&!o)throw new Error("The cacheId \"".concat(n,"\" does not exist in BaseTextureCache."));return o||(o=new hs(t,e),o.cacheId=n,hs.addToCache(o,n)),o;}},{key:"fromBuffer",value:function fromBuffer(t,e,i,s){t=t||new Float32Array(e*i*4);var n=new $n(t,_objectSpread({width:e,height:i},s==null?void 0:s.resourceOptions));var o,a;return t instanceof Float32Array?(o=H.RGBA,a=tt.FLOAT):t instanceof Int32Array?(o=H.RGBA_INTEGER,a=tt.INT):t instanceof Uint32Array?(o=H.RGBA_INTEGER,a=tt.UNSIGNED_INT):t instanceof Int16Array?(o=H.RGBA_INTEGER,a=tt.SHORT):t instanceof Uint16Array?(o=H.RGBA_INTEGER,a=tt.UNSIGNED_SHORT):t instanceof Int8Array?(o=H.RGBA,a=tt.BYTE):(o=H.RGBA,a=tt.UNSIGNED_BYTE),n.internal=!0,new hs(n,Object.assign({},bb,{type:a,format:o},s));}},{key:"addToCache",value:function addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Ur[e]&&Ur[e]!==t&&console.warn("BaseTexture added to the cache with an id [".concat(e,"] that already had an entry")),Ur[e]=t);}},{key:"removeFromCache",value:function removeFromCache(t){if(typeof t=="string"){var e=Ur[t];if(e){var i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete Ur[t],e;}}else if(t!=null&&t.textureCacheIds){for(var _e5=0;_e5<t.textureCacheIds.length;++_e5)delete Ur[t.textureCacheIds[_e5]];return t.textureCacheIds.length=0,t;}return null;}}]);return hs;}(Ts);Tl.defaultOptions={mipmap:ir.POW2,anisotropicLevel:0,scaleMode:vr.LINEAR,wrapMode:Dr.CLAMP,alphaMode:Ce.UNPACK,target:Ui.TEXTURE_2D,format:H.RGBA,type:tt.UNSIGNED_BYTE},Tl._globalBatch=0;var ft=Tl;var wl=/*#__PURE__*/_createClass(function wl(){_classCallCheck(this,wl);this.texArray=null,this.blend=0,this.type=rr.TRIANGLES,this.start=0,this.size=0,this.data=null;});var Eb=0;var Vt=/*#__PURE__*/function(){function Vt(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!0;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:!1;_classCallCheck(this,Vt);this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this["static"]=e,this.id=Eb++,this.disposeRunner=new ze("disposeBuffer");}_createClass(Vt,[{key:"update",value:function update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++;}},{key:"dispose",value:function dispose(){this.disposeRunner.emit(this,!1);}},{key:"destroy",value:function destroy(){this.dispose(),this.data=null;}},{key:"index",get:function get(){return this.type===nr.ELEMENT_ARRAY_BUFFER;},set:function set(t){this.type=t?nr.ELEMENT_ARRAY_BUFFER:nr.ARRAY_BUFFER;}}],[{key:"from",value:function from(t){return t instanceof Array&&(t=new Float32Array(t)),new Vt(t);}}]);return Vt;}();var Hn=/*#__PURE__*/function(){function Hn(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:!1;var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:tt.FLOAT;var n=arguments.length>4?arguments[4]:undefined;var o=arguments.length>5?arguments[5]:undefined;var a=arguments.length>6?arguments[6]:undefined;var l=arguments.length>7&&arguments[7]!==undefined?arguments[7]:1;_classCallCheck(this,Hn);this.buffer=t,this.size=e,this.normalized=i,this.type=s,this.stride=n,this.start=o,this.instance=a,this.divisor=l;}_createClass(Hn,[{key:"destroy",value:function destroy(){this.buffer=null;}}],[{key:"from",value:function from(t,e,i,s,n){return new Hn(t,e,i,s,n);}}]);return Hn;}();var Tb={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};function wb(r,t){var e=0,i=0;var s={};for(var l=0;l<r.length;l++)i+=t[l],e+=r[l].length;var n=new ArrayBuffer(e*4);var o=null,a=0;for(var _l2=0;_l2<r.length;_l2++){var h=t[_l2],u=r[_l2],c=Fd(u);s[c]||(s[c]=new Tb[c](n)),o=s[c];for(var d=0;d<u.length;d++){var p=(d/h|0)*i+a,f=d%h;o[p+f]=u[d];}a+=h;}return new Float32Array(n);}var Wd={5126:4,5123:2,5121:1};var Ab=0;var Sb={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array};var kr=/*#__PURE__*/function(){function kr(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,kr);this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=Ab++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new ze("disposeGeometry"),this.refCount=0;}_createClass(kr,[{key:"addAttribute",value:function addAttribute(t,e){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:!1;var n=arguments.length>4?arguments[4]:undefined;var o=arguments.length>5?arguments[5]:undefined;var a=arguments.length>6?arguments[6]:undefined;var l=arguments.length>7&&arguments[7]!==undefined?arguments[7]:!1;if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof Vt||(e instanceof Array&&(e=new Float32Array(e)),e=new Vt(e));var h=t.split("|");if(h.length>1){for(var c=0;c<h.length;c++)this.addAttribute(h[c],e,i,s,n);return this;}var u=this.buffers.indexOf(e);return u===-1&&(this.buffers.push(e),u=this.buffers.length-1),this.attributes[t]=new Hn(u,i,s,n,o,a,l),this.instanced=this.instanced||l,this;}},{key:"getAttribute",value:function getAttribute(t){return this.attributes[t];}},{key:"getBuffer",value:function getBuffer(t){return this.buffers[this.getAttribute(t).buffer];}},{key:"addIndex",value:function addIndex(t){return t instanceof Vt||(t instanceof Array&&(t=new Uint16Array(t)),t=new Vt(t)),t.type=nr.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this;}},{key:"getIndex",value:function getIndex(){return this.indexBuffer;}},{key:"interleave",value:function interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;var t=[],e=[],i=new Vt();var s;for(s in this.attributes){var n=this.attributes[s],o=this.buffers[n.buffer];t.push(o.data),e.push(n.size*Wd[n.type]/4),n.buffer=0;}for(i.data=wb(t,e),s=0;s<this.buffers.length;s++)this.buffers[s]!==this.indexBuffer&&this.buffers[s].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this;}},{key:"getSize",value:function getSize(){for(var t in this.attributes){var e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size);}return 0;}},{key:"dispose",value:function dispose(){this.disposeRunner.emit(this,!1);}},{key:"destroy",value:function destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null;}},{key:"clone",value:function clone(){var t=new kr();for(var e=0;e<this.buffers.length;e++)t.buffers[e]=new Vt(this.buffers[e].data.slice(0));for(var _e6 in this.attributes){var i=this.attributes[_e6];t.attributes[_e6]=new Hn(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance);}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=nr.ELEMENT_ARRAY_BUFFER),t;}}],[{key:"merge",value:function merge(t){var e=new kr(),i=[],s=[],n=[];var o;for(var a=0;a<t.length;a++){o=t[a];for(var l=0;l<o.buffers.length;l++)s[l]=s[l]||0,s[l]+=o.buffers[l].data.length,n[l]=0;}for(var _a2=0;_a2<o.buffers.length;_a2++)i[_a2]=new Sb[Fd(o.buffers[_a2].data)](s[_a2]),e.buffers[_a2]=new Vt(i[_a2]);for(var _a3=0;_a3<t.length;_a3++){o=t[_a3];for(var _l3=0;_l3<o.buffers.length;_l3++)i[_l3].set(o.buffers[_l3].data,n[_l3]),n[_l3]+=o.buffers[_l3].data.length;}if(e.attributes=o.attributes,o.indexBuffer){e.indexBuffer=e.buffers[o.buffers.indexOf(o.indexBuffer)],e.indexBuffer.type=nr.ELEMENT_ARRAY_BUFFER;var _a4=0,_l4=0,h=0,u=0;for(var c=0;c<o.buffers.length;c++)if(o.buffers[c]!==o.indexBuffer){u=c;break;}for(var _c7 in o.attributes){var d=o.attributes[_c7];(d.buffer|0)===u&&(_l4+=d.size*Wd[d.type]/4);}for(var _c8=0;_c8<t.length;_c8++){var _d3=t[_c8].indexBuffer.data;for(var p=0;p<_d3.length;p++)e.indexBuffer.data[p+h]+=_a4;_a4+=t[_c8].buffers[u].data.length/_l4,h+=_d3.length;}}return e;}}]);return kr;}();var Yd=/*#__PURE__*/function(_kr){_inherits(Yd,_kr);var _super19=_createSuper(Yd);function Yd(){var _this26;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!1;_classCallCheck(this,Yd);_this26=_super19.call(this),_this26._buffer=new Vt(null,t,!1),_this26._indexBuffer=new Vt(null,t,!0),_this26.addAttribute("aVertexPosition",_this26._buffer,2,!1,tt.FLOAT).addAttribute("aTextureCoord",_this26._buffer,2,!1,tt.FLOAT).addAttribute("aColor",_this26._buffer,4,!0,tt.UNSIGNED_BYTE).addAttribute("aTextureId",_this26._buffer,1,!0,tt.FLOAT).addIndex(_this26._indexBuffer);return _this26;}return _createClass(Yd);}(kr);var Vn=Math.PI*2,Cb=180/Math.PI,Ib=Math.PI/180;var he=function(r){return r[r.POLY=0]="POLY",r[r.RECT=1]="RECT",r[r.CIRC=2]="CIRC",r[r.ELIP=3]="ELIP",r[r.RREC=4]="RREC",r;}(he||{});var bt=/*#__PURE__*/function(){function bt(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;_classCallCheck(this,bt);this.x=0,this.y=0,this.x=t,this.y=e;}_createClass(bt,[{key:"clone",value:function clone(){return new bt(this.x,this.y);}},{key:"copyFrom",value:function copyFrom(t){return this.set(t.x,t.y),this;}},{key:"copyTo",value:function copyTo(t){return t.set(this.x,this.y),t;}},{key:"equals",value:function equals(t){return t.x===this.x&&t.y===this.y;}},{key:"set",value:function set(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:t;return this.x=t,this.y=e,this;}}]);return bt;}();bt.prototype.toString=function(){return"[@pixi/math:Point x=".concat(this.x," y=").concat(this.y,"]");};var Xn=[new bt(),new bt(),new bt(),new bt()];var pt=/*#__PURE__*/function(){function pt(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;_classCallCheck(this,pt);this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(s),this.type=he.RECT;}_createClass(pt,[{key:"left",get:function get(){return this.x;}},{key:"right",get:function get(){return this.x+this.width;}},{key:"top",get:function get(){return this.y;}},{key:"bottom",get:function get(){return this.y+this.height;}},{key:"clone",value:function clone(){return new pt(this.x,this.y,this.width,this.height);}},{key:"copyFrom",value:function copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this;}},{key:"copyTo",value:function copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t;}},{key:"contains",value:function contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height;}},{key:"intersects",value:function intersects(t,e){if(!e){var T=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=T)return!1;var N=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>N;}var i=this.left,s=this.right,n=this.top,o=this.bottom;if(s<=i||o<=n)return!1;var a=Xn[0].set(t.left,t.top),l=Xn[1].set(t.left,t.bottom),h=Xn[2].set(t.right,t.top),u=Xn[3].set(t.right,t.bottom);if(h.x<=a.x||l.y<=a.y)return!1;var c=Math.sign(e.a*e.d-e.b*e.c);if(c===0||(e.apply(a,a),e.apply(l,l),e.apply(h,h),e.apply(u,u),Math.max(a.x,l.x,h.x,u.x)<=i||Math.min(a.x,l.x,h.x,u.x)>=s||Math.max(a.y,l.y,h.y,u.y)<=n||Math.min(a.y,l.y,h.y,u.y)>=o))return!1;var d=c*(l.y-a.y),p=c*(a.x-l.x),f=d*i+p*n,m=d*s+p*n,y=d*i+p*o,_=d*s+p*o;if(Math.max(f,m,y,_)<=d*a.x+p*a.y||Math.min(f,m,y,_)>=d*u.x+p*u.y)return!1;var v=c*(a.y-h.y),g=c*(h.x-a.x),x=v*i+g*n,b=v*s+g*n,S=v*i+g*o,w=v*s+g*o;return!(Math.max(x,b,S,w)<=v*a.x+g*a.y||Math.min(x,b,S,w)>=v*u.x+g*u.y);}},{key:"pad",value:function pad(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:t;return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this;}},{key:"fit",value:function fit(t){var e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),s=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=s,this.height=Math.max(n-s,0),this;}},{key:"ceil",value:function ceil(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:.001;var i=Math.ceil((this.x+this.width-e)*t)/t,s=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=s-this.y,this;}},{key:"enlarge",value:function enlarge(t){var e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),s=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=s,this.height=n-s,this;}}],[{key:"EMPTY",get:function get(){return new pt(0,0,0,0);}}]);return pt;}();pt.prototype.toString=function(){return"[@pixi/math:Rectangle x=".concat(this.x," y=").concat(this.y," width=").concat(this.width," height=").concat(this.height,"]");};var zn=/*#__PURE__*/function(){function zn(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;_classCallCheck(this,zn);this.x=t,this.y=e,this.radius=i,this.type=he.CIRC;}_createClass(zn,[{key:"clone",value:function clone(){return new zn(this.x,this.y,this.radius);}},{key:"contains",value:function contains(t,e){if(this.radius<=0)return!1;var i=this.radius*this.radius;var s=this.x-t,n=this.y-e;return s*=s,n*=n,s+n<=i;}},{key:"getBounds",value:function getBounds(){return new pt(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2);}}]);return zn;}();zn.prototype.toString=function(){return"[@pixi/math:Circle x=".concat(this.x," y=").concat(this.y," radius=").concat(this.radius,"]");};var Wn=/*#__PURE__*/function(){function Wn(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;_classCallCheck(this,Wn);this.x=t,this.y=e,this.width=i,this.height=s,this.type=he.ELIP;}_createClass(Wn,[{key:"clone",value:function clone(){return new Wn(this.x,this.y,this.width,this.height);}},{key:"contains",value:function contains(t,e){if(this.width<=0||this.height<=0)return!1;var i=(t-this.x)/this.width,s=(e-this.y)/this.height;return i*=i,s*=s,i+s<=1;}},{key:"getBounds",value:function getBounds(){return new pt(this.x-this.width,this.y-this.height,this.width,this.height);}}]);return Wn;}();Wn.prototype.toString=function(){return"[@pixi/math:Ellipse x=".concat(this.x," y=").concat(this.y," width=").concat(this.width," height=").concat(this.height,"]");};var di=/*#__PURE__*/function(){function di(){_classCallCheck(this,di);for(var _len8=arguments.length,t=new Array(_len8),_key8=0;_key8<_len8;_key8++){t[_key8]=arguments[_key8];}var e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){var i=[];for(var s=0,n=e.length;s<n;s++)i.push(e[s].x,e[s].y);e=i;}this.points=e,this.type=he.POLY,this.closeStroke=!0;}_createClass(di,[{key:"clone",value:function clone(){var t=this.points.slice(),e=new di(t);return e.closeStroke=this.closeStroke,e;}},{key:"contains",value:function contains(t,e){var i=!1;var s=this.points.length/2;for(var n=0,o=s-1;n<s;o=n++){var a=this.points[n*2],l=this.points[n*2+1],h=this.points[o*2],u=this.points[o*2+1];l>e!=u>e&&t<(h-a)*((e-l)/(u-l))+a&&(i=!i);}return i;}}]);return di;}();di.prototype.toString=function(){return"[@pixi/math:PolygoncloseStroke=".concat(this.closeStroke,"points=").concat(this.points.reduce(function(r,t){return"".concat(r,", ").concat(t);},""),"]");};var Yn=/*#__PURE__*/function(){function Yn(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var n=arguments.length>4&&arguments[4]!==undefined?arguments[4]:20;_classCallCheck(this,Yn);this.x=t,this.y=e,this.width=i,this.height=s,this.radius=n,this.type=he.RREC;}_createClass(Yn,[{key:"clone",value:function clone(){return new Yn(this.x,this.y,this.width,this.height,this.radius);}},{key:"contains",value:function contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){var i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+i&&e<=this.y+this.height-i||t>=this.x+i&&t<=this.x+this.width-i)return!0;var s=t-(this.x+i),n=e-(this.y+i);var o=i*i;if(s*s+n*n<=o||(s=t-(this.x+this.width-i),s*s+n*n<=o)||(n=e-(this.y+this.height-i),s*s+n*n<=o)||(s=t-(this.x+i),s*s+n*n<=o))return!0;}return!1;}}]);return Yn;}();Yn.prototype.toString=function(){return"[@pixi/math:RoundedRectangle x=".concat(this.x," y=").concat(this.y,"width=").concat(this.width," height=").concat(this.height," radius=").concat(this.radius,"]");};var Rt=/*#__PURE__*/function(){function Rt(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var n=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var o=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;_classCallCheck(this,Rt);this.array=null,this.a=t,this.b=e,this.c=i,this.d=s,this.tx=n,this.ty=o;}_createClass(Rt,[{key:"fromArray",value:function fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5];}},{key:"set",value:function set(t,e,i,s,n,o){return this.a=t,this.b=e,this.c=i,this.d=s,this.tx=n,this.ty=o,this;}},{key:"toArray",value:function toArray(t,e){this.array||(this.array=new Float32Array(9));var i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i;}},{key:"apply",value:function apply(t,e){e=e||new bt();var i=t.x,s=t.y;return e.x=this.a*i+this.c*s+this.tx,e.y=this.b*i+this.d*s+this.ty,e;}},{key:"applyInverse",value:function applyInverse(t,e){e=e||new bt();var i=1/(this.a*this.d+this.c*-this.b),s=t.x,n=t.y;return e.x=this.d*i*s+-this.c*i*n+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*n+-this.b*i*s+(-this.ty*this.a+this.tx*this.b)*i,e;}},{key:"translate",value:function translate(t,e){return this.tx+=t,this.ty+=e,this;}},{key:"scale",value:function scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this;}},{key:"rotate",value:function rotate(t){var e=Math.cos(t),i=Math.sin(t),s=this.a,n=this.c,o=this.tx;return this.a=s*e-this.b*i,this.b=s*i+this.b*e,this.c=n*e-this.d*i,this.d=n*i+this.d*e,this.tx=o*e-this.ty*i,this.ty=o*i+this.ty*e,this;}},{key:"append",value:function append(t){var e=this.a,i=this.b,s=this.c,n=this.d;return this.a=t.a*e+t.b*s,this.b=t.a*i+t.b*n,this.c=t.c*e+t.d*s,this.d=t.c*i+t.d*n,this.tx=t.tx*e+t.ty*s+this.tx,this.ty=t.tx*i+t.ty*n+this.ty,this;}},{key:"setTransform",value:function setTransform(t,e,i,s,n,o,a,l,h){return this.a=Math.cos(a+h)*n,this.b=Math.sin(a+h)*n,this.c=-Math.sin(a-l)*o,this.d=Math.cos(a-l)*o,this.tx=t-(i*this.a+s*this.c),this.ty=e-(i*this.b+s*this.d),this;}},{key:"prepend",value:function prepend(t){var e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){var i=this.a,s=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=s*t.a+this.d*t.c,this.d=s*t.b+this.d*t.d;}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this;}},{key:"decompose",value:function decompose(t){var e=this.a,i=this.b,s=this.c,n=this.d,o=t.pivot,a=-Math.atan2(-s,n),l=Math.atan2(i,e),h=Math.abs(a+l);return h<1e-5||Math.abs(Vn-h)<1e-5?(t.rotation=l,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=l),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(s*s+n*n),t.position.x=this.tx+(o.x*e+o.y*s),t.position.y=this.ty+(o.x*i+o.y*n),t;}},{key:"invert",value:function invert(){var t=this.a,e=this.b,i=this.c,s=this.d,n=this.tx,o=t*s-e*i;return this.a=s/o,this.b=-e/o,this.c=-i/o,this.d=t/o,this.tx=(i*this.ty-s*n)/o,this.ty=-(t*this.ty-e*n)/o,this;}},{key:"identity",value:function identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this;}},{key:"clone",value:function clone(){var t=new Rt();return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t;}},{key:"copyTo",value:function copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t;}},{key:"copyFrom",value:function copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this;}}],[{key:"IDENTITY",get:function get(){return new Rt();}},{key:"TEMP_MATRIX",get:function get(){return new Rt();}}]);return Rt;}();Rt.prototype.toString=function(){return"[@pixi/math:Matrix a=".concat(this.a," b=").concat(this.b," c=").concat(this.c," d=").concat(this.d," tx=").concat(this.tx," ty=").concat(this.ty,"]");};var fi=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],pi=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],mi=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],gi=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Al=[],jd=[],jn=Math.sign;function Rb(){for(var _r4=0;_r4<16;_r4++){var t=[];Al.push(t);for(var e=0;e<16;e++){var i=jn(fi[_r4]*fi[e]+mi[_r4]*pi[e]),s=jn(pi[_r4]*fi[e]+gi[_r4]*pi[e]),n=jn(fi[_r4]*mi[e]+mi[_r4]*gi[e]),o=jn(pi[_r4]*mi[e]+gi[_r4]*gi[e]);for(var a=0;a<16;a++)if(fi[a]===i&&pi[a]===s&&mi[a]===n&&gi[a]===o){t.push(a);break;}}}for(var _r5=0;_r5<16;_r5++){var _t15=new Rt();_t15.set(fi[_r5],pi[_r5],mi[_r5],gi[_r5],0,0),jd.push(_t15);}}Rb();var Dt={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function uX(r){return fi[r];},uY:function uY(r){return pi[r];},vX:function vX(r){return mi[r];},vY:function vY(r){return gi[r];},inv:function inv(r){return r&8?r&15:-r&7;},add:function add(r,t){return Al[r][t];},sub:function sub(r,t){return Al[r][Dt.inv(t)];},rotate180:function rotate180(r){return r^4;},isVertical:function isVertical(r){return(r&3)===2;},byDirection:function byDirection(r,t){return Math.abs(r)*2<=Math.abs(t)?t>=0?Dt.S:Dt.N:Math.abs(t)*2<=Math.abs(r)?r>0?Dt.E:Dt.W:t>0?r>0?Dt.SE:Dt.SW:r>0?Dt.NE:Dt.NW;},matrixAppendRotationInv:function matrixAppendRotationInv(r,t){var e=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var s=jd[Dt.inv(t)];s.tx=e,s.ty=i,r.append(s);}};var Sr=/*#__PURE__*/function(){function Sr(t,e){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;_classCallCheck(this,Sr);this._x=i,this._y=s,this.cb=t,this.scope=e;}_createClass(Sr,[{key:"clone",value:function clone(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.cb;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.scope;return new Sr(t,e,this._x,this._y);}},{key:"set",value:function set(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:t;return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this;}},{key:"copyFrom",value:function copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this;}},{key:"copyTo",value:function copyTo(t){return t.set(this._x,this._y),t;}},{key:"equals",value:function equals(t){return t.x===this._x&&t.y===this._y;}},{key:"x",get:function get(){return this._x;},set:function set(t){this._x!==t&&(this._x=t,this.cb.call(this.scope));}},{key:"y",get:function get(){return this._y;},set:function set(t){this._y!==t&&(this._y=t,this.cb.call(this.scope));}}]);return Sr;}();Sr.prototype.toString=function(){return"[@pixi/math:ObservablePoint x=".concat(this.x," y=").concat(this.y," scope=").concat(this.scope,"]");};var Sl=/*#__PURE__*/function(){function Sl(){_classCallCheck(this,Sl);this.worldTransform=new Rt(),this.localTransform=new Rt(),this.position=new Sr(this.onChange,this,0,0),this.scale=new Sr(this.onChange,this,1,1),this.pivot=new Sr(this.onChange,this,0,0),this.skew=new Sr(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0;}_createClass(Sl,[{key:"onChange",value:function onChange(){this._localID++;}},{key:"updateSkew",value:function updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++;}},{key:"updateLocalTransform",value:function updateLocalTransform(){var r=this.localTransform;this._localID!==this._currentLocalID&&(r.a=this._cx*this.scale.x,r.b=this._sx*this.scale.x,r.c=this._cy*this.scale.y,r.d=this._sy*this.scale.y,r.tx=this.position.x-(this.pivot.x*r.a+this.pivot.y*r.c),r.ty=this.position.y-(this.pivot.x*r.b+this.pivot.y*r.d),this._currentLocalID=this._localID,this._parentID=-1);}},{key:"updateTransform",value:function updateTransform(r){var t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==r._worldID){var e=r.worldTransform,i=this.worldTransform;i.a=t.a*e.a+t.b*e.c,i.b=t.a*e.b+t.b*e.d,i.c=t.c*e.a+t.d*e.c,i.d=t.c*e.b+t.d*e.d,i.tx=t.tx*e.a+t.ty*e.c+e.tx,i.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=r._worldID,this._worldID++;}}},{key:"setFromMatrix",value:function setFromMatrix(r){r.decompose(this),this._localID++;}},{key:"rotation",get:function get(){return this._rotation;},set:function set(r){this._rotation!==r&&(this._rotation=r,this.updateSkew());}}]);return Sl;}();Sl.IDENTITY=new Sl();var Cl=Sl;Cl.prototype.toString=function(){return"[@pixi/math:Transform position=(".concat(this.position.x,", ").concat(this.position.y,") rotation=").concat(this.rotation," scale=(").concat(this.scale.x,", ").concat(this.scale.y,") skew=(").concat(this.skew.x,", ").concat(this.skew.y,") ]");};var Mb="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}",Pb="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n";function qd(r,t,e){var i=r.createShader(t);return r.shaderSource(i,e),r.compileShader(i),i;}function Il(r){var t=new Array(r);for(var e=0;e<t.length;e++)t[e]=!1;return t;}function Kd(r,t){switch(r){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return Il(2*t);case"bvec3":return Il(3*t);case"bvec4":return Il(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);}return null;}var Zi=[{test:function test(r){return r.type==="float"&&r.size===1&&!r.isArray;},code:function code(r){return"\n            if(uv[\"".concat(r,"\"] !== ud[\"").concat(r,"\"].value)\n            {\n                ud[\"").concat(r,"\"].value = uv[\"").concat(r,"\"]\n                gl.uniform1f(ud[\"").concat(r,"\"].location, uv[\"").concat(r,"\"])\n            }\n            ");}},{test:function test(r,t){return(r.type==="sampler2D"||r.type==="samplerCube"||r.type==="sampler2DArray")&&r.size===1&&!r.isArray&&(t==null||t.castToBaseTexture!==void 0);},code:function code(r){return"t = syncData.textureCount++;\n\n            renderer.texture.bind(uv[\"".concat(r,"\"], t);\n\n            if(ud[\"").concat(r,"\"].value !== t)\n            {\n                ud[\"").concat(r,"\"].value = t;\n                gl.uniform1i(ud[\"").concat(r,"\"].location, t);\n; // eslint-disable-line max-len\n            }");}},{test:function test(r,t){return r.type==="mat3"&&r.size===1&&!r.isArray&&t.a!==void 0;},code:function code(r){return"\n            gl.uniformMatrix3fv(ud[\"".concat(r,"\"].location, false, uv[\"").concat(r,"\"].toArray(true));\n            ");},codeUbo:function codeUbo(r){return"\n                var ".concat(r,"_matrix = uv.").concat(r,".toArray(true);\n\n                data[offset] = ").concat(r,"_matrix[0];\n                data[offset+1] = ").concat(r,"_matrix[1];\n                data[offset+2] = ").concat(r,"_matrix[2];\n        \n                data[offset + 4] = ").concat(r,"_matrix[3];\n                data[offset + 5] = ").concat(r,"_matrix[4];\n                data[offset + 6] = ").concat(r,"_matrix[5];\n        \n                data[offset + 8] = ").concat(r,"_matrix[6];\n                data[offset + 9] = ").concat(r,"_matrix[7];\n                data[offset + 10] = ").concat(r,"_matrix[8];\n            ");}},{test:function test(r,t){return r.type==="vec2"&&r.size===1&&!r.isArray&&t.x!==void 0;},code:function code(r){return"\n                cv = ud[\"".concat(r,"\"].value;\n                v = uv[\"").concat(r,"\"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud[\"").concat(r,"\"].location, v.x, v.y);\n                }");},codeUbo:function codeUbo(r){return"\n                v = uv.".concat(r,";\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            ");}},{test:function test(r){return r.type==="vec2"&&r.size===1&&!r.isArray;},code:function code(r){return"\n                cv = ud[\"".concat(r,"\"].value;\n                v = uv[\"").concat(r,"\"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud[\"").concat(r,"\"].location, v[0], v[1]);\n                }\n            ");}},{test:function test(r,t){return r.type==="vec4"&&r.size===1&&!r.isArray&&t.width!==void 0;},code:function code(r){return"\n                cv = ud[\"".concat(r,"\"].value;\n                v = uv[\"").concat(r,"\"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud[\"").concat(r,"\"].location, v.x, v.y, v.width, v.height)\n                }");},codeUbo:function codeUbo(r){return"\n                    v = uv.".concat(r,";\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                ");}},{test:function test(r,t){return r.type==="vec4"&&r.size===1&&!r.isArray&&t.red!==void 0;},code:function code(r){return"\n                cv = ud[\"".concat(r,"\"].value;\n                v = uv[\"").concat(r,"\"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n                    cv[3] = v.alpha;\n                    gl.uniform4f(ud[\"").concat(r,"\"].location, v.red, v.green, v.blue, v.alpha)\n                }");},codeUbo:function codeUbo(r){return"\n                    v = uv.".concat(r,";\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                    data[offset+3] = v.alpha;\n                ");}},{test:function test(r,t){return r.type==="vec3"&&r.size===1&&!r.isArray&&t.red!==void 0;},code:function code(r){return"\n                cv = ud[\"".concat(r,"\"].value;\n                v = uv[\"").concat(r,"\"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n    \n                    gl.uniform3f(ud[\"").concat(r,"\"].location, v.red, v.green, v.blue)\n                }");},codeUbo:function codeUbo(r){return"\n                    v = uv.".concat(r,";\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                ");}},{test:function test(r){return r.type==="vec4"&&r.size===1&&!r.isArray;},code:function code(r){return"\n                cv = ud[\"".concat(r,"\"].value;\n                v = uv[\"").concat(r,"\"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud[\"").concat(r,"\"].location, v[0], v[1], v[2], v[3])\n                }");}}],Ob={"float":"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }",vec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }","int":"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",ivec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",ivec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",ivec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",uint:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }",uvec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }",uvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }",uvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }",bool:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }",bvec2:"\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",bvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",bvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",samplerCube:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",sampler2DArray:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }"},Nb={"float":"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)","int":"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function Db(r,t){var i;var e=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    "];for(var s in r.uniforms){var n=t[s];if(!n){((i=r.uniforms[s])==null?void 0:i.group)===!0&&(r.uniforms[s].ubo?e.push("\n                        renderer.shader.syncUniformBufferGroup(uv.".concat(s,", '").concat(s,"');\n                    ")):e.push("\n                        renderer.shader.syncUniformGroup(uv.".concat(s,", syncData);\n                    ")));continue;}var o=r.uniforms[s];var a=!1;for(var l=0;l<Zi.length;l++)if(Zi[l].test(n,o)){e.push(Zi[l].code(s,o)),a=!0;break;}if(!a){var _l5=(n.size===1&&!n.isArray?Ob:Nb)[n.type].replace("location","ud[\"".concat(s,"\"].location"));e.push("\n            cu = ud[\"".concat(s,"\"];\n            cv = cu.value;\n            v = uv[\"").concat(s,"\"];\n            ").concat(_l5,";"));}}return new Function("ud","uv","renderer","syncData",e.join("\n"));}var Zd={};var Qi=Zd;function Lb(){if(Qi===Zd||Qi!=null&&Qi.isContextLost()){var _r6=j.ADAPTER.createCanvas();var t;j.PREFER_ENV>=ni.WEBGL2&&(t=_r6.getContext("webgl2",{})),t||(t=_r6.getContext("webgl",{})||_r6.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),Qi=t;}return Qi;}var qn;function Bb(){if(!qn){qn=Le.MEDIUM;var _r7=Lb();if(_r7&&_r7.getShaderPrecisionFormat){var t=_r7.getShaderPrecisionFormat(_r7.FRAGMENT_SHADER,_r7.HIGH_FLOAT);t&&(qn=t.precision?Le.HIGH:Le.MEDIUM);}}return qn;}function Qd(r,t){var _console;var e=r.getShaderSource(t).split("\n").map(function(h,u){return"".concat(u,": ").concat(h);}),i=r.getShaderInfoLog(t),s=i.split("\n"),n={},o=s.map(function(h){return parseFloat(h.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"));}).filter(function(h){return h&&!n[h]?(n[h]=!0,!0):!1;}),a=[""];o.forEach(function(h){e[h-1]="%c".concat(e[h-1],"%c"),a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px");});var l=e.join("\n");a[0]=l,console.error(i),console.groupCollapsed("click to view full shader code"),(_console=console).warn.apply(_console,a),console.groupEnd();}function Fb(r,t,e,i){r.getProgramParameter(t,r.LINK_STATUS)||(r.getShaderParameter(e,r.COMPILE_STATUS)||Qd(r,e),r.getShaderParameter(i,r.COMPILE_STATUS)||Qd(r,i),console.error("PixiJS Error: Could not initialize shader."),r.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",r.getProgramInfoLog(t)));}var Ub={"float":1,vec2:2,vec3:3,vec4:4,"int":1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Jd(r){return Ub[r];}var Kn=null;var tf={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function ef(r,t){if(!Kn){var e=Object.keys(tf);Kn={};for(var i=0;i<e.length;++i){var s=e[i];Kn[r[s]]=tf[s];}}return Kn[t];}function rf(r,t,e){if(r.substring(0,9)!=="precision"){var i=t;return t===Le.HIGH&&e!==Le.HIGH&&(i=Le.MEDIUM),"precision ".concat(i," float;\n").concat(r);}else if(e!==Le.HIGH&&r.substring(0,15)==="precision highp")return r.replace("precision highp","precision mediump");return r;}var ks;function kb(){if(typeof ks=="boolean")return ks;try{ks=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0;}catch(_unused19){ks=!1;}return ks;}var Gb=0;var Zn={},Rl=/*#__PURE__*/function(){function us(t,e){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"pixi-shader";var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};_classCallCheck(this,us);this.extra={},this.id=Gb++,this.vertexSrc=t||us.defaultVertexSrc,this.fragmentSrc=e||us.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=s,this.vertexSrc.substring(0,8)!=="#version"&&(i=i.replace(/\s+/g,"-"),Zn[i]?(Zn[i]++,i+="-".concat(Zn[i])):Zn[i]=1,this.vertexSrc="#define SHADER_NAME ".concat(i,"\n").concat(this.vertexSrc),this.fragmentSrc="#define SHADER_NAME ".concat(i,"\n").concat(this.fragmentSrc),this.vertexSrc=rf(this.vertexSrc,us.defaultVertexPrecision,Le.HIGH),this.fragmentSrc=rf(this.fragmentSrc,us.defaultFragmentPrecision,Bb())),this.glPrograms={},this.syncUniforms=null;}_createClass(us,null,[{key:"defaultVertexSrc",get:function get(){return Pb;}},{key:"defaultFragmentSrc",get:function get(){return Mb;}},{key:"from",value:function from(t,e,i){var s=t+e;var n=$d[s];return n||($d[s]=n=new us(t,e,i)),n;}}]);return us;}();Rl.defaultVertexPrecision=Le.HIGH,Rl.defaultFragmentPrecision=br.apple.device?Le.HIGH:Le.MEDIUM;var Cr=Rl,$b=0;var We=/*#__PURE__*/function(){function We(t,e,i){_classCallCheck(this,We);this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=$b++,this["static"]=!!e,this.ubo=!!i,t instanceof Vt?(this.buffer=t,this.buffer.type=nr.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new Vt(new Float32Array(1)),this.buffer.type=nr.UNIFORM_BUFFER,this.autoManage=!0));}_createClass(We,[{key:"update",value:function update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update();}},{key:"add",value:function add(t,e,i){if(!this.ubo)this.uniforms[t]=new We(e,i);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");}}],[{key:"from",value:function from(t,e,i){return new We(t,e,i);}},{key:"uboFrom",value:function uboFrom(t,e){return new We(t,e!==null&&e!==void 0?e:!0,!0);}}]);return We;}();var dr=/*#__PURE__*/function(){function dr(t,e){_classCallCheck(this,dr);this.uniformBindCount=0,this.program=t,e?e instanceof We?this.uniformGroup=e:this.uniformGroup=new We(e):this.uniformGroup=new We({}),this.disposeRunner=new ze("disposeShader");}_createClass(dr,[{key:"checkUniformExists",value:function checkUniformExists(t,e){if(e.uniforms[t])return!0;for(var i in e.uniforms){var s=e.uniforms[i];if(s.group===!0&&this.checkUniformExists(t,s))return!0;}return!1;}},{key:"destroy",value:function destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy();}},{key:"uniforms",get:function get(){return this.uniformGroup.uniforms;}}],[{key:"from",value:function from(t,e,i){var s=Cr.from(t,e);return new dr(s,i);}}]);return dr;}();var Hb=/*#__PURE__*/function(){function Hb(t,e){_classCallCheck(this,Hb);if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".');}_createClass(Hb,[{key:"generateShader",value:function generateShader(t){if(!this.programCache[t]){var i=new Int32Array(t);for(var n=0;n<t;n++)i[n]=n;this.defaultGroupCache[t]=We.from({uSamplers:i},!0);var s=this.fragTemplate;s=s.replace(/%count%/gi,"".concat(t)),s=s.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Cr(this.vertexSrc,s);}var e={tint:new Float32Array([1,1,1,1]),translationMatrix:new Rt(),"default":this.defaultGroupCache[t]};return new dr(this.programCache[t],e);}},{key:"generateSampleSrc",value:function generateSampleSrc(t){var e="";e+="\n",e+="\n";for(var i=0;i<t;i++)i>0&&(e+="\nelse "),i<t-1&&(e+="if(vTextureId < ".concat(i,".5)")),e+="\n{",e+="\n\tcolor = texture2D(uSamplers[".concat(i,"], vTextureCoord);"),e+="\n}";return e+="\n",e+="\n",e;}}]);return Hb;}();var Ml=/*#__PURE__*/function(){function Ml(){_classCallCheck(this,Ml);this.elements=[],this.ids=[],this.count=0;}_createClass(Ml,[{key:"clear",value:function clear(){for(var t=0;t<this.count;t++)this.elements[t]=null;this.count=0;}}]);return Ml;}();function Vb(){return!br.apple.device;}function Xb(r){var t=!0;var e=j.ADAPTER.getNavigator();if(br.tablet||br.phone){if(br.apple.device){var i=e.userAgent.match(/OS (\d+)_(\d+)?/);i&&parseInt(i[1],10)<11&&(t=!1);}if(br.android.device){var _i25=e.userAgent.match(/Android\s([0-9.]*)/);_i25&&parseInt(_i25[1],10)<7&&(t=!1);}}return t?r:4;}var Qn=/*#__PURE__*/function(){function Qn(t){_classCallCheck(this,Qn);this.renderer=t;}_createClass(Qn,[{key:"flush",value:function flush(){}},{key:"destroy",value:function destroy(){this.renderer=null;}},{key:"start",value:function start(){}},{key:"stop",value:function stop(){this.flush();}},{key:"render",value:function render(t){}}]);return Qn;}();var zb="varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n",Wb="precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n";var Gs=/*#__PURE__*/function(_Qn){_inherits(tr,_Qn);var _super20=_createSuper(tr);function tr(t){var _this27;_classCallCheck(this,tr);_this27=_super20.call(this,t),_this27.setShaderGenerator(),_this27.geometryClass=Yd,_this27.vertexSize=6,_this27.state=cr.for2d(),_this27.size=tr.defaultBatchSize*4,_this27._vertexCount=0,_this27._indexCount=0,_this27._bufferedElements=[],_this27._bufferedTextures=[],_this27._bufferSize=0,_this27._shader=null,_this27._packedGeometries=[],_this27._packedGeometryPoolSize=2,_this27._flushId=0,_this27._aBuffers={},_this27._iBuffers={},_this27.maxTextures=1,_this27.renderer.on("prerender",_this27.onPrerender,_assertThisInitialized(_this27)),t.runners.contextChange.add(_assertThisInitialized(_this27)),_this27._dcIndex=0,_this27._aIndex=0,_this27._iIndex=0,_this27._attributeBuffer=null,_this27._indexBuffer=null,_this27._tempBoundTextures=[];return _this27;}_createClass(tr,[{key:"MAX_TEXTURES",get:function get(){return gt("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures;}},{key:"setShaderGenerator",value:function setShaderGenerator(){var _ref110=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref110$vertex=_ref110.vertex,t=_ref110$vertex===void 0?tr.defaultVertexSrc:_ref110$vertex,_ref110$fragment=_ref110.fragment,e=_ref110$fragment===void 0?tr.defaultFragmentTemplate:_ref110$fragment;this.shaderGenerator=new Hb(t,e);}},{key:"contextChange",value:function contextChange(){var t=this.renderer.gl;j.PREFER_ENV===ni.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),tr.defaultMaxTextures),this.maxTextures=xb(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(var e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass();this.initFlushBuffers();}},{key:"initFlushBuffers",value:function initFlushBuffers(){var t=tr._drawCallPool,e=tr._textureArrayPool,i=this.size/4,s=Math.floor(i/this.maxTextures)+1;for(;t.length<i;)t.push(new wl());for(;e.length<s;)e.push(new Ml());for(var n=0;n<this.maxTextures;n++)this._tempBoundTextures[n]=null;}},{key:"onPrerender",value:function onPrerender(){this._flushId=0;}},{key:"render",value:function render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t);}},{key:"buildTexturesAndDrawCalls",value:function buildTexturesAndDrawCalls(){var t=this._bufferedTextures,e=this.maxTextures,i=tr._textureArrayPool,s=this.renderer.batch,n=this._tempBoundTextures,o=this.renderer.textureGC.count;var a=++ft._globalBatch,l=0,h=i[0],u=0;s.copyBoundTextures(n,e);for(var c=0;c<this._bufferSize;++c){var d=t[c];t[c]=null,d._batchEnabled!==a&&(h.count>=e&&(s.boundArray(h,n,a,e),this.buildDrawCalls(h,u,c),u=c,h=i[++l],++a),d._batchEnabled=a,d.touched=o,h.elements[h.count++]=d);}h.count>0&&(s.boundArray(h,n,a,e),this.buildDrawCalls(h,u,this._bufferSize),++l,++a);for(var _c9=0;_c9<n.length;_c9++)n[_c9]=null;ft._globalBatch=a;}},{key:"buildDrawCalls",value:function buildDrawCalls(t,e,i){var s=this._bufferedElements,n=this._attributeBuffer,o=this._indexBuffer,a=this.vertexSize,l=tr._drawCallPool;var h=this._dcIndex,u=this._aIndex,c=this._iIndex,d=l[h];d.start=this._iIndex,d.texArray=t;for(var p=e;p<i;++p){var f=s[p],m=f._texture.baseTexture,y=Ld[m.alphaMode?1:0][f.blendMode];s[p]=null,e<p&&d.blend!==y&&(d.size=c-d.start,e=p,d=l[++h],d.texArray=t,d.start=c),this.packInterleavedGeometry(f,n,o,u,c),u+=f.vertexData.length/2*a,c+=f.indices.length,d.blend=y;}e<i&&(d.size=c-d.start,++h),this._dcIndex=h,this._aIndex=u,this._iIndex=c;}},{key:"bindAndClearTexArray",value:function bindAndClearTexArray(t){var e=this.renderer.texture;for(var i=0;i<t.count;i++)e.bind(t.elements[i],t.ids[i]),t.elements[i]=null;t.count=0;}},{key:"updateGeometry",value:function updateGeometry(){var t=this._packedGeometries,e=this._attributeBuffer,i=this._indexBuffer;tr.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass()),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++);}},{key:"drawBatches",value:function drawBatches(){var t=this._dcIndex,_this$renderer=this.renderer,e=_this$renderer.gl,i=_this$renderer.state,s=tr._drawCallPool;var n=null;for(var o=0;o<t;o++){var _s$o=s[o],a=_s$o.texArray,l=_s$o.type,h=_s$o.size,u=_s$o.start,c=_s$o.blend;n!==a&&(n=a,this.bindAndClearTexArray(a)),this.state.blendMode=c,i.set(this.state),e.drawElements(l,h,e.UNSIGNED_SHORT,u*2);}}},{key:"flush",value:function flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0);}},{key:"start",value:function start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),tr.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId]);}},{key:"stop",value:function stop(){this.flush();}},{key:"destroy",value:function destroy(){for(var t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),_get(_getPrototypeOf(tr.prototype),"destroy",this).call(this);}},{key:"getAttributeBuffer",value:function getAttributeBuffer(t){var e=Gn(Math.ceil(t/8)),i=kd(e),s=e*8;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);var n=this._aBuffers[s];return n||(this._aBuffers[s]=n=new ml(s*this.vertexSize*4)),n;}},{key:"getIndexBuffer",value:function getIndexBuffer(t){var e=Gn(Math.ceil(t/12)),i=kd(e),s=e*12;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);var n=this._iBuffers[i];return n||(this._iBuffers[i]=n=new Uint16Array(s)),n;}},{key:"packInterleavedGeometry",value:function packInterleavedGeometry(t,e,i,s,n){var o=e.uint32View,a=e.float32View,l=s/this.vertexSize,h=t.uvs,u=t.indices,c=t.vertexData,d=t._texture.baseTexture._batchLocation,p=Math.min(t.worldAlpha,1),f=wt.shared.setValue(t._tintRGB).toPremultiplied(p,t._texture.baseTexture.alphaMode>0);for(var m=0;m<c.length;m+=2)a[s++]=c[m],a[s++]=c[m+1],a[s++]=h[m],a[s++]=h[m+1],o[s++]=f,a[s++]=d;for(var _m4=0;_m4<u.length;_m4++)i[n++]=l+u[_m4];}}],[{key:"defaultMaxTextures",get:function get(){var _this$_defaultMaxText;return this._defaultMaxTextures=(_this$_defaultMaxText=this._defaultMaxTextures)!==null&&_this$_defaultMaxText!==void 0?_this$_defaultMaxText:Xb(32),this._defaultMaxTextures;},set:function set(t){this._defaultMaxTextures=t;}},{key:"canUploadSameBuffer",get:function get(){var _this$_canUploadSameB;return this._canUploadSameBuffer=(_this$_canUploadSameB=this._canUploadSameBuffer)!==null&&_this$_canUploadSameB!==void 0?_this$_canUploadSameB:Vb(),this._canUploadSameBuffer;},set:function set(t){this._canUploadSameBuffer=t;}},{key:"defaultVertexSrc",get:function get(){return Wb;}},{key:"defaultFragmentTemplate",get:function get(){return zb;}}]);return tr;}(Qn);Gs.defaultBatchSize=4096,Gs.extension={name:"batch",type:W.RendererPlugin},Gs._drawCallPool=[],Gs._textureArrayPool=[];var yi=Gs;K.add(yi);var Yb="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n",jb="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";var Pl=/*#__PURE__*/function(_dr){_inherits(qs,_dr);var _super21=_createSuper(qs);function qs(t,e,i){var _this28;_classCallCheck(this,qs);var s=Cr.from(t||qs.defaultVertexSrc,e||qs.defaultFragmentSrc);_this28=_super21.call(this,s,i),_this28.padding=0,_this28.resolution=qs.defaultResolution,_this28.multisample=qs.defaultMultisample,_this28.enabled=!0,_this28.autoFit=!0,_this28.state=new cr();return _this28;}_createClass(qs,[{key:"apply",value:function apply(t,e,i,s,n){t.applyFilter(this,e,i,s);}},{key:"blendMode",get:function get(){return this.state.blendMode;},set:function set(t){this.state.blendMode=t;}},{key:"resolution",get:function get(){return this._resolution;},set:function set(t){this._resolution=t;}}],[{key:"defaultVertexSrc",get:function get(){return jb;}},{key:"defaultFragmentSrc",get:function get(){return Yb;}}]);return qs;}(dr);Pl.defaultResolution=1,Pl.defaultMultisample=Yt.NONE;var ve=Pl;var Jn=/*#__PURE__*/function(){function Jn(){_classCallCheck(this,Jn);this.clearBeforeRender=!0,this._backgroundColor=new wt(0),this.alpha=1;}_createClass(Jn,[{key:"init",value:function init(t){this.clearBeforeRender=t.clearBeforeRender;var e=t.backgroundColor,i=t.background,s=t.backgroundAlpha,n=i!==null&&i!==void 0?i:e;n!==void 0&&(this.color=n),this.alpha=s;}},{key:"color",get:function get(){return this._backgroundColor.value;},set:function set(t){this._backgroundColor.setValue(t);}},{key:"alpha",get:function get(){return this._backgroundColor.alpha;},set:function set(t){this._backgroundColor.setAlpha(t);}},{key:"backgroundColor",get:function get(){return this._backgroundColor;}},{key:"destroy",value:function destroy(){}}]);return Jn;}();Jn.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},Jn.extension={type:[W.RendererSystem,W.CanvasRendererSystem],name:"background"},K.add(Jn);var sf=/*#__PURE__*/function(){function sf(t){_classCallCheck(this,sf);this.renderer=t,this.emptyRenderer=new Qn(t),this.currentRenderer=this.emptyRenderer;}_createClass(sf,[{key:"setObjectRenderer",value:function setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start());}},{key:"flush",value:function flush(){this.setObjectRenderer(this.emptyRenderer);}},{key:"reset",value:function reset(){this.setObjectRenderer(this.emptyRenderer);}},{key:"copyBoundTextures",value:function copyBoundTextures(t,e){var i=this.renderer.texture.boundTextures;for(var s=e-1;s>=0;--s)t[s]=i[s]||null,t[s]&&(t[s]._batchLocation=s);}},{key:"boundArray",value:function boundArray(t,e,i,s){var n=t.elements,o=t.ids,a=t.count;var l=0;for(var h=0;h<a;h++){var u=n[h],c=u._batchLocation;if(c>=0&&c<s&&e[c]===u){o[h]=c;continue;}for(;l<s;){var d=e[l];if(d&&d._batchEnabled===i&&d._batchLocation===l){l++;continue;}o[h]=l,u._batchLocation=l,e[l]=u;break;}}}},{key:"destroy",value:function destroy(){this.renderer=null;}}]);return sf;}();sf.extension={type:W.RendererSystem,name:"batch"},K.add(sf);var nf=0;var to=/*#__PURE__*/function(){function to(t){_classCallCheck(this,to);this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this);}_createClass(to,[{key:"isLost",get:function get(){return!this.gl||this.gl.isContextLost();}},{key:"contextChange",value:function contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=nf++;}},{key:"init",value:function init(t){if(t.context)this.initFromContext(t.context);else{var e=this.renderer.background.alpha<1,i=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:i,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference});}}},{key:"initFromContext",value:function initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=nf++,this.renderer.runners.contextChange.emit(t);var e=this.renderer.view;e.addEventListener!==void 0&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1));}},{key:"initFromOptions",value:function initFromOptions(t){var e=this.createContext(this.renderer.view,t);this.initFromContext(e);}},{key:"createContext",value:function createContext(t,e){var i;if(j.PREFER_ENV>=ni.WEBGL2&&(i=t.getContext("webgl2",e)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!i)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl;}},{key:"getExtensions",value:function getExtensions(){var t=this.gl,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc"),bptc:t.getExtension("EXT_texture_compression_bptc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")});}},{key:"handleContextLost",value:function handleContextLost(t){var _this29=this;t.preventDefault(),setTimeout(function(){_this29.gl.isContextLost()&&_this29.extensions.loseContext&&_this29.extensions.loseContext.restoreContext();},0);}},{key:"handleContextRestored",value:function handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl);}},{key:"destroy",value:function destroy(){var t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext();}},{key:"postrender",value:function postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush();}},{key:"validateContext",value:function validateContext(t){var e=t.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");var s=i||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=s,s||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly");}}]);return to;}();to.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},to.extension={type:W.RendererSystem,name:"context"},K.add(to);var Ol=/*#__PURE__*/function(){function Ol(t,e){_classCallCheck(this,Ol);if(this.width=Math.round(t),this.height=Math.round(e),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new ze("disposeFramebuffer"),this.multisample=Yt.NONE;}_createClass(Ol,[{key:"colorTexture",get:function get(){return this.colorTextures[0];}},{key:"addColorTexture",value:function addColorTexture(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var e=arguments.length>1?arguments[1]:undefined;return this.colorTextures[t]=e||new ft(null,{scaleMode:vr.NEAREST,resolution:1,mipmap:ir.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this;}},{key:"addDepthTexture",value:function addDepthTexture(t){return this.depthTexture=t||new ft(null,{scaleMode:vr.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:ir.OFF,format:H.DEPTH_COMPONENT,type:tt.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this;}},{key:"enableDepth",value:function enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this;}},{key:"enableStencil",value:function enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this;}},{key:"resize",value:function resize(t,e){if(t=Math.round(t),e=Math.round(e),!t||!e)throw new Error("Framebuffer width and height must not be zero");if(!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(var i=0;i<this.colorTextures.length;i++){var s=this.colorTextures[i],n=s.resolution;s.setSize(t/n,e/n);}if(this.depthTexture){var _i26=this.depthTexture.resolution;this.depthTexture.setSize(t/_i26,e/_i26);}}}},{key:"dispose",value:function dispose(){this.disposeRunner.emit(this,!1);}},{key:"destroyDepthTexture",value:function destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat);}}]);return Ol;}();var of=/*#__PURE__*/function(_ft){_inherits(of,_ft);var _super22=_createSuper(of);function of(){var _t$width,_t$height,_t$multisample;var _this30;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,of);if(typeof t=="number"){var e=arguments[0],i=arguments[1],s=arguments[2],n=arguments[3];t={width:e,height:i,scaleMode:s,resolution:n};}t.width=(_t$width=t.width)!==null&&_t$width!==void 0?_t$width:100,t.height=(_t$height=t.height)!==null&&_t$height!==void 0?_t$height:100,(_t$multisample=t.multisample)!==null&&_t$multisample!==void 0?_t$multisample:t.multisample=Yt.NONE,_this30=_super22.call(this,null,t),_this30.mipmap=ir.OFF,_this30.valid=!0,_this30._clear=new wt([0,0,0,0]),_this30.framebuffer=new Ol(_this30.realWidth,_this30.realHeight).addColorTexture(0,_assertThisInitialized(_this30)),_this30.framebuffer.multisample=t.multisample,_this30.maskStack=[],_this30.filterStack=[{}];return _this30;}_createClass(of,[{key:"clearColor",get:function get(){return this._clear.value;},set:function set(t){this._clear.setValue(t);}},{key:"clear",get:function get(){return this._clear;}},{key:"multisample",get:function get(){return this.framebuffer.multisample;},set:function set(t){this.framebuffer.multisample=t;}},{key:"resize",value:function resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height);}},{key:"dispose",value:function dispose(){this.framebuffer.dispose(),_get(_getPrototypeOf(of.prototype),"dispose",this).call(this);}},{key:"destroy",value:function destroy(){_get(_getPrototypeOf(of.prototype),"destroy",this).call(this),this.framebuffer.destroyDepthTexture(),this.framebuffer=null;}}]);return of;}(ft);var Ir=/*#__PURE__*/function(_Us2){_inherits(Ir,_Us2);var _super23=_createSuper(Ir);function Ir(t){var _this31;_classCallCheck(this,Ir);var e=t,i=e.naturalWidth||e.videoWidth||e.displayWidth||e.width,s=e.naturalHeight||e.videoHeight||e.displayHeight||e.height;_this31=_super23.call(this,i,s),_this31.source=t,_this31.noSubImage=!1;return _this31;}_createClass(Ir,[{key:"upload",value:function upload(t,e,i,s){var n=t.gl,o=e.realWidth,a=e.realHeight;if(s=s||this.source,(typeof HTMLImageElement==="undefined"?"undefined":_typeof(HTMLImageElement))<"u"&&s instanceof HTMLImageElement){if(!s.complete||s.naturalWidth===0)return!1;}else if((typeof HTMLVideoElement==="undefined"?"undefined":_typeof(HTMLVideoElement))<"u"&&s instanceof HTMLVideoElement&&s.readyState<=1)return!1;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Ce.UNPACK),!this.noSubImage&&e.target===n.TEXTURE_2D&&i.width===o&&i.height===a?n.texSubImage2D(n.TEXTURE_2D,0,0,0,e.format,i.type,s):(i.width=o,i.height=a,n.texImage2D(e.target,0,i.internalFormat,e.format,i.type,s)),!0;}},{key:"update",value:function update(){if(this.destroyed)return;var t=this.source,e=t.naturalWidth||t.videoWidth||t.width,i=t.naturalHeight||t.videoHeight||t.height;this.resize(e,i),_get(_getPrototypeOf(Ir.prototype),"update",this).call(this);}},{key:"dispose",value:function dispose(){this.source=null;}}],[{key:"crossOrigin",value:function crossOrigin(t,e,i){i===void 0&&!e.startsWith("data:")?t.crossOrigin=yb(e):i!==!1&&(t.crossOrigin=typeof i=="string"?i:"anonymous");}}]);return Ir;}(Us);var af=/*#__PURE__*/function(_Ir){_inherits(af,_Ir);var _super24=_createSuper(af);function af(t,e){var _e$createBitmap;var _this32;_classCallCheck(this,af);if(e=e||{},typeof t=="string"){var i=new Image();Ir.crossOrigin(i,t,e.crossorigin),i.src=t,t=i;}_this32=_super24.call(this,t),!t.complete&&_this32._width&&_this32._height&&(_this32._width=0,_this32._height=0),_this32.url=t.src,_this32._process=null,_this32.preserveBitmap=!1,_this32.createBitmap=((_e$createBitmap=e.createBitmap)!==null&&_e$createBitmap!==void 0?_e$createBitmap:j.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,_this32.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,_this32.bitmap=null,_this32._load=null,e.autoLoad!==!1&&_this32.load();return _this32;}_createClass(af,[{key:"load",value:function load(t){var _this33=this;return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise(function(e,i){var s=_this33.source;_this33.url=s.src;var n=function n(){_this33.destroyed||(s.onload=null,s.onerror=null,_this33.update(),_this33._load=null,_this33.createBitmap?e(_this33.process()):e(_this33));};s.complete&&s.src?n():(s.onload=n,s.onerror=function(o){i(o),_this33.onError.emit(o);});}),this._load);}},{key:"process",value:function process(){var _this34=this;var t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);var e=globalThis.createImageBitmap,i=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:i?"cors":"no-cors"}).then(function(s){return s.blob();}).then(function(s){return e(s,0,0,t.width,t.height,{premultiplyAlpha:_this34.alphaMode===null||_this34.alphaMode===Ce.UNPACK?"premultiply":"none"});}).then(function(s){return _this34.destroyed?Promise.reject():(_this34.bitmap=s,_this34.update(),_this34._process=null,Promise.resolve(_this34));}),this._process;}},{key:"upload",value:function upload(t,e,i){if(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),!this.createBitmap)return _get(_getPrototypeOf(af.prototype),"upload",this).call(this,t,e,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(_get(_getPrototypeOf(af.prototype),"upload",this).call(this,t,e,i,this.bitmap),!this.preserveBitmap){var s=!0;var n=e._glTextures;for(var o in n){var a=n[o];if(a!==i&&a.dirtyId!==e.dirtyId){s=!1;break;}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null);}return!0;}},{key:"dispose",value:function dispose(){this.source.onload=null,this.source.onerror=null,_get(_getPrototypeOf(af.prototype),"dispose",this).call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null;}}],[{key:"test",value:function test(t){return(typeof HTMLImageElement==="undefined"?"undefined":_typeof(HTMLImageElement))<"u"&&(typeof t=="string"||t instanceof HTMLImageElement);}}]);return af;}(Ir);var Nl=/*#__PURE__*/function(){function Nl(){_classCallCheck(this,Nl);this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8);}_createClass(Nl,[{key:"set",value:function set(t,e,i){var s=e.width,n=e.height;if(i){var o=t.width/2/s,a=t.height/2/n,l=t.x/s+o,h=t.y/n+a;i=Dt.add(i,Dt.NW),this.x0=l+o*Dt.uX(i),this.y0=h+a*Dt.uY(i),i=Dt.add(i,2),this.x1=l+o*Dt.uX(i),this.y1=h+a*Dt.uY(i),i=Dt.add(i,2),this.x2=l+o*Dt.uX(i),this.y2=h+a*Dt.uY(i),i=Dt.add(i,2),this.x3=l+o*Dt.uX(i),this.y3=h+a*Dt.uY(i);}else this.x0=t.x/s,this.y0=t.y/n,this.x1=(t.x+t.width)/s,this.y1=t.y/n,this.x2=(t.x+t.width)/s,this.y2=(t.y+t.height)/n,this.x3=t.x/s,this.y3=(t.y+t.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3;}}]);return Nl;}();Nl.prototype.toString=function(){return"[@pixi/core:TextureUvs x0=".concat(this.x0," y0=").concat(this.y0," x1=").concat(this.x1," y1=").concat(this.y1," x2=").concat(this.x2," y2=").concat(this.y2," x3=").concat(this.x3," y3=").concat(this.y3,"]");};var lf=new Nl();function eo(r){r.destroy=function(){},r.on=function(){},r.once=function(){},r.emit=function(){};}var Z=/*#__PURE__*/function(_Ts2){_inherits(Z,_Ts2);var _super25=_createSuper(Z);function Z(t,e,i,s,n,o,a){var _this35;_classCallCheck(this,Z);if(_this35=_super25.call(this),_this35.noFrame=!1,e||(_this35.noFrame=!0,e=new pt(0,0,1,1)),t instanceof Z&&(t=t.baseTexture),_this35.baseTexture=t,_this35._frame=e,_this35.trim=s,_this35.valid=!1,_this35.destroyed=!1,_this35._uvs=lf,_this35.uvMatrix=null,_this35.orig=i||e,_this35._rotate=Number(n||0),n===!0)_this35._rotate=2;else if(_this35._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");_this35.defaultAnchor=o?new bt(o.x,o.y):new bt(0,0),_this35.defaultBorders=a,_this35._updateID=0,_this35.textureCacheIds=[],t.valid?_this35.noFrame?t.valid&&_this35.onBaseTextureUpdated(t):_this35.frame=e:t.once("loaded",_this35.onBaseTextureUpdated,_assertThisInitialized(_this35)),_this35.noFrame&&t.on("update",_this35.onBaseTextureUpdated,_assertThisInitialized(_this35));return _possibleConstructorReturn(_this35);}_createClass(Z,[{key:"update",value:function update(){this.baseTexture.resource&&this.baseTexture.resource.update();}},{key:"onBaseTextureUpdated",value:function onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs();}else this.frame=this._frame;this.emit("update",this);}},{key:"destroy",value:function destroy(t){if(this.baseTexture){if(t){var e=this.baseTexture.resource;e!=null&&e.url&&ur[e.url]&&Z.removeFromCache(e.url),this.baseTexture.destroy();}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null;}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Z.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners();}},{key:"clone",value:function clone(){var s;var t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),i=new Z(this.baseTexture,!this.noFrame&&t,e,(s=this.trim)==null?void 0:s.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(i._frame=t),i;}},{key:"updateUvs",value:function updateUvs(){this._uvs===lf&&(this._uvs=new Nl()),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++;}},{key:"resolution",get:function get(){return this.baseTexture.resolution;}},{key:"frame",get:function get(){return this._frame;},set:function set(t){this._frame=t,this.noFrame=!1;var e=t.x,i=t.y,s=t.width,n=t.height,o=e+s>this.baseTexture.width,a=i+n>this.baseTexture.height;if(o||a){var l=o&&a?"and":"or",h="X: ".concat(e," + ").concat(s," = ").concat(e+s," > ").concat(this.baseTexture.width),u="Y: ".concat(i," + ").concat(n," = ").concat(i+n," > ").concat(this.baseTexture.height);throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: ".concat(h," ").concat(l," ").concat(u));}this.valid=s&&n&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs();}},{key:"rotate",get:function get(){return this._rotate;},set:function set(t){this._rotate=t,this.valid&&this.updateUvs();}},{key:"width",get:function get(){return this.orig.width;}},{key:"height",get:function get(){return this.orig.height;}},{key:"castToBaseTexture",value:function castToBaseTexture(){return this.baseTexture;}}],[{key:"from",value:function from(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:j.STRICT_TEXTURE_CACHE;var s=typeof t=="string";var n=null;if(s)n=t;else if(t instanceof ft){if(!t.cacheId){var a=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t.cacheId="".concat(a,"-").concat(ci()),ft.addToCache(t,t.cacheId);}n=t.cacheId;}else{if(!t._pixiId){var _a5=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId="".concat(_a5,"_").concat(ci());}n=t._pixiId;}var o=ur[n];if(s&&i&&!o)throw new Error("The cacheId \"".concat(n,"\" does not exist in TextureCache."));return!o&&!(t instanceof ft)?(e.resolution||(e.resolution=Ar(t)),o=new Z(new ft(t,e)),o.baseTexture.cacheId=n,ft.addToCache(o.baseTexture,n),Z.addToCache(o,n)):!o&&t instanceof ft&&(o=new Z(t),Z.addToCache(o,n)),o;}},{key:"fromURL",value:function fromURL(t,e){var i=Object.assign({autoLoad:!1},e==null?void 0:e.resourceOptions),s=Z.from(t,Object.assign({resourceOptions:i},e),!1),n=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):n.load().then(function(){return Promise.resolve(s);});}},{key:"fromBuffer",value:function fromBuffer(t,e,i,s){return new Z(ft.fromBuffer(t,e,i,s));}},{key:"fromLoader",value:function fromLoader(t,e,i,s){var n=new ft(t,Object.assign({scaleMode:ft.defaultOptions.scaleMode,resolution:Ar(e)},s)),o=n.resource;o instanceof af&&(o.url=e);var a=new Z(n);return i||(i=e),ft.addToCache(a.baseTexture,i),Z.addToCache(a,i),i!==e&&(ft.addToCache(a.baseTexture,e),Z.addToCache(a,e)),a.baseTexture.valid?Promise.resolve(a):new Promise(function(l){a.baseTexture.once("loaded",function(){return l(a);});});}},{key:"addToCache",value:function addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),ur[e]&&ur[e]!==t&&console.warn("Texture added to the cache with an id [".concat(e,"] that already had an entry")),ur[e]=t);}},{key:"removeFromCache",value:function removeFromCache(t){if(typeof t=="string"){var e=ur[t];if(e){var i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete ur[t],e;}}else if(t!=null&&t.textureCacheIds){for(var _e7=0;_e7<t.textureCacheIds.length;++_e7)ur[t.textureCacheIds[_e7]]===t&&delete ur[t.textureCacheIds[_e7]];return t.textureCacheIds.length=0,t;}return null;}},{key:"EMPTY",get:function get(){return Z._EMPTY||(Z._EMPTY=new Z(new ft()),eo(Z._EMPTY),eo(Z._EMPTY.baseTexture)),Z._EMPTY;}},{key:"WHITE",get:function get(){if(!Z._WHITE){var t=j.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),Z._WHITE=new Z(ft.from(t)),eo(Z._WHITE),eo(Z._WHITE.baseTexture);}return Z._WHITE;}}]);return Z;}(Ts);var _i=/*#__PURE__*/function(_Z){_inherits(_i,_Z);var _super26=_createSuper(_i);function _i(t,e){var _this36;_classCallCheck(this,_i);_this36=_super26.call(this,t,e),_this36.valid=!0,_this36.filterFrame=null,_this36.filterPoolKey=null,_this36.updateUvs();return _this36;}_createClass(_i,[{key:"framebuffer",get:function get(){return this.baseTexture.framebuffer;}},{key:"multisample",get:function get(){return this.framebuffer.multisample;},set:function set(t){this.framebuffer.multisample=t;}},{key:"resize",value:function resize(t,e){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:!0;var s=this.baseTexture.resolution,n=Math.round(t*s)/s,o=Math.round(e*s)/s;this.valid=n>0&&o>0,this._frame.width=this.orig.width=n,this._frame.height=this.orig.height=o,i&&this.baseTexture.resize(n,o),this.updateUvs();}},{key:"setResolution",value:function setResolution(t){var e=this.baseTexture;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1));}}],[{key:"create",value:function create(t){return new _i(new of(t));}}]);return _i;}(Z);var hf=/*#__PURE__*/function(){function hf(t){_classCallCheck(this,hf);this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0;}_createClass(hf,[{key:"createTexture",value:function createTexture(t,e){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:Yt.NONE;var s=new of(Object.assign({width:t,height:e,resolution:1,multisample:i},this.textureOptions));return new _i(s);}},{key:"getOptimalTexture",value:function getOptimalTexture(t,e){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:Yt.NONE;var n;t=Math.max(Math.ceil(t*i-1e-6),1),e=Math.max(Math.ceil(e*i-1e-6),1),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=Gn(t),e=Gn(e),n=((t&65535)<<16|e&65535)>>>0,s>1&&(n+=s*4294967296)):n=s>1?-s:-1,this.texturePool[n]||(this.texturePool[n]=[]);var o=this.texturePool[n].pop();return o||(o=this.createTexture(t,e,s)),o.filterPoolKey=n,o.setResolution(i),o;}},{key:"getFilterTexture",value:function getFilterTexture(t,e,i){var s=this.getOptimalTexture(t.width,t.height,e||t.resolution,i||Yt.NONE);return s.filterFrame=t.filterFrame,s;}},{key:"returnTexture",value:function returnTexture(t){var e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t);}},{key:"returnFilterTexture",value:function returnFilterTexture(t){this.returnTexture(t);}},{key:"clear",value:function clear(t){if(t=t!==!1,t)for(var e in this.texturePool){var i=this.texturePool[e];if(i)for(var s=0;s<i.length;s++)i[s].destroy(!0);}this.texturePool={};}},{key:"setScreenSize",value:function setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(var e in this.texturePool){if(!(Number(e)<0))continue;var i=this.texturePool[e];if(i)for(var s=0;s<i.length;s++)i[s].destroy(!0);this.texturePool[e]=[];}this._pixelsWidth=t.width,this._pixelsHeight=t.height;}}}]);return hf;}();hf.SCREEN_KEY=-1;var qb=/*#__PURE__*/function(_kr2){_inherits(qb,_kr2);var _super27=_createSuper(qb);function qb(){var _this37;_classCallCheck(this,qb);_this37=_super27.call(this),_this37.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2]);return _this37;}return _createClass(qb);}(kr);var uf=/*#__PURE__*/function(_kr3){_inherits(uf,_kr3);var _super28=_createSuper(uf);function uf(){var _this38;_classCallCheck(this,uf);_this38=_super28.call(this),_this38.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),_this38.uvs=new Float32Array([0,0,1,0,1,1,0,1]),_this38.vertexBuffer=new Vt(_this38.vertices),_this38.uvBuffer=new Vt(_this38.uvs),_this38.addAttribute("aVertexPosition",_this38.vertexBuffer).addAttribute("aTextureCoord",_this38.uvBuffer).addIndex([0,1,2,0,2,3]);return _this38;}_createClass(uf,[{key:"map",value:function map(t,e){var i=0,s=0;return this.uvs[0]=i,this.uvs[1]=s,this.uvs[2]=i+e.width/t.width,this.uvs[3]=s,this.uvs[4]=i+e.width/t.width,this.uvs[5]=s+e.height/t.height,this.uvs[6]=i,this.uvs[7]=s+e.height/t.height,i=e.x,s=e.y,this.vertices[0]=i,this.vertices[1]=s,this.vertices[2]=i+e.width,this.vertices[3]=s,this.vertices[4]=i+e.width,this.vertices[5]=s+e.height,this.vertices[6]=i,this.vertices[7]=s+e.height,this.invalidate(),this;}},{key:"invalidate",value:function invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this;}}]);return uf;}(kr);var Kb=/*#__PURE__*/function(){function Kb(){_classCallCheck(this,Kb);this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=Yt.NONE,this.sourceFrame=new pt(),this.destinationFrame=new pt(),this.bindingSourceFrame=new pt(),this.bindingDestinationFrame=new pt(),this.filters=[],this.transform=null;}_createClass(Kb,[{key:"clear",value:function clear(){this.target=null,this.filters=null,this.renderTexture=null;}}]);return Kb;}();var ro=[new bt(),new bt(),new bt(),new bt()],Dl=new Rt();var cf=/*#__PURE__*/function(){function cf(t){_classCallCheck(this,cf);this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new hf(),this.statePool=[],this.quad=new qb(),this.quadUv=new uf(),this.tempRect=new pt(),this.activeState={},this.globalUniforms=new We({outputFrame:new pt(),inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1;}_createClass(cf,[{key:"init",value:function init(){this.texturePool.setScreenSize(this.renderer.view);}},{key:"push",value:function push(t,e){var _e$0$multisample,_e$0$legacy;var i=this.renderer,s=this.defaultFilterStack,n=this.statePool.pop()||new Kb(),o=i.renderTexture;var a,l;if(o.current){var y=o.current;a=y.resolution,l=y.multisample;}else a=i.resolution,l=i.multisample;var h=e[0].resolution||a,u=(_e$0$multisample=e[0].multisample)!==null&&_e$0$multisample!==void 0?_e$0$multisample:l,c=e[0].padding,d=e[0].autoFit,p=(_e$0$legacy=e[0].legacy)!==null&&_e$0$legacy!==void 0?_e$0$legacy:!0;for(var _y2=1;_y2<e.length;_y2++){var _$multisample,_$legacy;var _=e[_y2];h=Math.min(h,_.resolution||a),u=Math.min(u,(_$multisample=_.multisample)!==null&&_$multisample!==void 0?_$multisample:l),c=this.useMaxPadding?Math.max(c,_.padding):c+_.padding,d=d&&_.autoFit,p=p||((_$legacy=_.legacy)!==null&&_$legacy!==void 0?_$legacy:!0);}s.length===1&&(this.defaultFilterStack[0].renderTexture=o.current),s.push(n),n.resolution=h,n.multisample=u,n.legacy=p,n.target=t,n.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),n.sourceFrame.pad(c);var f=this.tempRect.copyFrom(o.sourceFrame);i.projection.transform&&this.transformAABB(Dl.copyFrom(i.projection.transform).invert(),f),d?(n.sourceFrame.fit(f),(n.sourceFrame.width<=0||n.sourceFrame.height<=0)&&(n.sourceFrame.width=0,n.sourceFrame.height=0)):n.sourceFrame.intersects(f)||(n.sourceFrame.width=0,n.sourceFrame.height=0),this.roundFrame(n.sourceFrame,o.current?o.current.resolution:i.resolution,o.sourceFrame,o.destinationFrame,i.projection.transform),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,h,u),n.filters=e,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;var m=this.tempRect;m.x=0,m.y=0,m.width=n.sourceFrame.width,m.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,n.bindingSourceFrame.copyFrom(o.sourceFrame),n.bindingDestinationFrame.copyFrom(o.destinationFrame),n.transform=i.projection.transform,i.projection.transform=null,o.bind(n.renderTexture,n.sourceFrame,m),i.framebuffer.clear(0,0,0,0);}},{key:"pop",value:function pop(){var t=this.defaultFilterStack,e=t.pop(),i=e.filters;this.activeState=e;var s=this.globalUniforms.uniforms;s.outputFrame=e.sourceFrame,s.resolution=e.resolution;var n=s.inputSize,o=s.inputPixel,a=s.inputClamp;if(n[0]=e.destinationFrame.width,n[1]=e.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],o[0]=Math.round(n[0]*e.resolution),o[1]=Math.round(n[1]*e.resolution),o[2]=1/o[0],o[3]=1/o[1],a[0]=.5*o[2],a[1]=.5*o[3],a[2]=e.sourceFrame.width*n[2]-.5*o[2],a[3]=e.sourceFrame.height*n[3]-.5*o[3],e.legacy){var h=s.filterArea;h[0]=e.destinationFrame.width,h[1]=e.destinationFrame.height,h[2]=e.sourceFrame.x,h[3]=e.sourceFrame.y,s.filterClamp=s.inputClamp;}this.globalUniforms.update();var l=t[t.length-1];if(this.renderer.framebuffer.blit(),i.length===1)i[0].apply(this,e.renderTexture,l.renderTexture,sr.BLEND,e),this.returnFilterTexture(e.renderTexture);else{var _h7=e.renderTexture,u=this.getOptimalFilterTexture(_h7.width,_h7.height,e.resolution);u.filterFrame=_h7.filterFrame;var c=0;for(c=0;c<i.length-1;++c){c===1&&e.multisample>1&&(u=this.getOptimalFilterTexture(_h7.width,_h7.height,e.resolution),u.filterFrame=_h7.filterFrame),i[c].apply(this,_h7,u,sr.CLEAR,e);var d=_h7;_h7=u,u=d;}i[c].apply(this,_h7,l.renderTexture,sr.BLEND,e),c>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(_h7),this.returnFilterTexture(u);}e.clear(),this.statePool.push(e);}},{key:"bindAndClear",value:function bindAndClear(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:sr.CLEAR;var _this$renderer2=this.renderer,i=_this$renderer2.renderTexture,s=_this$renderer2.state;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t==null?void 0:t.filterFrame){var o=this.tempRect;o.x=0,o.y=0,o.width=t.filterFrame.width,o.height=t.filterFrame.height,i.bind(t,t.filterFrame,o);}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?i.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);var n=s.stateId&1||this.forceClear;(e===sr.CLEAR||e===sr.BLIT&&n)&&this.renderer.framebuffer.clear(0,0,0,0);}},{key:"applyFilter",value:function applyFilter(t,e,i,s){var n=this.renderer;n.state.set(t.state),this.bindAndClear(i,s),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(rr.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(rr.TRIANGLE_STRIP));}},{key:"calculateSpriteMatrix",value:function calculateSpriteMatrix(t,e){var _this$activeState=this.activeState,i=_this$activeState.sourceFrame,s=_this$activeState.destinationFrame,n=e._texture.orig,o=t.set(s.width,0,0,s.height,i.x,i.y),a=e.worldTransform.copyTo(Rt.TEMP_MATRIX);return a.invert(),o.prepend(a),o.scale(1/n.width,1/n.height),o.translate(e.anchor.x,e.anchor.y),o;}},{key:"destroy",value:function destroy(){this.renderer=null,this.texturePool.clear(!1);}},{key:"getOptimalFilterTexture",value:function getOptimalFilterTexture(t,e){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:Yt.NONE;return this.texturePool.getOptimalTexture(t,e,i,s);}},{key:"getFilterTexture",value:function getFilterTexture(t,e,i){if(typeof t=="number"){var n=t;t=e,e=n;}t=t||this.activeState.renderTexture;var s=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,i||Yt.NONE);return s.filterFrame=t.filterFrame,s;}},{key:"returnFilterTexture",value:function returnFilterTexture(t){this.texturePool.returnTexture(t);}},{key:"emptyPool",value:function emptyPool(){this.texturePool.clear(!0);}},{key:"resize",value:function resize(){this.texturePool.setScreenSize(this.renderer.view);}},{key:"transformAABB",value:function transformAABB(t,e){var i=ro[0],s=ro[1],n=ro[2],o=ro[3];i.set(e.left,e.top),s.set(e.left,e.bottom),n.set(e.right,e.top),o.set(e.right,e.bottom),t.apply(i,i),t.apply(s,s),t.apply(n,n),t.apply(o,o);var a=Math.min(i.x,s.x,n.x,o.x),l=Math.min(i.y,s.y,n.y,o.y),h=Math.max(i.x,s.x,n.x,o.x),u=Math.max(i.y,s.y,n.y,o.y);e.x=a,e.y=l,e.width=h-a,e.height=u-l;}},{key:"roundFrame",value:function roundFrame(t,e,i,s,n){if(!(t.width<=0||t.height<=0||i.width<=0||i.height<=0)){if(n){var _n7=n,o=_n7.a,a=_n7.b,l=_n7.c,h=_n7.d;if((Math.abs(a)>1e-4||Math.abs(l)>1e-4)&&(Math.abs(o)>1e-4||Math.abs(h)>1e-4))return;}n=n?Dl.copyFrom(n):Dl.identity(),n.translate(-i.x,-i.y).scale(s.width/i.width,s.height/i.height).translate(s.x,s.y),this.transformAABB(n,t),t.ceil(e),this.transformAABB(n.invert(),t);}}}]);return cf;}();cf.extension={type:W.RendererSystem,name:"filter"},K.add(cf);var Zb=/*#__PURE__*/_createClass(function Zb(t){_classCallCheck(this,Zb);this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=Yt.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0;});var Qb=new pt();var df=/*#__PURE__*/function(){function df(t){_classCallCheck(this,df);this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new Ol(10,10),this.msaaSamples=null;}_createClass(df,[{key:"contextChange",value:function contextChange(){this.disposeAll(!0);var t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new pt(),this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){var e=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;j.PREFER_ENV===ni.WEBGL_LEGACY&&(e=null,i=null),e?t.drawBuffers=function(s){return e.drawBuffersWEBGL(s);}:(this.hasMRT=!1,t.drawBuffers=function(){}),i||(this.writeDepthTexture=!1);}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES);}},{key:"bind",value:function bind(t,e){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var s=this.gl;if(t){var n=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,s.bindFramebuffer(s.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==i&&(t.dirtyId++,t.dirtyFormat++,n.mipLevel=i),n.dirtyId!==t.dirtyId&&(n.dirtyId=t.dirtyId,n.dirtyFormat!==t.dirtyFormat?(n.dirtyFormat=t.dirtyFormat,n.dirtySize=t.dirtySize,this.updateFramebuffer(t,i)):n.dirtySize!==t.dirtySize&&(n.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(var o=0;o<t.colorTextures.length;o++){var a=t.colorTextures[o];this.renderer.texture.unbind(a.parentTextureArray||a);}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){var _o12=e.width>>i,_a6=e.height>>i,l=_o12/e.width;this.setViewport(e.x*l,e.y*l,_o12,_a6);}else{var _o13=t.width>>i,_a7=t.height>>i;this.setViewport(0,0,_o13,_a7);}}else this.current&&(this.current=null,s.bindFramebuffer(s.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height);}},{key:"setViewport",value:function setViewport(t,e,i,s){var n=this.viewport;t=Math.round(t),e=Math.round(e),i=Math.round(i),s=Math.round(s),(n.width!==i||n.height!==s||n.x!==t||n.y!==e)&&(n.x=t,n.y=e,n.width=i,n.height=s,this.gl.viewport(t,e,i,s));}},{key:"size",get:function get(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height};}},{key:"clear",value:function clear(t,e,i,s){var n=arguments.length>4&&arguments[4]!==undefined?arguments[4]:xa.COLOR|xa.DEPTH;var o=this.gl;o.clearColor(t,e,i,s),o.clear(n);}},{key:"initFramebuffer",value:function initFramebuffer(t){var e=this.gl,i=new Zb(e.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i;}},{key:"resizeFramebuffer",value:function resizeFramebuffer(t){var e=this.gl,i=t.glFramebuffers[this.CONTEXT_UID];if(i.stencil){e.bindRenderbuffer(e.RENDERBUFFER,i.stencil);var o;this.renderer.context.webGLVersion===1?o=e.DEPTH_STENCIL:t.depth&&t.stencil?o=e.DEPTH24_STENCIL8:t.depth?o=e.DEPTH_COMPONENT24:o=e.STENCIL_INDEX8,i.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,o,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,o,t.width,t.height);}var s=t.colorTextures;var n=s.length;e.drawBuffers||(n=Math.min(n,1));for(var _o14=0;_o14<n;_o14++){var a=s[_o14],l=a.parentTextureArray||a;this.renderer.texture.bind(l,0),_o14===0&&i.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,i.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,l._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height));}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0);}},{key:"updateFramebuffer",value:function updateFramebuffer(t,e){var i=this.gl,s=t.glFramebuffers[this.CONTEXT_UID],n=t.colorTextures;var o=n.length;i.drawBuffers||(o=Math.min(o,1)),s.multisample>1&&this.canMultisampleFramebuffer(t)?s.msaaBuffer=s.msaaBuffer||i.createRenderbuffer():s.msaaBuffer&&(i.deleteRenderbuffer(s.msaaBuffer),s.msaaBuffer=null,s.blitFramebuffer&&(s.blitFramebuffer.dispose(),s.blitFramebuffer=null));var a=[];for(var l=0;l<o;l++){var h=n[l],u=h.parentTextureArray||h;this.renderer.texture.bind(u,0),l===0&&s.msaaBuffer?(i.bindRenderbuffer(i.RENDERBUFFER,s.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,s.multisample,u._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,s.msaaBuffer)):(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+l,h.target,u._glTextures[this.CONTEXT_UID].texture,e),a.push(i.COLOR_ATTACHMENT0+l));}if(a.length>1&&i.drawBuffers(a),t.depthTexture&&this.writeDepthTexture){var _l6=t.depthTexture;this.renderer.texture.bind(_l6,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,_l6._glTextures[this.CONTEXT_UID].texture,e);}if((t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)){s.stencil=s.stencil||i.createRenderbuffer();var _l7,_h8;this.renderer.context.webGLVersion===1?(_l7=i.DEPTH_STENCIL_ATTACHMENT,_h8=i.DEPTH_STENCIL):t.depth&&t.stencil?(_l7=i.DEPTH_STENCIL_ATTACHMENT,_h8=i.DEPTH24_STENCIL8):t.depth?(_l7=i.DEPTH_ATTACHMENT,_h8=i.DEPTH_COMPONENT24):(_l7=i.STENCIL_ATTACHMENT,_h8=i.STENCIL_INDEX8),i.bindRenderbuffer(i.RENDERBUFFER,s.stencil),s.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,s.multisample,_h8,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,_h8,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,_l7,i.RENDERBUFFER,s.stencil);}else s.stencil&&(i.deleteRenderbuffer(s.stencil),s.stencil=null);}},{key:"canMultisampleFramebuffer",value:function canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture;}},{key:"detectSamples",value:function detectSamples(t){var e=this.msaaSamples;var i=Yt.NONE;if(t<=1||e===null)return i;for(var s=0;s<e.length;s++)if(e[s]<=t){i=e[s];break;}return i===1&&(i=Yt.NONE),i;}},{key:"blit",value:function blit(t,e,i){var s=this.current,n=this.renderer,o=this.gl,a=this.CONTEXT_UID;if(n.context.webGLVersion!==2||!s)return;var l=s.glFramebuffers[a];if(!l)return;if(!t){if(!l.msaaBuffer)return;var u=s.colorTextures[0];if(!u)return;l.blitFramebuffer||(l.blitFramebuffer=new Ol(s.width,s.height),l.blitFramebuffer.addColorTexture(0,u)),t=l.blitFramebuffer,t.colorTextures[0]!==u&&(t.colorTextures[0]=u,t.dirtyId++,t.dirtyFormat++),(t.width!==s.width||t.height!==s.height)&&(t.width=s.width,t.height=s.height,t.dirtyId++,t.dirtySize++);}e||(e=Qb,e.width=s.width,e.height=s.height),i||(i=e);var h=e.width===i.width&&e.height===i.height;this.bind(t),o.bindFramebuffer(o.READ_FRAMEBUFFER,l.framebuffer),o.blitFramebuffer(e.left,e.top,e.right,e.bottom,i.left,i.top,i.right,i.bottom,o.COLOR_BUFFER_BIT,h?o.NEAREST:o.LINEAR),o.bindFramebuffer(o.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer);}},{key:"disposeFramebuffer",value:function disposeFramebuffer(t,e){var i=t.glFramebuffers[this.CONTEXT_UID],s=this.gl;if(!i)return;delete t.glFramebuffers[this.CONTEXT_UID];var n=this.managedFramebuffers.indexOf(t);n>=0&&this.managedFramebuffers.splice(n,1),t.disposeRunner.remove(this),e||(s.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&s.deleteRenderbuffer(i.msaaBuffer),i.stencil&&s.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&this.disposeFramebuffer(i.blitFramebuffer,e);}},{key:"disposeAll",value:function disposeAll(t){var e=this.managedFramebuffers;this.managedFramebuffers=[];for(var i=0;i<e.length;i++)this.disposeFramebuffer(e[i],t);}},{key:"forceStencil",value:function forceStencil(){var t=this.current;if(!t)return;var e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil&&t.stencil)return;t.stencil=!0;var i=t.width,s=t.height,n=this.gl,o=e.stencil=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,o);var a,l;this.renderer.context.webGLVersion===1?(a=n.DEPTH_STENCIL_ATTACHMENT,l=n.DEPTH_STENCIL):t.depth?(a=n.DEPTH_STENCIL_ATTACHMENT,l=n.DEPTH24_STENCIL8):(a=n.STENCIL_ATTACHMENT,l=n.STENCIL_INDEX8),e.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,e.multisample,l,i,s):n.renderbufferStorage(n.RENDERBUFFER,l,i,s),n.framebufferRenderbuffer(n.FRAMEBUFFER,a,n.RENDERBUFFER,o);}},{key:"reset",value:function reset(){this.current=this.unknownFramebuffer,this.viewport=new pt();}},{key:"destroy",value:function destroy(){this.renderer=null;}}]);return df;}();df.extension={type:W.RendererSystem,name:"framebuffer"},K.add(df);var Ll={5126:4,5123:2,5121:1};var ff=/*#__PURE__*/function(){function ff(t){_classCallCheck(this,ff);this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={};}_createClass(ff,[{key:"contextChange",value:function contextChange(){this.disposeAll(!0);var t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){var i=this.renderer.context.extensions.vertexArrayObject;j.PREFER_ENV===ni.WEBGL_LEGACY&&(i=null),i?(t.createVertexArray=function(){return i.createVertexArrayOES();},t.bindVertexArray=function(s){return i.bindVertexArrayOES(s);},t.deleteVertexArray=function(s){return i.deleteVertexArrayOES(s);}):(this.hasVao=!1,t.createVertexArray=function(){return null;},t.bindVertexArray=function(){return null;},t.deleteVertexArray=function(){return null;});}if(e.webGLVersion!==2){var _i27=t.getExtension("ANGLE_instanced_arrays");_i27?(t.vertexAttribDivisor=function(s,n){return _i27.vertexAttribDivisorANGLE(s,n);},t.drawElementsInstanced=function(s,n,o,a,l){return _i27.drawElementsInstancedANGLE(s,n,o,a,l);},t.drawArraysInstanced=function(s,n,o,a){return _i27.drawArraysInstancedANGLE(s,n,o,a);}):this.hasInstance=!1;}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex;}},{key:"bind",value:function bind(t,e){e=e||this.renderer.shader.shader;var i=this.gl;var s=t.glVertexArrayObjects[this.CONTEXT_UID],n=!1;s||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=s={},n=!0);var o=s[e.program.id]||this.initGeometryVao(t,e,n);this._activeGeometry=t,this._activeVao!==o&&(this._activeVao=o,this.hasVao?i.bindVertexArray(o):this.activateVao(t,e.program)),this.updateBuffers();}},{key:"reset",value:function reset(){this.unbind();}},{key:"updateBuffers",value:function updateBuffers(){var t=this._activeGeometry,e=this.renderer.buffer;for(var i=0;i<t.buffers.length;i++){var s=t.buffers[i];e.update(s);}}},{key:"checkCompatibility",value:function checkCompatibility(t,e){var i=t.attributes,s=e.attributeData;for(var n in s)if(!i[n])throw new Error("shader and geometry incompatible, geometry missing the \"".concat(n,"\" attribute"));}},{key:"getSignature",value:function getSignature(t,e){var i=t.attributes,s=e.attributeData,n=["g",t.id];for(var o in i)s[o]&&n.push(o,s[o].location);return n.join("-");}},{key:"initGeometryVao",value:function initGeometryVao(t,e){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:!0;var s=this.gl,n=this.CONTEXT_UID,o=this.renderer.buffer,a=e.program;a.glPrograms[n]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,a);var l=this.getSignature(t,a),h=t.glVertexArrayObjects[this.CONTEXT_UID];var u=h[l];if(u)return h[a.id]=u,u;var c=t.buffers,d=t.attributes,p={},f={};for(var m in c)p[m]=0,f[m]=0;for(var _m5 in d)!d[_m5].size&&a.attributeData[_m5]?d[_m5].size=a.attributeData[_m5].size:d[_m5].size||console.warn("PIXI Geometry attribute '".concat(_m5,"' size cannot be determined (likely the bound shader does not have the attribute)")),p[d[_m5].buffer]+=d[_m5].size*Ll[d[_m5].type];for(var _m6 in d){var y=d[_m6],_=y.size;y.stride===void 0&&(p[y.buffer]===_*Ll[y.type]?y.stride=0:y.stride=p[y.buffer]),y.start===void 0&&(y.start=f[y.buffer],f[y.buffer]+=_*Ll[y.type]);}u=s.createVertexArray(),s.bindVertexArray(u);for(var _m7=0;_m7<c.length;_m7++){var _y3=c[_m7];o.bind(_y3),i&&_y3._glBuffers[n].refCount++;}return this.activateVao(t,a),h[a.id]=u,h[l]=u,s.bindVertexArray(null),o.unbind(nr.ARRAY_BUFFER),u;}},{key:"disposeGeometry",value:function disposeGeometry(t,e){var a;if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];var i=t.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,n=t.buffers,o=(a=this.renderer)==null?void 0:a.buffer;if(t.disposeRunner.remove(this),!!i){if(o)for(var l=0;l<n.length;l++){var h=n[l]._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!e&&o.dispose(n[l],e));}if(!e){for(var _l8 in i)if(_l8[0]==="g"){var _h9=i[_l8];this._activeVao===_h9&&this.unbind(),s.deleteVertexArray(_h9);}}delete t.glVertexArrayObjects[this.CONTEXT_UID];}}},{key:"disposeAll",value:function disposeAll(t){var e=Object.keys(this.managedGeometries);for(var i=0;i<e.length;i++)this.disposeGeometry(this.managedGeometries[e[i]],t);}},{key:"activateVao",value:function activateVao(t,e){var i=this.gl,s=this.CONTEXT_UID,n=this.renderer.buffer,o=t.buffers,a=t.attributes;t.indexBuffer&&n.bind(t.indexBuffer);var l=null;for(var h in a){var u=a[h],c=o[u.buffer],d=c._glBuffers[s];if(e.attributeData[h]){l!==d&&(n.bind(c),l=d);var p=e.attributeData[h].location;if(i.enableVertexAttribArray(p),i.vertexAttribPointer(p,u.size,u.type||i.FLOAT,u.normalized,u.stride,u.start),u.instance)if(this.hasInstance)i.vertexAttribDivisor(p,u.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device");}}}},{key:"draw",value:function draw(t,e,i,s){var n=this.gl,o=this._activeGeometry;if(o.indexBuffer){var a=o.indexBuffer.data.BYTES_PER_ELEMENT,l=a===2?n.UNSIGNED_SHORT:n.UNSIGNED_INT;a===2||a===4&&this.canUseUInt32ElementIndex?o.instanced?n.drawElementsInstanced(t,e||o.indexBuffer.data.length,l,(i||0)*a,s||1):n.drawElements(t,e||o.indexBuffer.data.length,l,(i||0)*a):console.warn("unsupported index buffer type: uint32");}else o.instanced?n.drawArraysInstanced(t,i,e||o.getSize(),s||1):n.drawArrays(t,i,e||o.getSize());return this;}},{key:"unbind",value:function unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null;}},{key:"destroy",value:function destroy(){this.renderer=null;}}]);return ff;}();ff.extension={type:W.RendererSystem,name:"geometry"},K.add(ff);var pf=new Rt();var mf=/*#__PURE__*/function(){function mf(t,e){_classCallCheck(this,mf);this._texture=t,this.mapCoord=new Rt(),this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=_typeof(e)>"u"?.5:e,this.isSimple=!1;}_createClass(mf,[{key:"texture",get:function get(){return this._texture;},set:function set(t){this._texture=t,this._textureID=-1;}},{key:"multiplyUvs",value:function multiplyUvs(t,e){e===void 0&&(e=t);var i=this.mapCoord;for(var s=0;s<t.length;s+=2){var n=t[s],o=t[s+1];e[s]=n*i.a+o*i.c+i.tx,e[s+1]=n*i.b+o*i.d+i.ty;}return e;}},{key:"update",value:function update(t){var e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;var i=e._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);var s=e.orig,n=e.trim;n&&(pf.set(s.width/n.width,0,0,s.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(pf));var o=e.baseTexture,a=this.uClampFrame,l=this.clampMargin/o.resolution,h=this.clampOffset;return a[0]=(e._frame.x+l+h)/o.width,a[1]=(e._frame.y+l+h)/o.height,a[2]=(e._frame.x+e._frame.width-l+h)/o.width,a[3]=(e._frame.y+e._frame.height-l+h)/o.height,this.uClampOffset[0]=h/o.realWidth,this.uClampOffset[1]=h/o.realHeight,this.isSimple=e._frame.width===o.width&&e._frame.height===o.height&&e.rotate===0,!0;}}]);return mf;}();var Jb="varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",tE="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n";var eE=/*#__PURE__*/function(_ve){_inherits(eE,_ve);var _super29=_createSuper(eE);function eE(t,e,i){var _this39;_classCallCheck(this,eE);var s=null;typeof t!="string"&&e===void 0&&i===void 0&&(s=t,t=void 0,e=void 0,i=void 0),_this39=_super29.call(this,t||tE,e||Jb,i),_this39.maskSprite=s,_this39.maskMatrix=new Rt();return _this39;}_createClass(eE,[{key:"maskSprite",get:function get(){return this._maskSprite;},set:function set(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1);}},{key:"apply",value:function apply(t,e,i,s){var n=this._maskSprite,o=n._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new mf(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,n).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,t.applyFilter(this,e,i,s));}}]);return eE;}(ve);var rE=/*#__PURE__*/function(){function rE(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;_classCallCheck(this,rE);this.type=Qt.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=ve.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null;}_createClass(rE,[{key:"filter",get:function get(){return this._filters?this._filters[0]:null;},set:function set(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null;}},{key:"reset",value:function reset(){this.pooled&&(this.maskObject=null,this.type=Qt.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null;}},{key:"copyCountersOrReset",value:function copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null);}}]);return rE;}();var gf=/*#__PURE__*/function(){function gf(t){_classCallCheck(this,gf);this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0;}_createClass(gf,[{key:"setMaskStack",value:function setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t);}},{key:"push",value:function push(t,e){var i=e;if(!i.isMaskData){var n=this.maskDataPool.pop()||new rE();n.pooled=!0,n.maskObject=e,i=n;}var s=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(s),i._colorMask=s?s._colorMask:15,i.autoDetect&&this.detect(i),i._target=t,i.type!==Qt.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case Qt.SCISSOR:this.renderer.scissor.push(i);break;case Qt.STENCIL:this.renderer.stencil.push(i);break;case Qt.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case Qt.COLOR:this.pushColorMask(i);break;}i.type===Qt.SPRITE&&this.maskStack.push(i);}},{key:"pop",value:function pop(t){var e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case Qt.SCISSOR:this.renderer.scissor.pop(e);break;case Qt.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case Qt.SPRITE:this.popSpriteMask(e);break;case Qt.COLOR:this.popColorMask(e);break;}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){var i=this.maskStack[this.maskStack.length-1];i.type===Qt.SPRITE&&i._filters&&(i._filters[0].maskSprite=i.maskObject);}}}},{key:"detect",value:function detect(t){var e=t.maskObject;e?e.isSprite?t.type=Qt.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=Qt.SCISSOR:t.type=Qt.STENCIL:t.type=Qt.COLOR;}},{key:"pushSpriteMask",value:function pushSpriteMask(t){var e=t.maskObject,i=t._target;var s=t._filters;s||(s=this.alphaMaskPool[this.alphaMaskIndex],s||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new eE()])),s[0].resolution=t.resolution,s[0].multisample=t.multisample,s[0].maskSprite=e;var n=i.filterArea;i.filterArea=e.getBounds(!0),this.renderer.filter.push(i,s),i.filterArea=n,t._filters||this.alphaMaskIndex++;}},{key:"popSpriteMask",value:function popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null);}},{key:"pushColorMask",value:function pushColorMask(t){var e=t._colorMask,i=t._colorMask=e&t.colorMask;i!==e&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0);}},{key:"popColorMask",value:function popColorMask(t){var e=t._colorMask,i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==e&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0);}},{key:"destroy",value:function destroy(){this.renderer=null;}}]);return gf;}();gf.extension={type:W.RendererSystem,name:"mask"},K.add(gf);var yf=/*#__PURE__*/function(){function yf(t){_classCallCheck(this,yf);this.renderer=t,this.maskStack=[],this.glConst=0;}_createClass(yf,[{key:"getStackLength",value:function getStackLength(){return this.maskStack.length;}},{key:"setMaskStack",value:function setMaskStack(t){var e=this.renderer.gl,i=this.getStackLength();this.maskStack=t;var s=this.getStackLength();s!==i&&(s===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()));}},{key:"_useCurrent",value:function _useCurrent(){}},{key:"destroy",value:function destroy(){this.renderer=null,this.maskStack=null;}}]);return yf;}();var _f=new Rt(),vf=[],xf=/*#__PURE__*/function(_yf){_inherits(Fo,_yf);var _super30=_createSuper(Fo);function Fo(t){var _this40;_classCallCheck(this,Fo);_this40=_super30.call(this,t),_this40.glConst=j.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST;return _this40;}_createClass(Fo,[{key:"getStackLength",value:function getStackLength(){var t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0;}},{key:"calcScissorRect",value:function calcScissorRect(t){var _vf$pop;if(t._scissorRectLocal)return;var e=t._scissorRect,i=t.maskObject,s=this.renderer,n=s.renderTexture,o=i.getBounds(!0,(_vf$pop=vf.pop())!==null&&_vf$pop!==void 0?_vf$pop:new pt());this.roundFrameToPixels(o,n.current?n.current.resolution:s.resolution,n.sourceFrame,n.destinationFrame,s.projection.transform),e&&o.fit(e),t._scissorRectLocal=o;}},{key:"testScissor",value:function testScissor(t){var e=t.maskObject;if(!e.isFastRect||!e.isFastRect()||Fo.isMatrixRotated(e.worldTransform)||Fo.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);var i=t._scissorRectLocal;return i.width>0&&i.height>0;}},{key:"roundFrameToPixels",value:function roundFrameToPixels(t,e,i,s,n){Fo.isMatrixRotated(n)||(n=n?_f.copyFrom(n):_f.identity(),n.translate(-i.x,-i.y).scale(s.width/i.width,s.height/i.height).translate(s.x,s.y),this.renderer.filter.transformAABB(n,t),t.fit(s),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e));}},{key:"push",value:function push(t){t._scissorRectLocal||this.calcScissorRect(t);var e=this.renderer.gl;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent();}},{key:"pop",value:function pop(t){var e=this.renderer.gl;t&&vf.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST);}},{key:"_useCurrent",value:function _useCurrent(){var t=this.maskStack[this.maskStack.length-1]._scissorRect;var e;this.renderer.renderTexture.current?e=t.y:e=this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height);}}],[{key:"isMatrixRotated",value:function isMatrixRotated(t){if(!t)return!1;var e=t.a,i=t.b,s=t.c,n=t.d;return(Math.abs(i)>1e-4||Math.abs(s)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(n)>1e-4);}}]);return Fo;}(yf);xf.extension={type:W.RendererSystem,name:"scissor"};var iE=xf;K.add(iE);var bf=/*#__PURE__*/function(_yf2){_inherits(bf,_yf2);var _super31=_createSuper(bf);function bf(t){var _this41;_classCallCheck(this,bf);_this41=_super31.call(this,t),_this41.glConst=j.ADAPTER.getWebGLRenderingContext().STENCIL_TEST;return _this41;}_createClass(bf,[{key:"getStackLength",value:function getStackLength(){var t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0;}},{key:"push",value:function push(t){var e=t.maskObject,i=this.renderer.gl,s=t._stencilCounter;s===0&&(this.renderer.framebuffer.forceStencil(),i.clearStencil(0),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST)),t._stencilCounter++;var n=t._colorMask;n!==0&&(t._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilFunc(i.EQUAL,s,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,n!==0&&(t._colorMask=n,i.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent();}},{key:"pop",value:function pop(t){var e=this.renderer.gl;if(this.getStackLength()===0)e.disable(e.STENCIL_TEST);else{var i=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,s=i?i._colorMask:15;s!==0&&(i._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,s!==0&&(i._colorMask=s,e.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent();}}},{key:"_useCurrent",value:function _useCurrent(){var t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP);}}]);return bf;}(yf);bf.extension={type:W.RendererSystem,name:"stencil"},K.add(bf);var Ef=/*#__PURE__*/function(){function Ef(t){_classCallCheck(this,Ef);this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get:function get(){return gt("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract;}},prepare:{enumerable:!1,get:function get(){return gt("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare;}},interaction:{enumerable:!1,get:function get(){return gt("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events;}}});}_createClass(Ef,[{key:"init",value:function init(){var t=this.rendererPlugins;for(var e in t)this.plugins[e]=new t[e](this.renderer);}},{key:"destroy",value:function destroy(){for(var t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null;}}]);return Ef;}();Ef.extension={type:[W.RendererSystem,W.CanvasRendererSystem],name:"_plugin"},K.add(Ef);var Tf=/*#__PURE__*/function(){function Tf(t){_classCallCheck(this,Tf);this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Rt(),this.transform=null;}_createClass(Tf,[{key:"update",value:function update(t,e,i,s){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,s),this.transform&&this.projectionMatrix.append(this.transform);var n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals);}},{key:"calculateProjection",value:function calculateProjection(t,e,i,s){var n=this.projectionMatrix,o=s?-1:1;n.identity(),n.a=1/e.width*2,n.d=o*(1/e.height*2),n.tx=-1-e.x*n.a,n.ty=-o-e.y*n.d;}},{key:"setTransform",value:function setTransform(t){}},{key:"destroy",value:function destroy(){this.renderer=null;}}]);return Tf;}();Tf.extension={type:W.RendererSystem,name:"projection"},K.add(Tf);var sE=new Cl(),wf=new pt();var Af=/*#__PURE__*/function(){function Af(t){_classCallCheck(this,Af);this.renderer=t,this._tempMatrix=new Rt();}_createClass(Af,[{key:"generateTexture",value:function generateTexture(t,e){var _s$multisample;var _ref111=e||{},i=_ref111.region,s=_objectWithoutProperties(_ref111,_excluded5),n=(i==null?void 0:i.copyTo(wf))||t.getLocalBounds(wf,!0),o=s.resolution||this.renderer.resolution;n.width=Math.max(n.width,1/o),n.height=Math.max(n.height,1/o),s.width=n.width,s.height=n.height,s.resolution=o,(_s$multisample=s.multisample)!==null&&_s$multisample!==void 0?_s$multisample:s.multisample=this.renderer.multisample;var a=_i.create(s);this._tempMatrix.tx=-n.x,this._tempMatrix.ty=-n.y;var l=t.transform;return t.transform=sE,this.renderer.render(t,{renderTexture:a,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=l,a;}},{key:"destroy",value:function destroy(){}}]);return Af;}();Af.extension={type:[W.RendererSystem,W.CanvasRendererSystem],name:"textureGenerator"},K.add(Af);var vi=new pt(),$s=new pt();var Sf=/*#__PURE__*/function(){function Sf(t){_classCallCheck(this,Sf);this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new pt(),this.destinationFrame=new pt(),this.viewportFrame=new pt();}_createClass(Sf,[{key:"contextChange",value:function contextChange(){var e;var t=(e=this.renderer)==null?void 0:e.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha);}},{key:"bind",value:function bind(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var e=arguments.length>1?arguments[1]:undefined;var i=arguments.length>2?arguments[2]:undefined;var s=this.renderer;this.current=t;var n,o,a;t?(n=t.baseTexture,a=n.resolution,e||(vi.width=t.frame.width,vi.height=t.frame.height,e=vi),i||($s.x=t.frame.x,$s.y=t.frame.y,$s.width=e.width,$s.height=e.height,i=$s),o=n.framebuffer):(a=s.resolution,e||(vi.width=s._view.screen.width,vi.height=s._view.screen.height,e=vi),i||(i=vi,i.width=e.width,i.height=e.height));var l=this.viewportFrame;l.x=i.x*a,l.y=i.y*a,l.width=i.width*a,l.height=i.height*a,t||(l.y=s.view.height-(l.y+l.height)),l.ceil(),this.renderer.framebuffer.bind(o,l),this.renderer.projection.update(i,e,a,!o),t?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(i);}},{key:"clear",value:function clear(t,e){var i=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,s=wt.shared.setValue(t||i);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&s.premultiply(s.alpha);var n=this.destinationFrame,o=this.current?this.current.baseTexture:this.renderer._view.screen,a=n.width!==o.width||n.height!==o.height;if(a){var _this$viewportFrame=this.viewportFrame,l=_this$viewportFrame.x,h=_this$viewportFrame.y,u=_this$viewportFrame.width,c=_this$viewportFrame.height;l=Math.round(l),h=Math.round(h),u=Math.round(u),c=Math.round(c),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(l,h,u,c);}this.renderer.framebuffer.clear(s.red,s.green,s.blue,s.alpha,e),a&&this.renderer.scissor.pop();}},{key:"resize",value:function resize(){this.bind(null);}},{key:"reset",value:function reset(){this.bind(null);}},{key:"destroy",value:function destroy(){this.renderer=null;}}]);return Sf;}();Sf.extension={type:W.RendererSystem,name:"renderTexture"},K.add(Sf);var nE=/*#__PURE__*/function(){function nE(t,e){_classCallCheck(this,nE);this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={};}_createClass(nE,[{key:"destroy",value:function destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null;}}]);return nE;}();function oE(r,t){var e={},i=t.getProgramParameter(r,t.ACTIVE_ATTRIBUTES);for(var s=0;s<i;s++){var n=t.getActiveAttrib(r,s);if(n.name.startsWith("gl_"))continue;var o=ef(t,n.type),a={type:o,name:n.name,size:Jd(o),location:t.getAttribLocation(r,n.name)};e[n.name]=a;}return e;}function aE(r,t){var e={},i=t.getProgramParameter(r,t.ACTIVE_UNIFORMS);for(var s=0;s<i;s++){var n=t.getActiveUniform(r,s),o=n.name.replace(/\[.*?\]$/,""),a=!!n.name.match(/\[.*?\]$/),l=ef(t,n.type);e[o]={name:o,index:s,type:l,size:n.size,isArray:a,value:Kd(l,n.size)};}return e;}function lE(r,t){var a;var e=qd(r,r.VERTEX_SHADER,t.vertexSrc),i=qd(r,r.FRAGMENT_SHADER,t.fragmentSrc),s=r.createProgram();r.attachShader(s,e),r.attachShader(s,i);var n=(a=t.extra)==null?void 0:a.transformFeedbackVaryings;if(n&&(typeof r.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):r.transformFeedbackVaryings(s,n.names,n.bufferMode==="separate"?r.SEPARATE_ATTRIBS:r.INTERLEAVED_ATTRIBS)),r.linkProgram(s),r.getProgramParameter(s,r.LINK_STATUS)||Fb(r,s,e,i),t.attributeData=oE(s,r),t.uniformData=aE(s,r),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){var l=Object.keys(t.attributeData);l.sort(function(h,u){return h>u?1:-1;});for(var h=0;h<l.length;h++)t.attributeData[l[h]].location=h,r.bindAttribLocation(s,h,l[h]);r.linkProgram(s);}r.deleteShader(e),r.deleteShader(i);var o={};for(var _l9 in t.uniformData){var _h10=t.uniformData[_l9];o[_l9]={location:r.getUniformLocation(s,_l9),value:Kd(_h10.type,_h10.size)};}return new nE(s,o);}function hE(r,t,e,i,s){e.buffer.update(s);}var uE={"float":"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},Cf={"float":4,vec2:8,vec3:12,vec4:16,"int":4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function cE(r){var t=r.map(function(n){return{data:n,offset:0,dataLen:0,dirty:0};});var e=0,i=0,s=0;for(var n=0;n<t.length;n++){var o=t[n];if(e=Cf[o.data.type],o.data.size>1&&(e=Math.max(e,16)*o.data.size),o.dataLen=e,i%e!==0&&i<16){var a=i%e%16;i+=a,s+=a;}i+e>16?(s=Math.ceil(s/16)*16,o.offset=s,s+=e,i=e):(o.offset=s,i+=e,s+=e);}return s=Math.ceil(s/16)*16,{uboElements:t,size:s};}function dE(r,t){var e=[];for(var i in r)t[i]&&e.push(t[i]);return e.sort(function(i,s){return i.index-s.index;}),e;}function fE(r,t){if(!r.autoManage)return{size:0,syncFunc:hE};var e=dE(r.uniforms,t),_cE=cE(e),i=_cE.uboElements,s=_cE.size,n=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "];for(var o=0;o<i.length;o++){var a=i[o],l=r.uniforms[a.data.name],h=a.data.name;var u=!1;for(var c=0;c<Zi.length;c++){var d=Zi[c];if(d.codeUbo&&d.test(a.data,l)){n.push("offset = ".concat(a.offset/4,";"),Zi[c].codeUbo(a.data.name,l)),u=!0;break;}}if(!u)if(a.data.size>1){var _c10=Jd(a.data.type),_d4=Math.max(Cf[a.data.type]/16,1),p=_c10/_d4,f=(4-p%4)%4;n.push("\n                cv = ud.".concat(h,".value;\n                v = uv.").concat(h,";\n                offset = ").concat(a.offset/4,";\n\n                t = 0;\n\n                for(var i=0; i < ").concat(a.data.size*_d4,"; i++)\n                {\n                    for(var j = 0; j < ").concat(p,"; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += ").concat(f,";\n                }\n\n                "));}else{var _c11=uE[a.data.type];n.push("\n                cv = ud.".concat(h,".value;\n                v = uv.").concat(h,";\n                offset = ").concat(a.offset/4,";\n                ").concat(_c11,";\n                "));}}return n.push("\n       renderer.buffer.update(buffer);\n    "),{size:s,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join("\n"))};}var pE=0;var io={textureCount:0,uboCount:0};var If=/*#__PURE__*/function(){function If(t){_classCallCheck(this,If);this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=pE++;}_createClass(If,[{key:"systemCheck",value:function systemCheck(){if(!kb())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.");}},{key:"contextChange",value:function contextChange(t){this.gl=t,this.reset();}},{key:"bind",value:function bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;var i=t.program,s=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(s.program)),e||(io.textureCount=0,io.uboCount=0,this.syncUniformGroup(t.uniformGroup,io)),s;}},{key:"setUniforms",value:function setUniforms(t){var e=this.shader.program,i=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(i.uniformData,t,this.renderer);}},{key:"syncUniformGroup",value:function syncUniformGroup(t,e){var i=this.getGlProgram();(!t["static"]||t.dirtyId!==i.uniformDirtyGroups[t.id])&&(i.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,e));}},{key:"syncUniforms",value:function syncUniforms(t,e,i){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,i);}},{key:"createSyncGroups",value:function createSyncGroups(t){var e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=Db(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id];}},{key:"syncUniformBufferGroup",value:function syncUniformBufferGroup(t,e){var i=this.getGlProgram();if(!t["static"]||t.dirtyId!==0||!i.uniformGroups[t.id]){t.dirtyId=0;var s=i.uniformGroups[t.id]||this.createSyncBufferGroup(t,i,e);t.buffer.update(),s(i.uniformData,t.uniforms,this.renderer,io,t.buffer);}this.renderer.buffer.bindBufferBase(t.buffer,i.uniformBufferBindings[e]);}},{key:"createSyncBufferGroup",value:function createSyncBufferGroup(t,e,i){var s=this.renderer.gl;this.renderer.buffer.bind(t.buffer);var n=this.gl.getUniformBlockIndex(e.program,i);e.uniformBufferBindings[i]=this.shader.uniformBindCount,s.uniformBlockBinding(e.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;var o=this.getSignature(t,this.shader.program.uniformData,"ubo");var a=this._uboCache[o];if(a||(a=this._uboCache[o]=fE(t,this.shader.program.uniformData)),t.autoManage){var l=new Float32Array(a.size/4);t.buffer.update(l);}return e.uniformGroups[t.id]=a.syncFunc,e.uniformGroups[t.id];}},{key:"getSignature",value:function getSignature(t,e,i){var s=t.uniforms,n=["".concat(i,"-")];for(var o in s)n.push(o),e[o]&&n.push(e[o].type);return n.join("-");}},{key:"getGlProgram",value:function getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null;}},{key:"generateProgram",value:function generateProgram(t){var e=this.gl,i=t.program,s=lE(e,i);return i.glPrograms[this.renderer.CONTEXT_UID]=s,s;}},{key:"reset",value:function reset(){this.program=null,this.shader=null;}},{key:"disposeShader",value:function disposeShader(t){this.shader===t&&(this.shader=null);}},{key:"destroy",value:function destroy(){this.renderer=null,this.destroyed=!0;}}]);return If;}();If.extension={type:W.RendererSystem,name:"shader"},K.add(If);var so=/*#__PURE__*/function(){function so(t){_classCallCheck(this,so);this.renderer=t;}_createClass(so,[{key:"run",value:function run(t){var e=this.renderer;e.runners.init.emit(e.options),t.hello&&console.log("PixiJS 7.4.3 - ".concat(e.rendererLogId," - https://pixijs.com")),e.resize(e.screen.width,e.screen.height);}},{key:"destroy",value:function destroy(){}}]);return so;}();so.defaultOptions={hello:!1},so.extension={type:[W.RendererSystem,W.CanvasRendererSystem],name:"startup"},K.add(so);function mE(r){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return t[at.NORMAL]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.ADD]=[r.ONE,r.ONE],t[at.MULTIPLY]=[r.DST_COLOR,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.SCREEN]=[r.ONE,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.OVERLAY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.DARKEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.LIGHTEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.COLOR_DODGE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.COLOR_BURN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.HARD_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.SOFT_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.DIFFERENCE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.EXCLUSION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.HUE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.SATURATION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.COLOR]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.LUMINOSITY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.NONE]=[0,0],t[at.NORMAL_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.ADD_NPM]=[r.SRC_ALPHA,r.ONE,r.ONE,r.ONE],t[at.SCREEN_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[at.SRC_IN]=[r.DST_ALPHA,r.ZERO],t[at.SRC_OUT]=[r.ONE_MINUS_DST_ALPHA,r.ZERO],t[at.SRC_ATOP]=[r.DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],t[at.DST_OVER]=[r.ONE_MINUS_DST_ALPHA,r.ONE],t[at.DST_IN]=[r.ZERO,r.SRC_ALPHA],t[at.DST_OUT]=[r.ZERO,r.ONE_MINUS_SRC_ALPHA],t[at.DST_ATOP]=[r.ONE_MINUS_DST_ALPHA,r.SRC_ALPHA],t[at.XOR]=[r.ONE_MINUS_DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],t[at.SUBTRACT]=[r.ONE,r.ONE,r.ONE,r.ONE,r.FUNC_REVERSE_SUBTRACT,r.FUNC_ADD],t;}var gE=0,yE=1,_E=2,vE=3,xE=4,bE=5,Rf=/*#__PURE__*/function(){function wh(){_classCallCheck(this,wh);this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=at.NONE,this._blendEq=!1,this.map=[],this.map[gE]=this.setBlend,this.map[yE]=this.setOffset,this.map[_E]=this.setCullFace,this.map[vE]=this.setDepthTest,this.map[xE]=this.setFrontFace,this.map[bE]=this.setDepthMask,this.checks=[],this.defaultState=new cr(),this.defaultState.blend=!0;}_createClass(wh,[{key:"contextChange",value:function contextChange(t){this.gl=t,this.blendModes=mE(t),this.set(this.defaultState),this.reset();}},{key:"set",value:function set(t){if(t=t||this.defaultState,this.stateId!==t.data){var e=this.stateId^t.data,i=0;for(;e;)e&1&&this.map[i].call(this,!!(t.data&1<<i)),e=e>>1,i++;this.stateId=t.data;}for(var _e8=0;_e8<this.checks.length;_e8++)this.checks[_e8](this,t);}},{key:"forceState",value:function forceState(t){t=t||this.defaultState;for(var e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(var _e9=0;_e9<this.checks.length;_e9++)this.checks[_e9](this,t);this.stateId=t.data;}},{key:"setBlend",value:function setBlend(t){this.updateCheck(wh.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND);}},{key:"setOffset",value:function setOffset(t){this.updateCheck(wh.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL);}},{key:"setDepthTest",value:function setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST);}},{key:"setDepthMask",value:function setDepthMask(t){this.gl.depthMask(t);}},{key:"setCullFace",value:function setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE);}},{key:"setFrontFace",value:function setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"]);}},{key:"setBlendMode",value:function setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;var e=this.blendModes[t],i=this.gl;e.length===2?i.blendFunc(e[0],e[1]):i.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,i.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD));}},{key:"setPolygonOffset",value:function setPolygonOffset(t,e){this.gl.polygonOffset(t,e);}},{key:"reset",value:function reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0);}},{key:"updateCheck",value:function updateCheck(t,e){var i=this.checks.indexOf(t);e&&i===-1?this.checks.push(t):!e&&i!==-1&&this.checks.splice(i,1);}},{key:"destroy",value:function destroy(){this.gl=null;}}],[{key:"checkBlendMode",value:function checkBlendMode(t,e){t.setBlendMode(e.blendMode);}},{key:"checkPolygonOffset",value:function checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset);}}]);return wh;}();Rf.extension={type:W.RendererSystem,name:"state"};var EE=Rf;K.add(EE);var TE=/*#__PURE__*/function(_Ts3){_inherits(TE,_Ts3);var _super32=_createSuper(TE);function TE(){var _this42;_classCallCheck(this,TE);_this42=_super32.apply(this,arguments),_this42.runners={},_this42._systemsHash={};return _this42;}_createClass(TE,[{key:"setup",value:function setup(t){var _t$priority;this.addRunners.apply(this,_toConsumableArray(t.runners));var e=((_t$priority=t.priority)!==null&&_t$priority!==void 0?_t$priority:[]).filter(function(s){return t.systems[s];}),i=[].concat(_toConsumableArray(e),_toConsumableArray(Object.keys(t.systems).filter(function(s){return!e.includes(s);})));var _iterator15=_createForOfIteratorHelper(i),_step15;try{for(_iterator15.s();!(_step15=_iterator15.n()).done;){var s=_step15.value;this.addSystem(t.systems[s],s);}}catch(err){_iterator15.e(err);}finally{_iterator15.f();}}},{key:"addRunners",value:function addRunners(){var _this43=this;for(var _len9=arguments.length,t=new Array(_len9),_key9=0;_key9<_len9;_key9++){t[_key9]=arguments[_key9];}t.forEach(function(e){_this43.runners[e]=new ze(e);});}},{key:"addSystem",value:function addSystem(t,e){var i=new t(this);if(this[e])throw new Error("Whoops! The name \"".concat(e,"\" is already in use"));this[e]=i,this._systemsHash[e]=i;for(var s in this.runners)this.runners[s].add(i);return this;}},{key:"emitWithCustomOptions",value:function emitWithCustomOptions(t,e){var _this44=this;var i=Object.keys(this._systemsHash);t.items.forEach(function(s){var n=i.find(function(o){return _this44._systemsHash[o]===s;});s[t.name](e[n]);});}},{key:"destroy",value:function destroy(){Object.values(this.runners).forEach(function(t){t.destroy();}),this._systemsHash={};}}]);return TE;}(Ts);var Hs=/*#__PURE__*/function(){function Uo(t){_classCallCheck(this,Uo);this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=Uo.defaultMaxIdle,this.checkCountMax=Uo.defaultCheckCountMax,this.mode=Uo.defaultMode;}_createClass(Uo,[{key:"postrender",value:function postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==ba.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())));}},{key:"run",value:function run(){var t=this.renderer.texture,e=t.managedTextures;var i=!1;for(var s=0;s<e.length;s++){var n=e[s];n.resource&&this.count-n.touched>this.maxIdle&&(t.destroyTexture(n,!0),e[s]=null,i=!0);}if(i){var _s4=0;for(var _n8=0;_n8<e.length;_n8++)e[_n8]!==null&&(e[_s4++]=e[_n8]);e.length=_s4;}}},{key:"unload",value:function unload(t){var e=this.renderer.texture,i=t._texture;i&&!i.framebuffer&&e.destroyTexture(i);for(var s=t.children.length-1;s>=0;s--)this.unload(t.children[s]);}},{key:"destroy",value:function destroy(){this.renderer=null;}}]);return Uo;}();Hs.defaultMode=ba.AUTO,Hs.defaultMaxIdle=60*60,Hs.defaultCheckCountMax=60*10,Hs.extension={type:W.RendererSystem,name:"textureGC"};var xi=Hs;K.add(xi);var Bl=/*#__PURE__*/_createClass(function Bl(t){_classCallCheck(this,Bl);this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=tt.UNSIGNED_BYTE,this.internalFormat=H.RGBA,this.samplerType=0;});function wE(r){var _t16,_t17;var t;return"WebGL2RenderingContext"in globalThis&&r instanceof globalThis.WebGL2RenderingContext?t=(_t16={},_defineProperty(_t16,r.RGB,Y.FLOAT),_defineProperty(_t16,r.RGBA,Y.FLOAT),_defineProperty(_t16,r.ALPHA,Y.FLOAT),_defineProperty(_t16,r.LUMINANCE,Y.FLOAT),_defineProperty(_t16,r.LUMINANCE_ALPHA,Y.FLOAT),_defineProperty(_t16,r.R8,Y.FLOAT),_defineProperty(_t16,r.R8_SNORM,Y.FLOAT),_defineProperty(_t16,r.RG8,Y.FLOAT),_defineProperty(_t16,r.RG8_SNORM,Y.FLOAT),_defineProperty(_t16,r.RGB8,Y.FLOAT),_defineProperty(_t16,r.RGB8_SNORM,Y.FLOAT),_defineProperty(_t16,r.RGB565,Y.FLOAT),_defineProperty(_t16,r.RGBA4,Y.FLOAT),_defineProperty(_t16,r.RGB5_A1,Y.FLOAT),_defineProperty(_t16,r.RGBA8,Y.FLOAT),_defineProperty(_t16,r.RGBA8_SNORM,Y.FLOAT),_defineProperty(_t16,r.RGB10_A2,Y.FLOAT),_defineProperty(_t16,r.RGB10_A2UI,Y.FLOAT),_defineProperty(_t16,r.SRGB8,Y.FLOAT),_defineProperty(_t16,r.SRGB8_ALPHA8,Y.FLOAT),_defineProperty(_t16,r.R16F,Y.FLOAT),_defineProperty(_t16,r.RG16F,Y.FLOAT),_defineProperty(_t16,r.RGB16F,Y.FLOAT),_defineProperty(_t16,r.RGBA16F,Y.FLOAT),_defineProperty(_t16,r.R32F,Y.FLOAT),_defineProperty(_t16,r.RG32F,Y.FLOAT),_defineProperty(_t16,r.RGB32F,Y.FLOAT),_defineProperty(_t16,r.RGBA32F,Y.FLOAT),_defineProperty(_t16,r.R11F_G11F_B10F,Y.FLOAT),_defineProperty(_t16,r.RGB9_E5,Y.FLOAT),_defineProperty(_t16,r.R8I,Y.INT),_defineProperty(_t16,r.R8UI,Y.UINT),_defineProperty(_t16,r.R16I,Y.INT),_defineProperty(_t16,r.R16UI,Y.UINT),_defineProperty(_t16,r.R32I,Y.INT),_defineProperty(_t16,r.R32UI,Y.UINT),_defineProperty(_t16,r.RG8I,Y.INT),_defineProperty(_t16,r.RG8UI,Y.UINT),_defineProperty(_t16,r.RG16I,Y.INT),_defineProperty(_t16,r.RG16UI,Y.UINT),_defineProperty(_t16,r.RG32I,Y.INT),_defineProperty(_t16,r.RG32UI,Y.UINT),_defineProperty(_t16,r.RGB8I,Y.INT),_defineProperty(_t16,r.RGB8UI,Y.UINT),_defineProperty(_t16,r.RGB16I,Y.INT),_defineProperty(_t16,r.RGB16UI,Y.UINT),_defineProperty(_t16,r.RGB32I,Y.INT),_defineProperty(_t16,r.RGB32UI,Y.UINT),_defineProperty(_t16,r.RGBA8I,Y.INT),_defineProperty(_t16,r.RGBA8UI,Y.UINT),_defineProperty(_t16,r.RGBA16I,Y.INT),_defineProperty(_t16,r.RGBA16UI,Y.UINT),_defineProperty(_t16,r.RGBA32I,Y.INT),_defineProperty(_t16,r.RGBA32UI,Y.UINT),_defineProperty(_t16,r.DEPTH_COMPONENT16,Y.FLOAT),_defineProperty(_t16,r.DEPTH_COMPONENT24,Y.FLOAT),_defineProperty(_t16,r.DEPTH_COMPONENT32F,Y.FLOAT),_defineProperty(_t16,r.DEPTH_STENCIL,Y.FLOAT),_defineProperty(_t16,r.DEPTH24_STENCIL8,Y.FLOAT),_defineProperty(_t16,r.DEPTH32F_STENCIL8,Y.FLOAT),_t16):t=(_t17={},_defineProperty(_t17,r.RGB,Y.FLOAT),_defineProperty(_t17,r.RGBA,Y.FLOAT),_defineProperty(_t17,r.ALPHA,Y.FLOAT),_defineProperty(_t17,r.LUMINANCE,Y.FLOAT),_defineProperty(_t17,r.LUMINANCE_ALPHA,Y.FLOAT),_defineProperty(_t17,r.DEPTH_STENCIL,Y.FLOAT),_t17),t;}function AE(r){var _tt$UNSIGNED_BYTE,_tt$BYTE,_tt$UNSIGNED_SHORT,_tt$SHORT,_tt$UNSIGNED_INT,_tt$INT,_tt$FLOAT,_tt$HALF_FLOAT,_tt$UNSIGNED_INT_2_,_t18,_tt$UNSIGNED_BYTE2,_t19;var t;return"WebGL2RenderingContext"in globalThis&&r instanceof globalThis.WebGL2RenderingContext?t=(_t18={},_defineProperty(_t18,tt.UNSIGNED_BYTE,(_tt$UNSIGNED_BYTE={},_defineProperty(_tt$UNSIGNED_BYTE,H.RGBA,r.RGBA8),_defineProperty(_tt$UNSIGNED_BYTE,H.RGB,r.RGB8),_defineProperty(_tt$UNSIGNED_BYTE,H.RG,r.RG8),_defineProperty(_tt$UNSIGNED_BYTE,H.RED,r.R8),_defineProperty(_tt$UNSIGNED_BYTE,H.RGBA_INTEGER,r.RGBA8UI),_defineProperty(_tt$UNSIGNED_BYTE,H.RGB_INTEGER,r.RGB8UI),_defineProperty(_tt$UNSIGNED_BYTE,H.RG_INTEGER,r.RG8UI),_defineProperty(_tt$UNSIGNED_BYTE,H.RED_INTEGER,r.R8UI),_defineProperty(_tt$UNSIGNED_BYTE,H.ALPHA,r.ALPHA),_defineProperty(_tt$UNSIGNED_BYTE,H.LUMINANCE,r.LUMINANCE),_defineProperty(_tt$UNSIGNED_BYTE,H.LUMINANCE_ALPHA,r.LUMINANCE_ALPHA),_tt$UNSIGNED_BYTE)),_defineProperty(_t18,tt.BYTE,(_tt$BYTE={},_defineProperty(_tt$BYTE,H.RGBA,r.RGBA8_SNORM),_defineProperty(_tt$BYTE,H.RGB,r.RGB8_SNORM),_defineProperty(_tt$BYTE,H.RG,r.RG8_SNORM),_defineProperty(_tt$BYTE,H.RED,r.R8_SNORM),_defineProperty(_tt$BYTE,H.RGBA_INTEGER,r.RGBA8I),_defineProperty(_tt$BYTE,H.RGB_INTEGER,r.RGB8I),_defineProperty(_tt$BYTE,H.RG_INTEGER,r.RG8I),_defineProperty(_tt$BYTE,H.RED_INTEGER,r.R8I),_tt$BYTE)),_defineProperty(_t18,tt.UNSIGNED_SHORT,(_tt$UNSIGNED_SHORT={},_defineProperty(_tt$UNSIGNED_SHORT,H.RGBA_INTEGER,r.RGBA16UI),_defineProperty(_tt$UNSIGNED_SHORT,H.RGB_INTEGER,r.RGB16UI),_defineProperty(_tt$UNSIGNED_SHORT,H.RG_INTEGER,r.RG16UI),_defineProperty(_tt$UNSIGNED_SHORT,H.RED_INTEGER,r.R16UI),_defineProperty(_tt$UNSIGNED_SHORT,H.DEPTH_COMPONENT,r.DEPTH_COMPONENT16),_tt$UNSIGNED_SHORT)),_defineProperty(_t18,tt.SHORT,(_tt$SHORT={},_defineProperty(_tt$SHORT,H.RGBA_INTEGER,r.RGBA16I),_defineProperty(_tt$SHORT,H.RGB_INTEGER,r.RGB16I),_defineProperty(_tt$SHORT,H.RG_INTEGER,r.RG16I),_defineProperty(_tt$SHORT,H.RED_INTEGER,r.R16I),_tt$SHORT)),_defineProperty(_t18,tt.UNSIGNED_INT,(_tt$UNSIGNED_INT={},_defineProperty(_tt$UNSIGNED_INT,H.RGBA_INTEGER,r.RGBA32UI),_defineProperty(_tt$UNSIGNED_INT,H.RGB_INTEGER,r.RGB32UI),_defineProperty(_tt$UNSIGNED_INT,H.RG_INTEGER,r.RG32UI),_defineProperty(_tt$UNSIGNED_INT,H.RED_INTEGER,r.R32UI),_defineProperty(_tt$UNSIGNED_INT,H.DEPTH_COMPONENT,r.DEPTH_COMPONENT24),_tt$UNSIGNED_INT)),_defineProperty(_t18,tt.INT,(_tt$INT={},_defineProperty(_tt$INT,H.RGBA_INTEGER,r.RGBA32I),_defineProperty(_tt$INT,H.RGB_INTEGER,r.RGB32I),_defineProperty(_tt$INT,H.RG_INTEGER,r.RG32I),_defineProperty(_tt$INT,H.RED_INTEGER,r.R32I),_tt$INT)),_defineProperty(_t18,tt.FLOAT,(_tt$FLOAT={},_defineProperty(_tt$FLOAT,H.RGBA,r.RGBA32F),_defineProperty(_tt$FLOAT,H.RGB,r.RGB32F),_defineProperty(_tt$FLOAT,H.RG,r.RG32F),_defineProperty(_tt$FLOAT,H.RED,r.R32F),_defineProperty(_tt$FLOAT,H.DEPTH_COMPONENT,r.DEPTH_COMPONENT32F),_tt$FLOAT)),_defineProperty(_t18,tt.HALF_FLOAT,(_tt$HALF_FLOAT={},_defineProperty(_tt$HALF_FLOAT,H.RGBA,r.RGBA16F),_defineProperty(_tt$HALF_FLOAT,H.RGB,r.RGB16F),_defineProperty(_tt$HALF_FLOAT,H.RG,r.RG16F),_defineProperty(_tt$HALF_FLOAT,H.RED,r.R16F),_tt$HALF_FLOAT)),_defineProperty(_t18,tt.UNSIGNED_SHORT_5_6_5,_defineProperty({},H.RGB,r.RGB565)),_defineProperty(_t18,tt.UNSIGNED_SHORT_4_4_4_4,_defineProperty({},H.RGBA,r.RGBA4)),_defineProperty(_t18,tt.UNSIGNED_SHORT_5_5_5_1,_defineProperty({},H.RGBA,r.RGB5_A1)),_defineProperty(_t18,tt.UNSIGNED_INT_2_10_10_10_REV,(_tt$UNSIGNED_INT_2_={},_defineProperty(_tt$UNSIGNED_INT_2_,H.RGBA,r.RGB10_A2),_defineProperty(_tt$UNSIGNED_INT_2_,H.RGBA_INTEGER,r.RGB10_A2UI),_tt$UNSIGNED_INT_2_)),_defineProperty(_t18,tt.UNSIGNED_INT_10F_11F_11F_REV,_defineProperty({},H.RGB,r.R11F_G11F_B10F)),_defineProperty(_t18,tt.UNSIGNED_INT_5_9_9_9_REV,_defineProperty({},H.RGB,r.RGB9_E5)),_defineProperty(_t18,tt.UNSIGNED_INT_24_8,_defineProperty({},H.DEPTH_STENCIL,r.DEPTH24_STENCIL8)),_defineProperty(_t18,tt.FLOAT_32_UNSIGNED_INT_24_8_REV,_defineProperty({},H.DEPTH_STENCIL,r.DEPTH32F_STENCIL8)),_t18):t=(_t19={},_defineProperty(_t19,tt.UNSIGNED_BYTE,(_tt$UNSIGNED_BYTE2={},_defineProperty(_tt$UNSIGNED_BYTE2,H.RGBA,r.RGBA),_defineProperty(_tt$UNSIGNED_BYTE2,H.RGB,r.RGB),_defineProperty(_tt$UNSIGNED_BYTE2,H.ALPHA,r.ALPHA),_defineProperty(_tt$UNSIGNED_BYTE2,H.LUMINANCE,r.LUMINANCE),_defineProperty(_tt$UNSIGNED_BYTE2,H.LUMINANCE_ALPHA,r.LUMINANCE_ALPHA),_tt$UNSIGNED_BYTE2)),_defineProperty(_t19,tt.UNSIGNED_SHORT_5_6_5,_defineProperty({},H.RGB,r.RGB)),_defineProperty(_t19,tt.UNSIGNED_SHORT_4_4_4_4,_defineProperty({},H.RGBA,r.RGBA)),_defineProperty(_t19,tt.UNSIGNED_SHORT_5_5_5_1,_defineProperty({},H.RGBA,r.RGBA)),_t19),t;}var Mf=/*#__PURE__*/function(){function Mf(t){_classCallCheck(this,Mf);this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new ft(),this.hasIntegerTextures=!1;}_createClass(Mf,[{key:"contextChange",value:function contextChange(){var t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=AE(t),this.samplerTypes=wE(t);var e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(var s=0;s<e;s++)this.boundTextures[s]=null;this.emptyTextures={};var i=new Bl(t.createTexture());t.bindTexture(t.TEXTURE_2D,i.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=i,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new Bl(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(var _s5=0;_s5<6;_s5++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+_s5,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(var _s6=0;_s6<this.boundTextures.length;_s6++)this.bind(null,_s6);}},{key:"bind",value:function bind(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var i=this.gl;if(t=t==null?void 0:t.castToBaseTexture(),(t==null?void 0:t.valid)&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;var s=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(t.target,s.texture)),s.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),this.updateTexture(t)):s.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t;}else this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[e]=null;}},{key:"reset",value:function reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(var t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture;}},{key:"unbind",value:function unbind(t){var e=this.gl,i=this.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var s=0;s<i.length;s++)i[s]===this.unknownTexture&&this.bind(null,s);}for(var _s7=0;_s7<i.length;_s7++)i[_s7]===t&&(this.currentLocation!==_s7&&(e.activeTexture(e.TEXTURE0+_s7),this.currentLocation=_s7),e.bindTexture(t.target,this.emptyTextures[t.target].texture),i[_s7]=null);}},{key:"ensureSamplerType",value:function ensureSamplerType(t){var e=this.boundTextures,i=this.hasIntegerTextures,s=this.CONTEXT_UID;if(i)for(var n=t-1;n>=0;--n){var o=e[n];o&&o._glTextures[s].samplerType!==Y.FLOAT&&this.renderer.texture.unbind(o);}}},{key:"initTexture",value:function initTexture(t){var e=new Bl(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e;}},{key:"initTextureType",value:function initTextureType(t,e){var _ref112,_this$samplerTypes$e$;var i;e.internalFormat=(_ref112=(i=this.internalFormats[t.type])==null?void 0:i[t.format])!==null&&_ref112!==void 0?_ref112:t.format,e.samplerType=(_this$samplerTypes$e$=this.samplerTypes[e.internalFormat])!==null&&_this$samplerTypes$e$!==void 0?_this$samplerTypes$e$:Y.FLOAT,this.webGLVersion===2&&t.type===tt.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type;}},{key:"updateTexture",value:function updateTexture(t){var s;var e=t._glTextures[this.CONTEXT_UID];if(!e)return;var i=this.renderer;if(this.initTextureType(t,e),(s=t.resource)==null?void 0:s.upload(i,t,e))e.samplerType!==Y.FLOAT&&(this.hasIntegerTextures=!0);else{var n=t.realWidth,o=t.realHeight,a=i.gl;(e.width!==n||e.height!==o||e.dirtyId<0)&&(e.width=n,e.height=o,a.texImage2D(t.target,0,e.internalFormat,n,o,0,t.format,e.type,null));}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId;}},{key:"destroyTexture",value:function destroyTexture(t,e){var i=this.gl;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){var s=this.managedTextures.indexOf(t);s!==-1&&Ki(this.managedTextures,s,1);}}},{key:"updateTextureStyle",value:function updateTextureStyle(t){var i;var e=t._glTextures[this.CONTEXT_UID];e&&((t.mipmap===ir.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=Dr.CLAMP:e.wrapMode=t.wrapMode,(i=t.resource)!=null&&i.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId);}},{key:"setStyle",value:function setStyle(t,e){var i=this.gl;if(e.mipmap&&t.mipmap!==ir.ON_MANUAL&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===vr.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);var s=this.renderer.context.extensions.anisotropicFiltering;if(s&&t.anisotropicLevel>0&&t.scaleMode===vr.LINEAR){var n=Math.min(t.anisotropicLevel,i.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,s.TEXTURE_MAX_ANISOTROPY_EXT,n);}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===vr.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode===vr.LINEAR?i.LINEAR:i.NEAREST);}},{key:"destroy",value:function destroy(){this.renderer=null;}}]);return Mf;}();Mf.extension={type:W.RendererSystem,name:"texture"},K.add(Mf);var Pf=/*#__PURE__*/function(){function Pf(t){_classCallCheck(this,Pf);this.renderer=t;}_createClass(Pf,[{key:"contextChange",value:function contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID;}},{key:"bind",value:function bind(t){var e=this.gl,i=this.CONTEXT_UID,s=t._glTransformFeedbacks[i]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,s);}},{key:"unbind",value:function unbind(){var t=this.gl;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null);}},{key:"beginTransformFeedback",value:function beginTransformFeedback(t,e){var i=this.gl,s=this.renderer;e&&s.shader.bind(e),i.beginTransformFeedback(t);}},{key:"endTransformFeedback",value:function endTransformFeedback(){var t=this.gl;t.endTransformFeedback();}},{key:"createGLTransformFeedback",value:function createGLTransformFeedback(t){var e=this.gl,i=this.renderer,s=this.CONTEXT_UID,n=e.createTransformFeedback();t._glTransformFeedbacks[s]=n,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n);for(var o=0;o<t.buffers.length;o++){var a=t.buffers[o];a&&(i.buffer.update(a),a._glBuffers[s].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,o,a._glBuffers[s].buffer||null));}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),n;}},{key:"disposeTransformFeedback",value:function disposeTransformFeedback(t,e){var i=t._glTransformFeedbacks[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this);var n=this.renderer.buffer;if(n)for(var o=0;o<t.buffers.length;o++){var a=t.buffers[o];if(!a)continue;var l=a._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!e&&n.dispose(a,e));}i&&(e||s.deleteTransformFeedback(i),delete t._glTransformFeedbacks[this.CONTEXT_UID]);}},{key:"destroy",value:function destroy(){this.renderer=null;}}]);return Pf;}();Pf.extension={type:W.RendererSystem,name:"transformFeedback"},K.add(Pf);var no=/*#__PURE__*/function(){function no(t){_classCallCheck(this,no);this.renderer=t;}_createClass(no,[{key:"init",value:function init(t){this.screen=new pt(0,0,t.width,t.height),this.element=t.view||j.ADAPTER.createCanvas(),this.resolution=t.resolution||j.RESOLUTION,this.autoDensity=!!t.autoDensity;}},{key:"resizeView",value:function resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);var i=this.element.width/this.resolution,s=this.element.height/this.resolution;this.screen.width=i,this.screen.height=s,this.autoDensity&&(this.element.style.width="".concat(i,"px"),this.element.style.height="".concat(s,"px")),this.renderer.emit("resize",i,s),this.renderer.runners.resize.emit(this.screen.width,this.screen.height);}},{key:"destroy",value:function destroy(t){var e;t&&((e=this.element.parentNode)==null||e.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null;}}]);return no;}();no.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},no.extension={type:[W.RendererSystem,W.CanvasRendererSystem],name:"_view"},K.add(no),j.PREFER_ENV=ni.WEBGL2,j.STRICT_TEXTURE_CACHE=!1,j.RENDER_OPTIONS=_objectSpread(_objectSpread(_objectSpread(_objectSpread({},to.defaultOptions),Jn.defaultOptions),no.defaultOptions),so.defaultOptions),Object.defineProperties(j,{WRAP_MODE:{get:function get(){return ft.defaultOptions.wrapMode;},set:function set(r){gt("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),ft.defaultOptions.wrapMode=r;}},SCALE_MODE:{get:function get(){return ft.defaultOptions.scaleMode;},set:function set(r){gt("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),ft.defaultOptions.scaleMode=r;}},MIPMAP_TEXTURES:{get:function get(){return ft.defaultOptions.mipmap;},set:function set(r){gt("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),ft.defaultOptions.mipmap=r;}},ANISOTROPIC_LEVEL:{get:function get(){return ft.defaultOptions.anisotropicLevel;},set:function set(r){gt("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),ft.defaultOptions.anisotropicLevel=r;}},FILTER_RESOLUTION:{get:function get(){return gt("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),ve.defaultResolution;},set:function set(r){ve.defaultResolution=r;}},FILTER_MULTISAMPLE:{get:function get(){return gt("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),ve.defaultMultisample;},set:function set(r){ve.defaultMultisample=r;}},SPRITE_MAX_TEXTURES:{get:function get(){return yi.defaultMaxTextures;},set:function set(r){gt("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),yi.defaultMaxTextures=r;}},SPRITE_BATCH_SIZE:{get:function get(){return yi.defaultBatchSize;},set:function set(r){gt("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),yi.defaultBatchSize=r;}},CAN_UPLOAD_SAME_BUFFER:{get:function get(){return yi.canUploadSameBuffer;},set:function set(r){gt("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),yi.canUploadSameBuffer=r;}},GC_MODE:{get:function get(){return xi.defaultMode;},set:function set(r){gt("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),xi.defaultMode=r;}},GC_MAX_IDLE:{get:function get(){return xi.defaultMaxIdle;},set:function set(r){gt("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),xi.defaultMaxIdle=r;}},GC_MAX_CHECK_COUNT:{get:function get(){return xi.defaultCheckCountMax;},set:function set(r){gt("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),xi.defaultCheckCountMax=r;}},PRECISION_VERTEX:{get:function get(){return Cr.defaultVertexPrecision;},set:function set(r){gt("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),Cr.defaultVertexPrecision=r;}},PRECISION_FRAGMENT:{get:function get(){return Cr.defaultFragmentPrecision;},set:function set(r){gt("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),Cr.defaultFragmentPrecision=r;}}});var bi=function(r){return r[r.INTERACTION=50]="INTERACTION",r[r.HIGH=25]="HIGH",r[r.NORMAL=0]="NORMAL",r[r.LOW=-25]="LOW",r[r.UTILITY=-50]="UTILITY",r;}(bi||{});var Fl=/*#__PURE__*/function(){function Fl(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:!1;_classCallCheck(this,Fl);this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=i,this.once=s;}_createClass(Fl,[{key:"match",value:function match(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return this.fn===t&&this.context===e;}},{key:"emit",value:function emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));var e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e;}},{key:"connect",value:function connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this;}},{key:"destroy",value:function destroy(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!1;this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var e=this.next;return this.next=t?null:e,this.previous=null,e;}}]);return Fl;}();var Of=/*#__PURE__*/function(){function Pe(){var _this45=this;_classCallCheck(this,Pe);this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Fl(null,null,1/0),this.deltaMS=1/Pe.targetFPMS,this.elapsedMS=1/Pe.targetFPMS,this._tick=function(t){_this45._requestId=null,_this45.started&&(_this45.update(t),_this45.started&&_this45._requestId===null&&_this45._head.next&&(_this45._requestId=requestAnimationFrame(_this45._tick)));};}_createClass(Pe,[{key:"_requestIfNeeded",value:function _requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick));}},{key:"_cancelIfNeeded",value:function _cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null);}},{key:"_startIfPossible",value:function _startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start();}},{key:"add",value:function add(t,e){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:bi.NORMAL;return this._addListener(new Fl(t,e,i));}},{key:"addOnce",value:function addOnce(t,e){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:bi.NORMAL;return this._addListener(new Fl(t,e,i,!0));}},{key:"_addListener",value:function _addListener(t){var e=this._head.next,i=this._head;if(!e)t.connect(i);else{for(;e;){if(t.priority>e.priority){t.connect(i);break;}i=e,e=e.next;}t.previous||t.connect(i);}return this._startIfPossible(),this;}},{key:"remove",value:function remove(t,e){var i=this._head.next;for(;i;)i.match(t,e)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this;}},{key:"count",get:function get(){if(!this._head)return 0;var t=0,e=this._head;for(;e=e.next;)t++;return t;}},{key:"start",value:function start(){this.started||(this.started=!0,this._requestIfNeeded());}},{key:"stop",value:function stop(){this.started&&(this.started=!1,this._cancelIfNeeded());}},{key:"destroy",value:function destroy(){if(!this._protected){this.stop();var t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null;}}},{key:"update",value:function update(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:performance.now();var e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){var n=t-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=t-n%this._minElapsedMS;}this.deltaMS=e,this.deltaTime=this.deltaMS*Pe.targetFPMS;var i=this._head;var s=i.next;for(;s;)s=s.emit(this.deltaTime);i.next||this._cancelIfNeeded();}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t;}},{key:"FPS",get:function get(){return 1e3/this.elapsedMS;}},{key:"minFPS",get:function get(){return 1e3/this._maxElapsedMS;},set:function set(t){var e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,Pe.targetFPMS);this._maxElapsedMS=1/i;}},{key:"maxFPS",get:function get(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0;},set:function set(t){if(t===0)this._minElapsedMS=0;else{var e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3);}}}],[{key:"shared",get:function get(){if(!Pe._shared){var t=Pe._shared=new Pe();t.autoStart=!0,t._protected=!0;}return Pe._shared;}},{key:"system",get:function get(){if(!Pe._system){var t=Pe._system=new Pe();t.autoStart=!0,t._protected=!0;}return Pe._system;}}]);return Pe;}();Of.targetFPMS=.06;var Me=Of;Object.defineProperties(j,{TARGET_FPMS:{get:function get(){return Me.targetFPMS;},set:function set(r){gt("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Me.targetFPMS=r;}}});var Nf=/*#__PURE__*/function(){function Nf(){_classCallCheck(this,Nf);}_createClass(Nf,null,[{key:"init",value:function init(t){var _this46=this;t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set:function set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,bi.LOW);},get:function get(){return this._ticker;}}),this.stop=function(){_this46._ticker.stop();},this.start=function(){_this46._ticker.start();},this._ticker=null,this.ticker=t.sharedTicker?Me.shared:new Me(),t.autoStart&&this.start();}},{key:"destroy",value:function destroy(){if(this._ticker){var t=this._ticker;this.ticker=null,t.destroy();}}}]);return Nf;}();Nf.extension=W.Application,K.add(Nf);var Df=[];K.handleByList(W.Renderer,Df);function Lf(r){for(var _i28=0,_Df=Df;_i28<_Df.length;_i28++){var t=_Df[_i28];if(t.test(r))return new t(r);}throw new Error("Unable to auto-detect a suitable renderer.");}var SE="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",CE="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";var IE=SE,Bf=CE;var Ff=/*#__PURE__*/function(){function Ff(t){_classCallCheck(this,Ff);this.renderer=t;}_createClass(Ff,[{key:"contextChange",value:function contextChange(t){var e;if(this.renderer.context.webGLVersion===1){var i=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,i);}else{var _i29=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,_i29);}e>=Yt.HIGH?this.multisample=Yt.HIGH:e>=Yt.MEDIUM?this.multisample=Yt.MEDIUM:e>=Yt.LOW?this.multisample=Yt.LOW:this.multisample=Yt.NONE;}},{key:"destroy",value:function destroy(){}}]);return Ff;}();Ff.extension={type:W.RendererSystem,name:"_multisample"},K.add(Ff);var RE=/*#__PURE__*/_createClass(function RE(t){_classCallCheck(this,RE);this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0;});var Uf=/*#__PURE__*/function(){function Uf(t){_classCallCheck(this,Uf);this.renderer=t,this.managedBuffers={},this.boundBufferBases={};}_createClass(Uf,[{key:"destroy",value:function destroy(){this.renderer=null;}},{key:"contextChange",value:function contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID;}},{key:"bind",value:function bind(t){var e=this.gl,i=this.CONTEXT_UID,s=t._glBuffers[i]||this.createGLBuffer(t);e.bindBuffer(t.type,s.buffer);}},{key:"unbind",value:function unbind(t){var e=this.gl;e.bindBuffer(t,null);}},{key:"bindBufferBase",value:function bindBufferBase(t,e){var i=this.gl,s=this.CONTEXT_UID;if(this.boundBufferBases[e]!==t){var n=t._glBuffers[s]||this.createGLBuffer(t);this.boundBufferBases[e]=t,i.bindBufferBase(i.UNIFORM_BUFFER,e,n.buffer);}}},{key:"bindBufferRange",value:function bindBufferRange(t,e,i){var s=this.gl,n=this.CONTEXT_UID;i=i||0;var o=t._glBuffers[n]||this.createGLBuffer(t);s.bindBufferRange(s.UNIFORM_BUFFER,e||0,o.buffer,i*256,256);}},{key:"update",value:function update(t){var e=this.gl,i=this.CONTEXT_UID,s=t._glBuffers[i]||this.createGLBuffer(t);if(t._updateID!==s.updateID)if(s.updateID=t._updateID,e.bindBuffer(t.type,s.buffer),s.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{var n=t["static"]?e.STATIC_DRAW:e.DYNAMIC_DRAW;s.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,n);}}},{key:"dispose",value:function dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];var i=t._glBuffers[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this),i&&(e||s.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID]);}},{key:"disposeAll",value:function disposeAll(t){var e=Object.keys(this.managedBuffers);for(var i=0;i<e.length;i++)this.dispose(this.managedBuffers[e[i]],t);}},{key:"createGLBuffer",value:function createGLBuffer(t){var e=this.CONTEXT_UID,i=this.gl;return t._glBuffers[e]=new RE(i.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e];}}]);return Uf;}();Uf.extension={type:W.RendererSystem,name:"buffer"},K.add(Uf);var kf=/*#__PURE__*/function(){function kf(t){_classCallCheck(this,kf);this.renderer=t;}_createClass(kf,[{key:"render",value:function render(t,e){var i=this.renderer;var s,n,o,a;if(e&&(s=e.renderTexture,n=e.clear,o=e.transform,a=e.skipUpdateTransform),this.renderingToScreen=!s,i.runners.prerender.emit(),i.emit("prerender"),i.projection.transform=o,!i.context.isLost){var _n9;if(s||(this.lastObjectRendered=t),!a){var l=t.enableTempParent();t.updateTransform(),t.disableTempParent(l);}i.renderTexture.bind(s),i.batch.currentRenderer.start(),((_n9=n)!==null&&_n9!==void 0?_n9:i.background.clearBeforeRender)&&i.renderTexture.clear(),t.render(i),i.batch.currentRenderer.flush(),s&&(e.blit&&i.framebuffer.blit(),s.baseTexture.update()),i.runners.postrender.emit(),i.projection.transform=null,i.emit("postrender");}}},{key:"destroy",value:function destroy(){this.renderer=null,this.lastObjectRendered=null;}}]);return kf;}();kf.extension={type:W.RendererSystem,name:"objectRenderer"},K.add(kf);var oo=/*#__PURE__*/function(_TE){_inherits(Ah,_TE);var _super33=_createSuper(Ah);function Ah(t){var _this47;_classCallCheck(this,Ah);_this47=_super33.call(this),_this47.type=oc.WEBGL,t=Object.assign({},j.RENDER_OPTIONS,t),_this47.gl=null,_this47.CONTEXT_UID=0,_this47.globalUniforms=new We({projectionMatrix:new Rt()},!0);var e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Ah.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};_this47.setup(e),"useContextAlpha"in t&&(gt("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&t.useContextAlpha!=="notMultiplied",t.backgroundAlpha=t.useContextAlpha===!1?1:t.backgroundAlpha),_this47._plugin.rendererPlugins=Ah.__plugins,_this47.options=t,_this47.startup.run(_this47.options);return _this47;}_createClass(Ah,[{key:"render",value:function render(t,e){this.objectRenderer.render(t,e);}},{key:"resize",value:function resize(t,e){this._view.resizeView(t,e);}},{key:"reset",value:function reset(){return this.runners.reset.emit(),this;}},{key:"clear",value:function clear(){this.renderTexture.bind(),this.renderTexture.clear();}},{key:"destroy",value:function destroy(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!1;this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),_get(_getPrototypeOf(Ah.prototype),"destroy",this).call(this);}},{key:"plugins",get:function get(){return this._plugin.plugins;}},{key:"multisample",get:function get(){return this._multisample.multisample;}},{key:"width",get:function get(){return this._view.element.width;}},{key:"height",get:function get(){return this._view.element.height;}},{key:"resolution",get:function get(){return this._view.resolution;},set:function set(t){this._view.resolution=t,this.runners.resolutionChange.emit(t);}},{key:"autoDensity",get:function get(){return this._view.autoDensity;}},{key:"view",get:function get(){return this._view.element;}},{key:"screen",get:function get(){return this._view.screen;}},{key:"lastObjectRendered",get:function get(){return this.objectRenderer.lastObjectRendered;}},{key:"renderingToScreen",get:function get(){return this.objectRenderer.renderingToScreen;}},{key:"rendererLogId",get:function get(){return"WebGL ".concat(this.context.webGLVersion);}},{key:"clearBeforeRender",get:function get(){return gt("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender;}},{key:"useContextAlpha",get:function get(){return gt("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha;}},{key:"preserveDrawingBuffer",get:function get(){return gt("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer;}},{key:"backgroundColor",get:function get(){return gt("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color;},set:function set(t){gt("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t;}},{key:"backgroundAlpha",get:function get(){return gt("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha;},set:function set(t){gt("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t;}},{key:"powerPreference",get:function get(){return gt("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference;}},{key:"generateTexture",value:function generateTexture(t,e){return this.textureGenerator.generateTexture(t,e);}}],[{key:"test",value:function test(t){return t!=null&&t.forceCanvas?!1:Jx();}}]);return Ah;}(TE);oo.extension={type:W.Renderer,priority:1},oo.__plugins={},oo.__systems={};var Ul=oo;K.handleByMap(W.RendererPlugin,Ul.__plugins),K.handleByMap(W.RendererSystem,Ul.__systems),K.add(Ul);var Gf=/*#__PURE__*/function(_Us3){_inherits(Gf,_Us3);var _super34=_createSuper(Gf);function Gf(t,e){var _this48;_classCallCheck(this,Gf);var _ref113=e||{},i=_ref113.width,s=_ref113.height;_this48=_super34.call(this,i,s),_this48.items=[],_this48.itemDirtyIds=[];for(var n=0;n<t;n++){var o=new ft();_this48.items.push(o),_this48.itemDirtyIds.push(-2);}_this48.length=t,_this48._load=null,_this48.baseTexture=null;return _this48;}_createClass(Gf,[{key:"initFromArray",value:function initFromArray(t,e){for(var i=0;i<this.length;i++)t[i]&&(t[i].castToBaseTexture?this.addBaseTextureAt(t[i].castToBaseTexture(),i):t[i]instanceof Us?this.addResourceAt(t[i],i):this.addResourceAt(zd(t[i],e),i));}},{key:"dispose",value:function dispose(){for(var t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null;}},{key:"addResourceAt",value:function addResourceAt(t,e){if(!this.items[e])throw new Error("Index ".concat(e," is out of bounds"));return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this;}},{key:"bind",value:function bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");_get(_getPrototypeOf(Gf.prototype),"bind",this).call(this,t);for(var e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t);}},{key:"unbind",value:function unbind(t){_get(_getPrototypeOf(Gf.prototype),"unbind",this).call(this,t);for(var e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t);}},{key:"load",value:function load(){var _this49=this;if(this._load)return this._load;var t=this.items.map(function(e){return e.resource;}).filter(function(e){return e;}).map(function(e){return e.load();});return this._load=Promise.all(t).then(function(){var _this49$items$=_this49.items[0],e=_this49$items$.realWidth,i=_this49$items$.realHeight;return _this49.resize(e,i),_this49.update(),Promise.resolve(_this49);}),this._load;}}]);return Gf;}(Us);var ME=/*#__PURE__*/function(_Gf){_inherits(ME,_Gf);var _super35=_createSuper(ME);function ME(t,e){var _this50;_classCallCheck(this,ME);var _ref114=e||{},i=_ref114.width,s=_ref114.height;var n,o;Array.isArray(t)?(n=t,o=t.length):o=t,_this50=_super35.call(this,o,{width:i,height:s}),n&&_this50.initFromArray(n,e);return _this50;}_createClass(ME,[{key:"addBaseTextureAt",value:function addBaseTextureAt(t,e){if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("ArrayResource does not support RenderTexture");return this;}},{key:"bind",value:function bind(t){_get(_getPrototypeOf(ME.prototype),"bind",this).call(this,t),t.target=Ui.TEXTURE_2D_ARRAY;}},{key:"upload",value:function upload(t,e,i){var s=this.length,n=this.itemDirtyIds,o=this.items,a=t.gl;i.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,s,0,e.format,i.type,null);for(var l=0;l<s;l++){var h=o[l];n[l]<h.dirtyId&&(n[l]=h.dirtyId,h.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,l,h.resource.width,h.resource.height,1,e.format,i.type,h.resource.source));}return!0;}}]);return ME;}(Gf);var PE=/*#__PURE__*/function(_Ir2){_inherits(PE,_Ir2);var _super36=_createSuper(PE);function PE(t){_classCallCheck(this,PE);return _super36.call(this,t);}_createClass(PE,null,[{key:"test",value:function test(t){var e=globalThis.OffscreenCanvas;return e&&t instanceof e?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement;}}]);return PE;}(Ir);var $f=/*#__PURE__*/function(_Gf2){_inherits(Ks,_Gf2);var _super37=_createSuper(Ks);function Ks(t,e){var _this51;_classCallCheck(this,Ks);var _ref115=e||{},i=_ref115.width,s=_ref115.height,n=_ref115.autoLoad,o=_ref115.linkBaseTexture;if(t&&t.length!==Ks.SIDES)throw new Error("Invalid length. Got ".concat(t.length,", expected 6"));_this51=_super37.call(this,6,{width:i,height:s});for(var a=0;a<Ks.SIDES;a++)_this51.items[a].target=Ui.TEXTURE_CUBE_MAP_POSITIVE_X+a;_this51.linkBaseTexture=o!==!1,t&&_this51.initFromArray(t,e),n!==!1&&_this51.load();return _this51;}_createClass(Ks,[{key:"bind",value:function bind(t){_get(_getPrototypeOf(Ks.prototype),"bind",this).call(this,t),t.target=Ui.TEXTURE_CUBE_MAP;}},{key:"addBaseTextureAt",value:function addBaseTextureAt(t,e,i){if(i===void 0&&(i=this.linkBaseTexture),!this.items[e])throw new Error("Index ".concat(e," is out of bounds"));if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0){if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("CubeResource does not support copying of renderTexture.");}else t.target=Ui.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this;}},{key:"upload",value:function upload(t,e,i){var s=this.itemDirtyIds;for(var n=0;n<Ks.SIDES;n++){var o=this.items[n];(s[n]<o.dirtyId||i.dirtyId<e.dirtyId)&&(o.valid&&o.resource?(o.resource.upload(t,o,i),s[n]=o.dirtyId):s[n]<-1&&(t.gl.texImage2D(o.target,0,i.internalFormat,e.realWidth,e.realHeight,0,e.format,i.type,null),s[n]=-1));}return!0;}}],[{key:"test",value:function test(t){return Array.isArray(t)&&t.length===Ks.SIDES;}}]);return Ks;}(Gf);$f.SIDES=6;var OE=$f;var Ji=/*#__PURE__*/function(_Ir3){_inherits(Ji,_Ir3);var _super38=_createSuper(Ji);function Ji(t,e){var _e$crossOrigin,_e$ownsImageBitmap;var _this52;_classCallCheck(this,Ji);e=e||{};var i,s,n;typeof t=="string"?(i=Ji.EMPTY,s=t,n=!0):(i=t,s=null,n=!1),_this52=_super38.call(this,i),_this52.url=s,_this52.crossOrigin=(_e$crossOrigin=e.crossOrigin)!==null&&_e$crossOrigin!==void 0?_e$crossOrigin:!0,_this52.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,_this52.ownsImageBitmap=(_e$ownsImageBitmap=e.ownsImageBitmap)!==null&&_e$ownsImageBitmap!==void 0?_e$ownsImageBitmap:n,_this52._load=null,e.autoLoad!==!1&&_this52.load();return _this52;}_createClass(Ji,[{key:"load",value:function load(){var _this53=this;return this._load?this._load:(this._load=new Promise(/*#__PURE__*/function(){var _ref116=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(t,e){var i,s,n;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(!(_this53.url===null)){_context.next=3;break;}t(_this53);return _context.abrupt("return");case 3:_context.prev=3;_context.next=6;return j.ADAPTER.fetch(_this53.url,{mode:_this53.crossOrigin?"cors":"no-cors"});case 6:i=_context.sent;if(!_this53.destroyed){_context.next=9;break;}return _context.abrupt("return");case 9:_context.next=11;return i.blob();case 11:s=_context.sent;if(!_this53.destroyed){_context.next=14;break;}return _context.abrupt("return");case 14:_context.next=16;return createImageBitmap(s,{premultiplyAlpha:_this53.alphaMode===null||_this53.alphaMode===Ce.UNPACK?"premultiply":"none"});case 16:n=_context.sent;if(!_this53.destroyed){_context.next=20;break;}n.close();return _context.abrupt("return");case 20:_this53.source=n,_this53.update(),t(_this53);_context.next=28;break;case 23:_context.prev=23;_context.t0=_context["catch"](3);if(!_this53.destroyed){_context.next=27;break;}return _context.abrupt("return");case 27:e(_context.t0),_this53.onError.emit(_context.t0);case 28:case"end":return _context.stop();}},_callee,null,[[3,23]]);}));return function(_x4,_x5){return _ref116.apply(this,arguments);};}()),this._load);}},{key:"upload",value:function upload(t,e,i){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),_get(_getPrototypeOf(Ji.prototype),"upload",this).call(this,t,e,i)):(this.load(),!1);}},{key:"dispose",value:function dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),_get(_getPrototypeOf(Ji.prototype),"dispose",this).call(this),this._load=null;}}],[{key:"test",value:function test(t){return!!globalThis.createImageBitmap&&(typeof ImageBitmap==="undefined"?"undefined":_typeof(ImageBitmap))<"u"&&(typeof t=="string"||t instanceof ImageBitmap);}},{key:"EMPTY",get:function get(){var _Ji$_EMPTY;return Ji._EMPTY=(_Ji$_EMPTY=Ji._EMPTY)!==null&&_Ji$_EMPTY!==void 0?_Ji$_EMPTY:j.ADAPTER.createCanvas(0,0),Ji._EMPTY;}}]);return Ji;}(Ir);var kl=/*#__PURE__*/function(_Ir4){_inherits(ko,_Ir4);var _super39=_createSuper(ko);function ko(t,e){var _this54;_classCallCheck(this,ko);e=e||{},_this54=_super39.call(this,j.ADAPTER.createCanvas()),_this54._width=0,_this54._height=0,_this54.svg=t,_this54.scale=e.scale||1,_this54._overrideWidth=e.width,_this54._overrideHeight=e.height,_this54._resolve=null,_this54._crossorigin=e.crossorigin,_this54._load=null,e.autoLoad!==!1&&_this54.load();return _this54;}_createClass(ko,[{key:"load",value:function load(){var _this55=this;return this._load?this._load:(this._load=new Promise(function(t){if(_this55._resolve=function(){_this55.update(),t(_this55);},ko.SVG_XML.test(_this55.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");_this55.svg="data:image/svg+xml;base64,".concat(btoa(unescape(encodeURIComponent(_this55.svg))));}_this55._loadSvg();}),this._load);}},{key:"_loadSvg",value:function _loadSvg(){var _this56=this;var t=new Image();Ir.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=function(e){_this56._resolve&&(t.onerror=null,_this56.onError.emit(e));},t.onload=function(){if(!_this56._resolve)return;var e=t.width,i=t.height;if(!e||!i)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var s=e*_this56.scale,n=i*_this56.scale;(_this56._overrideWidth||_this56._overrideHeight)&&(s=_this56._overrideWidth||_this56._overrideHeight/i*e,n=_this56._overrideHeight||_this56._overrideWidth/e*i),s=Math.round(s),n=Math.round(n);var o=_this56.source;o.width=s,o.height=n,o._pixiId="canvas_".concat(ci()),o.getContext("2d").drawImage(t,0,0,e,i,0,0,s,n),_this56._resolve(),_this56._resolve=null;};}},{key:"dispose",value:function dispose(){_get(_getPrototypeOf(ko.prototype),"dispose",this).call(this),this._resolve=null,this._crossorigin=null;}}],[{key:"getSize",value:function getSize(t){var e=ko.SVG_SIZE.exec(t),i={};return e&&(i[e[1]]=Math.round(parseFloat(e[3])),i[e[5]]=Math.round(parseFloat(e[7]))),i;}},{key:"test",value:function test(t,e){return e==="svg"||typeof t=="string"&&t.startsWith("data:image/svg+xml")||typeof t=="string"&&ko.SVG_XML.test(t);}}]);return ko;}(Ir);kl.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,kl.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;var Gl=kl;var NE=/*#__PURE__*/function(_Ir5){_inherits(NE,_Ir5);var _super40=_createSuper(NE);function NE(t){_classCallCheck(this,NE);return _super40.call(this,t);}_createClass(NE,null,[{key:"test",value:function test(t){return!!globalThis.VideoFrame&&t instanceof globalThis.VideoFrame;}}]);return NE;}(Ir);var $l=/*#__PURE__*/function(_Ir6){_inherits(Sh,_Ir6);var _super41=_createSuper(Sh);function Sh(t,e){var _this57;_classCallCheck(this,Sh);if(e=e||{},!(t instanceof HTMLVideoElement)){var i=document.createElement("video");e.autoLoad!==!1&&i.setAttribute("preload","auto"),e.playsinline!==!1&&(i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline","")),e.muted===!0&&(i.setAttribute("muted",""),i.muted=!0),e.loop===!0&&i.setAttribute("loop",""),e.autoPlay!==!1&&i.setAttribute("autoplay",""),typeof t=="string"&&(t=[t]);var s=t[0].src||t[0];Ir.crossOrigin(i,s,e.crossorigin);for(var n=0;n<t.length;++n){var o=document.createElement("source");var _t$n=t[n],a=_t$n.src,l=_t$n.mime;if(a=a||t[n],a.startsWith("data:"))l=a.slice(5,a.indexOf(";"));else if(!a.startsWith("blob:")){var h=a.split("?").shift().toLowerCase(),u=h.slice(h.lastIndexOf(".")+1);l=l||Sh.MIME_TYPES[u]||"video/".concat(u);}o.src=a,l&&(o.type=l),i.appendChild(o);}t=i;}_this57=_super41.call(this,t),_this57.noSubImage=!0,_this57._autoUpdate=!0,_this57._isConnectedToTicker=!1,_this57._updateFPS=e.updateFPS||0,_this57._msToNextUpdate=0,_this57.autoPlay=e.autoPlay!==!1,_this57._videoFrameRequestCallback=_this57._videoFrameRequestCallback.bind(_assertThisInitialized(_this57)),_this57._videoFrameRequestCallbackHandle=null,_this57._load=null,_this57._resolve=null,_this57._reject=null,_this57._onCanPlay=_this57._onCanPlay.bind(_assertThisInitialized(_this57)),_this57._onError=_this57._onError.bind(_assertThisInitialized(_this57)),_this57._onPlayStart=_this57._onPlayStart.bind(_assertThisInitialized(_this57)),_this57._onPlayStop=_this57._onPlayStop.bind(_assertThisInitialized(_this57)),_this57._onSeeked=_this57._onSeeked.bind(_assertThisInitialized(_this57)),e.autoLoad!==!1&&_this57.load();return _this57;}_createClass(Sh,[{key:"update",value:function update(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;if(!this.destroyed){if(this._updateFPS){var e=Me.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e);}(!this._updateFPS||this._msToNextUpdate<=0)&&(_get(_getPrototypeOf(Sh.prototype),"update",this).call(this),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0);}}},{key:"_videoFrameRequestCallback",value:function _videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback);}},{key:"load",value:function load(){var _this58=this;if(this._load)return this._load;var t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise(function(e,i){_this58.valid?e(_this58):(_this58._resolve=e,_this58._reject=i,t.load());}),this._load;}},{key:"_onError",value:function _onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null);}},{key:"_isSourcePlaying",value:function _isSourcePlaying(){var t=this.source;return!t.paused&&!t.ended;}},{key:"_isSourceReady",value:function _isSourceReady(){return this.source.readyState>2;}},{key:"_onPlayStart",value:function _onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate();}},{key:"_onPlayStop",value:function _onPlayStop(){this._configureAutoUpdate();}},{key:"_onSeeked",value:function _onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0);}},{key:"_onCanPlay",value:function _onCanPlay(){var t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);var e=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!e&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play();}},{key:"dispose",value:function dispose(){this._configureAutoUpdate();var t=this.source;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),_get(_getPrototypeOf(Sh.prototype),"dispose",this).call(this);}},{key:"autoUpdate",get:function get(){return this._autoUpdate;},set:function set(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate());}},{key:"updateFPS",get:function get(){return this._updateFPS;},set:function set(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate());}},{key:"_configureAutoUpdate",value:function _configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(Me.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(Me.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(Me.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0));}}],[{key:"test",value:function test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||Sh.TYPES.includes(e);}}]);return Sh;}(Ir);$l.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],$l.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};var Hf=$l;El.push(Ji,af,PE,Hf,NE,Gl,$n,OE,ME);var ao=/*#__PURE__*/function(){function ao(){_classCallCheck(this,ao);this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1;}_createClass(ao,[{key:"isEmpty",value:function isEmpty(){return this.minX>this.maxX||this.minY>this.maxY;}},{key:"clear",value:function clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0;}},{key:"getRectangle",value:function getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?pt.EMPTY:(t=t||new pt(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t);}},{key:"addPoint",value:function addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y);}},{key:"addPointMatrix",value:function addPointMatrix(t,e){var i=t.a,s=t.b,n=t.c,o=t.d,a=t.tx,l=t.ty,h=i*e.x+n*e.y+a,u=s*e.x+o*e.y+l;this.minX=Math.min(this.minX,h),this.maxX=Math.max(this.maxX,h),this.minY=Math.min(this.minY,u),this.maxY=Math.max(this.maxY,u);}},{key:"addQuad",value:function addQuad(t){var e=this.minX,i=this.minY,s=this.maxX,n=this.maxY,o=t[0],a=t[1];e=o<e?o:e,i=a<i?a:i,s=o>s?o:s,n=a>n?a:n,o=t[2],a=t[3],e=o<e?o:e,i=a<i?a:i,s=o>s?o:s,n=a>n?a:n,o=t[4],a=t[5],e=o<e?o:e,i=a<i?a:i,s=o>s?o:s,n=a>n?a:n,o=t[6],a=t[7],e=o<e?o:e,i=a<i?a:i,s=o>s?o:s,n=a>n?a:n,this.minX=e,this.minY=i,this.maxX=s,this.maxY=n;}},{key:"addFrame",value:function addFrame(t,e,i,s,n){this.addFrameMatrix(t.worldTransform,e,i,s,n);}},{key:"addFrameMatrix",value:function addFrameMatrix(t,e,i,s,n){var o=t.a,a=t.b,l=t.c,h=t.d,u=t.tx,c=t.ty;var d=this.minX,p=this.minY,f=this.maxX,m=this.maxY,y=o*e+l*i+u,_=a*e+h*i+c;d=y<d?y:d,p=_<p?_:p,f=y>f?y:f,m=_>m?_:m,y=o*s+l*i+u,_=a*s+h*i+c,d=y<d?y:d,p=_<p?_:p,f=y>f?y:f,m=_>m?_:m,y=o*e+l*n+u,_=a*e+h*n+c,d=y<d?y:d,p=_<p?_:p,f=y>f?y:f,m=_>m?_:m,y=o*s+l*n+u,_=a*s+h*n+c,d=y<d?y:d,p=_<p?_:p,f=y>f?y:f,m=_>m?_:m,this.minX=d,this.minY=p,this.maxX=f,this.maxY=m;}},{key:"addVertexData",value:function addVertexData(t,e,i){var s=this.minX,n=this.minY,o=this.maxX,a=this.maxY;for(var l=e;l<i;l+=2){var h=t[l],u=t[l+1];s=h<s?h:s,n=u<n?u:n,o=h>o?h:o,a=u>a?u:a;}this.minX=s,this.minY=n,this.maxX=o,this.maxY=a;}},{key:"addVertices",value:function addVertices(t,e,i,s){this.addVerticesMatrix(t.worldTransform,e,i,s);}},{key:"addVerticesMatrix",value:function addVerticesMatrix(t,e,i,s){var n=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var o=arguments.length>5&&arguments[5]!==undefined?arguments[5]:n;var a=t.a,l=t.b,h=t.c,u=t.d,c=t.tx,d=t.ty;var p=this.minX,f=this.minY,m=this.maxX,y=this.maxY;for(var _=i;_<s;_+=2){var v=e[_],g=e[_+1],x=a*v+h*g+c,b=u*g+l*v+d;p=Math.min(p,x-n),m=Math.max(m,x+n),f=Math.min(f,b-o),y=Math.max(y,b+o);}this.minX=p,this.minY=f,this.maxX=m,this.maxY=y;}},{key:"addBounds",value:function addBounds(t){var e=this.minX,i=this.minY,s=this.maxX,n=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>s?t.maxX:s,this.maxY=t.maxY>n?t.maxY:n;}},{key:"addBoundsMask",value:function addBoundsMask(t,e){var i=t.minX>e.minX?t.minX:e.minX,s=t.minY>e.minY?t.minY:e.minY,n=t.maxX<e.maxX?t.maxX:e.maxX,o=t.maxY<e.maxY?t.maxY:e.maxY;if(i<=n&&s<=o){var a=this.minX,l=this.minY,h=this.maxX,u=this.maxY;this.minX=i<a?i:a,this.minY=s<l?s:l,this.maxX=n>h?n:h,this.maxY=o>u?o:u;}}},{key:"addBoundsMatrix",value:function addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY);}},{key:"addBoundsArea",value:function addBoundsArea(t,e){var i=t.minX>e.x?t.minX:e.x,s=t.minY>e.y?t.minY:e.y,n=t.maxX<e.x+e.width?t.maxX:e.x+e.width,o=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(i<=n&&s<=o){var a=this.minX,l=this.minY,h=this.maxX,u=this.maxY;this.minX=i<a?i:a,this.minY=s<l?s:l,this.maxX=n>h?n:h,this.maxY=o>u?o:u;}}},{key:"pad",value:function pad(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:t;this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e);}},{key:"addFramePad",value:function addFramePad(t,e,i,s,n,o){t-=n,e-=o,i+=n,s+=o,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>s?this.maxY:s;}}]);return ao;}();var Lt=/*#__PURE__*/function(_Ts4){_inherits(Lt,_Ts4);var _super42=_createSuper(Lt);function Lt(){var _this59;_classCallCheck(this,Lt);_this59=_super42.call(this),_this59.tempDisplayObjectParent=null,_this59.transform=new Cl(),_this59.alpha=1,_this59.visible=!0,_this59.renderable=!0,_this59.cullable=!1,_this59.cullArea=null,_this59.parent=null,_this59.worldAlpha=1,_this59._lastSortedIndex=0,_this59._zIndex=0,_this59.filterArea=null,_this59.filters=null,_this59._enabledFilters=null,_this59._bounds=new ao(),_this59._localBounds=null,_this59._boundsID=0,_this59._boundsRect=null,_this59._localBoundsRect=null,_this59._mask=null,_this59._maskRefCount=0,_this59._destroyed=!1,_this59.isSprite=!1,_this59.isMask=!1;return _this59;}_createClass(Lt,[{key:"destroyed",get:function get(){return this._destroyed;}},{key:"_recursivePostUpdateTransform",value:function _recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform);}},{key:"updateTransform",value:function updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;}},{key:"getBounds",value:function getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new pt()),e=this._boundsRect),this._bounds.getRectangle(e);}},{key:"getLocalBounds",value:function getLocalBounds(t){var _ref117;t||(this._localBoundsRect||(this._localBoundsRect=new pt()),t=this._localBoundsRect),this._localBounds||(this._localBounds=new ao());var e=this.transform,i=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=(_ref117=i==null?void 0:i.worldAlpha)!==null&&_ref117!==void 0?_ref117:1,this.transform=this._tempDisplayObjectParent.transform;var s=this._bounds,n=this._boundsID;this._bounds=this._localBounds;var o=this.getBounds(!1,t);return this.parent=i,this.transform=e,this._bounds=s,this._bounds.updateID+=this._boundsID-n,o;}},{key:"toGlobal",value:function toGlobal(t,e){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:!1;return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e);}},{key:"toLocal",value:function toLocal(t,e,i,s){return e&&(t=e.toGlobal(t,i,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,i);}},{key:"setParent",value:function setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t;}},{key:"removeFromParent",value:function removeFromParent(){var t;(t=this.parent)==null||t.removeChild(this);}},{key:"setTransform",value:function setTransform(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var n=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var o=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var a=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var l=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;var h=arguments.length>8&&arguments[8]!==undefined?arguments[8]:0;return this.position.x=t,this.position.y=e,this.scale.x=i||1,this.scale.y=s||1,this.rotation=n,this.skew.x=o,this.skew.y=a,this.pivot.x=l,this.pivot.y=h,this;}},{key:"destroy",value:function destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners();}},{key:"_tempDisplayObjectParent",get:function get(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new DE()),this.tempDisplayObjectParent;}},{key:"enableTempParent",value:function enableTempParent(){var t=this.parent;return this.parent=this._tempDisplayObjectParent,t;}},{key:"disableTempParent",value:function disableTempParent(t){this.parent=t;}},{key:"x",get:function get(){return this.position.x;},set:function set(t){this.transform.position.x=t;}},{key:"y",get:function get(){return this.position.y;},set:function set(t){this.transform.position.y=t;}},{key:"worldTransform",get:function get(){return this.transform.worldTransform;}},{key:"localTransform",get:function get(){return this.transform.localTransform;}},{key:"position",get:function get(){return this.transform.position;},set:function set(t){this.transform.position.copyFrom(t);}},{key:"scale",get:function get(){return this.transform.scale;},set:function set(t){this.transform.scale.copyFrom(t);}},{key:"pivot",get:function get(){return this.transform.pivot;},set:function set(t){this.transform.pivot.copyFrom(t);}},{key:"skew",get:function get(){return this.transform.skew;},set:function set(t){this.transform.skew.copyFrom(t);}},{key:"rotation",get:function get(){return this.transform.rotation;},set:function set(t){this.transform.rotation=t;}},{key:"angle",get:function get(){return this.transform.rotation*Cb;},set:function set(t){this.transform.rotation=t*Ib;}},{key:"zIndex",get:function get(){return this._zIndex;},set:function set(t){this._zIndex!==t&&(this._zIndex=t,this.parent&&(this.parent.sortDirty=!0));}},{key:"worldVisible",get:function get(){var t=this;do{if(!t.visible)return!1;t=t.parent;}while(t);return!0;}},{key:"mask",get:function get(){return this._mask;},set:function set(t){if(this._mask!==t){if(this._mask){var e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,e._maskRefCount===0&&(e.renderable=!0,e.isMask=!1));}if(this._mask=t,this._mask){var _e10=this._mask.isMaskData?this._mask.maskObject:this._mask;_e10&&(_e10._maskRefCount===0&&(_e10.renderable=!1,_e10.isMask=!0),_e10._maskRefCount++);}}}}],[{key:"mixin",value:function mixin(t){var e=Object.keys(t);for(var i=0;i<e.length;++i){var s=e[i];Object.defineProperty(Lt.prototype,s,Object.getOwnPropertyDescriptor(t,s));}}}]);return Lt;}(Ts);var DE=/*#__PURE__*/function(_Lt){_inherits(DE,_Lt);var _super43=_createSuper(DE);function DE(){var _this60;_classCallCheck(this,DE);_this60=_super43.apply(this,arguments),_this60.sortDirty=null;return _this60;}return _createClass(DE);}(Lt);Lt.prototype.displayObjectUpdateTransform=Lt.prototype.updateTransform;var LE=new Rt();function BE(r,t){return r.zIndex===t.zIndex?r._lastSortedIndex-t._lastSortedIndex:r.zIndex-t.zIndex;}var Vf=/*#__PURE__*/function(_Lt2){_inherits(Ch,_Lt2);var _super44=_createSuper(Ch);function Ch(){var _this61;_classCallCheck(this,Ch);_this61=_super44.call(this),_this61.children=[],_this61.sortableChildren=Ch.defaultSortableChildren,_this61.sortDirty=!1;return _this61;}_createClass(Ch,[{key:"onChildrenChange",value:function onChildrenChange(t){}},{key:"addChild",value:function addChild(){if(arguments.length>1)for(var e=0;e<arguments.length;e++)this.addChild(e<0||arguments.length<=e?undefined:arguments[e]);else{var _e11=arguments.length<=0?undefined:arguments[0];_e11.parent&&_e11.parent.removeChild(_e11),_e11.parent=this,this.sortDirty=!0,_e11.transform._parentID=-1,this.children.push(_e11),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",_e11,this,this.children.length-1),_e11.emit("added",this);}return arguments.length<=0?undefined:arguments[0];}},{key:"addChildAt",value:function addChildAt(t,e){if(e<0||e>this.children.length)throw new Error("".concat(t,"addChildAt: The index ").concat(e," supplied is out of bounds ").concat(this.children.length));return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t;}},{key:"swapChildren",value:function swapChildren(t,e){if(t===e)return;var i=this.getChildIndex(t),s=this.getChildIndex(e);this.children[i]=e,this.children[s]=t,this.onChildrenChange(i<s?i:s);}},{key:"getChildIndex",value:function getChildIndex(t){var e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return e;}},{key:"setChildIndex",value:function setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error("The index ".concat(e," supplied is out of bounds ").concat(this.children.length));var i=this.getChildIndex(t);Ki(this.children,i,1),this.children.splice(e,0,t),this.onChildrenChange(e);}},{key:"getChildAt",value:function getChildAt(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Index (".concat(t,") does not exist."));return this.children[t];}},{key:"removeChild",value:function removeChild(){if(arguments.length>1)for(var e=0;e<arguments.length;e++)this.removeChild(e<0||arguments.length<=e?undefined:arguments[e]);else{var _e12=arguments.length<=0?undefined:arguments[0],i=this.children.indexOf(_e12);if(i===-1)return null;_e12.parent=null,_e12.transform._parentID=-1,Ki(this.children,i,1),this._boundsID++,this.onChildrenChange(i),_e12.emit("removed",this),this.emit("childRemoved",_e12,this,i);}return arguments.length<=0?undefined:arguments[0];}},{key:"removeChildAt",value:function removeChildAt(t){var e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,Ki(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e;}},{key:"removeChildren",value:function removeChildren(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.children.length;var i=t,s=e,n=s-i;var o;if(n>0&&n<=s){o=this.children.splice(i,n);for(var a=0;a<o.length;++a)o[a].parent=null,o[a].transform&&(o[a].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(var _a8=0;_a8<o.length;++_a8)o[_a8].emit("removed",this),this.emit("childRemoved",o[_a8],this,_a8);return o;}else if(n===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.");}},{key:"sortChildren",value:function sortChildren(){var t=!1;for(var e=0,i=this.children.length;e<i;++e){var s=this.children[e];s._lastSortedIndex=e,!t&&s.zIndex!==0&&(t=!0);}t&&this.children.length>1&&this.children.sort(BE),this.sortDirty=!1;}},{key:"updateTransform",value:function updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var t=0,e=this.children.length;t<e;++t){var i=this.children[t];i.visible&&i.updateTransform();}}},{key:"calculateBounds",value:function calculateBounds(){this._bounds.clear(),this._calculateBounds();for(var t=0;t<this.children.length;t++){var e=this.children[t];if(!(!e.visible||!e.renderable))if(e.calculateBounds(),e._mask){var i=e._mask.isMaskData?e._mask.maskObject:e._mask;i?(i.calculateBounds(),this._bounds.addBoundsMask(e._bounds,i._bounds)):this._bounds.addBounds(e._bounds);}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds);}this._bounds.updateID=this._boundsID;}},{key:"getLocalBounds",value:function getLocalBounds(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!1;var i=_get(_getPrototypeOf(Ch.prototype),"getLocalBounds",this).call(this,t);if(!e)for(var s=0,n=this.children.length;s<n;++s){var o=this.children[s];o.visible&&o.updateTransform();}return i;}},{key:"_calculateBounds",value:function _calculateBounds(){}},{key:"_renderWithCulling",value:function _renderWithCulling(t){var e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;var i,s;this.cullArea?(i=this.cullArea,s=this.worldTransform):this._render!==Ch.prototype._render&&(i=this.getBounds(!0));var n=t.projection.transform;if(n&&(s?(s=LE.copyFrom(s),s.prepend(n)):s=n),i&&e.intersects(i,s))this._render(t);else if(this.cullArea)return;for(var o=0,a=this.children.length;o<a;++o){var l=this.children[o],h=l.cullable;l.cullable=h||!this.cullArea,l.render(t),l.cullable=h;}}},{key:"render",value:function render(t){var e;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(e=this.filters)!=null&&e.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(var i=0,s=this.children.length;i<s;++i)this.children[i].render(t);}}},{key:"renderAdvanced",value:function renderAdvanced(t){var n,o,a;var e=this.filters,i=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var l=0;l<e.length;l++)e[l].enabled&&this._enabledFilters.push(e[l]);}var s=e&&((n=this._enabledFilters)==null?void 0:n.length)||i&&(!i.isMaskData||i.enabled&&(i.autoDetect||i.type!==Qt.NONE));if(s&&t.batch.flush(),e&&(o=this._enabledFilters)!=null&&o.length&&t.filter.push(this,this._enabledFilters),i&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(var _l10=0,h=this.children.length;_l10<h;++_l10)this.children[_l10].render(t);}s&&t.batch.flush(),i&&t.mask.pop(this),e&&(a=this._enabledFilters)!=null&&a.length&&t.filter.pop();}},{key:"_render",value:function _render(t){}},{key:"destroy",value:function destroy(t){_get(_getPrototypeOf(Ch.prototype),"destroy",this).call(this),this.sortDirty=!1;var e=typeof t=="boolean"?t:t==null?void 0:t.children,i=this.removeChildren(0,this.children.length);if(e)for(var s=0;s<i.length;++s)i[s].destroy(t);}},{key:"width",get:function get(){return this.scale.x*this.getLocalBounds().width;},set:function set(t){var e=this.getLocalBounds().width;e!==0?this.scale.x=t/e:this.scale.x=1,this._width=t;}},{key:"height",get:function get(){return this.scale.y*this.getLocalBounds().height;},set:function set(t){var e=this.getLocalBounds().height;e!==0?this.scale.y=t/e:this.scale.y=1,this._height=t;}}]);return Ch;}(Lt);Vf.defaultSortableChildren=!1;var Ye=Vf;Ye.prototype.containerUpdateTransform=Ye.prototype.updateTransform,Object.defineProperties(j,{SORTABLE_CHILDREN:{get:function get(){return Ye.defaultSortableChildren;},set:function set(r){gt("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Ye.defaultSortableChildren=r;}}});var Vs=new bt(),FE=new Uint16Array([0,1,2,0,2,3]);var ts=/*#__PURE__*/function(_Ye){_inherits(ts,_Ye);var _super45=_createSuper(ts);function ts(t){var _this62;_classCallCheck(this,ts);_this62=_super45.call(this),_this62._anchor=new Sr(_this62._onAnchorUpdate,_assertThisInitialized(_this62),t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),_this62._texture=null,_this62._width=0,_this62._height=0,_this62._tintColor=new wt(16777215),_this62._tintRGB=null,_this62.tint=16777215,_this62.blendMode=at.NORMAL,_this62._cachedTint=16777215,_this62.uvs=null,_this62.texture=t||Z.EMPTY,_this62.vertexData=new Float32Array(8),_this62.vertexTrimmedData=null,_this62._transformID=-1,_this62._textureID=-1,_this62._transformTrimmedID=-1,_this62._textureTrimmedID=-1,_this62.indices=FE,_this62.pluginName="batch",_this62.isSprite=!0,_this62._roundPixels=j.ROUND_PIXELS;return _this62;}_createClass(ts,[{key:"_onTextureUpdate",value:function _onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Fr(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Fr(this.scale.y)*this._height/this._texture.orig.height);}},{key:"_onAnchorUpdate",value:function _onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1;}},{key:"calculateVertices",value:function calculateVertices(){var t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;var e=this.transform.worldTransform,i=e.a,s=e.b,n=e.c,o=e.d,a=e.tx,l=e.ty,h=this.vertexData,u=t.trim,c=t.orig,d=this._anchor;var p=0,f=0,m=0,y=0;if(u?(f=u.x-d._x*c.width,p=f+u.width,y=u.y-d._y*c.height,m=y+u.height):(f=-d._x*c.width,p=f+c.width,y=-d._y*c.height,m=y+c.height),h[0]=i*f+n*y+a,h[1]=o*y+s*f+l,h[2]=i*p+n*y+a,h[3]=o*y+s*p+l,h[4]=i*p+n*m+a,h[5]=o*m+s*p+l,h[6]=i*f+n*m+a,h[7]=o*m+s*f+l,this._roundPixels){var _=j.RESOLUTION;for(var v=0;v<h.length;++v)h[v]=Math.round(h[v]*_)/_;}}},{key:"calculateTrimmedVertices",value:function calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var t=this._texture,e=this.vertexTrimmedData,i=t.orig,s=this._anchor,n=this.transform.worldTransform,o=n.a,a=n.b,l=n.c,h=n.d,u=n.tx,c=n.ty,d=-s._x*i.width,p=d+i.width,f=-s._y*i.height,m=f+i.height;if(e[0]=o*d+l*f+u,e[1]=h*f+a*d+c,e[2]=o*p+l*f+u,e[3]=h*f+a*p+c,e[4]=o*p+l*m+u,e[5]=h*m+a*p+c,e[6]=o*d+l*m+u,e[7]=h*m+a*d+c,this._roundPixels){var y=j.RESOLUTION;for(var _=0;_<e.length;++_)e[_]=Math.round(e[_]*y)/y;}}},{key:"_render",value:function _render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this);}},{key:"_calculateBounds",value:function _calculateBounds(){var t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData));}},{key:"getLocalBounds",value:function getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new ao()),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new pt()),t=this._localBoundsRect),this._localBounds.getRectangle(t)):_get(_getPrototypeOf(ts.prototype),"getLocalBounds",this).call(this,t);}},{key:"containsPoint",value:function containsPoint(t){this.worldTransform.applyInverse(t,Vs);var e=this._texture.orig.width,i=this._texture.orig.height,s=-e*this.anchor.x;var n=0;return Vs.x>=s&&Vs.x<s+e&&(n=-i*this.anchor.y,Vs.y>=n&&Vs.y<n+i);}},{key:"destroy",value:function destroy(t){if(_get(_getPrototypeOf(ts.prototype),"destroy",this).call(this,t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t==null?void 0:t.texture){var e=typeof t=="boolean"?t:t==null?void 0:t.baseTexture;this._texture.destroy(!!e);}this._texture=null;}},{key:"roundPixels",get:function get(){return this._roundPixels;},set:function set(t){this._roundPixels!==t&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=t;}},{key:"width",get:function get(){return Math.abs(this.scale.x)*this._texture.orig.width;},set:function set(t){var e=Fr(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t;}},{key:"height",get:function get(){return Math.abs(this.scale.y)*this._texture.orig.height;},set:function set(t){var e=Fr(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t;}},{key:"anchor",get:function get(){return this._anchor;},set:function set(t){this._anchor.copyFrom(t);}},{key:"tint",get:function get(){return this._tintColor.value;},set:function set(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber();}},{key:"tintValue",get:function get(){return this._tintColor.toNumber();}},{key:"texture",get:function get(){return this._texture;},set:function set(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Z.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)));}}],[{key:"from",value:function from(t,e){var i=t instanceof Z?t:Z.from(t,e);return new ts(i);}}]);return ts;}(Ye);var Xf=new Rt();Lt.prototype._cacheAsBitmap=!1,Lt.prototype._cacheData=null,Lt.prototype._cacheAsBitmapResolution=null,Lt.prototype._cacheAsBitmapMultisample=null;var UE=/*#__PURE__*/_createClass(function UE(){_classCallCheck(this,UE);this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null;});Object.defineProperties(Lt.prototype,{cacheAsBitmapResolution:{get:function get(){return this._cacheAsBitmapResolution;},set:function set(r){r!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=r,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0));}},cacheAsBitmapMultisample:{get:function get(){return this._cacheAsBitmapMultisample;},set:function set(r){r!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=r,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0));}},cacheAsBitmap:{get:function get(){return this._cacheAsBitmap;},set:function set(r){if(this._cacheAsBitmap===r)return;this._cacheAsBitmap=r;var t;r?(this._cacheData||(this._cacheData=new UE()),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea);}}}),Lt.prototype._renderCached=function(r){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(r),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(r));},Lt.prototype._initCachedDisplayObject=function(r){var _this$cacheAsBitmapMu;var d,p;if((d=this._cacheData)!=null&&d.sprite)return;var t=this.alpha;this.alpha=1,r.batch.flush();var e=this.getLocalBounds(new pt(),!0);if((p=this.filters)!=null&&p.length){var f=this.filters[0].padding;e.pad(f);}var i=this.cacheAsBitmapResolution||r.resolution;e.ceil(i),e.width=Math.max(e.width,1/i),e.height=Math.max(e.height,1/i);var s=r.renderTexture.current,n=r.renderTexture.sourceFrame.clone(),o=r.renderTexture.destinationFrame.clone(),a=r.projection.transform,l=_i.create({width:e.width,height:e.height,resolution:i,multisample:(_this$cacheAsBitmapMu=this.cacheAsBitmapMultisample)!==null&&_this$cacheAsBitmapMu!==void 0?_this$cacheAsBitmapMu:r.multisample}),h="cacheAsBitmap_".concat(ci());this._cacheData.textureCacheId=h,ft.addToCache(l.baseTexture,h),Z.addToCache(l,h);var u=this.transform.localTransform.copyTo(Xf).invert().translate(-e.x,-e.y);this.render=this._cacheData.originalRender,r.render(this,{renderTexture:l,clear:!0,transform:u,skipUpdateTransform:!1}),r.framebuffer.blit(),r.projection.transform=a,r.renderTexture.bind(s,n,o),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;var c=new ts(l);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-(e.x/e.width),c.anchor.y=-(e.y/e.height),c.alpha=t,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=c.containsPoint.bind(c);},Lt.prototype._renderCachedCanvas=function(r){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(r),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(r));},Lt.prototype._initCachedDisplayObjectCanvas=function(r){var u;if((u=this._cacheData)!=null&&u.sprite)return;var t=this.getLocalBounds(new pt(),!0),e=this.alpha;this.alpha=1;var i=r.canvasContext.activeContext,s=r._projTransform,n=this.cacheAsBitmapResolution||r.resolution;t.ceil(n),t.width=Math.max(t.width,1/n),t.height=Math.max(t.height,1/n);var o=_i.create({width:t.width,height:t.height,resolution:n}),a="cacheAsBitmap_".concat(ci());this._cacheData.textureCacheId=a,ft.addToCache(o.baseTexture,a),Z.addToCache(o,a);var l=Xf;this.transform.localTransform.copyTo(l),l.invert(),l.tx-=t.x,l.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,r.render(this,{renderTexture:o,clear:!0,transform:l,skipUpdateTransform:!1}),r.canvasContext.activeContext=i,r._projTransform=s,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;var h=new ts(o);h.transform.worldTransform=this.transform.worldTransform,h.anchor.x=-(t.x/t.width),h.anchor.y=-(t.y/t.height),h.alpha=e,h._bounds=this._bounds,this._cacheData.sprite=h,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=r._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=h.containsPoint.bind(h);},Lt.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID;},Lt.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null);},Lt.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,ft.removeFromCache(this._cacheData.textureCacheId),Z.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null;},Lt.prototype._cacheAsBitmapDestroy=function(r){this.cacheAsBitmap=!1,this.destroy(r);},Lt.prototype.name=null,Ye.prototype.getChildByName=function(r,t){for(var e=0,i=this.children.length;e<i;e++)if(this.children[e].name===r)return this.children[e];if(t)for(var _e13=0,_i30=this.children.length;_e13<_i30;_e13++){var s=this.children[_e13];if(!s.getChildByName)continue;var n=s.getChildByName(r,!0);if(n)return n;}return null;},Lt.prototype.getGlobalPosition=function(){var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new bt();var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!1;return this.parent?this.parent.toGlobal(this.position,r,t):(r.x=this.position.x,r.y=this.position.y),r;};var kE="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n";var GE=/*#__PURE__*/function(_ve2){_inherits(GE,_ve2);var _super46=_createSuper(GE);function GE(){var _this63;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;_classCallCheck(this,GE);_this63=_super46.call(this,IE,kE,{uAlpha:1}),_this63.alpha=t;return _this63;}_createClass(GE,[{key:"alpha",get:function get(){return this.uniforms.uAlpha;},set:function set(t){this.uniforms.uAlpha=t;}}]);return GE;}(ve);var $E={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},HE=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");function VE(r){var t=$E[r],e=t.length;var i=HE,s="";var n="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";var o;for(var a=0;a<r;a++){var l=n.replace("%index%",a.toString());o=a,a>=e&&(o=r-a-1),l=l.replace("%value%",t[o].toString()),s+=l,s+="\n";}return i=i.replace("%blur%",s),i=i.replace("%size%",r.toString()),i;}var XE="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }";function zE(r,t){var e=Math.ceil(r/2);var i=XE,s="",n;t?n="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":n="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(var o=0;o<r;o++){var a=n.replace("%index%",o.toString());a=a.replace("%sampleIndex%","".concat(o-(e-1),".0")),s+=a,s+="\n";}return i=i.replace("%blur%",s),i=i.replace("%size%",r.toString()),i;}var Hl=/*#__PURE__*/function(_ve3){_inherits(Hl,_ve3);var _super47=_createSuper(Hl);function Hl(t){var _this64;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:8;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:4;var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:ve.defaultResolution;var n=arguments.length>4&&arguments[4]!==undefined?arguments[4]:5;_classCallCheck(this,Hl);var o=zE(n,t),a=VE(n);_this64=_super47.call(this,o,a),_this64.horizontal=t,_this64.resolution=s,_this64._quality=0,_this64.quality=i,_this64.blur=e;return _this64;}_createClass(Hl,[{key:"apply",value:function apply(t,e,i,s){if(i?this.horizontal?this.uniforms.strength=1/i.width*(i.width/e.width):this.uniforms.strength=1/i.height*(i.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,e,i,s);else{var n=t.getFilterTexture(),o=t.renderer;var a=e,l=n;this.state.blend=!1,t.applyFilter(this,a,l,sr.CLEAR);for(var h=1;h<this.passes-1;h++){t.bindAndClear(a,sr.BLIT),this.uniforms.uSampler=l;var u=l;l=a,a=u,o.shader.bind(this),o.geometry.draw(5);}this.state.blend=!0,t.applyFilter(this,l,i,s),t.returnFilterTexture(n);}}},{key:"blur",get:function get(){return this.strength;},set:function set(t){this.padding=1+Math.abs(t)*2,this.strength=t;}},{key:"quality",get:function get(){return this._quality;},set:function set(t){this._quality=t,this.passes=t;}}]);return Hl;}(ve);var WE=/*#__PURE__*/function(_ve4){_inherits(WE,_ve4);var _super48=_createSuper(WE);function WE(){var _this65;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:8;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:4;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:ve.defaultResolution;var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:5;_classCallCheck(this,WE);_this65=_super48.call(this),_this65._repeatEdgePixels=!1,_this65.blurXFilter=new Hl(!0,t,e,i,s),_this65.blurYFilter=new Hl(!1,t,e,i,s),_this65.resolution=i,_this65.quality=e,_this65.blur=t,_this65.repeatEdgePixels=!1;return _this65;}_createClass(WE,[{key:"apply",value:function apply(t,e,i,s){var n=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(n&&o){var a=t.getFilterTexture();this.blurXFilter.apply(t,e,a,sr.CLEAR),this.blurYFilter.apply(t,a,i,s),t.returnFilterTexture(a);}else o?this.blurYFilter.apply(t,e,i,s):this.blurXFilter.apply(t,e,i,s);}},{key:"updatePadding",value:function updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2;}},{key:"blur",get:function get(){return this.blurXFilter.blur;},set:function set(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding();}},{key:"quality",get:function get(){return this.blurXFilter.quality;},set:function set(t){this.blurXFilter.quality=this.blurYFilter.quality=t;}},{key:"blurX",get:function get(){return this.blurXFilter.blur;},set:function set(t){this.blurXFilter.blur=t,this.updatePadding();}},{key:"blurY",get:function get(){return this.blurYFilter.blur;},set:function set(t){this.blurYFilter.blur=t,this.updatePadding();}},{key:"blendMode",get:function get(){return this.blurYFilter.blendMode;},set:function set(t){this.blurYFilter.blendMode=t;}},{key:"repeatEdgePixels",get:function get(){return this._repeatEdgePixels;},set:function set(t){this._repeatEdgePixels=t,this.updatePadding();}}]);return WE;}(ve);var YE="varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n";var Vl=/*#__PURE__*/function(_ve5){_inherits(Vl,_ve5);var _super49=_createSuper(Vl);function Vl(){var _this66;_classCallCheck(this,Vl);var t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};_this66=_super49.call(this,Bf,YE,t),_this66.alpha=1;return _this66;}_createClass(Vl,[{key:"_loadMatrix",value:function _loadMatrix(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!1;var i=t;e&&(this._multiply(i,this.uniforms.m,t),i=this._colorMatrix(i)),this.uniforms.m=i;}},{key:"_multiply",value:function _multiply(t,e,i){return t[0]=e[0]*i[0]+e[1]*i[5]+e[2]*i[10]+e[3]*i[15],t[1]=e[0]*i[1]+e[1]*i[6]+e[2]*i[11]+e[3]*i[16],t[2]=e[0]*i[2]+e[1]*i[7]+e[2]*i[12]+e[3]*i[17],t[3]=e[0]*i[3]+e[1]*i[8]+e[2]*i[13]+e[3]*i[18],t[4]=e[0]*i[4]+e[1]*i[9]+e[2]*i[14]+e[3]*i[19]+e[4],t[5]=e[5]*i[0]+e[6]*i[5]+e[7]*i[10]+e[8]*i[15],t[6]=e[5]*i[1]+e[6]*i[6]+e[7]*i[11]+e[8]*i[16],t[7]=e[5]*i[2]+e[6]*i[7]+e[7]*i[12]+e[8]*i[17],t[8]=e[5]*i[3]+e[6]*i[8]+e[7]*i[13]+e[8]*i[18],t[9]=e[5]*i[4]+e[6]*i[9]+e[7]*i[14]+e[8]*i[19]+e[9],t[10]=e[10]*i[0]+e[11]*i[5]+e[12]*i[10]+e[13]*i[15],t[11]=e[10]*i[1]+e[11]*i[6]+e[12]*i[11]+e[13]*i[16],t[12]=e[10]*i[2]+e[11]*i[7]+e[12]*i[12]+e[13]*i[17],t[13]=e[10]*i[3]+e[11]*i[8]+e[12]*i[13]+e[13]*i[18],t[14]=e[10]*i[4]+e[11]*i[9]+e[12]*i[14]+e[13]*i[19]+e[14],t[15]=e[15]*i[0]+e[16]*i[5]+e[17]*i[10]+e[18]*i[15],t[16]=e[15]*i[1]+e[16]*i[6]+e[17]*i[11]+e[18]*i[16],t[17]=e[15]*i[2]+e[16]*i[7]+e[17]*i[12]+e[18]*i[17],t[18]=e[15]*i[3]+e[16]*i[8]+e[17]*i[13]+e[18]*i[18],t[19]=e[15]*i[4]+e[16]*i[9]+e[17]*i[14]+e[18]*i[19]+e[19],t;}},{key:"_colorMatrix",value:function _colorMatrix(t){var e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e;}},{key:"brightness",value:function brightness(t,e){var i=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(i,e);}},{key:"tint",value:function tint(t,e){var _wt$shared$setValue$t=wt.shared.setValue(t).toArray(),_wt$shared$setValue$t2=_slicedToArray(_wt$shared$setValue$t,3),i=_wt$shared$setValue$t2[0],s=_wt$shared$setValue$t2[1],n=_wt$shared$setValue$t2[2],o=[i,0,0,0,0,0,s,0,0,0,0,0,n,0,0,0,0,0,1,0];this._loadMatrix(o,e);}},{key:"greyscale",value:function greyscale(t,e){var i=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(i,e);}},{key:"blackAndWhite",value:function blackAndWhite(t){var e=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(e,t);}},{key:"hue",value:function hue(t,e){t=(t||0)/180*Math.PI;var i=Math.cos(t),s=Math.sin(t),n=Math.sqrt,o=1/3,a=n(o),l=i+(1-i)*o,h=o*(1-i)-a*s,u=o*(1-i)+a*s,c=o*(1-i)+a*s,d=i+o*(1-i),p=o*(1-i)-a*s,f=o*(1-i)-a*s,m=o*(1-i)+a*s,y=i+o*(1-i),_=[l,h,u,0,0,c,d,p,0,0,f,m,y,0,0,0,0,0,1,0];this._loadMatrix(_,e);}},{key:"contrast",value:function contrast(t,e){var i=(t||0)+1,s=-.5*(i-1),n=[i,0,0,0,s,0,i,0,0,s,0,0,i,0,s,0,0,0,1,0];this._loadMatrix(n,e);}},{key:"saturate",value:function saturate(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var e=arguments.length>1?arguments[1]:undefined;var i=t*2/3+1,s=(i-1)*-.5,n=[i,s,s,0,0,s,i,s,0,0,s,s,i,0,0,0,0,0,1,0];this._loadMatrix(n,e);}},{key:"desaturate",value:function desaturate(){this.saturate(-1);}},{key:"negative",value:function negative(t){var e=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(e,t);}},{key:"sepia",value:function sepia(t){var e=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(e,t);}},{key:"technicolor",value:function technicolor(t){var e=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(e,t);}},{key:"polaroid",value:function polaroid(t){var e=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(e,t);}},{key:"toBGR",value:function toBGR(t){var e=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(e,t);}},{key:"kodachrome",value:function kodachrome(t){var e=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(e,t);}},{key:"browni",value:function browni(t){var e=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(e,t);}},{key:"vintage",value:function vintage(t){var e=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(e,t);}},{key:"colorTone",value:function colorTone(t,e,i,s,n){t=t||.2,e=e||.15,i=i||16770432,s=s||3375104;var o=wt.shared,_o$setValue$toArray=o.setValue(i).toArray(),_o$setValue$toArray2=_slicedToArray(_o$setValue$toArray,3),a=_o$setValue$toArray2[0],l=_o$setValue$toArray2[1],h=_o$setValue$toArray2[2],_o$setValue$toArray3=o.setValue(s).toArray(),_o$setValue$toArray4=_slicedToArray(_o$setValue$toArray3,3),u=_o$setValue$toArray4[0],c=_o$setValue$toArray4[1],d=_o$setValue$toArray4[2],p=[.3,.59,.11,0,0,a,l,h,t,0,u,c,d,e,0,a-u,l-c,h-d,0,0];this._loadMatrix(p,n);}},{key:"night",value:function night(t,e){t=t||.1;var i=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(i,e);}},{key:"predator",value:function predator(t,e){var i=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(i,e);}},{key:"lsd",value:function lsd(t){var e=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(e,t);}},{key:"reset",value:function reset(){var t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1);}},{key:"matrix",get:function get(){return this.uniforms.m;},set:function set(t){this.uniforms.m=t;}},{key:"alpha",get:function get(){return this.uniforms.uAlpha;},set:function set(t){this.uniforms.uAlpha=t;}}]);return Vl;}(ve);Vl.prototype.grayscale=Vl.prototype.greyscale;var jE="varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",qE="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n";var KE=/*#__PURE__*/function(_ve6){_inherits(KE,_ve6);var _super50=_createSuper(KE);function KE(t,e){var _this67;_classCallCheck(this,KE);var i=new Rt();t.renderable=!1,_this67=_super50.call(this,qE,jE,{mapSampler:t._texture,filterMatrix:i,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),_this67.maskSprite=t,_this67.maskMatrix=i,e==null&&(e=20),_this67.scale=new bt(e,e);return _this67;}_createClass(KE,[{key:"apply",value:function apply(t,e,i,s){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;var n=this.maskSprite.worldTransform,o=Math.sqrt(n.a*n.a+n.b*n.b),a=Math.sqrt(n.c*n.c+n.d*n.d);o!==0&&a!==0&&(this.uniforms.rotation[0]=n.a/o,this.uniforms.rotation[1]=n.b/o,this.uniforms.rotation[2]=n.c/a,this.uniforms.rotation[3]=n.d/a),t.applyFilter(this,e,i,s);}},{key:"map",get:function get(){return this.uniforms.mapSampler;},set:function set(t){this.uniforms.mapSampler=t;}}]);return KE;}(ve);var ZE="varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it's\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n",QE="\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n";var JE=/*#__PURE__*/function(_ve7){_inherits(JE,_ve7);var _super51=_createSuper(JE);function JE(){_classCallCheck(this,JE);return _super51.call(this,QE,ZE);}return _createClass(JE);}(ve);var tT="precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n";var eT=/*#__PURE__*/function(_ve8){_inherits(eT,_ve8);var _super52=_createSuper(eT);function eT(){var _this68;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:.5;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Math.random();_classCallCheck(this,eT);_this68=_super52.call(this,Bf,tT,{uNoise:0,uSeed:0}),_this68.noise=t,_this68.seed=e;return _this68;}_createClass(eT,[{key:"noise",get:function get(){return this.uniforms.uNoise;},set:function set(t){this.uniforms.uNoise=t;}},{key:"seed",get:function get(){return this.uniforms.uSeed;},set:function set(t){this.uniforms.uSeed=t;}}]);return eT;}(ve);var zf={AlphaFilter:GE,BlurFilter:WE,BlurFilterPass:Hl,ColorMatrixFilter:Vl,DisplacementFilter:KE,FXAAFilter:JE,NoiseFilter:eT};Object.entries(zf).forEach(function(_ref118){var _ref119=_slicedToArray(_ref118,2),r=_ref119[0],t=_ref119[1];Object.defineProperty(zf,r,{get:function get(){return gt("7.1.0","filters.".concat(r," has moved to ").concat(r)),t;}});});var rT=/*#__PURE__*/function(){function rT(){_classCallCheck(this,rT);this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0;}_createClass(rT,[{key:"init",value:function init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0;}},{key:"pauseUpdate",get:function get(){return this._pauseUpdate;},set:function set(t){this._pauseUpdate=t;}},{key:"addTickerListener",value:function addTickerListener(){this.tickerAdded||!this.domElement||(Me.system.add(this.tickerUpdate,this,bi.INTERACTION),this.tickerAdded=!0);}},{key:"removeTickerListener",value:function removeTickerListener(){this.tickerAdded&&(Me.system.remove(this.tickerUpdate,this),this.tickerAdded=!1);}},{key:"pointerMoved",value:function pointerMoved(){this._didMove=!0;}},{key:"update",value:function update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return;}var t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&t.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}));}},{key:"tickerUpdate",value:function tickerUpdate(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update());}}]);return rT;}();var Gr=new rT();var Xs=/*#__PURE__*/function(){function Xs(t){_classCallCheck(this,Xs);this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=Xs.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new bt(),this.page=new bt(),this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t;}_createClass(Xs,[{key:"layerX",get:function get(){return this.layer.x;}},{key:"layerY",get:function get(){return this.layer.y;}},{key:"pageX",get:function get(){return this.page.x;}},{key:"pageY",get:function get(){return this.page.y;}},{key:"data",get:function get(){return this;}},{key:"composedPath",value:function composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path;}},{key:"initEvent",value:function initEvent(t,e,i){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.");}},{key:"initUIEvent",value:function initUIEvent(t,e,i,s,n){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.");}},{key:"preventDefault",value:function preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0;}},{key:"stopImmediatePropagation",value:function stopImmediatePropagation(){this.propagationImmediatelyStopped=!0;}},{key:"stopPropagation",value:function stopPropagation(){this.propagationStopped=!0;}}]);return Xs;}();var lo=/*#__PURE__*/function(_Xs){_inherits(lo,_Xs);var _super53=_createSuper(lo);function lo(){var _this69;_classCallCheck(this,lo);_this69=_super53.apply(this,arguments),_this69.client=new bt(),_this69.movement=new bt(),_this69.offset=new bt(),_this69.global=new bt(),_this69.screen=new bt();return _this69;}_createClass(lo,[{key:"clientX",get:function get(){return this.client.x;}},{key:"clientY",get:function get(){return this.client.y;}},{key:"x",get:function get(){return this.clientX;}},{key:"y",get:function get(){return this.clientY;}},{key:"movementX",get:function get(){return this.movement.x;}},{key:"movementY",get:function get(){return this.movement.y;}},{key:"offsetX",get:function get(){return this.offset.x;}},{key:"offsetY",get:function get(){return this.offset.y;}},{key:"globalX",get:function get(){return this.global.x;}},{key:"globalY",get:function get(){return this.global.y;}},{key:"screenX",get:function get(){return this.screen.x;}},{key:"screenY",get:function get(){return this.screen.y;}},{key:"getLocalPosition",value:function getLocalPosition(t,e,i){return t.worldTransform.applyInverse(i||this.global,e);}},{key:"getModifierState",value:function getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t);}},{key:"initMouseEvent",value:function initMouseEvent(t,e,i,s,n,o,a,l,h,u,c,d,p,f,m){throw new Error("Method not implemented.");}}]);return lo;}(Xs);var je=/*#__PURE__*/function(_lo){_inherits(je,_lo);var _super54=_createSuper(je);function je(){var _this70;_classCallCheck(this,je);_this70=_super54.apply(this,arguments),_this70.width=0,_this70.height=0,_this70.isPrimary=!1;return _this70;}_createClass(je,[{key:"getCoalescedEvents",value:function getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[];}},{key:"getPredictedEvents",value:function getPredictedEvents(){throw new Error("getPredictedEvents is not supported!");}}]);return je;}(lo);var es=/*#__PURE__*/function(_lo2){_inherits(es,_lo2);var _super55=_createSuper(es);function es(){var _this71;_classCallCheck(this,es);_this71=_super55.apply(this,arguments),_this71.DOM_DELTA_PIXEL=0,_this71.DOM_DELTA_LINE=1,_this71.DOM_DELTA_PAGE=2;return _this71;}return _createClass(es);}(lo);es.DOM_DELTA_PIXEL=0,es.DOM_DELTA_LINE=1,es.DOM_DELTA_PAGE=2;var iT=2048,sT=new bt(),Xl=new bt();var nT=/*#__PURE__*/function(){function nT(t){_classCallCheck(this,nT);this.dispatch=new Ts(),this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map(),this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel);}_createClass(nT,[{key:"addEventMapping",value:function addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort(function(i,s){return i.priority-s.priority;});}},{key:"dispatchEvent",value:function dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t);}},{key:"mapEvent",value:function mapEvent(t){if(!this.rootTarget)return;var e=this.mappingTable[t.type];if(e)for(var i=0,s=e.length;i<s;i++)e[i].fn(t);else console.warn("[EventBoundary]: Event mapping not defined for ".concat(t.type));}},{key:"hitTest",value:function hitTest(t,e){Gr.pauseUpdate=!0;var i=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",s=this[i](this.rootTarget,this.rootTarget.eventMode,sT.set(t,e),this.hitTestFn,this.hitPruneFn);return s&&s[0];}},{key:"propagate",value:function propagate(t,e){if(!t.target)return;var i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(var s=0,n=i.length-1;s<n;s++)if(t.currentTarget=i[s],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(var _s8=i.length-2;_s8>=0;_s8--)if(t.currentTarget=i[_s8],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;}}},{key:"all",value:function all(t,e){var _this72=this;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:this._allInteractiveElements;if(i.length===0)return;t.eventPhase=t.BUBBLING_PHASE;var s=Array.isArray(e)?e:[e];var _loop=function _loop(n){s.forEach(function(o){t.currentTarget=i[n],_this72.notifyTarget(t,o);});};for(var n=i.length-1;n>=0;n--){_loop(n);}}},{key:"propagationPath",value:function propagationPath(t){var e=[t];for(var i=0;i<iT&&t!==this.rootTarget;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent;}return e.reverse(),e;}},{key:"hitTestMoveRecursive",value:function hitTestMoveRecursive(t,e,i,s,n){var o=arguments.length>5&&arguments[5]!==undefined?arguments[5]:!1;var a=!1;if(this._interactivePrune(t))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(Gr.pauseUpdate=!1),t.interactiveChildren&&t.children){var u=t.children;for(var c=u.length-1;c>=0;c--){var d=u[c],p=this.hitTestMoveRecursive(d,this._isInteractive(e)?e:d.eventMode,i,s,n,o||n(t,i));if(p){if(p.length>0&&!p[p.length-1].parent)continue;var f=t.isInteractive();(p.length>0||f)&&(f&&this._allInteractiveElements.push(t),p.push(t)),this._hitElements.length===0&&(this._hitElements=p),a=!0;}}}var l=this._isInteractive(e),h=t.isInteractive();return l&&h&&this._allInteractiveElements.push(t),o||this._hitElements.length>0?null:a?this._hitElements:l&&!n(t,i)&&s(t,i)?h?[t]:[]:null;}},{key:"hitTestRecursive",value:function hitTestRecursive(t,e,i,s,n){if(this._interactivePrune(t)||n(t,i))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(Gr.pauseUpdate=!1),t.interactiveChildren&&t.children){var l=t.children;for(var h=l.length-1;h>=0;h--){var u=l[h],c=this.hitTestRecursive(u,this._isInteractive(e)?e:u.eventMode,i,s,n);if(c){if(c.length>0&&!c[c.length-1].parent)continue;var d=t.isInteractive();return(c.length>0||d)&&c.push(t),c;}}}var o=this._isInteractive(e),a=t.isInteractive();return o&&s(t,i)?a?[t]:[]:null;}},{key:"_isInteractive",value:function _isInteractive(t){return t==="static"||t==="dynamic";}},{key:"_interactivePrune",value:function _interactivePrune(t){return!!(!t||t.isMask||!t.visible||!t.renderable||t.eventMode==="none"||t.eventMode==="passive"&&!t.interactiveChildren||t.isMask);}},{key:"hitPruneFn",value:function hitPruneFn(t,e){var i;if(t.hitArea&&(t.worldTransform.applyInverse(e,Xl),!t.hitArea.contains(Xl.x,Xl.y)))return!0;if(t._mask){var s=t._mask.isMaskData?t._mask.maskObject:t._mask;if(s&&!((i=s.containsPoint)!=null&&i.call(s,e)))return!0;}return!1;}},{key:"hitTestFn",value:function hitTestFn(t,e){return t.eventMode==="passive"?!1:t.hitArea?!0:t.containsPoint?t.containsPoint(e):!1;}},{key:"notifyTarget",value:function notifyTarget(t,e){var _e14;var n,o;e=(_e14=e)!==null&&_e14!==void 0?_e14:t.type;var i="on".concat(e);(o=(n=t.currentTarget)[i])==null||o.call(n,t);var s=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?"".concat(e,"capture"):e;this.notifyListeners(t,s),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e);}},{key:"mapPointerDown",value:function mapPointerDown(t){if(!(t instanceof je)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return;}var e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),e.pointerType==="touch")this.dispatchEvent(e,"touchstart");else if(e.pointerType==="mouse"||e.pointerType==="pen"){var s=e.button===2;this.dispatchEvent(e,s?"rightdown":"mousedown");}var i=this.trackingData(t.pointerId);i.pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e);}},{key:"mapPointerMove",value:function mapPointerMove(t){var _this$enableGlobalMov;var l,h;if(!(t instanceof je)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return;}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;var e=this.createPointerEvent(t);this._isPointerMoveEvent=!1;var i=e.pointerType==="mouse"||e.pointerType==="pen",s=this.trackingData(t.pointerId),n=this.findMountedTarget(s.overTargets);if(((l=s.overTargets)==null?void 0:l.length)>0&&n!==e.target){var u=t.type==="mousemove"?"mouseout":"pointerout",c=this.createPointerEvent(t,u,n);if(this.dispatchEvent(c,"pointerout"),i&&this.dispatchEvent(c,"mouseout"),!e.composedPath().includes(n)){var d=this.createPointerEvent(t,"pointerleave",n);for(d.eventPhase=d.AT_TARGET;d.target&&!e.composedPath().includes(d.target);)d.currentTarget=d.target,this.notifyTarget(d),i&&this.notifyTarget(d,"mouseleave"),d.target=d.target.parent;this.freeEvent(d);}this.freeEvent(c);}if(n!==e.target){var _u4=t.type==="mousemove"?"mouseover":"pointerover",_c12=this.clonePointerEvent(e,_u4);this.dispatchEvent(_c12,"pointerover"),i&&this.dispatchEvent(_c12,"mouseover");var _d5=n==null?void 0:n.parent;for(;_d5&&_d5!==this.rootTarget.parent&&_d5!==e.target;)_d5=_d5.parent;if(!_d5||_d5===this.rootTarget.parent){var p=this.clonePointerEvent(e,"pointerenter");for(p.eventPhase=p.AT_TARGET;p.target&&p.target!==n&&p.target!==this.rootTarget.parent;)p.currentTarget=p.target,this.notifyTarget(p),i&&this.notifyTarget(p,"mouseenter"),p.target=p.target.parent;this.freeEvent(p);}this.freeEvent(_c12);}var o=[],a=(_this$enableGlobalMov=this.enableGlobalMoveEvents)!==null&&_this$enableGlobalMov!==void 0?_this$enableGlobalMov:!0;this.moveOnAll?o.push("pointermove"):this.dispatchEvent(e,"pointermove"),a&&o.push("globalpointermove"),e.pointerType==="touch"&&(this.moveOnAll?o.splice(1,0,"touchmove"):this.dispatchEvent(e,"touchmove"),a&&o.push("globaltouchmove")),i&&(this.moveOnAll?o.splice(1,0,"mousemove"):this.dispatchEvent(e,"mousemove"),a&&o.push("globalmousemove"),this.cursor=(h=e.target)==null?void 0:h.cursor),o.length>0&&this.all(e,o),this._allInteractiveElements.length=0,this._hitElements.length=0,s.overTargets=e.composedPath(),this.freeEvent(e);}},{key:"mapPointerOver",value:function mapPointerOver(t){var o;if(!(t instanceof je)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return;}var e=this.trackingData(t.pointerId),i=this.createPointerEvent(t),s=i.pointerType==="mouse"||i.pointerType==="pen";this.dispatchEvent(i,"pointerover"),s&&this.dispatchEvent(i,"mouseover"),i.pointerType==="mouse"&&(this.cursor=(o=i.target)==null?void 0:o.cursor);var n=this.clonePointerEvent(i,"pointerenter");for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),s&&this.notifyTarget(n,"mouseenter"),n.target=n.target.parent;e.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(n);}},{key:"mapPointerOut",value:function mapPointerOut(t){if(!(t instanceof je)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return;}var e=this.trackingData(t.pointerId);if(e.overTargets){var i=t.pointerType==="mouse"||t.pointerType==="pen",s=this.findMountedTarget(e.overTargets),n=this.createPointerEvent(t,"pointerout",s);this.dispatchEvent(n),i&&this.dispatchEvent(n,"mouseout");var o=this.createPointerEvent(t,"pointerleave",s);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),i&&this.notifyTarget(o,"mouseleave"),o.target=o.target.parent;e.overTargets=null,this.freeEvent(n),this.freeEvent(o);}this.cursor=null;}},{key:"mapPointerUp",value:function mapPointerUp(t){if(!(t instanceof je)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return;}var e=performance.now(),i=this.createPointerEvent(t);if(this.dispatchEvent(i,"pointerup"),i.pointerType==="touch")this.dispatchEvent(i,"touchend");else if(i.pointerType==="mouse"||i.pointerType==="pen"){var a=i.button===2;this.dispatchEvent(i,a?"rightup":"mouseup");}var s=this.trackingData(t.pointerId),n=this.findMountedTarget(s.pressTargetsByButton[t.button]);var o=n;if(n&&!i.composedPath().includes(n)){var _a9=n;for(;_a9&&!i.composedPath().includes(_a9);){if(i.currentTarget=_a9,this.notifyTarget(i,"pointerupoutside"),i.pointerType==="touch")this.notifyTarget(i,"touchendoutside");else if(i.pointerType==="mouse"||i.pointerType==="pen"){var l=i.button===2;this.notifyTarget(i,l?"rightupoutside":"mouseupoutside");}_a9=_a9.parent;}delete s.pressTargetsByButton[t.button],o=_a9;}if(o){var _a10=this.clonePointerEvent(i,"click");_a10.target=o,_a10.path=null,s.clicksByButton[t.button]||(s.clicksByButton[t.button]={clickCount:0,target:_a10.target,timeStamp:e});var _l11=s.clicksByButton[t.button];if(_l11.target===_a10.target&&e-_l11.timeStamp<200?++_l11.clickCount:_l11.clickCount=1,_l11.target=_a10.target,_l11.timeStamp=e,_a10.detail=_l11.clickCount,_a10.pointerType==="mouse"){var h=_a10.button===2;this.dispatchEvent(_a10,h?"rightclick":"click");}else _a10.pointerType==="touch"&&this.dispatchEvent(_a10,"tap");this.dispatchEvent(_a10,"pointertap"),this.freeEvent(_a10);}this.freeEvent(i);}},{key:"mapPointerUpOutside",value:function mapPointerUpOutside(t){if(!(t instanceof je)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return;}var e=this.trackingData(t.pointerId),i=this.findMountedTarget(e.pressTargetsByButton[t.button]),s=this.createPointerEvent(t);if(i){var n=i;for(;n;)s.currentTarget=n,this.notifyTarget(s,"pointerupoutside"),s.pointerType==="touch"?this.notifyTarget(s,"touchendoutside"):(s.pointerType==="mouse"||s.pointerType==="pen")&&this.notifyTarget(s,s.button===2?"rightupoutside":"mouseupoutside"),n=n.parent;delete e.pressTargetsByButton[t.button];}this.freeEvent(s);}},{key:"mapWheel",value:function mapWheel(t){if(!(t instanceof es)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return;}var e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e);}},{key:"findMountedTarget",value:function findMountedTarget(t){if(!t)return null;var e=t[0];for(var i=1;i<t.length&&t[i].parent===e;i++)e=t[i];return e;}},{key:"createPointerEvent",value:function createPointerEvent(t,e,i){var _ref120;var s=this.allocateEvent(je);return this.copyPointerData(t,s),this.copyMouseData(t,s),this.copyData(t,s),s.nativeEvent=t.nativeEvent,s.originalEvent=t,s.target=(_ref120=i!==null&&i!==void 0?i:this.hitTest(s.global.x,s.global.y))!==null&&_ref120!==void 0?_ref120:this._hitElements[0],typeof e=="string"&&(s.type=e),s;}},{key:"createWheelEvent",value:function createWheelEvent(t){var e=this.allocateEvent(es);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e;}},{key:"clonePointerEvent",value:function clonePointerEvent(t,e){var i=this.allocateEvent(je);return i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice(),i.type=e!==null&&e!==void 0?e:i.type,i;}},{key:"copyWheelData",value:function copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ;}},{key:"copyPointerData",value:function copyPointerData(t,e){t instanceof je&&e instanceof je&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist);}},{key:"copyMouseData",value:function copyMouseData(t,e){t instanceof lo&&e instanceof lo&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global));}},{key:"copyData",value:function copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page);}},{key:"trackingData",value:function trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t];}},{key:"allocateEvent",value:function allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);var e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e;}},{key:"freeEvent",value:function freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");var e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t);}},{key:"notifyListeners",value:function notifyListeners(t,e){var i=t.currentTarget._events[e];if(i&&t.currentTarget.isInteractive())if("fn"in i)i.once&&t.currentTarget.removeListener(e,i.fn,void 0,!0),i.fn.call(i.context,t);else for(var s=0,n=i.length;s<n&&!t.propagationImmediatelyStopped;s++)i[s].once&&t.currentTarget.removeListener(e,i[s].fn,void 0,!0),i[s].fn.call(i[s].context,t);}}]);return nT;}();var oT=1,aT={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},zl=/*#__PURE__*/function(){function Ih(t){var _this73=this;_classCallCheck(this,Ih);this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new nT(null),Gr.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new je(null),this.rootWheelEvent=new es(null),this.cursorStyles={"default":"inherit",pointer:"pointer"},this.features=new Proxy(_objectSpread({},Ih.defaultEventFeatures),{set:function set(e,i,s){return i==="globalMove"&&(_this73.rootBoundary.enableGlobalMoveEvents=s),e[i]=s,!0;}}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this);}_createClass(Ih,[{key:"init",value:function init(t){var _t$eventMode,_t$eventFeatures;var _this$renderer3=this.renderer,e=_this$renderer3.view,i=_this$renderer3.resolution;this.setTargetElement(e),this.resolution=i,Ih._defaultEventMode=(_t$eventMode=t.eventMode)!==null&&_t$eventMode!==void 0?_t$eventMode:"auto",Object.assign(this.features,(_t$eventFeatures=t.eventFeatures)!==null&&_t$eventFeatures!==void 0?_t$eventFeatures:{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove;}},{key:"resolutionChange",value:function resolutionChange(t){this.resolution=t;}},{key:"destroy",value:function destroy(){this.setTargetElement(null),this.renderer=null;}},{key:"setCursor",value:function setCursor(t){t=t||"default";var e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;var i=this.cursorStyles[t];if(i)switch(_typeof(i)){case"string":e&&(this.domElement.style.cursor=i);break;case"function":i(t);break;case"object":e&&Object.assign(this.domElement.style,i);break;}else e&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t);}},{key:"pointer",get:function get(){return this.rootPointerEvent;}},{key:"onPointerDown",value:function onPointerDown(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;var e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(var i=0,s=e.length;i<s;i++){var n=e[i],o=this.bootstrapEvent(this.rootPointerEvent,n);this.rootBoundary.mapEvent(o);}this.setCursor(this.rootBoundary.cursor);}},{key:"onPointerMove",value:function onPointerMove(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,Gr.pointerMoved();var e=this.normalizeToPointerData(t);for(var i=0,s=e.length;i<s;i++){var n=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(n);}this.setCursor(this.rootBoundary.cursor);}},{key:"onPointerUp",value:function onPointerUp(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;var e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);var i=e!==this.domElement?"outside":"",s=this.normalizeToPointerData(t);for(var n=0,o=s.length;n<o;n++){var a=this.bootstrapEvent(this.rootPointerEvent,s[n]);a.type+=i,this.rootBoundary.mapEvent(a);}this.setCursor(this.rootBoundary.cursor);}},{key:"onPointerOverOut",value:function onPointerOverOut(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;var e=this.normalizeToPointerData(t);for(var i=0,s=e.length;i<s;i++){var n=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(n);}this.setCursor(this.rootBoundary.cursor);}},{key:"onWheel",value:function onWheel(t){if(!this.features.wheel)return;var e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e);}},{key:"setTargetElement",value:function setTargetElement(t){this.removeEvents(),this.domElement=t,Gr.domElement=t,this.addEvents();}},{key:"addEvents",value:function addEvents(){if(this.eventsAdded||!this.domElement)return;Gr.addTickerListener();var t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0;}},{key:"removeEvents",value:function removeEvents(){if(!this.eventsAdded||!this.domElement)return;Gr.removeTickerListener();var t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1;}},{key:"mapPositionToPoint",value:function mapPositionToPoint(t,e,i){var s=this.domElement.isConnected?this.domElement.getBoundingClientRect():{width:this.domElement.width,height:this.domElement.height,left:0,top:0},n=1/this.resolution;t.x=(e-s.left)*(this.domElement.width/s.width)*n,t.y=(i-s.top)*(this.domElement.height/s.height)*n;}},{key:"normalizeToPointerData",value:function normalizeToPointerData(t){var e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(var i=0,s=t.changedTouches.length;i<s;i++){var n=t.changedTouches[i];_typeof(n.button)>"u"&&(n.button=0),_typeof(n.buttons)>"u"&&(n.buttons=1),_typeof(n.isPrimary)>"u"&&(n.isPrimary=t.touches.length===1&&t.type==="touchstart"),_typeof(n.width)>"u"&&(n.width=n.radiusX||1),_typeof(n.height)>"u"&&(n.height=n.radiusY||1),_typeof(n.tiltX)>"u"&&(n.tiltX=0),_typeof(n.tiltY)>"u"&&(n.tiltY=0),_typeof(n.pointerType)>"u"&&(n.pointerType="touch"),_typeof(n.pointerId)>"u"&&(n.pointerId=n.identifier||0),_typeof(n.pressure)>"u"&&(n.pressure=n.force||.5),_typeof(n.twist)>"u"&&(n.twist=0),_typeof(n.tangentialPressure)>"u"&&(n.tangentialPressure=0),_typeof(n.layerX)>"u"&&(n.layerX=n.offsetX=n.clientX),_typeof(n.layerY)>"u"&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,n.type=t.type,e.push(n);}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){var _i31=t;_typeof(_i31.isPrimary)>"u"&&(_i31.isPrimary=!0),_typeof(_i31.width)>"u"&&(_i31.width=1),_typeof(_i31.height)>"u"&&(_i31.height=1),_typeof(_i31.tiltX)>"u"&&(_i31.tiltX=0),_typeof(_i31.tiltY)>"u"&&(_i31.tiltY=0),_typeof(_i31.pointerType)>"u"&&(_i31.pointerType="mouse"),_typeof(_i31.pointerId)>"u"&&(_i31.pointerId=oT),_typeof(_i31.pressure)>"u"&&(_i31.pressure=.5),_typeof(_i31.twist)>"u"&&(_i31.twist=0),_typeof(_i31.tangentialPressure)>"u"&&(_i31.tangentialPressure=0),_i31.isNormalized=!0,e.push(_i31);}else e.push(t);return e;}},{key:"normalizeWheelEvent",value:function normalizeWheelEvent(t){var e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e;}},{key:"bootstrapEvent",value:function bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=aT[t.type]||t.type),t;}},{key:"transferMouseData",value:function transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey;}}],[{key:"defaultEventMode",get:function get(){return this._defaultEventMode;}}]);return Ih;}();zl.extension={name:"events",type:[W.RendererSystem,W.CanvasRendererSystem]},zl.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};var Wl=zl;K.add(Wl);function Wf(r){return r==="dynamic"||r==="static";}var lT={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){var _this$_internalIntera;return(_this$_internalIntera=this._internalInteractive)!==null&&_this$_internalIntera!==void 0?_this$_internalIntera:Wf(Wl.defaultEventMode);},set interactive(r){gt("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=r,this.eventMode=r?"static":"auto";},_internalEventMode:void 0,get eventMode(){var _this$_internalEventM;return(_this$_internalEventM=this._internalEventMode)!==null&&_this$_internalEventM!==void 0?_this$_internalEventM:Wl.defaultEventMode;},set eventMode(r){this._internalInteractive=Wf(r),this._internalEventMode=r;},isInteractive:function isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic";},interactiveChildren:!0,hitArea:null,addEventListener:function addEventListener(r,t,e){var i=typeof e=="boolean"&&e||_typeof(e)=="object"&&e.capture,s=_typeof(e)=="object"?e.signal:void 0,n=_typeof(e)=="object"?e.once===!0:!1,o=typeof t=="function"?void 0:t;r=i?"".concat(r,"capture"):r;var a=typeof t=="function"?t:t.handleEvent,l=this;s&&s.addEventListener("abort",function(){l.off(r,a,o);}),n?l.once(r,a,o):l.on(r,a,o);},removeEventListener:function removeEventListener(r,t,e){var i=typeof e=="boolean"&&e||_typeof(e)=="object"&&e.capture,s=typeof t=="function"?void 0:t;r=i?"".concat(r,"capture"):r,t=typeof t=="function"?t:t.handleEvent,this.off(r,t,s);},dispatchEvent:function dispatchEvent(r){if(!(r instanceof Xs))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return r.defaultPrevented=!1,r.path=null,r.target=this,r.manager.dispatchEvent(r),!r.defaultPrevented;}};Lt.mixin(lT);var hT={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};Lt.mixin(hT);var uT=9,ho=100,cT=0,dT=0,Yf=2,jf=1,fT=-1e3,pT=-1e3,mT=2;var qf=/*#__PURE__*/function(){function qf(t){_classCallCheck(this,qf);this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(br.tablet||br.phone)&&this.createTouchHook();var e=document.createElement("div");e.style.width="".concat(ho,"px"),e.style.height="".concat(ho,"px"),e.style.position="absolute",e.style.top="".concat(cT,"px"),e.style.left="".concat(dT,"px"),e.style.zIndex=Yf.toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1);}_createClass(qf,[{key:"isActive",get:function get(){return this._isActive;}},{key:"isMobileAccessibility",get:function get(){return this._isMobileAccessibility;}},{key:"createTouchHook",value:function createTouchHook(){var _this74=this;var t=document.createElement("button");t.style.width="".concat(jf,"px"),t.style.height="".concat(jf,"px"),t.style.position="absolute",t.style.top="".concat(fT,"px"),t.style.left="".concat(pT,"px"),t.style.zIndex=mT.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",function(){_this74._isMobileAccessibility=!0,_this74.activate(),_this74.destroyTouchHook();}),document.body.appendChild(t),this._hookDiv=t;}},{key:"destroyTouchHook",value:function destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null);}},{key:"activate",value:function activate(){var t;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(t=this.renderer.view.parentNode)==null||t.appendChild(this.div));}},{key:"deactivate",value:function deactivate(){var t;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(t=this.div.parentNode)==null||t.removeChild(this.div));}},{key:"updateAccessibleObjects",value:function updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);var e=t.children;if(e)for(var i=0;i<e.length;i++)this.updateAccessibleObjects(e[i]);}},{key:"update",value:function update(){var t=performance.now();if(br.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);var _this$renderer$view$g=this.renderer.view.getBoundingClientRect(),e=_this$renderer$view$g.x,i=_this$renderer$view$g.y,s=_this$renderer$view$g.width,n=_this$renderer$view$g.height,_this$renderer4=this.renderer,o=_this$renderer4.width,a=_this$renderer4.height,l=_this$renderer4.resolution,h=s/o*l,u=n/a*l;var c=this.div;c.style.left="".concat(e,"px"),c.style.top="".concat(i,"px"),c.style.width="".concat(o,"px"),c.style.height="".concat(a,"px");for(var d=0;d<this.children.length;d++){var p=this.children[d];if(p.renderId!==this.renderId)p._accessibleActive=!1,Ki(this.children,d,1),this.div.removeChild(p._accessibleDiv),this.pool.push(p._accessibleDiv),p._accessibleDiv=null,d--;else{c=p._accessibleDiv;var f=p.hitArea;var m=p.worldTransform;p.hitArea?(c.style.left="".concat((m.tx+f.x*m.a)*h,"px"),c.style.top="".concat((m.ty+f.y*m.d)*u,"px"),c.style.width="".concat(f.width*m.a*h,"px"),c.style.height="".concat(f.height*m.d*u,"px")):(f=p.getBounds(),this.capHitArea(f),c.style.left="".concat(f.x*h,"px"),c.style.top="".concat(f.y*u,"px"),c.style.width="".concat(f.width*h,"px"),c.style.height="".concat(f.height*u,"px"),c.title!==p.accessibleTitle&&p.accessibleTitle!==null&&(c.title=p.accessibleTitle),c.getAttribute("aria-label")!==p.accessibleHint&&p.accessibleHint!==null&&c.setAttribute("aria-label",p.accessibleHint)),(p.accessibleTitle!==c.title||p.tabIndex!==c.tabIndex)&&(c.title=p.accessibleTitle,c.tabIndex=p.tabIndex,this.debug&&this.updateDebugHTML(c));}}this.renderId++;}},{key:"updateDebugHTML",value:function updateDebugHTML(t){t.innerHTML="type: ".concat(t.type,"</br> title : ").concat(t.title,"</br> tabIndex: ").concat(t.tabIndex);}},{key:"capHitArea",value:function capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);var _this$renderer5=this.renderer,e=_this$renderer5.width,i=_this$renderer5.height;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>i&&(t.height=i-t.y);}},{key:"addChild",value:function addChild(t){var e=this.pool.pop();e||(e=document.createElement("button"),e.style.width="".concat(ho,"px"),e.style.height="".concat(ho,"px"),e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=Yf.toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?e.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(e.title="displayObject ".concat(t.tabIndex)),t.accessibleHint&&t.accessibleHint!==null&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex;}},{key:"_dispatchEvent",value:function _dispatchEvent(t,e){var i=t.target.displayObject,s=this.renderer.events.rootBoundary,n=Object.assign(new Xs(s),{target:i});s.rootTarget=this.renderer.lastObjectRendered,e.forEach(function(o){return s.dispatchEvent(n,o);});}},{key:"_onClick",value:function _onClick(t){this._dispatchEvent(t,["click","pointertap","tap"]);}},{key:"_onFocus",value:function _onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"]);}},{key:"_onFocusOut",value:function _onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"]);}},{key:"_onKeyDown",value:function _onKeyDown(t){t.keyCode===uT&&this.activate();}},{key:"_onMouseMove",value:function _onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate();}},{key:"destroy",value:function destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null;}}]);return qf;}();qf.extension={name:"accessibility",type:[W.RendererPlugin,W.CanvasRendererPlugin]},K.add(qf);var Kf=/*#__PURE__*/function(){function Rh(t){var _this75=this;_classCallCheck(this,Rh);this.stage=new Ye(),t=Object.assign({forceCanvas:!1},t),this.renderer=Lf(t),Rh._plugins.forEach(function(e){e.init.call(_this75,t);});}_createClass(Rh,[{key:"render",value:function render(){this.renderer.render(this.stage);}},{key:"view",get:function get(){var t;return(t=this.renderer)==null?void 0:t.view;}},{key:"screen",get:function get(){var t;return(t=this.renderer)==null?void 0:t.screen;}},{key:"destroy",value:function destroy(t,e){var _this76=this;var i=Rh._plugins.slice(0);i.reverse(),i.forEach(function(s){s.destroy.call(_this76);}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null;}}]);return Rh;}();Kf._plugins=[];var gT=Kf;K.handleByList(W.Application,gT._plugins);var Zf=/*#__PURE__*/function(){function Zf(){_classCallCheck(this,Zf);}_createClass(Zf,null,[{key:"init",value:function init(t){var _this77=this;Object.defineProperty(this,"resizeTo",{set:function set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize());},get:function get(){return this._resizeTo;}}),this.queueResize=function(){_this77._resizeTo&&(_this77.cancelResize(),_this77._resizeId=requestAnimationFrame(function(){return _this77.resize();}));},this.cancelResize=function(){_this77._resizeId&&(cancelAnimationFrame(_this77._resizeId),_this77._resizeId=null);},this.resize=function(){if(!_this77._resizeTo)return;_this77.cancelResize();var e,i;if(_this77._resizeTo===globalThis.window)e=globalThis.innerWidth,i=globalThis.innerHeight;else{var _this77$_resizeTo=_this77._resizeTo,s=_this77$_resizeTo.clientWidth,n=_this77$_resizeTo.clientHeight;e=s,i=n;}_this77.renderer.resize(e,i),_this77.render();},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null;}},{key:"destroy",value:function destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null;}}]);return Zf;}();Zf.extension=W.Application,K.add(Zf);var Qf={loader:W.LoadParser,resolver:W.ResolveParser,cache:W.CacheParser,detection:W.DetectionParser};K.handle(W.Asset,function(r){var t=r.ref;Object.entries(Qf).filter(function(_ref121){var _ref122=_slicedToArray(_ref121,1),e=_ref122[0];return!!t[e];}).forEach(function(_ref123){var _t$e$extension;var _ref124=_slicedToArray(_ref123,2),e=_ref124[0],i=_ref124[1];return K.add(Object.assign(t[e],{extension:(_t$e$extension=t[e].extension)!==null&&_t$e$extension!==void 0?_t$e$extension:i}));});},function(r){var t=r.ref;Object.keys(Qf).filter(function(e){return!!t[e];}).forEach(function(e){return K.remove(t[e]);});});var yT=/*#__PURE__*/function(){function yT(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!1;_classCallCheck(this,yT);this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e;}_createClass(yT,[{key:"add",value:function add(t){var _this78=this;t.forEach(function(e){_this78._assetList.push(e);}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next();}},{key:"_next",value:function(){var _next2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var t,e,i;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:if(!(this._assetList.length&&this._isActive)){_context2.next=8;break;}this._isLoading=!0;t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(i=0;i<e;i++)t.push(this._assetList.pop());_context2.next=6;return this._loader.load(t);case 6:this._isLoading=!1;this._next();case 8:case"end":return _context2.stop();}},_callee2,this);}));function _next(){return _next2.apply(this,arguments);}return _next;}()},{key:"active",get:function get(){return this._isActive;},set:function set(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next());}}]);return yT;}();function rs(r,t){if(Array.isArray(t)){var _iterator16=_createForOfIteratorHelper(t),_step16;try{for(_iterator16.s();!(_step16=_iterator16.n()).done;){var e=_step16.value;if(r.startsWith("data:".concat(e)))return!0;}}catch(err){_iterator16.e(err);}finally{_iterator16.f();}return!1;}return r.startsWith("data:".concat(t));}function $r(r,t){var e=r.split("?")[0],i=se.extname(e).toLowerCase();return Array.isArray(t)?t.includes(i):i===t;}var qe=function qe(r,t){var e=arguments.length>2&&arguments[2]!==undefined?arguments[2]:!1;return Array.isArray(r)||(r=[r]),t?r.map(function(i){return typeof i=="string"||e?t(i):i;}):r;},Yl=function Yl(r,t){var e=t.split("?")[1];return e&&(r+="?".concat(e)),r;};function Jf(r,t,e,i,s){var n=t[e];for(var o=0;o<n.length;o++){var a=n[o];e<t.length-1?Jf(r.replace(i[e],a),t,e+1,i,s):s.push(r.replace(i[e],a));}}function _T(r){var t=/\{(.*?)\}/g,e=r.match(t),i=[];if(e){var s=[];e.forEach(function(n){var o=n.substring(1,n.length-1).split(",");s.push(o);}),Jf(r,s,0,e,i);}else i.push(r);return i;}var uo=function uo(r){return!Array.isArray(r);};var vT=/*#__PURE__*/function(){function vT(){_classCallCheck(this,vT);this._parsers=[],this._cache=new Map(),this._cacheMap=new Map();}_createClass(vT,[{key:"reset",value:function reset(){this._cacheMap.clear(),this._cache.clear();}},{key:"has",value:function has(t){return this._cache.has(t);}},{key:"get",value:function get(t){var e=this._cache.get(t);return e||console.warn("[Assets] Asset id ".concat(t," was not found in the Cache")),e;}},{key:"set",value:function set(t,e){var _this79=this;var i=qe(t);var s;for(var a=0;a<this.parsers.length;a++){var l=this.parsers[a];if(l.test(e)){s=l.getCacheableAssets(i,e);break;}}s||(s={},i.forEach(function(a){s[a]=e;}));var n=Object.keys(s),o={cacheKeys:n,keys:i};if(i.forEach(function(a){_this79._cacheMap.set(a,o);}),n.forEach(function(a){var l=s?s[a]:e;_this79._cache.has(a)&&_this79._cache.get(a)!==l&&console.warn("[Cache] already has key:",a),_this79._cache.set(a,s[a]);}),e instanceof Z){var _a11=e;i.forEach(function(l){_a11.baseTexture!==Z.EMPTY.baseTexture&&ft.addToCache(_a11.baseTexture,l),Z.addToCache(_a11,l);});}}},{key:"remove",value:function remove(t){var _this80=this;if(!this._cacheMap.has(t)){console.warn("[Assets] Asset id ".concat(t," was not found in the Cache"));return;}var e=this._cacheMap.get(t);e.cacheKeys.forEach(function(i){_this80._cache["delete"](i);}),e.keys.forEach(function(i){_this80._cacheMap["delete"](i);});}},{key:"parsers",get:function get(){return this._parsers;}}]);return vT;}();var Ei=new vT();var xT=/*#__PURE__*/function(){function xT(){var _this81=this;_classCallCheck(this,xT);this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:function set(t,e,i){return _this81._parsersValidated=!1,t[e]=i,!0;}}),this.promiseCache={};}_createClass(xT,[{key:"reset",value:function reset(){this._parsersValidated=!1,this.promiseCache={};}},{key:"_getLoadPromiseAndParser",value:function _getLoadPromiseAndParser(t,e){var _this82=this;var i={promise:null,parser:null};return i.promise=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var o,a,s,n,l,h,_l12,_h11;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:s=null,n=null;if(!(e.loadParser&&(n=_this82._parserHash[e.loadParser],n||console.warn("[Assets] specified load parser \"".concat(e.loadParser,"\" not found while loading ").concat(t))),!n)){_context3.next=13;break;}l=0;case 3:if(!(l<_this82.parsers.length)){_context3.next=11;break;}h=_this82.parsers[l];if(!(h.load&&(o=h.test)!=null&&o.call(h,t,e,_this82))){_context3.next=8;break;}n=h;return _context3.abrupt("break",11);case 8:l++;_context3.next=3;break;case 11:if(n){_context3.next=13;break;}return _context3.abrupt("return",(console.warn("[Assets] ".concat(t," could not be loaded as we don't know how to parse it, ensure the correct parser has been added")),null));case 13:_context3.next=15;return n.load(t,e,_this82);case 15:s=_context3.sent;i.parser=n;_l12=0;case 18:if(!(_l12<_this82.parsers.length)){_context3.next=37;break;}_h11=_this82.parsers[_l12];_context3.t0=_h11.parse&&_h11.parse;if(!_context3.t0){_context3.next=25;break;}_context3.next=24;return(a=_h11.testParse)==null?void 0:a.call(_h11,s,e,_this82);case 24:_context3.t0=_context3.sent;case 25:_context3.t1=_context3.t0;if(!_context3.t1){_context3.next=34;break;}_context3.next=29;return _h11.parse(s,e,_this82);case 29:_context3.t2=_context3.sent;if(_context3.t2){_context3.next=32;break;}_context3.t2=s;case 32:s=_context3.t2;i.parser=_h11;case 34:_l12++;_context3.next=18;break;case 37:return _context3.abrupt("return",s);case 38:case"end":return _context3.stop();}},_callee3);}))(),i;}},{key:"load",value:function(){var _load=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5(t,e){var _this83=this;var i,s,n,o,a,l;return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1)switch(_context5.prev=_context5.next){case 0:this._parsersValidated||this._validateParsers();i=0;s={},n=uo(t),o=qe(t,function(h){return{alias:[h],src:h};}),a=o.length,l=o.map(/*#__PURE__*/function(){var _ref126=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(h){var u;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:u=se.toAbsolute(h.src);if(s[h.src]){_context4.next=13;break;}_context4.prev=2;_this83.promiseCache[u]||(_this83.promiseCache[u]=_this83._getLoadPromiseAndParser(u,h));_context4.next=6;return _this83.promiseCache[u].promise;case 6:s[h.src]=_context4.sent;e&&e(++i/a);_context4.next=13;break;case 10:_context4.prev=10;_context4.t0=_context4["catch"](2);throw delete _this83.promiseCache[u],delete s[h.src],new Error("[Loader.load] Failed to load ".concat(u,".\n").concat(_context4.t0));case 13:case"end":return _context4.stop();}},_callee4,null,[[2,10]]);}));return function(_x8){return _ref126.apply(this,arguments);};}());_context5.next=5;return Promise.all(l);case 5:return _context5.abrupt("return",n?s[o[0].src]:s);case 6:case"end":return _context5.stop();}},_callee5,this);}));function load(_x6,_x7){return _load.apply(this,arguments);}return load;}()},{key:"unload",value:function(){var _unload=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee7(t){var _this84=this;var e;return _regeneratorRuntime().wrap(function _callee7$(_context7){while(1)switch(_context7.prev=_context7.next){case 0:e=qe(t,function(i){return{alias:[i],src:i};}).map(/*#__PURE__*/function(){var _ref127=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee6(i){var o,a,s,n,l;return _regeneratorRuntime().wrap(function _callee6$(_context6){while(1)switch(_context6.prev=_context6.next){case 0:s=se.toAbsolute(i.src),n=_this84.promiseCache[s];if(!n){_context6.next=6;break;}_context6.next=4;return n.promise;case 4:l=_context6.sent;delete _this84.promiseCache[s],(a=(o=n.parser)==null?void 0:o.unload)==null||a.call(o,l,i,_this84);case 6:case"end":return _context6.stop();}},_callee6);}));return function(_x10){return _ref127.apply(this,arguments);};}());_context7.next=3;return Promise.all(e);case 3:case"end":return _context7.stop();}},_callee7);}));function unload(_x9){return _unload.apply(this,arguments);}return unload;}()},{key:"_validateParsers",value:function _validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(function(t){return t.name;}).reduce(function(t,e){return t[e.name]&&console.warn("[Assets] loadParser name conflict \"".concat(e.name,"\"")),_objectSpread(_objectSpread({},t),{},_defineProperty({},e.name,e));},{});}}]);return xT;}();var Ke=function(r){return r[r.Low=0]="Low",r[r.Normal=1]="Normal",r[r.High=2]="High",r;}(Ke||{});var bT=".json",ET="application/json",TT={extension:{type:W.LoadParser,priority:Ke.Low},name:"loadJson",test:function test(r){return rs(r,ET)||$r(r,bT);},load:function load(r){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee8(){return _regeneratorRuntime().wrap(function _callee8$(_context8){while(1)switch(_context8.prev=_context8.next){case 0:_context8.next=2;return j.ADAPTER.fetch(r);case 2:_context8.next=4;return _context8.sent.json();case 4:return _context8.abrupt("return",_context8.sent);case 5:case"end":return _context8.stop();}},_callee8);}))();}};K.add(TT);var wT=".txt",AT="text/plain",ST={name:"loadTxt",extension:{type:W.LoadParser,priority:Ke.Low},test:function test(r){return rs(r,AT)||$r(r,wT);},load:function load(r){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee9(){return _regeneratorRuntime().wrap(function _callee9$(_context9){while(1)switch(_context9.prev=_context9.next){case 0:_context9.next=2;return j.ADAPTER.fetch(r);case 2:_context9.next=4;return _context9.sent.text();case 4:return _context9.abrupt("return",_context9.sent);case 5:case"end":return _context9.stop();}},_callee9);}))();}};K.add(ST);var CT=["normal","bold","100","200","300","400","500","600","700","800","900"],IT=[".ttf",".otf",".woff",".woff2"],RT=["font/ttf","font/otf","font/woff","font/woff2"],MT=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function PT(r){var t=se.extname(r),e=se.basename(r,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(function(n){return n.charAt(0).toUpperCase()+n.slice(1);});var i=e.length>0;var _iterator17=_createForOfIteratorHelper(e),_step17;try{for(_iterator17.s();!(_step17=_iterator17.n()).done;){var n=_step17.value;if(!n.match(MT)){i=!1;break;}}}catch(err){_iterator17.e(err);}finally{_iterator17.f();}var s=e.join(" ");return i||(s="\"".concat(s.replace(/[\\"]/g,"\\$&"),"\"")),s;}var OT=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function NT(r){return OT.test(r)?r:encodeURI(r);}var DT={extension:{type:W.LoadParser,priority:Ke.Low},name:"loadWebFont",test:function test(r){return rs(r,RT)||$r(r,IT);},load:function load(r,t){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee10(){var i,s,n,e,_ref128,_ref129,_t$data,o,a,l,h,u,c,d;return _regeneratorRuntime().wrap(function _callee10$(_context10){while(1)switch(_context10.prev=_context10.next){case 0:e=j.ADAPTER.getFontFaceSet();if(!e){_context10.next=14;break;}o=[],a=(_ref128=(i=t.data)==null?void 0:i.family)!==null&&_ref128!==void 0?_ref128:PT(r),l=(_ref129=(n=(s=t.data)==null?void 0:s.weights)==null?void 0:n.filter(function(u){return CT.includes(u);}))!==null&&_ref129!==void 0?_ref129:["normal"],h=(_t$data=t.data)!==null&&_t$data!==void 0?_t$data:{};u=0;case 4:if(!(u<l.length)){_context10.next=13;break;}c=l[u],d=new FontFace(a,"url(".concat(NT(r),")"),_objectSpread(_objectSpread({},h),{},{weight:c}));_context10.next=8;return d.load();case 8:e.add(d);o.push(d);case 10:u++;_context10.next=4;break;case 13:return _context10.abrupt("return",o.length===1?o[0]:o);case 14:return _context10.abrupt("return",(console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null));case 15:case"end":return _context10.stop();}},_callee10);}))();},unload:function unload(r){(Array.isArray(r)?r:[r]).forEach(function(t){return j.ADAPTER.getFontFaceSet()["delete"](t);});}};K.add(DT);var LT="(function() {\n  \"use strict\";\n  const WHITE_PNG = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=\";\n  async function checkImageBitmap() {\n    try {\n      if (typeof createImageBitmap != \"function\")\n        return !1;\n      const imageBlob = await (await fetch(WHITE_PNG)).blob(), imageBitmap = await createImageBitmap(imageBlob);\n      return imageBitmap.width === 1 && imageBitmap.height === 1;\n    } catch {\n      return !1;\n    }\n  }\n  checkImageBitmap().then((result) => {\n    self.postMessage(result);\n  });\n})();\n";var is=null,jl=/*#__PURE__*/_createClass(function jl(){_classCallCheck(this,jl);is||(is=URL.createObjectURL(new Blob([LT],{type:"application/javascript"}))),this.worker=new Worker(is);});jl.revokeObjectURL=function(){is&&(URL.revokeObjectURL(is),is=null);};var BT="(function() {\n  \"use strict\";\n  async function loadImageBitmap(url) {\n    const response = await fetch(url);\n    if (!response.ok)\n      throw new Error(`[WorkerManager.loadImageBitmap] Failed to fetch ${url}: ${response.status} ${response.statusText}`);\n    const imageBlob = await response.blob();\n    return await createImageBitmap(imageBlob);\n  }\n  self.onmessage = async (event) => {\n    try {\n      const imageBitmap = await loadImageBitmap(event.data.data[0]);\n      self.postMessage({\n        data: imageBitmap,\n        uuid: event.data.uuid,\n        id: event.data.id\n      }, [imageBitmap]);\n    } catch (e) {\n      self.postMessage({\n        error: e,\n        uuid: event.data.uuid,\n        id: event.data.id\n      });\n    }\n  };\n})();\n";var ss=null;var tp=/*#__PURE__*/_createClass(function tp(){_classCallCheck(this,tp);ss||(ss=URL.createObjectURL(new Blob([BT],{type:"application/javascript"}))),this.worker=new Worker(ss);});tp.revokeObjectURL=function(){ss&&(URL.revokeObjectURL(ss),ss=null);};var ep=0,ql;var FT=/*#__PURE__*/function(){function FT(){_classCallCheck(this,FT);this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={};}_createClass(FT,[{key:"isImageBitmapSupported",value:function isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(function(t){var _jl=new jl(),e=_jl.worker;e.addEventListener("message",function(i){e.terminate(),jl.revokeObjectURL(),t(i.data);});}),this._isImageBitmapSupported);}},{key:"loadImageBitmap",value:function loadImageBitmap(t){return this._run("loadImageBitmap",[t]);}},{key:"_initWorkers",value:function(){var _initWorkers2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee11(){return _regeneratorRuntime().wrap(function _callee11$(_context11){while(1)switch(_context11.prev=_context11.next){case 0:this._initialized||(this._initialized=!0);case 1:case"end":return _context11.stop();}},_callee11,this);}));function _initWorkers(){return _initWorkers2.apply(this,arguments);}return _initWorkers;}()},{key:"getWorker",value:function getWorker(){var _this85=this;ql===void 0&&(ql=navigator.hardwareConcurrency||4);var t=this.workerPool.pop();return!t&&this._createdWorkers<ql&&(this._createdWorkers++,t=new tp().worker,t.addEventListener("message",function(e){_this85.complete(e.data),_this85.returnWorker(e.target),_this85.next();})),t;}},{key:"returnWorker",value:function returnWorker(t){this.workerPool.push(t);}},{key:"complete",value:function complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null;}},{key:"_run",value:function(){var _run2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee12(t,e){var _this86=this;var i;return _regeneratorRuntime().wrap(function _callee12$(_context12){while(1)switch(_context12.prev=_context12.next){case 0:_context12.next=2;return this._initWorkers();case 2:i=new Promise(function(s,n){_this86.queue.push({id:t,arguments:e,resolve:s,reject:n});});return _context12.abrupt("return",(this.next(),i));case 4:case"end":return _context12.stop();}},_callee12,this);}));function _run(_x11,_x12){return _run2.apply(this,arguments);}return _run;}()},{key:"next",value:function next(){if(!this.queue.length)return;var t=this.getWorker();if(!t)return;var e=this.queue.pop(),i=e.id;this.resolveHash[ep]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:ep++,id:i});}}]);return FT;}();var rp=new FT();function zs(r,t,e){r.resource.internal=!0;var i=new Z(r),s=function s(){delete t.promiseCache[e],Ei.has(e)&&Ei.remove(e);};return i.baseTexture.once("destroyed",function(){e in t.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),s());}),i.once("destroyed",function(){r.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),s());}),i;}var UT=[".jpeg",".jpg",".png",".webp",".avif"],kT=["image/jpeg","image/png","image/webp","image/avif"];function GT(_x13){return _GT.apply(this,arguments);}function _GT(){_GT=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee63(r){var t,e;return _regeneratorRuntime().wrap(function _callee63$(_context63){while(1)switch(_context63.prev=_context63.next){case 0:_context63.next=2;return j.ADAPTER.fetch(r);case 2:t=_context63.sent;if(t.ok){_context63.next=5;break;}throw new Error("[loadImageBitmap] Failed to fetch ".concat(r,": ").concat(t.status," ").concat(t.statusText));case 5:_context63.next=7;return t.blob();case 7:e=_context63.sent;_context63.next=10;return createImageBitmap(e);case 10:return _context63.abrupt("return",_context63.sent);case 11:case"end":return _context63.stop();}},_callee63);}));return _GT.apply(this,arguments);}var co={name:"loadTextures",extension:{type:W.LoadParser,priority:Ke.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test:function test(r){return rs(r,kT)||$r(r,UT);},load:function load(r,t,e){var _this87=this;return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee13(){var _n$resolution;var a,i,s,n,o;return _regeneratorRuntime().wrap(function _callee13$(_context13){while(1)switch(_context13.prev=_context13.next){case 0:i=globalThis.createImageBitmap&&_this87.config.preferCreateImageBitmap;if(!i){_context13.next=18;break;}_context13.t0=_this87.config.preferWorkers;if(!_context13.t0){_context13.next=7;break;}_context13.next=6;return rp.isImageBitmapSupported();case 6:_context13.t0=_context13.sent;case 7:if(!_context13.t0){_context13.next=13;break;}_context13.next=10;return rp.loadImageBitmap(r);case 10:s=_context13.sent;_context13.next=16;break;case 13:_context13.next=15;return GT(r);case 15:s=_context13.sent;case 16:_context13.next=21;break;case 18:_context13.next=20;return new Promise(function(l,h){var u=new Image();u.crossOrigin=_this87.config.crossOrigin,u.src=r,u.complete?l(u):(u.onload=function(){return l(u);},u.onerror=function(c){return h(c);});});case 20:s=_context13.sent;case 21:n=_objectSpread({},t.data);(_n$resolution=n.resolution)!==null&&_n$resolution!==void 0?_n$resolution:n.resolution=Ar(r),i&&((a=n.resourceOptions)==null?void 0:a.ownsImageBitmap)===void 0&&(n.resourceOptions=_objectSpread({},n.resourceOptions),n.resourceOptions.ownsImageBitmap=!0);o=new ft(s,n);return _context13.abrupt("return",(o.resource.src=r,zs(o,e,r)));case 25:case"end":return _context13.stop();}},_callee13);}))();},unload:function unload(r){r.destroy(!0);}};K.add(co);var $T=".svg",HT="image/svg+xml",VT={extension:{type:W.LoadParser,priority:Ke.High},name:"loadSVG",test:function test(r){return rs(r,HT)||$r(r,$T);},testParse:function testParse(r){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee14(){return _regeneratorRuntime().wrap(function _callee14$(_context14){while(1)switch(_context14.prev=_context14.next){case 0:return _context14.abrupt("return",Gl.test(r));case 1:case"end":return _context14.stop();}},_callee14);}))();},parse:function parse(r,t,e){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee15(){var n,i,s;return _regeneratorRuntime().wrap(function _callee15$(_context15){while(1)switch(_context15.prev=_context15.next){case 0:i=new Gl(r,(n=t==null?void 0:t.data)==null?void 0:n.resourceOptions);_context15.next=3;return i.load();case 3:s=new ft(i,_objectSpread({resolution:Ar(r)},t==null?void 0:t.data));return _context15.abrupt("return",(s.resource.src=t.src,zs(s,e,t.src)));case 5:case"end":return _context15.stop();}},_callee15);}))();},load:function load(r,t){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee16(){return _regeneratorRuntime().wrap(function _callee16$(_context16){while(1)switch(_context16.prev=_context16.next){case 0:_context16.next=2;return j.ADAPTER.fetch(r);case 2:return _context16.abrupt("return",_context16.sent.text());case 3:case"end":return _context16.stop();}},_callee16);}))();},unload:co.unload};K.add(VT);var XT=[".mp4",".m4v",".webm",".ogv"],zT=["video/mp4","video/webm","video/ogg"],WT={name:"loadVideo",extension:{type:W.LoadParser,priority:Ke.High},config:{defaultAutoPlay:!0,defaultUpdateFPS:0,defaultLoop:!1,defaultMuted:!1,defaultPlaysinline:!0},test:function test(r){return rs(r,zT)||$r(r,XT);},load:function load(r,t,e){var _this88=this;return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee17(){var o,i,s,n,a,l,h;return _regeneratorRuntime().wrap(function _callee17$(_context17){while(1)switch(_context17.prev=_context17.next){case 0:_context17.next=2;return j.ADAPTER.fetch(r);case 2:_context17.next=4;return _context17.sent.blob();case 4:s=_context17.sent;n=URL.createObjectURL(s);_context17.prev=6;a=_objectSpread(_objectSpread({autoPlay:_this88.config.defaultAutoPlay,updateFPS:_this88.config.defaultUpdateFPS,loop:_this88.config.defaultLoop,muted:_this88.config.defaultMuted,playsinline:_this88.config.defaultPlaysinline},(o=t==null?void 0:t.data)==null?void 0:o.resourceOptions),{},{autoLoad:!0}),l=new Hf(n,a);_context17.next=10;return l.load();case 10:_context17.t0=ft;_context17.t1=l;_context17.t2=_objectSpread;_context17.next=15;return Qx();case 15:_context17.t3=_context17.sent;_context17.t4=Ar(r);_context17.t5={alphaMode:_context17.t3,resolution:_context17.t4};_context17.t6=t==null?void 0:t.data;_context17.t7=(0,_context17.t2)(_context17.t5,_context17.t6);h=new _context17.t0(_context17.t1,_context17.t7);h.resource.src=r,i=zs(h,e,r),i.baseTexture.once("destroyed",function(){URL.revokeObjectURL(n);});_context17.next=27;break;case 24:_context17.prev=24;_context17.t8=_context17["catch"](6);throw URL.revokeObjectURL(n),_context17.t8;case 27:return _context17.abrupt("return",i);case 28:case"end":return _context17.stop();}},_callee17,null,[[6,24]]);}))();},unload:function unload(r){r.destroy(!0);}};K.add(WT);var YT=/*#__PURE__*/function(){function YT(){var _this89=this;_classCallCheck(this,YT);this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:function createBundleAssetId(t,e){return"".concat(t).concat(_this89._bundleIdConnector).concat(e);},extractAssetIdFromBundle:function extractAssetIdFromBundle(t,e){return e.replace("".concat(t).concat(_this89._bundleIdConnector),"");}},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={};}_createClass(YT,[{key:"setBundleIdentifier",value:function setBundleIdentifier(t){var _t$connector,_t$createBundleAssetI,_t$extractAssetIdFrom;if(this._bundleIdConnector=(_t$connector=t.connector)!==null&&_t$connector!==void 0?_t$connector:this._bundleIdConnector,this._createBundleAssetId=(_t$createBundleAssetI=t.createBundleAssetId)!==null&&_t$createBundleAssetI!==void 0?_t$createBundleAssetI:this._createBundleAssetId,this._extractAssetIdFromBundle=(_t$extractAssetIdFrom=t.extractAssetIdFromBundle)!==null&&_t$extractAssetIdFrom!==void 0?_t$extractAssetIdFrom:this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly");}},{key:"prefer",value:function prefer(){var _this90=this;for(var _len10=arguments.length,t=new Array(_len10),_key10=0;_key10<_len10;_key10++){t[_key10]=arguments[_key10];}t.forEach(function(e){_this90._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params));}),this._resolverHash={};}},{key:"basePath",get:function get(){return this._basePath;},set:function set(t){this._basePath=t;}},{key:"rootPath",get:function get(){return this._rootPath;},set:function set(t){this._rootPath=t;}},{key:"parsers",get:function get(){return this._parsers;}},{key:"reset",value:function reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null;}},{key:"setDefaultSearchParams",value:function setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{var e=t;this._defaultSearchParams=Object.keys(e).map(function(i){return"".concat(encodeURIComponent(i),"=").concat(encodeURIComponent(e[i]));}).join("&");}}},{key:"getAlias",value:function getAlias(t){var e=t.alias,i=t.name,s=t.src,n=t.srcs;return qe(e||i||s||n,function(o){var _o$src;return typeof o=="string"?o:Array.isArray(o)?o.map(function(a){var _ref130,_ref131;return(_ref130=(_ref131=a==null?void 0:a.src)!==null&&_ref131!==void 0?_ref131:a==null?void 0:a.srcs)!==null&&_ref130!==void 0?_ref130:a;}):o!=null&&o.src||o!=null&&o.srcs?(_o$src=o.src)!==null&&_o$src!==void 0?_o$src:o.srcs:o;},!0);}},{key:"addManifest",value:function addManifest(t){var _this91=this;this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(function(e){_this91.addBundle(e.name,e.assets);});}},{key:"addBundle",value:function addBundle(t,e){var _this92=this;var i=[];Array.isArray(e)?e.forEach(function(s){var _s$src,_s$alias;var n=(_s$src=s.src)!==null&&_s$src!==void 0?_s$src:s.srcs,o=(_s$alias=s.alias)!==null&&_s$alias!==void 0?_s$alias:s.name;var a;if(typeof o=="string"){var l=_this92._createBundleAssetId(t,o);i.push(l),a=[o,l];}else{var _l13=o.map(function(h){return _this92._createBundleAssetId(t,h);});i.push.apply(i,_toConsumableArray(_l13)),a=[].concat(_toConsumableArray(o),_toConsumableArray(_l13));}_this92.add(_objectSpread(_objectSpread({},s),{},{alias:a,src:n}));}):Object.keys(e).forEach(function(s){var n=[s,_this92._createBundleAssetId(t,s)];if(typeof e[s]=="string")_this92.add({alias:n,src:e[s]});else if(Array.isArray(e[s]))_this92.add({alias:n,src:e[s]});else{var _o$src2;var o=e[s],a=(_o$src2=o.src)!==null&&_o$src2!==void 0?_o$src2:o.srcs;_this92.add(_objectSpread(_objectSpread({},o),{},{alias:n,src:Array.isArray(a)?a:[a]}));}i.push.apply(i,n);}),this._bundles[t]=i;}},{key:"add",value:function add(t,e,i,s,n){var _this93=this;var o=[];typeof t=="string"||Array.isArray(t)&&typeof t[0]=="string"?(gt("7.2.0","Assets.add now uses an object instead of individual parameters.\nPlease use Assets.add({ alias, src, data, format, loadParser }) instead."),o.push({alias:t,src:e,data:i,format:s,loadParser:n})):Array.isArray(t)?o.push.apply(o,_toConsumableArray(t)):o.push(t);var a;a=function a(l){_this93.hasKey(l)&&console.warn("[Resolver] already has key: ".concat(l," overwriting"));},qe(o).forEach(function(l){var h=l.src,u=l.srcs;var c=l.data,d=l.format,p=l.loadParser;var f=qe(h||u).map(function(_){return typeof _=="string"?_T(_):Array.isArray(_)?_:[_];}),m=_this93.getAlias(l);Array.isArray(m)?m.forEach(a):a(m);var y=[];f.forEach(function(_){_.forEach(function(v){var _v$data,_v$format,_v$loadParser;var g={};if(_typeof(v)!="object"){g.src=v;for(var x=0;x<_this93._parsers.length;x++){var b=_this93._parsers[x];if(b.test(v)){g=b.parse(v);break;}}}else c=(_v$data=v.data)!==null&&_v$data!==void 0?_v$data:c,d=(_v$format=v.format)!==null&&_v$format!==void 0?_v$format:d,p=(_v$loadParser=v.loadParser)!==null&&_v$loadParser!==void 0?_v$loadParser:p,g=_objectSpread(_objectSpread({},g),v);if(!m)throw new Error("[Resolver] alias is undefined for this asset: ".concat(g.src));g=_this93.buildResolvedAsset(g,{aliases:m,data:c,format:d,loadParser:p}),y.push(g);});}),m.forEach(function(_){_this93._assetMap[_]=y;});});}},{key:"resolveBundle",value:function resolveBundle(t){var _this94=this;var e=uo(t);t=qe(t);var i={};return t.forEach(function(s){var n=_this94._bundles[s];if(n){var o=_this94.resolve(n),a={};for(var l in o){var h=o[l];a[_this94._extractAssetIdFromBundle(s,l)]=h;}i[s]=a;}}),e?i[t[0]]:i;}},{key:"resolveUrl",value:function resolveUrl(t){var e=this.resolve(t);if(typeof t!="string"){var i={};for(var s in e)i[s]=e[s].src;return i;}return e.src;}},{key:"resolve",value:function resolve(t){var _this95=this;var e=uo(t);t=qe(t);var i={};return t.forEach(function(s){if(!_this95._resolverHash[s])if(_this95._assetMap[s]){var _n$;var n=_this95._assetMap[s];var o=n[0],a=_this95._getPreferredOrder(n);a==null||a.priority.forEach(function(l){a.params[l].forEach(function(h){var u=n.filter(function(c){return c[l]?c[l]===h:!1;});u.length&&(n=u);});}),_this95._resolverHash[s]=(_n$=n[0])!==null&&_n$!==void 0?_n$:o;}else _this95._resolverHash[s]=_this95.buildResolvedAsset({alias:[s],src:s},{});i[s]=_this95._resolverHash[s];}),e?i[t[0]]:i;}},{key:"hasKey",value:function hasKey(t){return!!this._assetMap[t];}},{key:"hasBundle",value:function hasBundle(t){return!!this._bundles[t];}},{key:"_getPreferredOrder",value:function _getPreferredOrder(t){var _this96=this;var _loop2=function _loop2(){var i=t[0],s=_this96._preferredOrder.find(function(n){return n.params.format.includes(i.format);});if(s)return{v:s};};for(var e=0;e<t.length;e++){var _ret=_loop2();if(_typeof(_ret)==="object")return _ret.v;}return this._preferredOrder[0];}},{key:"_appendDefaultSearchParams",value:function _appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;var e=/\?/.test(t)?"&":"?";return"".concat(t).concat(e).concat(this._defaultSearchParams);}},{key:"buildResolvedAsset",value:function buildResolvedAsset(t,e){var _ref132,_ref133;var i=e.aliases,s=e.data,n=e.loadParser,o=e.format;return(this._basePath||this._rootPath)&&(t.src=se.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=(_ref132=i!==null&&i!==void 0?i:t.alias)!==null&&_ref132!==void 0?_ref132:[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data=_objectSpread(_objectSpread({},s||{}),t.data),t.loadParser=n!==null&&n!==void 0?n:t.loadParser,t.format=(_ref133=o!==null&&o!==void 0?o:t.format)!==null&&_ref133!==void 0?_ref133:se.extname(t.src).slice(1),t.srcs=t.src,t.name=t.alias,t;}}]);return YT;}();var jT=/*#__PURE__*/function(){function jT(){_classCallCheck(this,jT);this._detections=[],this._initialized=!1,this.resolver=new YT(),this.loader=new xT(),this.cache=Ei,this._backgroundLoader=new yT(this.loader),this._backgroundLoader.active=!0,this.reset();}_createClass(jT,[{key:"init",value:function(){var _init=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee18(){var _ref134;var t,n,o,a,e,i,s,_args18=arguments;return _regeneratorRuntime().wrap(function _callee18$(_context18){while(1)switch(_context18.prev=_context18.next){case 0:t=_args18.length>0&&_args18[0]!==undefined?_args18[0]:{};if(!this._initialized){_context18.next=4;break;}console.warn("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return _context18.abrupt("return");case 4:if(!(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest)){_context18.next=12;break;}a=t.manifest;_context18.t0=typeof a=="string";if(!_context18.t0){_context18.next=11;break;}_context18.next=10;return this.load(a);case 10:a=_context18.sent;case 11:this.resolver.addManifest(a);case 12:e=(_ref134=(n=t.texturePreference)==null?void 0:n.resolution)!==null&&_ref134!==void 0?_ref134:1;i=typeof e=="number"?[e]:e;_context18.next=16;return this._detectFormats({preferredFormats:(o=t.texturePreference)==null?void 0:o.format,skipDetections:t.skipDetections,detections:this._detections});case 16:s=_context18.sent;this.resolver.prefer({params:{format:s,resolution:i}}),t.preferences&&this.setPreferences(t.preferences);case 18:case"end":return _context18.stop();}},_callee18,this);}));function init(){return _init.apply(this,arguments);}return init;}()},{key:"add",value:function add(t,e,i,s,n){this.resolver.add(t,e,i,s,n);}},{key:"load",value:function(){var _load2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee19(t,e){var _this97=this;var i,s,n,o;return _regeneratorRuntime().wrap(function _callee19$(_context19){while(1)switch(_context19.prev=_context19.next){case 0:_context19.t0=this._initialized;if(_context19.t0){_context19.next=4;break;}_context19.next=4;return this.init();case 4:i=uo(t);s=qe(t).map(function(a){if(typeof a!="string"){var l=_this97.resolver.getAlias(a);return l.some(function(h){return!_this97.resolver.hasKey(h);})&&_this97.add(a),Array.isArray(l)?l[0]:l;}return _this97.resolver.hasKey(a)||_this97.add({alias:a,src:a}),a;});n=this.resolver.resolve(s);_context19.next=9;return this._mapLoadToResolve(n,e);case 9:o=_context19.sent;return _context19.abrupt("return",i?o[s[0]]:o);case 11:case"end":return _context19.stop();}},_callee19,this);}));function load(_x14,_x15){return _load2.apply(this,arguments);}return load;}()},{key:"addBundle",value:function addBundle(t,e){this.resolver.addBundle(t,e);}},{key:"loadBundle",value:function(){var _loadBundle=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee20(t,e){var _this98=this;var i,s,n,o,a,l,h,u;return _regeneratorRuntime().wrap(function _callee20$(_context20){while(1)switch(_context20.prev=_context20.next){case 0:_context20.t0=this._initialized;if(_context20.t0){_context20.next=4;break;}_context20.next=4;return this.init();case 4:i=!1;typeof t=="string"&&(i=!0,t=[t]);s=this.resolver.resolveBundle(t),n={},o=Object.keys(s);a=0,l=0;h=function h(){e==null||e(++a/l);},u=o.map(function(c){var d=s[c];return l+=Object.keys(d).length,_this98._mapLoadToResolve(d,h).then(function(p){n[c]=p;});});_context20.next=11;return Promise.all(u);case 11:return _context20.abrupt("return",i?n[t[0]]:n);case 12:case"end":return _context20.stop();}},_callee20,this);}));function loadBundle(_x16,_x17){return _loadBundle.apply(this,arguments);}return loadBundle;}()},{key:"backgroundLoad",value:function(){var _backgroundLoad=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee21(t){var e;return _regeneratorRuntime().wrap(function _callee21$(_context21){while(1)switch(_context21.prev=_context21.next){case 0:_context21.t0=this._initialized;if(_context21.t0){_context21.next=4;break;}_context21.next=4;return this.init();case 4:typeof t=="string"&&(t=[t]);e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e));case 7:case"end":return _context21.stop();}},_callee21,this);}));function backgroundLoad(_x18){return _backgroundLoad.apply(this,arguments);}return backgroundLoad;}()},{key:"backgroundLoadBundle",value:function(){var _backgroundLoadBundle=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee22(t){var _this99=this;var e;return _regeneratorRuntime().wrap(function _callee22$(_context22){while(1)switch(_context22.prev=_context22.next){case 0:_context22.t0=this._initialized;if(_context22.t0){_context22.next=4;break;}_context22.next=4;return this.init();case 4:typeof t=="string"&&(t=[t]);e=this.resolver.resolveBundle(t);Object.values(e).forEach(function(i){_this99._backgroundLoader.add(Object.values(i));});case 7:case"end":return _context22.stop();}},_callee22,this);}));function backgroundLoadBundle(_x19){return _backgroundLoadBundle.apply(this,arguments);}return backgroundLoadBundle;}()},{key:"reset",value:function reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1;}},{key:"get",value:function get(t){if(typeof t=="string")return Ei.get(t);var e={};for(var i=0;i<t.length;i++)e[i]=Ei.get(t[i]);return e;}},{key:"_mapLoadToResolve",value:function(){var _mapLoadToResolve2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee23(t,e){var i,s,n,o;return _regeneratorRuntime().wrap(function _callee23$(_context23){while(1)switch(_context23.prev=_context23.next){case 0:i=Object.values(t),s=Object.keys(t);this._backgroundLoader.active=!1;_context23.next=4;return this.loader.load(i,e);case 4:n=_context23.sent;this._backgroundLoader.active=!0;o={};return _context23.abrupt("return",(i.forEach(function(a,l){var h=n[a.src],u=[a.src];a.alias&&u.push.apply(u,_toConsumableArray(a.alias)),o[s[l]]=h,Ei.set(u,h);}),o));case 8:case"end":return _context23.stop();}},_callee23,this);}));function _mapLoadToResolve(_x20,_x21){return _mapLoadToResolve2.apply(this,arguments);}return _mapLoadToResolve;}()},{key:"unload",value:function(){var _unload2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee24(t){var e,i;return _regeneratorRuntime().wrap(function _callee24$(_context24){while(1)switch(_context24.prev=_context24.next){case 0:_context24.t0=this._initialized;if(_context24.t0){_context24.next=4;break;}_context24.next=4;return this.init();case 4:e=qe(t).map(function(s){return typeof s!="string"?s.src:s;}),i=this.resolver.resolve(e);_context24.next=7;return this._unloadFromResolved(i);case 7:case"end":return _context24.stop();}},_callee24,this);}));function unload(_x22){return _unload2.apply(this,arguments);}return unload;}()},{key:"unloadBundle",value:function(){var _unloadBundle=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee25(t){var _this100=this;var e,i;return _regeneratorRuntime().wrap(function _callee25$(_context25){while(1)switch(_context25.prev=_context25.next){case 0:_context25.t0=this._initialized;if(_context25.t0){_context25.next=4;break;}_context25.next=4;return this.init();case 4:t=qe(t);e=this.resolver.resolveBundle(t),i=Object.keys(e).map(function(s){return _this100._unloadFromResolved(e[s]);});_context25.next=8;return Promise.all(i);case 8:case"end":return _context25.stop();}},_callee25,this);}));function unloadBundle(_x23){return _unloadBundle.apply(this,arguments);}return unloadBundle;}()},{key:"_unloadFromResolved",value:function(){var _unloadFromResolved2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee26(t){var e;return _regeneratorRuntime().wrap(function _callee26$(_context26){while(1)switch(_context26.prev=_context26.next){case 0:e=Object.values(t);e.forEach(function(i){Ei.remove(i.src);});_context26.next=4;return this.loader.unload(e);case 4:case"end":return _context26.stop();}},_callee26,this);}));function _unloadFromResolved(_x24){return _unloadFromResolved2.apply(this,arguments);}return _unloadFromResolved;}()},{key:"_detectFormats",value:function(){var _detectFormats2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee27(t){var e,_iterator18,_step18,i;return _regeneratorRuntime().wrap(function _callee27$(_context27){while(1)switch(_context27.prev=_context27.next){case 0:e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);_iterator18=_createForOfIteratorHelper(t.detections);_context27.prev=3;_iterator18.s();case 5:if((_step18=_iterator18.n()).done){_context27.next=25;break;}i=_step18.value;_context27.t0=t.skipDetections;if(_context27.t0){_context27.next=12;break;}_context27.next=11;return i.test();case 11:_context27.t0=_context27.sent;case 12:if(!_context27.t0){_context27.next=18;break;}_context27.next=15;return i.add(e);case 15:e=_context27.sent;_context27.next=23;break;case 18:_context27.t1=t.skipDetections;if(_context27.t1){_context27.next=23;break;}_context27.next=22;return i.remove(e);case 22:e=_context27.sent;case 23:_context27.next=5;break;case 25:_context27.next=30;break;case 27:_context27.prev=27;_context27.t2=_context27["catch"](3);_iterator18.e(_context27.t2);case 30:_context27.prev=30;_iterator18.f();return _context27.finish(30);case 33:return _context27.abrupt("return",(e=e.filter(function(i,s){return e.indexOf(i)===s;}),e));case 34:case"end":return _context27.stop();}},_callee27,null,[[3,27,30,33]]);}));function _detectFormats(_x25){return _detectFormats2.apply(this,arguments);}return _detectFormats;}()},{key:"detections",get:function get(){return this._detections;}},{key:"preferWorkers",get:function get(){return co.config.preferWorkers;},set:function set(t){gt("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t});}},{key:"setPreferences",value:function setPreferences(t){this.loader.parsers.forEach(function(e){e.config&&Object.keys(e.config).filter(function(i){return i in t;}).forEach(function(i){e.config[i]=t[i];});});}}]);return jT;}();var fo=new jT();K.handleByList(W.LoadParser,fo.loader.parsers).handleByList(W.ResolveParser,fo.resolver.parsers).handleByList(W.CacheParser,fo.cache.parsers).handleByList(W.DetectionParser,fo.detections);var qT={extension:W.CacheParser,test:function test(r){return Array.isArray(r)&&r.every(function(t){return t instanceof Z;});},getCacheableAssets:function getCacheableAssets(r,t){var e={};return r.forEach(function(i){t.forEach(function(s,n){e[i+(n===0?"":n+1)]=s;});}),e;}};K.add(qT);function ip(_x26){return _ip.apply(this,arguments);}function _ip(){_ip=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee64(r){var t;return _regeneratorRuntime().wrap(function _callee64$(_context64){while(1)switch(_context64.prev=_context64.next){case 0:if(!("Image"in globalThis)){_context64.next=2;break;}return _context64.abrupt("return",new Promise(function(t){var e=new Image();e.onload=function(){t(!0);},e.onerror=function(){t(!1);},e.src=r;}));case 2:if(!("createImageBitmap"in globalThis&&"fetch"in globalThis)){_context64.next=17;break;}_context64.prev=3;_context64.next=6;return fetch(r);case 6:_context64.next=8;return _context64.sent.blob();case 8:t=_context64.sent;_context64.next=11;return createImageBitmap(t);case 11:_context64.next=16;break;case 13:_context64.prev=13;_context64.t0=_context64["catch"](3);return _context64.abrupt("return",!1);case 16:return _context64.abrupt("return",!0);case 17:return _context64.abrupt("return",!1);case 18:case"end":return _context64.stop();}},_callee64,null,[[3,13]]);}));return _ip.apply(this,arguments);}var KT={extension:{type:W.DetectionParser,priority:1},test:function(){var _test=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee28(){return _regeneratorRuntime().wrap(function _callee28$(_context28){while(1)switch(_context28.prev=_context28.next){case 0:return _context28.abrupt("return",ip("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="));case 1:case"end":return _context28.stop();}},_callee28);}));function test(){return _test.apply(this,arguments);}return test;}(),add:function(){var _add=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee29(r){return _regeneratorRuntime().wrap(function _callee29$(_context29){while(1)switch(_context29.prev=_context29.next){case 0:return _context29.abrupt("return",[].concat(_toConsumableArray(r),["avif"]));case 1:case"end":return _context29.stop();}},_callee29);}));function add(_x27){return _add.apply(this,arguments);}return add;}(),remove:function(){var _remove=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee30(r){return _regeneratorRuntime().wrap(function _callee30$(_context30){while(1)switch(_context30.prev=_context30.next){case 0:return _context30.abrupt("return",r.filter(function(t){return t!=="avif";}));case 1:case"end":return _context30.stop();}},_callee30);}));function remove(_x28){return _remove.apply(this,arguments);}return remove;}()};K.add(KT);var ZT={extension:{type:W.DetectionParser,priority:0},test:function(){var _test2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee31(){return _regeneratorRuntime().wrap(function _callee31$(_context31){while(1)switch(_context31.prev=_context31.next){case 0:return _context31.abrupt("return",ip("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="));case 1:case"end":return _context31.stop();}},_callee31);}));function test(){return _test2.apply(this,arguments);}return test;}(),add:function(){var _add2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee32(r){return _regeneratorRuntime().wrap(function _callee32$(_context32){while(1)switch(_context32.prev=_context32.next){case 0:return _context32.abrupt("return",[].concat(_toConsumableArray(r),["webp"]));case 1:case"end":return _context32.stop();}},_callee32);}));function add(_x29){return _add2.apply(this,arguments);}return add;}(),remove:function(){var _remove2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee33(r){return _regeneratorRuntime().wrap(function _callee33$(_context33){while(1)switch(_context33.prev=_context33.next){case 0:return _context33.abrupt("return",r.filter(function(t){return t!=="webp";}));case 1:case"end":return _context33.stop();}},_callee33);}));function remove(_x30){return _remove2.apply(this,arguments);}return remove;}()};K.add(ZT);var sp=["png","jpg","jpeg"],QT={extension:{type:W.DetectionParser,priority:-1},test:function test(){return Promise.resolve(!0);},add:function(){var _add3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee34(r){return _regeneratorRuntime().wrap(function _callee34$(_context34){while(1)switch(_context34.prev=_context34.next){case 0:return _context34.abrupt("return",[].concat(_toConsumableArray(r),sp));case 1:case"end":return _context34.stop();}},_callee34);}));function add(_x31){return _add3.apply(this,arguments);}return add;}(),remove:function(){var _remove3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee35(r){return _regeneratorRuntime().wrap(function _callee35$(_context35){while(1)switch(_context35.prev=_context35.next){case 0:return _context35.abrupt("return",r.filter(function(t){return!sp.includes(t);}));case 1:case"end":return _context35.stop();}},_callee35);}));function remove(_x32){return _remove3.apply(this,arguments);}return remove;}()};K.add(QT);var JT="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function Kl(r){return JT?!1:document.createElement("video").canPlayType(r)!=="";}var tw={extension:{type:W.DetectionParser,priority:0},test:function(){var _test3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee36(){return _regeneratorRuntime().wrap(function _callee36$(_context36){while(1)switch(_context36.prev=_context36.next){case 0:return _context36.abrupt("return",Kl("video/webm"));case 1:case"end":return _context36.stop();}},_callee36);}));function test(){return _test3.apply(this,arguments);}return test;}(),add:function(){var _add4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee37(r){return _regeneratorRuntime().wrap(function _callee37$(_context37){while(1)switch(_context37.prev=_context37.next){case 0:return _context37.abrupt("return",[].concat(_toConsumableArray(r),["webm"]));case 1:case"end":return _context37.stop();}},_callee37);}));function add(_x33){return _add4.apply(this,arguments);}return add;}(),remove:function(){var _remove4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee38(r){return _regeneratorRuntime().wrap(function _callee38$(_context38){while(1)switch(_context38.prev=_context38.next){case 0:return _context38.abrupt("return",r.filter(function(t){return t!=="webm";}));case 1:case"end":return _context38.stop();}},_callee38);}));function remove(_x34){return _remove4.apply(this,arguments);}return remove;}()};K.add(tw);var ew={extension:{type:W.DetectionParser,priority:0},test:function(){var _test4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee39(){return _regeneratorRuntime().wrap(function _callee39$(_context39){while(1)switch(_context39.prev=_context39.next){case 0:return _context39.abrupt("return",Kl("video/mp4"));case 1:case"end":return _context39.stop();}},_callee39);}));function test(){return _test4.apply(this,arguments);}return test;}(),add:function(){var _add5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee40(r){return _regeneratorRuntime().wrap(function _callee40$(_context40){while(1)switch(_context40.prev=_context40.next){case 0:return _context40.abrupt("return",[].concat(_toConsumableArray(r),["mp4","m4v"]));case 1:case"end":return _context40.stop();}},_callee40);}));function add(_x35){return _add5.apply(this,arguments);}return add;}(),remove:function(){var _remove5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee41(r){return _regeneratorRuntime().wrap(function _callee41$(_context41){while(1)switch(_context41.prev=_context41.next){case 0:return _context41.abrupt("return",r.filter(function(t){return t!=="mp4"&&t!=="m4v";}));case 1:case"end":return _context41.stop();}},_callee41);}));function remove(_x36){return _remove5.apply(this,arguments);}return remove;}()};K.add(ew);var rw={extension:{type:W.DetectionParser,priority:0},test:function(){var _test5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee42(){return _regeneratorRuntime().wrap(function _callee42$(_context42){while(1)switch(_context42.prev=_context42.next){case 0:return _context42.abrupt("return",Kl("video/ogg"));case 1:case"end":return _context42.stop();}},_callee42);}));function test(){return _test5.apply(this,arguments);}return test;}(),add:function(){var _add6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee43(r){return _regeneratorRuntime().wrap(function _callee43$(_context43){while(1)switch(_context43.prev=_context43.next){case 0:return _context43.abrupt("return",[].concat(_toConsumableArray(r),["ogv"]));case 1:case"end":return _context43.stop();}},_callee43);}));function add(_x37){return _add6.apply(this,arguments);}return add;}(),remove:function(){var _remove6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee44(r){return _regeneratorRuntime().wrap(function _callee44$(_context44){while(1)switch(_context44.prev=_context44.next){case 0:return _context44.abrupt("return",r.filter(function(t){return t!=="ogv";}));case 1:case"end":return _context44.stop();}},_callee44);}));function remove(_x38){return _remove6.apply(this,arguments);}return remove;}()};K.add(rw);var iw={extension:W.ResolveParser,test:co.test,parse:function parse(r){var _ref135;var t;return{resolution:parseFloat((_ref135=(t=j.RETINA_PREFIX.exec(r))==null?void 0:t[1])!==null&&_ref135!==void 0?_ref135:"1"),format:se.extname(r).slice(1),src:r};}};K.add(iw);var ue=function(r){return r[r.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",r[r.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",r[r.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",r[r.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",r[r.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",r[r.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",r[r.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",r[r.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",r[r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",r[r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",r[r.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",r[r.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",r[r.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",r[r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",r[r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",r[r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",r;}(ue||{});var po={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35987:1,34798:1,37808:1,36492:1,36493:1,36494:1,36495:1};var fr,ns;function np(){ns={bptc:fr.getExtension("EXT_texture_compression_bptc"),astc:fr.getExtension("WEBGL_compressed_texture_astc"),etc:fr.getExtension("WEBGL_compressed_texture_etc"),s3tc:fr.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:fr.getExtension("WEBGL_compressed_texture_s3tc_srgb"),pvrtc:fr.getExtension("WEBGL_compressed_texture_pvrtc")||fr.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:fr.getExtension("WEBGL_compressed_texture_etc1"),atc:fr.getExtension("WEBGL_compressed_texture_atc")};}var sw={extension:{type:W.DetectionParser,priority:2},test:function(){var _test6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee45(){var r;return _regeneratorRuntime().wrap(function _callee45$(_context45){while(1)switch(_context45.prev=_context45.next){case 0:r=j.ADAPTER.createCanvas().getContext("webgl");return _context45.abrupt("return",r?(fr=r,!0):(console.warn("WebGL not available for compressed textures."),!1));case 2:case"end":return _context45.stop();}},_callee45);}));function test(){return _test6.apply(this,arguments);}return test;}(),add:function(){var _add7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee46(r){var t,e;return _regeneratorRuntime().wrap(function _callee46$(_context46){while(1)switch(_context46.prev=_context46.next){case 0:ns||np();t=[];for(e in ns)ns[e]&&t.push(e);return _context46.abrupt("return",[].concat(t,_toConsumableArray(r)));case 4:case"end":return _context46.stop();}},_callee46);}));function add(_x39){return _add7.apply(this,arguments);}return add;}(),remove:function(){var _remove7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee47(r){return _regeneratorRuntime().wrap(function _callee47$(_context47){while(1)switch(_context47.prev=_context47.next){case 0:return _context47.abrupt("return",(ns||np(),r.filter(function(t){return!(t in ns);})));case 1:case"end":return _context47.stop();}},_callee47);}));function remove(_x40){return _remove7.apply(this,arguments);}return remove;}()};K.add(sw);var nw=/*#__PURE__*/function(_$n){_inherits(nw,_$n);var _super56=_createSuper(nw);function nw(t){var _this101;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{width:1,height:1,autoLoad:!0};_classCallCheck(this,nw);var i,s;typeof t=="string"?(i=t,s=new Uint8Array()):(i=null,s=t),_this101=_super56.call(this,s,e),_this101.origin=i,_this101.buffer=s?new ml(s):null,_this101._load=null,_this101.loaded=!1,_this101.origin!==null&&e.autoLoad!==!1&&_this101.load(),_this101.origin===null&&_this101.buffer&&(_this101._load=Promise.resolve(_assertThisInitialized(_this101)),_this101.loaded=!0,_this101.onBlobLoaded(_this101.buffer.rawBinaryData));return _this101;}_createClass(nw,[{key:"onBlobLoaded",value:function onBlobLoaded(t){}},{key:"load",value:function load(){var _this102=this;return this._load?this._load:(this._load=fetch(this.origin).then(function(t){return t.blob();}).then(function(t){return t.arrayBuffer();}).then(function(t){return _this102.data=new Uint32Array(t),_this102.buffer=new ml(t),_this102.loaded=!0,_this102.onBlobLoaded(t),_this102.update(),_this102;}),this._load);}}]);return nw;}($n);var Ti=/*#__PURE__*/function(_nw){_inherits(Ti,_nw);var _super57=_createSuper(Ti);function Ti(t,e){var _this103;_classCallCheck(this,Ti);_this103=_super57.call(this,t,e),_this103.format=e.format,_this103.levels=e.levels||1,_this103._width=e.width,_this103._height=e.height,_this103._extension=Ti._formatToExtension(_this103.format),(e.levelBuffers||_this103.buffer)&&(_this103._levelBuffers=e.levelBuffers||Ti._createLevelBuffers(t instanceof Uint8Array?t:_this103.buffer.uint8View,_this103.format,_this103.levels,4,4,_this103.width,_this103.height));return _this103;}_createClass(Ti,[{key:"upload",value:function upload(t,e,i){var s=t.gl;if(!t.context.extensions[this._extension])throw new Error("".concat(this._extension," textures are not supported on the current machine"));if(!this._levelBuffers)return!1;s.pixelStorei(s.UNPACK_ALIGNMENT,4);for(var n=0,o=this.levels;n<o;n++){var _this$_levelBuffers$n=this._levelBuffers[n],_a12=_this$_levelBuffers$n.levelID,_l14=_this$_levelBuffers$n.levelWidth,h=_this$_levelBuffers$n.levelHeight,u=_this$_levelBuffers$n.levelBuffer;s.compressedTexImage2D(s.TEXTURE_2D,_a12,this.format,_l14,h,0,u);}return!0;}},{key:"onBlobLoaded",value:function onBlobLoaded(){this._levelBuffers=Ti._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height);}}],[{key:"_formatToExtension",value:function _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=35916&&t<=35919)return"s3tc_sRGB";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t===36196)return"etc1";if(t===35986||t===35987||t===34798)return"atc";if(t>=36492&&t<=36495)return"bptc";if(t===37808)return"astc";throw new Error("Invalid (compressed) texture format given: ".concat(t));}},{key:"_createLevelBuffers",value:function _createLevelBuffers(t,e,i,s,n,o,a){var l=new Array(i);var h=t.byteOffset,u=o,c=a,d=u+s-1&~(s-1),p=c+n-1&~(n-1),f=d*p*po[e];for(var m=0;m<i;m++)l[m]={levelID:m,levelWidth:i>1?u:d,levelHeight:i>1?c:p,levelBuffer:new Uint8Array(t.buffer,h,f)},h+=f,u=u>>1||1,c=c>>1||1,d=u+s-1&~(s-1),p=c+n-1&~(n-1),f=d*p*po[e];return l;}}]);return Ti;}(nw);var Zl=4,mo=124,ow=32,op=20,aw=542327876,go={HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},lw={FOURCC:2},yo={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3},hw=1,uw=2,cw=4,dw=64,fw=512,pw=131072,mw=827611204,gw=861165636,yw=894720068,_w=808540228,vw=4,xw=(_xw={},_defineProperty(_xw,mw,ue.COMPRESSED_RGBA_S3TC_DXT1_EXT),_defineProperty(_xw,gw,ue.COMPRESSED_RGBA_S3TC_DXT3_EXT),_defineProperty(_xw,yw,ue.COMPRESSED_RGBA_S3TC_DXT5_EXT),_xw),bw={70:ue.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:ue.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:ue.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:ue.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:ue.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:ue.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:ue.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:ue.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:ue.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,96:ue.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,95:ue.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,98:ue.COMPRESSED_RGBA_BPTC_UNORM_EXT,99:ue.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT};function Ew(r){var t=new Uint32Array(r);if(t[0]!==aw)throw new Error("Invalid DDS file magic word");var e=new Uint32Array(r,0,mo/Uint32Array.BYTES_PER_ELEMENT),i=e[go.HEIGHT],s=e[go.WIDTH],n=e[go.MIPMAP_COUNT],o=new Uint32Array(r,go.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,ow/Uint32Array.BYTES_PER_ELEMENT),a=o[hw];if(a&cw){var _l15=o[lw.FOURCC];if(_l15!==_w){var v=xw[_l15],g=Zl+mo,x=new Uint8Array(r,g);return[new Ti(x,{format:v,width:s,height:i,levels:n})];}var h=Zl+mo,u=new Uint32Array(t.buffer,h,op/Uint32Array.BYTES_PER_ELEMENT),c=u[yo.DXGI_FORMAT],d=u[yo.RESOURCE_DIMENSION],p=u[yo.MISC_FLAG],f=u[yo.ARRAY_SIZE],m=bw[c];if(m===void 0)throw new Error("DDSParser cannot parse texture data with DXGI format ".concat(c));if(p===vw)throw new Error("DDSParser does not support cubemap textures");if(d===6)throw new Error("DDSParser does not supported 3D texture data");var y=new Array(),_=Zl+mo+op;if(f===1)y.push(new Uint8Array(r,_));else{var _v6=po[m];var _g5=0,_x41=s,b=i;for(var w=0;w<n;w++){var T=Math.max(1,_x41+3&-4),N=Math.max(1,b+3&-4),F=T*N*_v6;_g5+=F,_x41=_x41>>>1,b=b>>>1;}var S=_;for(var _w2=0;_w2<f;_w2++)y.push(new Uint8Array(r,S,_g5)),S+=_g5;}return y.map(function(v){return new Ti(v,{format:m,width:s,height:i,levels:n});});}throw a&dw?new Error("DDSParser does not support uncompressed texture data."):a&fw?new Error("DDSParser does not supported YUV uncompressed texture data."):a&pw?new Error("DDSParser does not support single-channel (lumninance) texture data!"):a&uw?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!");}var ap=[171,75,84,88,32,49,49,187,13,10,26,10],Tw=67305985,Ze={ENDIANNESS:12,GL_TYPE:16,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},Ql=64,lp=(_lp={},_defineProperty(_lp,tt.UNSIGNED_BYTE,1),_defineProperty(_lp,tt.UNSIGNED_SHORT,2),_defineProperty(_lp,tt.INT,4),_defineProperty(_lp,tt.UNSIGNED_INT,4),_defineProperty(_lp,tt.FLOAT,4),_defineProperty(_lp,tt.HALF_FLOAT,8),_lp),ww=(_ww={},_defineProperty(_ww,H.RGBA,4),_defineProperty(_ww,H.RGB,3),_defineProperty(_ww,H.RG,2),_defineProperty(_ww,H.RED,1),_defineProperty(_ww,H.LUMINANCE,1),_defineProperty(_ww,H.LUMINANCE_ALPHA,2),_defineProperty(_ww,H.ALPHA,1),_ww),Aw=(_Aw={},_defineProperty(_Aw,tt.UNSIGNED_SHORT_4_4_4_4,2),_defineProperty(_Aw,tt.UNSIGNED_SHORT_5_5_5_1,2),_defineProperty(_Aw,tt.UNSIGNED_SHORT_5_6_5,2),_Aw);function Sw(r,t){var e=arguments.length>2&&arguments[2]!==undefined?arguments[2]:!1;var i=new DataView(t);if(!Cw(r,i))return null;var s=i.getUint32(Ze.ENDIANNESS,!0)===Tw,n=i.getUint32(Ze.GL_TYPE,s),o=i.getUint32(Ze.GL_FORMAT,s),a=i.getUint32(Ze.GL_INTERNAL_FORMAT,s),l=i.getUint32(Ze.PIXEL_WIDTH,s),h=i.getUint32(Ze.PIXEL_HEIGHT,s)||1,u=i.getUint32(Ze.PIXEL_DEPTH,s)||1,c=i.getUint32(Ze.NUMBER_OF_ARRAY_ELEMENTS,s)||1,d=i.getUint32(Ze.NUMBER_OF_FACES,s),p=i.getUint32(Ze.NUMBER_OF_MIPMAP_LEVELS,s),f=i.getUint32(Ze.BYTES_OF_KEY_VALUE_DATA,s);if(h===0||u!==1)throw new Error("Only 2D textures are supported");if(d!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(c!==1)throw new Error("WebGL does not support array textures");var m=4,y=4,_=l+3&-4,v=h+3&-4,g=new Array(c);var x=l*h;n===0&&(x=_*v);var b;if(n!==0?lp[n]?b=lp[n]*ww[o]:b=Aw[n]:b=po[a],b===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");var S=e?Rw(i,f,s):null;var w=x*b,T=l,N=h,F=_,z=v,C=Ql+f;for(var E=0;E<p;E++){var I=i.getUint32(C,s);var P=C+4;for(var $=0;$<c;$++){var k=g[$];k||(k=g[$]=new Array(p)),k[E]={levelID:E,levelWidth:p>1||n!==0?T:F,levelHeight:p>1||n!==0?N:z,levelBuffer:new Uint8Array(t,P,w)},P+=w;}C+=I+4,C=C%4!==0?C+4-C%4:C,T=T>>1||1,N=N>>1||1,F=T+m-1&-4,z=N+y-1&-4,w=F*z*b;}return n!==0?{uncompressed:g.map(function(E){var I=E[0].levelBuffer,P=!1;return n===tt.FLOAT?I=new Float32Array(E[0].levelBuffer.buffer,E[0].levelBuffer.byteOffset,E[0].levelBuffer.byteLength/4):n===tt.UNSIGNED_INT?(P=!0,I=new Uint32Array(E[0].levelBuffer.buffer,E[0].levelBuffer.byteOffset,E[0].levelBuffer.byteLength/4)):n===tt.INT&&(P=!0,I=new Int32Array(E[0].levelBuffer.buffer,E[0].levelBuffer.byteOffset,E[0].levelBuffer.byteLength/4)),{resource:new $n(I,{width:E[0].levelWidth,height:E[0].levelHeight}),type:n,format:P?Iw(o):o};}),kvData:S}:{compressed:g.map(function(E){return new Ti(null,{format:a,width:l,height:h,levels:p,levelBuffers:E});}),kvData:S};}function Cw(r,t){for(var e=0;e<ap.length;e++)if(t.getUint8(e)!==ap[e])return console.error("".concat(r," is not a valid *.ktx file!")),!1;return!0;}function Iw(r){switch(r){case H.RGBA:return H.RGBA_INTEGER;case H.RGB:return H.RGB_INTEGER;case H.RG:return H.RG_INTEGER;case H.RED:return H.RED_INTEGER;default:return r;}}function Rw(r,t,e){var i=new Map();var s=0;for(;s<t;){var n=r.getUint32(Ql+s,e),o=Ql+s+4,_a13=3-(n+3)%4;if(n===0||n>t-s){console.error("KTXLoader: keyAndValueByteSize out of bounds");break;}var _l16=0;for(;_l16<n&&r.getUint8(o+_l16)!==0;_l16++);if(_l16===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break;}var h=new TextDecoder().decode(new Uint8Array(r.buffer,o,_l16)),u=new DataView(r.buffer,o+_l16+1,n-_l16-1);i.set(h,u),s+=4+n+_a13;}return i;}var Mw={extension:{type:W.LoadParser,priority:Ke.High},name:"loadDDS",test:function test(r){return $r(r,".dds");},load:function load(r,t,e){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee48(){var i,s;return _regeneratorRuntime().wrap(function _callee48$(_context48){while(1)switch(_context48.prev=_context48.next){case 0:_context48.next=2;return j.ADAPTER.fetch(r);case 2:_context48.next=4;return _context48.sent.arrayBuffer();case 4:i=_context48.sent;s=Ew(i).map(function(n){var o=new ft(n,_objectSpread({mipmap:ir.OFF,alphaMode:Ce.NO_PREMULTIPLIED_ALPHA,resolution:Ar(r)},t.data));return zs(o,e,r);});return _context48.abrupt("return",s.length===1?s[0]:s);case 7:case"end":return _context48.stop();}},_callee48);}))();},unload:function unload(r){Array.isArray(r)?r.forEach(function(t){return t.destroy(!0);}):r.destroy(!0);}};K.add(Mw);var Pw={extension:{type:W.LoadParser,priority:Ke.High},name:"loadKTX",test:function test(r){return $r(r,".ktx");},load:function load(r,t,e){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee49(){var i,_Sw,s,n,o,a,l,h;return _regeneratorRuntime().wrap(function _callee49$(_context49){while(1)switch(_context49.prev=_context49.next){case 0:_context49.next=2;return j.ADAPTER.fetch(r);case 2:_context49.next=4;return _context49.sent.arrayBuffer();case 4:i=_context49.sent;_Sw=Sw(r,i);s=_Sw.compressed;n=_Sw.uncompressed;o=_Sw.kvData;a=s!==null&&s!==void 0?s:n;l=_objectSpread({mipmap:ir.OFF,alphaMode:Ce.NO_PREMULTIPLIED_ALPHA,resolution:Ar(r)},t.data);h=a.map(function(u){var _u$resource;a===n&&Object.assign(l,{type:u.type,format:u.format});var c=(_u$resource=u.resource)!==null&&_u$resource!==void 0?_u$resource:u,d=new ft(c,l);return d.ktxKeyValueData=o,zs(d,e,r);});return _context49.abrupt("return",h.length===1?h[0]:h);case 13:case"end":return _context49.stop();}},_callee49);}))();},unload:function unload(r){Array.isArray(r)?r.forEach(function(t){return t.destroy(!0);}):r.destroy(!0);}};K.add(Pw);var Ow=["s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"],Nw={extension:W.ResolveParser,test:function test(r){var t=se.extname(r).slice(1);return["basis","ktx","dds"].includes(t);},parse:function parse(r){var _ref137;var i,s;var t=r.split("."),e=t.pop();if(["ktx","dds"].includes(e)){var _ref136;var n=t.pop();if(Ow.includes(n))return{resolution:parseFloat((_ref136=(i=j.RETINA_PREFIX.exec(r))==null?void 0:i[1])!==null&&_ref136!==void 0?_ref136:"1"),format:n,src:r};}return{resolution:parseFloat((_ref137=(s=j.RETINA_PREFIX.exec(r))==null?void 0:s[1])!==null&&_ref137!==void 0?_ref137:"1"),format:e,src:r};}};K.add(Nw);var _o=new pt(),Dw=4,hp=/*#__PURE__*/function(){function Zs(t){_classCallCheck(this,Zs);this.renderer=t,this._rendererPremultipliedAlpha=!1;}_createClass(Zs,[{key:"contextChange",value:function contextChange(){var e;var t=(e=this.renderer)==null?void 0:e.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha);}},{key:"image",value:function(){var _image=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee50(t,e,i,s){var n;return _regeneratorRuntime().wrap(function _callee50$(_context50){while(1)switch(_context50.prev=_context50.next){case 0:n=new Image();_context50.next=3;return this.base64(t,e,i,s);case 3:n.src=_context50.sent;return _context50.abrupt("return",n);case 5:case"end":return _context50.stop();}},_callee50,this);}));function image(_x42,_x43,_x44,_x45){return _image.apply(this,arguments);}return image;}()},{key:"base64",value:function(){var _base=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee51(t,e,i,s){var n,o;return _regeneratorRuntime().wrap(function _callee51$(_context51){while(1)switch(_context51.prev=_context51.next){case 0:n=this.canvas(t,s);if(!(n.toBlob!==void 0)){_context51.next=3;break;}return _context51.abrupt("return",new Promise(function(o,a){n.toBlob(function(l){if(!l){a(new Error("ICanvas.toBlob failed!"));return;}var h=new FileReader();h.onload=function(){return o(h.result);},h.onerror=a,h.readAsDataURL(l);},e,i);}));case 3:if(!(n.toDataURL!==void 0)){_context51.next=5;break;}return _context51.abrupt("return",n.toDataURL(e,i));case 5:if(!(n.convertToBlob!==void 0)){_context51.next=10;break;}_context51.next=8;return n.convertToBlob({type:e,quality:i});case 8:o=_context51.sent;return _context51.abrupt("return",new Promise(function(a,l){var h=new FileReader();h.onload=function(){return a(h.result);},h.onerror=l,h.readAsDataURL(o);}));case 10:throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented");case 11:case"end":return _context51.stop();}},_callee51,this);}));function base64(_x46,_x47,_x48,_x49){return _base.apply(this,arguments);}return base64;}()},{key:"canvas",value:function canvas(t,e){var _this$_rawPixels=this._rawPixels(t,e),i=_this$_rawPixels.pixels,s=_this$_rawPixels.width,n=_this$_rawPixels.height,o=_this$_rawPixels.flipY,a=_this$_rawPixels.premultipliedAlpha;o&&Zs._flipY(i,s,n),a&&Zs._unpremultiplyAlpha(i);var l=new pb(s,n,1),h=new ImageData(new Uint8ClampedArray(i.buffer),s,n);return l.context.putImageData(h,0,0),l.canvas;}},{key:"pixels",value:function pixels(t,e){var _this$_rawPixels2=this._rawPixels(t,e),i=_this$_rawPixels2.pixels,s=_this$_rawPixels2.width,n=_this$_rawPixels2.height,o=_this$_rawPixels2.flipY,a=_this$_rawPixels2.premultipliedAlpha;return o&&Zs._flipY(i,s,n),a&&Zs._unpremultiplyAlpha(i),i;}},{key:"_rawPixels",value:function _rawPixels(t,e){var i=this.renderer;if(!i)throw new Error("The Extract has already been destroyed");var s,n=!1,o=!1,a,l=!1;t&&(t instanceof _i?a=t:(a=i.generateTexture(t,{region:e,resolution:i.resolution,multisample:i.multisample}),l=!0,e&&(_o.width=e.width,_o.height=e.height,e=_o)));var h=i.gl;if(a){var _e15;if(s=a.baseTexture.resolution,e=(_e15=e)!==null&&_e15!==void 0?_e15:a.frame,n=!1,o=a.baseTexture.alphaMode>0&&a.baseTexture.format===H.RGBA,!l){i.renderTexture.bind(a);var p=a.framebuffer.glFramebuffers[i.CONTEXT_UID];p.blitFramebuffer&&i.framebuffer.bind(p.blitFramebuffer);}}else s=i.resolution,e||(e=_o,e.width=i.width/s,e.height=i.height/s),n=!0,o=this._rendererPremultipliedAlpha,i.renderTexture.bind();var u=Math.max(Math.round(e.width*s),1),c=Math.max(Math.round(e.height*s),1),d=new Uint8Array(Dw*u*c);return h.readPixels(Math.round(e.x*s),Math.round(e.y*s),u,c,h.RGBA,h.UNSIGNED_BYTE,d),l&&(a==null||a.destroy(!0)),{pixels:d,width:u,height:c,flipY:n,premultipliedAlpha:o};}},{key:"destroy",value:function destroy(){this.renderer=null;}}],[{key:"_flipY",value:function _flipY(t,e,i){var s=e<<2,n=i>>1,o=new Uint8Array(s);for(var _a14=0;_a14<n;_a14++){var _l17=_a14*s,h=(i-_a14-1)*s;o.set(t.subarray(_l17,_l17+s)),t.copyWithin(_l17,h,h+s),t.set(o,h);}}},{key:"_unpremultiplyAlpha",value:function _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));var e=t.length;for(var i=0;i<e;i+=4){var s=t[i+3];if(s!==0){var n=255.001/s;t[i]=t[i]*n+.5,t[i+1]=t[i+1]*n+.5,t[i+2]=t[i+2]*n+.5;}}}}]);return Zs;}();hp.extension={name:"extract",type:W.RendererSystem};var Lw=hp;K.add(Lw);var vo={build:function build(r){var t=r.points;var e,i,s,n,o,a;if(r.type===he.CIRC){var f=r.shape;e=f.x,i=f.y,o=a=f.radius,s=n=0;}else if(r.type===he.ELIP){var _f3=r.shape;e=_f3.x,i=_f3.y,o=_f3.width,a=_f3.height,s=n=0;}else{var _f4=r.shape,m=_f4.width/2,y=_f4.height/2;e=_f4.x+m,i=_f4.y+y,o=a=Math.max(0,Math.min(_f4.radius,Math.min(m,y))),s=m-o,n=y-a;}if(!(o>=0&&a>=0&&s>=0&&n>=0)){t.length=0;return;}var l=Math.ceil(2.3*Math.sqrt(o+a)),h=l*8+(s?4:0)+(n?4:0);if(t.length=h,h===0)return;if(l===0){t.length=8,t[0]=t[6]=e+s,t[1]=t[3]=i+n,t[2]=t[4]=e-s,t[5]=t[7]=i-n;return;}var u=0,c=l*4+(s?2:0)+2,d=c,p=h;{var _f5=s+o,_m8=n,_y4=e+_f5,_=e-_f5,v=i+_m8;if(t[u++]=_y4,t[u++]=v,t[--c]=v,t[--c]=_,n){var g=i-_m8;t[d++]=_,t[d++]=g,t[--p]=g,t[--p]=_y4;}}for(var _f6=1;_f6<l;_f6++){var _m9=Math.PI/2*(_f6/l),_y5=s+Math.cos(_m9)*o,_2=n+Math.sin(_m9)*a,_v7=e+_y5,_g6=e-_y5,x=i+_2,b=i-_2;t[u++]=_v7,t[u++]=x,t[--c]=x,t[--c]=_g6,t[d++]=_g6,t[d++]=b,t[--p]=b,t[--p]=_v7;}{var _f7=s,_m10=n+a,_y6=e+_f7,_3=e-_f7,_v8=i+_m10,_g7=i-_m10;t[u++]=_y6,t[u++]=_v8,t[--p]=_g7,t[--p]=_y6,s&&(t[u++]=_3,t[u++]=_v8,t[--p]=_g7,t[--p]=_3);}},triangulate:function triangulate(r,t){var e=r.points,i=t.points,s=t.indices;if(e.length===0)return;var n=i.length/2;var o=n;var a,l;if(r.type!==he.RREC){var u=r.shape;a=u.x,l=u.y;}else{var _u5=r.shape;a=_u5.x+_u5.width/2,l=_u5.y+_u5.height/2;}var h=r.matrix;i.push(r.matrix?h.a*a+h.c*l+h.tx:a,r.matrix?h.b*a+h.d*l+h.ty:l),n++,i.push(e[0],e[1]);for(var _u6=2;_u6<e.length;_u6+=2)i.push(e[_u6],e[_u6+1]),s.push(n++,o,n);s.push(o+1,o,n);}};function up(r){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!1;var e=r.length;if(e<6)return;var i=0;for(var s=0,n=r[e-2],o=r[e-1];s<e;s+=2){var _a15=r[s],_l18=r[s+1];i+=(_a15-n)*(_l18+o),n=_a15,o=_l18;}if(!t&&i>0||t&&i<=0){var _s9=e/2;for(var _n10=_s9+_s9%2;_n10<e;_n10+=2){var _ref138,_ref139;var _o15=e-_n10-2,_a16=e-_n10-1,_l19=_n10,h=_n10+1;(_ref138=[r[_l19],r[_o15]],r[_o15]=_ref138[0],r[_l19]=_ref138[1]),(_ref139=[r[h],r[_a16]],r[_a16]=_ref139[0],r[h]=_ref139[1]);}}}var cp={build:function build(r){r.points=r.shape.points.slice();},triangulate:function triangulate(r,t){var e=r.points;var i=r.holes,s=t.points,n=t.indices;if(e.length>=6){up(e,!1);var o=[];for(var h=0;h<i.length;h++){var u=i[h];up(u.points,!0),o.push(e.length/2),e=e.concat(u.points);}var _a17=G0(e,o,2);if(!_a17)return;var _l20=s.length/2;for(var _h12=0;_h12<_a17.length;_h12+=3)n.push(_a17[_h12]+_l20),n.push(_a17[_h12+1]+_l20),n.push(_a17[_h12+2]+_l20);for(var _h13=0;_h13<e.length;_h13++)s.push(e[_h13]);}}},Bw={build:function build(r){var t=r.shape,e=t.x,i=t.y,s=t.width,n=t.height,o=r.points;o.length=0,s>=0&&n>=0&&o.push(e,i,e+s,i,e+s,i+n,e,i+n);},triangulate:function triangulate(r,t){var e=r.points,i=t.points;if(e.length===0)return;var s=i.length/2;i.push(e[0],e[1],e[2],e[3],e[6],e[7],e[4],e[5]),t.indices.push(s,s+1,s+2,s+1,s+2,s+3);}},Fw={build:function build(r){vo.build(r);},triangulate:function triangulate(r,t){vo.triangulate(r,t);}};var Fe=function(r){return r.MITER="miter",r.BEVEL="bevel",r.ROUND="round",r;}(Fe||{}),Hr=function(r){return r.BUTT="butt",r.ROUND="round",r.SQUARE="square",r;}(Hr||{});var os={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount:function _segmentsCount(r){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:20;if(!this.adaptive||!r||isNaN(r))return t;var e=Math.ceil(r/this.maxLength);return e<this.minSegments?e=this.minSegments:e>this.maxSegments&&(e=this.maxSegments),e;}};var dp=/*#__PURE__*/function(){function dp(){_classCallCheck(this,dp);}_createClass(dp,null,[{key:"curveTo",value:function curveTo(t,e,i,s,n,o){var a=o[o.length-2],l=o[o.length-1]-e,h=a-t,u=s-e,c=i-t,d=Math.abs(l*c-h*u);if(d<1e-8||n===0)return(o[o.length-2]!==t||o[o.length-1]!==e)&&o.push(t,e),null;var p=l*l+h*h,f=u*u+c*c,m=l*u+h*c,y=n*Math.sqrt(p)/d,_=n*Math.sqrt(f)/d,v=y*m/p,g=_*m/f,x=y*c+_*h,b=y*u+_*l,S=h*(_+v),w=l*(_+v),T=c*(y+g),N=u*(y+g),F=Math.atan2(w-b,S-x),z=Math.atan2(N-b,T-x);return{cx:x+t,cy:b+e,radius:n,startAngle:F,endAngle:z,anticlockwise:h*u>c*l};}},{key:"arc",value:function arc(t,e,i,s,n,o,a,l,h){var u=a-o,c=os._segmentsCount(Math.abs(u)*n,Math.ceil(Math.abs(u)/Vn)*40),d=u/(c*2),p=d*2,f=Math.cos(d),m=Math.sin(d),y=c-1,_=y%1/y;for(var v=0;v<=y;++v){var g=v+_*v,x=d+o+p*g,b=Math.cos(x),S=-Math.sin(x);h.push((f*b+m*S)*n+i,(f*-S+m*b)*n+s);}}}]);return dp;}();var Uw=/*#__PURE__*/function(){function Uw(){_classCallCheck(this,Uw);this.reset();}_createClass(Uw,[{key:"begin",value:function begin(t,e,i){this.reset(),this.style=t,this.start=e,this.attribStart=i;}},{key:"end",value:function end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start;}},{key:"reset",value:function reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0;}}]);return Uw;}();var Jl=/*#__PURE__*/function(){function Jl(){_classCallCheck(this,Jl);}_createClass(Jl,null,[{key:"curveLength",value:function curveLength(t,e,i,s,n,o,a,l){var h=0,u=0,c=0,d=0,p=0,f=0,m=0,y=0,_=0,v=0,g=0,x=t,b=e;for(var S=1;S<=10;++S)u=S/10,c=u*u,d=c*u,p=1-u,f=p*p,m=f*p,y=m*t+3*f*u*i+3*p*c*n+d*a,_=m*e+3*f*u*s+3*p*c*o+d*l,v=x-y,g=b-_,x=y,b=_,h+=Math.sqrt(v*v+g*g);return h;}},{key:"curveTo",value:function curveTo(t,e,i,s,n,o,a){var l=a[a.length-2],h=a[a.length-1];a.length-=2;var u=os._segmentsCount(Jl.curveLength(l,h,t,e,i,s,n,o));var c=0,d=0,p=0,f=0,m=0;a.push(l,h);for(var y=1,_=0;y<=u;++y)_=y/u,c=1-_,d=c*c,p=d*c,f=_*_,m=f*_,a.push(p*l+3*d*_*t+3*c*f*i+m*n,p*h+3*d*_*e+3*c*f*s+m*o);}}]);return Jl;}();function fp(r,t,e,i,s,n,o,a){var l=r-e*s,h=t-i*s,u=r+e*n,c=t+i*n;var d,p;o?(d=i,p=-e):(d=-i,p=e);var f=l+d,m=h+p,y=u+d,_=c+p;return a.push(f,m,y,_),2;}function wi(r,t,e,i,s,n,o,a){var l=e-r,h=i-t;var u=Math.atan2(l,h),c=Math.atan2(s-r,n-t);a&&u<c?u+=Math.PI*2:!a&&u>c&&(c+=Math.PI*2);var d=u;var p=c-u,f=Math.abs(p),m=Math.sqrt(l*l+h*h),y=(15*f*Math.sqrt(m)/Math.PI>>0)+1,_=p/y;if(d+=_,a){o.push(r,t,e,i);for(var v=1,g=d;v<y;v++,g+=_)o.push(r,t,r+Math.sin(g)*m,t+Math.cos(g)*m);o.push(r,t,s,n);}else{o.push(e,i,r,t);for(var _v9=1,_g8=d;_v9<y;_v9++,_g8+=_)o.push(r+Math.sin(_g8)*m,t+Math.cos(_g8)*m,r,t);o.push(s,n,r,t);}return y*2;}function kw(r,t){var e=r.shape;var i=r.points||e.points.slice();var s=t.closePointEps;if(i.length===0)return;var n=r.lineStyle,o=new bt(i[0],i[1]),a=new bt(i[i.length-2],i[i.length-1]),l=e.type!==he.POLY||e.closeStroke,h=Math.abs(o.x-a.x)<s&&Math.abs(o.y-a.y)<s;if(l){i=i.slice(),h&&(i.pop(),i.pop(),a.set(i[i.length-2],i[i.length-1]));var k=(o.x+a.x)*.5,G=(a.y+o.y)*.5;i.unshift(k,G),i.push(k,G);}var u=t.points,c=i.length/2;var d=i.length;var p=u.length/2,f=n.width/2,m=f*f,y=n.miterLimit*n.miterLimit;var _=i[0],v=i[1],g=i[2],x=i[3],b=0,S=0,w=-(v-x),T=_-g,N=0,F=0,z=Math.sqrt(w*w+T*T);w/=z,T/=z,w*=f,T*=f;var C=n.alignment,E=(1-C)*2,I=C*2;l||(n.cap===Hr.ROUND?d+=wi(_-w*(E-I)*.5,v-T*(E-I)*.5,_-w*E,v-T*E,_+w*I,v+T*I,u,!0)+2:n.cap===Hr.SQUARE&&(d+=fp(_,v,w,T,E,I,!0,u))),u.push(_-w*E,v-T*E,_+w*I,v+T*I);for(var _k=1;_k<c-1;++_k){_=i[(_k-1)*2],v=i[(_k-1)*2+1],g=i[_k*2],x=i[_k*2+1],b=i[(_k+1)*2],S=i[(_k+1)*2+1],w=-(v-x),T=_-g,z=Math.sqrt(w*w+T*T),w/=z,T/=z,w*=f,T*=f,N=-(x-S),F=g-b,z=Math.sqrt(N*N+F*F),N/=z,F/=z,N*=f,F*=f;var _G=g-_,st=v-x,M=g-b,L=S-x,V=_G*M+st*L,rt=st*M-L*_G,Q=rt<0;if(Math.abs(rt)<.001*Math.abs(V)){u.push(g-w*E,x-T*E,g+w*I,x+T*I),V>=0&&(n.join===Fe.ROUND?d+=wi(g,x,g-w*E,x-T*E,g-N*E,x-F*E,u,!1)+4:d+=2,u.push(g-N*I,x-F*I,g+N*E,x+F*E));continue;}var X=(-w+_)*(-T+x)-(-w+g)*(-T+v),_t=(-N+b)*(-F+x)-(-N+g)*(-F+S),St=(_G*_t-M*X)/rt,O=(L*X-st*_t)/rt,D=(St-g)*(St-g)+(O-x)*(O-x),ut=g+(St-g)*E,lt=x+(O-x)*E,Et=g-(St-g)*I,Tt=x-(O-x)*I,mr=Math.min(_G*_G+st*st,M*M+L*L),gr=Q?E:I,js=mr+gr*gr*m,SC=D<=js;var Lo=n.join;if(Lo===Fe.MITER&&D/m>y&&(Lo=Fe.BEVEL),SC)switch(Lo){case Fe.MITER:{u.push(ut,lt,Et,Tt);break;}case Fe.BEVEL:{Q?u.push(ut,lt,g+w*I,x+T*I,ut,lt,g+N*I,x+F*I):u.push(g-w*E,x-T*E,Et,Tt,g-N*E,x-F*E,Et,Tt),d+=2;break;}case Fe.ROUND:{Q?(u.push(ut,lt,g+w*I,x+T*I),d+=wi(g,x,g+w*I,x+T*I,g+N*I,x+F*I,u,!0)+4,u.push(ut,lt,g+N*I,x+F*I)):(u.push(g-w*E,x-T*E,Et,Tt),d+=wi(g,x,g-w*E,x-T*E,g-N*E,x-F*E,u,!1)+4,u.push(g-N*E,x-F*E,Et,Tt));break;}}else{switch(u.push(g-w*E,x-T*E,g+w*I,x+T*I),Lo){case Fe.MITER:{Q?u.push(Et,Tt,Et,Tt):u.push(ut,lt,ut,lt),d+=2;break;}case Fe.ROUND:{Q?d+=wi(g,x,g+w*I,x+T*I,g+N*I,x+F*I,u,!0)+2:d+=wi(g,x,g-w*E,x-T*E,g-N*E,x-F*E,u,!1)+2;break;}}u.push(g-N*E,x-F*E,g+N*I,x+F*I),d+=2;}}_=i[(c-2)*2],v=i[(c-2)*2+1],g=i[(c-1)*2],x=i[(c-1)*2+1],w=-(v-x),T=_-g,z=Math.sqrt(w*w+T*T),w/=z,T/=z,w*=f,T*=f,u.push(g-w*E,x-T*E,g+w*I,x+T*I),l||(n.cap===Hr.ROUND?d+=wi(g-w*(E-I)*.5,x-T*(E-I)*.5,g-w*E,x-T*E,g+w*I,x+T*I,u,!1)+2:n.cap===Hr.SQUARE&&(d+=fp(g,x,w,T,E,I,!1,u)));var P=t.indices,$=os.epsilon*os.epsilon;for(var _k2=p;_k2<d+p-2;++_k2)_=u[_k2*2],v=u[_k2*2+1],g=u[(_k2+1)*2],x=u[(_k2+1)*2+1],b=u[(_k2+2)*2],S=u[(_k2+2)*2+1],!(Math.abs(_*(x-S)+g*(S-v)+b*(v-x))<$)&&P.push(_k2,_k2+1,_k2+2);}function Gw(r,t){var e=0;var i=r.shape,s=r.points||i.points,n=i.type!==he.POLY||i.closeStroke;if(s.length===0)return;var o=t.points,a=t.indices,l=s.length/2,h=o.length/2;var u=h;for(o.push(s[0],s[1]),e=1;e<l;e++)o.push(s[e*2],s[e*2+1]),a.push(u,u+1),u++;n&&a.push(u,h);}function pp(r,t){r.lineStyle["native"]?Gw(r,t):kw(r,t);}var th=/*#__PURE__*/function(){function th(){_classCallCheck(this,th);}_createClass(th,null,[{key:"curveLength",value:function curveLength(t,e,i,s,n,o){var a=t-2*i+n,l=e-2*s+o,h=2*i-2*t,u=2*s-2*e,c=4*(a*a+l*l),d=4*(a*h+l*u),p=h*h+u*u,f=2*Math.sqrt(c+d+p),m=Math.sqrt(c),y=2*c*m,_=2*Math.sqrt(p),v=d/m;return(y*f+m*d*(f-_)+(4*p*c-d*d)*Math.log((2*m+v+f)/(v+_)))/(4*y);}},{key:"curveTo",value:function curveTo(t,e,i,s,n){var o=n[n.length-2],a=n[n.length-1],l=os._segmentsCount(th.curveLength(o,a,t,e,i,s));var h=0,u=0;for(var c=1;c<=l;++c){var d=c/l;h=o+(t-o)*d,u=a+(e-a)*d,n.push(h+(t+(i-t)*d-h)*d,u+(e+(s-e)*d-u)*d);}}}]);return th;}();var eh=(_eh={},_defineProperty(_eh,he.POLY,cp),_defineProperty(_eh,he.CIRC,vo),_defineProperty(_eh,he.ELIP,vo),_defineProperty(_eh,he.RECT,Bw),_defineProperty(_eh,he.RREC,Fw),_eh),mp=[],xo=[];var bo=/*#__PURE__*/function(){function bo(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;_classCallCheck(this,bo);this.points=[],this.holes=[],this.shape=t,this.lineStyle=i,this.fillStyle=e,this.matrix=s,this.type=t.type;}_createClass(bo,[{key:"clone",value:function clone(){return new bo(this.shape,this.fillStyle,this.lineStyle,this.matrix);}},{key:"destroy",value:function destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null;}}]);return bo;}();var as=new bt(),gp=/*#__PURE__*/function(_Yd){_inherits(Im,_Yd);var _super58=_createSuper(Im);function Im(){var _this104;_classCallCheck(this,Im);_this104=_super58.call(this),_this104.closePointEps=1e-4,_this104.boundsPadding=0,_this104.uvsFloat32=null,_this104.indicesUint16=null,_this104.batchable=!1,_this104.points=[],_this104.colors=[],_this104.uvs=[],_this104.indices=[],_this104.textureIds=[],_this104.graphicsData=[],_this104.drawCalls=[],_this104.batchDirty=-1,_this104.batches=[],_this104.dirty=0,_this104.cacheDirty=-1,_this104.clearDirty=0,_this104.shapeIndex=0,_this104._bounds=new ao(),_this104.boundsDirty=-1;return _this104;}_createClass(Im,[{key:"bounds",get:function get(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds;}},{key:"invalidate",value:function invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(var t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),xo.push(this.drawCalls[t]);this.drawCalls.length=0;for(var _t20=0;_t20<this.batches.length;_t20++){var e=this.batches[_t20];e.reset(),mp.push(e);}this.batches.length=0;}},{key:"clear",value:function clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this;}},{key:"drawShape",value:function drawShape(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var n=new bo(t,e,i,s);return this.graphicsData.push(n),this.dirty++,this;}},{key:"drawHole",value:function drawHole(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!this.graphicsData.length)return null;var i=new bo(t,null,null,e),s=this.graphicsData[this.graphicsData.length-1];return i.lineStyle=s.lineStyle,s.holes.push(i),this.dirty++,this;}},{key:"destroy",value:function destroy(){_get(_getPrototypeOf(Im.prototype),"destroy",this).call(this);for(var t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null;}},{key:"containsPoint",value:function containsPoint(t){var e=this.graphicsData;for(var i=0;i<e.length;++i){var s=e[i];if(s.fillStyle.visible&&s.shape&&(s.matrix?s.matrix.applyInverse(t,as):as.copyFrom(t),s.shape.contains(as.x,as.y))){var n=!1;if(s.holes){for(var o=0;o<s.holes.length;o++)if(s.holes[o].shape.contains(as.x,as.y)){n=!0;break;}}if(!n)return!0;}}return!1;}},{key:"updateBatches",value:function updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return;}if(!this.validateBatching())return;this.cacheDirty=this.dirty;var t=this.uvs,e=this.graphicsData;var i=null,s=null;this.batches.length>0&&(i=this.batches[this.batches.length-1],s=i.style);for(var _l21=this.shapeIndex;_l21<e.length;_l21++){this.shapeIndex++;var h=e[_l21],u=h.fillStyle,c=h.lineStyle;eh[h.type].build(h),h.matrix&&this.transformPoints(h.points,h.matrix),(u.visible||c.visible)&&this.processHoles(h.holes);for(var d=0;d<2;d++){var p=d===0?u:c;if(!p.visible)continue;var f=p.texture.baseTexture,m=this.indices.length,y=this.points.length/2;f.wrapMode=Dr.REPEAT,d===0?this.processFill(h):this.processLine(h);var _=this.points.length/2-y;_!==0&&(i&&!this._compareStyles(s,p)&&(i.end(m,y),i=null),i||(i=mp.pop()||new Uw(),i.begin(p,m,y),this.batches.push(i),s=p),this.addUvs(this.points,t,p.texture,y,_,p.matrix));}}var n=this.indices.length,o=this.points.length/2;if(i&&i.end(n,o),this.batches.length===0){this.batchable=!0;return;}var a=o>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&a===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=a?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls();}},{key:"_compareStyles",value:function _compareStyles(t,e){return!(!t||!e||t.texture.baseTexture!==e.texture.baseTexture||t.color+t.alpha!==e.color+e.alpha||!!t["native"]!=!!e["native"]);}},{key:"validateBatching",value:function validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(var t=0,e=this.graphicsData.length;t<e;t++){var i=this.graphicsData[t],s=i.fillStyle,n=i.lineStyle;if(s&&!s.texture.baseTexture.valid||n&&!n.texture.baseTexture.valid)return!1;}return!0;}},{key:"packBatches",value:function packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);var t=this.batches;for(var e=0,i=t.length;e<i;e++){var s=t[e];for(var n=0;n<s.size;n++){var o=s.start+n;this.indicesUint16[o]=this.indicesUint16[o]-s.attribStart;}}}},{key:"isBatchable",value:function isBatchable(){if(this.points.length>65535*2)return!1;var t=this.batches;for(var e=0;e<t.length;e++)if(t[e].style["native"])return!1;return this.points.length<Im.BATCHABLE_SIZE*2;}},{key:"buildDrawCalls",value:function buildDrawCalls(){var t=++ft._globalBatch;for(var c=0;c<this.drawCalls.length;c++)this.drawCalls[c].texArray.clear(),xo.push(this.drawCalls[c]);this.drawCalls.length=0;var e=this.colors,i=this.textureIds;var s=xo.pop();s||(s=new wl(),s.texArray=new Ml()),s.texArray.count=0,s.start=0,s.size=0,s.type=rr.TRIANGLES;var n=0,o=null,a=0,l=!1,h=rr.TRIANGLES,u=0;this.drawCalls.push(s);for(var _c13=0;_c13<this.batches.length;_c13++){var d=this.batches[_c13],p=8,f=d.style,m=f.texture.baseTexture;l!==!!f["native"]&&(l=!!f["native"],h=l?rr.LINES:rr.TRIANGLES,o=null,n=p,t++),o!==m&&(o=m,m._batchEnabled!==t&&(n===p&&(t++,n=0,s.size>0&&(s=xo.pop(),s||(s=new wl(),s.texArray=new Ml()),this.drawCalls.push(s)),s.start=u,s.size=0,s.texArray.count=0,s.type=h),m.touched=1,m._batchEnabled=t,m._batchLocation=n,m.wrapMode=Dr.REPEAT,s.texArray.elements[s.texArray.count++]=m,n++)),s.size+=d.size,u+=d.size,a=m._batchLocation,this.addColors(e,f.color,f.alpha,d.attribSize,d.attribStart),this.addTextureIds(i,a,d.attribSize,d.attribStart);}ft._globalBatch=t,this.packAttributes();}},{key:"packAttributes",value:function packAttributes(){var t=this.points,e=this.uvs,i=this.colors,s=this.textureIds,n=new ArrayBuffer(t.length*3*4),o=new Float32Array(n),a=new Uint32Array(n);var l=0;for(var h=0;h<t.length/2;h++)o[l++]=t[h*2],o[l++]=t[h*2+1],o[l++]=e[h*2],o[l++]=e[h*2+1],a[l++]=i[h],o[l++]=s[h];this._buffer.update(n),this._indexBuffer.update(this.indicesUint16);}},{key:"processFill",value:function processFill(t){t.holes.length?cp.triangulate(t,this):eh[t.type].triangulate(t,this);}},{key:"processLine",value:function processLine(t){pp(t,this);for(var e=0;e<t.holes.length;e++)pp(t.holes[e],this);}},{key:"processHoles",value:function processHoles(t){for(var e=0;e<t.length;e++){var i=t[e];eh[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix);}}},{key:"calculateBounds",value:function calculateBounds(){var t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding);}},{key:"transformPoints",value:function transformPoints(t,e){for(var i=0;i<t.length/2;i++){var s=t[i*2],n=t[i*2+1];t[i*2]=e.a*s+e.c*n+e.tx,t[i*2+1]=e.b*s+e.d*n+e.ty;}}},{key:"addColors",value:function addColors(t,e,i,s){var n=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var o=wt.shared.setValue(e).toLittleEndianNumber(),a=wt.shared.setValue(o).toPremultiplied(i);t.length=Math.max(t.length,n+s);for(var _l22=0;_l22<s;_l22++)t[n+_l22]=a;}},{key:"addTextureIds",value:function addTextureIds(t,e,i){var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;t.length=Math.max(t.length,s+i);for(var n=0;n<i;n++)t[s+n]=e;}},{key:"addUvs",value:function addUvs(t,e,i,s,n){var o=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;var a=0;var l=e.length,h=i.frame;for(;a<n;){var c=t[(s+a)*2],d=t[(s+a)*2+1];if(o){var p=o.a*c+o.c*d+o.tx;d=o.b*c+o.d*d+o.ty,c=p;}a++,e.push(c/h.width,d/h.height);}var u=i.baseTexture;(h.width<u.width||h.height<u.height)&&this.adjustUvs(e,i,l,n);}},{key:"adjustUvs",value:function adjustUvs(t,e,i,s){var n=e.baseTexture,o=1e-6,a=i+s*2,l=e.frame,h=l.width/n.width,u=l.height/n.height;var c=l.x/l.width,d=l.y/l.height,p=Math.floor(t[i]+o),f=Math.floor(t[i+1]+o);for(var m=i+2;m<a;m+=2)p=Math.min(p,Math.floor(t[m]+o)),f=Math.min(f,Math.floor(t[m+1]+o));c-=p,d-=f;for(var _m11=i;_m11<a;_m11+=2)t[_m11]=(t[_m11]+c)*h,t[_m11+1]=(t[_m11+1]+d)*u;}}]);return Im;}(Yd);gp.BATCHABLE_SIZE=100;var $w=gp;var Eo=/*#__PURE__*/function(){function Eo(){_classCallCheck(this,Eo);this.color=16777215,this.alpha=1,this.texture=Z.WHITE,this.matrix=null,this.visible=!1,this.reset();}_createClass(Eo,[{key:"clone",value:function clone(){var t=new Eo();return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t;}},{key:"reset",value:function reset(){this.color=16777215,this.alpha=1,this.texture=Z.WHITE,this.matrix=null,this.visible=!1;}},{key:"destroy",value:function destroy(){this.texture=null,this.matrix=null;}}]);return Eo;}();var rh=/*#__PURE__*/function(_Eo){_inherits(rh,_Eo);var _super59=_createSuper(rh);function rh(){var _this105;_classCallCheck(this,rh);_this105=_super59.apply(this,arguments),_this105.width=0,_this105.alignment=.5,_this105["native"]=!1,_this105.cap=Hr.BUTT,_this105.join=Fe.MITER,_this105.miterLimit=10;return _this105;}_createClass(rh,[{key:"clone",value:function clone(){var t=new rh();return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t["native"]=this["native"],t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t;}},{key:"reset",value:function reset(){_get(_getPrototypeOf(rh.prototype),"reset",this).call(this),this.color=0,this.alignment=.5,this.width=0,this["native"]=!1,this.cap=Hr.BUTT,this.join=Fe.MITER,this.miterLimit=10;}}]);return rh;}(Eo);var ih={},sh=/*#__PURE__*/function(_Ye2){_inherits(Go,_Ye2);var _super60=_createSuper(Go);function Go(){var _this106;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;_classCallCheck(this,Go);_this106=_super60.call(this),_this106.shader=null,_this106.pluginName="batch",_this106.currentPath=null,_this106.batches=[],_this106.batchTint=-1,_this106.batchDirty=-1,_this106.vertexData=null,_this106._fillStyle=new Eo(),_this106._lineStyle=new rh(),_this106._matrix=null,_this106._holeMode=!1,_this106.state=cr.for2d(),_this106._geometry=t||new $w(),_this106._geometry.refCount++,_this106._transformID=-1,_this106._tintColor=new wt(16777215),_this106.blendMode=at.NORMAL;return _this106;}_createClass(Go,[{key:"geometry",get:function get(){return this._geometry;}},{key:"clone",value:function clone(){return this.finishPoly(),new Go(this._geometry);}},{key:"blendMode",get:function get(){return this.state.blendMode;},set:function set(t){this.state.blendMode=t;}},{key:"tint",get:function get(){return this._tintColor.value;},set:function set(t){this._tintColor.setValue(t);}},{key:"fill",get:function get(){return this._fillStyle;}},{key:"line",get:function get(){return this._lineStyle;}},{key:"lineStyle",value:function lineStyle(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var i=arguments.length>2?arguments[2]:undefined;var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:.5;var n=arguments.length>4&&arguments[4]!==undefined?arguments[4]:!1;return typeof t=="number"&&(t={width:t,color:e,alpha:i,alignment:s,"native":n}),this.lineTextureStyle(t);}},{key:"lineTextureStyle",value:function lineTextureStyle(t){var e={width:0,texture:Z.WHITE,color:t!=null&&t.texture?16777215:0,matrix:null,alignment:.5,"native":!1,cap:Hr.BUTT,join:Fe.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();var i=t.width>0&&t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:i},t)):this._lineStyle.reset(),this;}},{key:"startPoly",value:function startPoly(){if(this.currentPath){var t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new di(),this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]));}else this.currentPath=new di(),this.currentPath.closeStroke=!1;}},{key:"finishPoly",value:function finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0);}},{key:"moveTo",value:function moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this;}},{key:"lineTo",value:function lineTo(t,e){this.currentPath||this.moveTo(0,0);var i=this.currentPath.points,s=i[i.length-2],n=i[i.length-1];return(s!==t||n!==e)&&i.push(t,e),this;}},{key:"_initCurve",value:function _initCurve(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[t,e]):this.moveTo(t,e);}},{key:"quadraticCurveTo",value:function quadraticCurveTo(t,e,i,s){this._initCurve();var n=this.currentPath.points;return n.length===0&&this.moveTo(0,0),th.curveTo(t,e,i,s,n),this;}},{key:"bezierCurveTo",value:function bezierCurveTo(t,e,i,s,n,o){return this._initCurve(),Jl.curveTo(t,e,i,s,n,o,this.currentPath.points),this;}},{key:"arcTo",value:function arcTo(t,e,i,s,n){this._initCurve(t,e);var o=this.currentPath.points,a=dp.curveTo(t,e,i,s,n,o);if(a){var _l23=a.cx,h=a.cy,u=a.radius,c=a.startAngle,d=a.endAngle,p=a.anticlockwise;this.arc(_l23,h,u,c,d,p);}return this;}},{key:"arc",value:function arc(t,e,i,s,n){var o=arguments.length>5&&arguments[5]!==undefined?arguments[5]:!1;if(s===n)return this;if(!o&&n<=s?n+=Vn:o&&s<=n&&(s+=Vn),n-s===0)return this;var a=t+Math.cos(s)*i,l=e+Math.sin(s)*i,h=this._geometry.closePointEps;var u=this.currentPath?this.currentPath.points:null;if(u){var c=Math.abs(u[u.length-2]-a),d=Math.abs(u[u.length-1]-l);c<h&&d<h||u.push(a,l);}else this.moveTo(a,l),u=this.currentPath.points;return dp.arc(a,l,t,e,i,s,n,o,u),this;}},{key:"beginFill",value:function beginFill(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var e=arguments.length>1?arguments[1]:undefined;return this.beginTextureFill({texture:Z.WHITE,color:t,alpha:e});}},{key:"normalizeColor",value:function normalizeColor(t){var _t$color,_t$alpha;var e=wt.shared.setValue((_t$color=t.color)!==null&&_t$color!==void 0?_t$color:0);t.color=e.toNumber(),(_t$alpha=t.alpha)!==null&&_t$alpha!==void 0?_t$alpha:t.alpha=e.alpha;}},{key:"beginTextureFill",value:function beginTextureFill(t){var e={texture:Z.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();var i=t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:i},t)):this._fillStyle.reset(),this;}},{key:"endFill",value:function endFill(){return this.finishPoly(),this._fillStyle.reset(),this;}},{key:"drawRect",value:function drawRect(t,e,i,s){return this.drawShape(new pt(t,e,i,s));}},{key:"drawRoundedRect",value:function drawRoundedRect(t,e,i,s,n){return this.drawShape(new Yn(t,e,i,s,n));}},{key:"drawCircle",value:function drawCircle(t,e,i){return this.drawShape(new zn(t,e,i));}},{key:"drawEllipse",value:function drawEllipse(t,e,i,s){return this.drawShape(new Wn(t,e,i,s));}},{key:"drawPolygon",value:function drawPolygon(){var e,i=!0;for(var _len11=arguments.length,t=new Array(_len11),_key11=0;_key11<_len11;_key11++){t[_key11]=arguments[_key11];}var s=t[0];s.points?(i=s.closeStroke,e=s.points):Array.isArray(t[0])?e=t[0]:e=t;var n=new di(e);return n.closeStroke=i,this.drawShape(n),this;}},{key:"drawShape",value:function drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this;}},{key:"clear",value:function clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this;}},{key:"isFastRect",value:function isFastRect(){var t=this._geometry.graphicsData;return t.length===1&&t[0].shape.type===he.RECT&&!t[0].matrix&&!t[0].holes.length&&!(t[0].lineStyle.visible&&t[0].lineStyle.width);}},{key:"_render",value:function _render(t){this.finishPoly();var e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t));}},{key:"_populateBatches",value:function _populateBatches(){var t=this._geometry,e=this.blendMode,i=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=i,this.vertexData=new Float32Array(t.points);for(var s=0;s<i;s++){var n=t.batches[s],o=n.style.color,_a18=new Float32Array(this.vertexData.buffer,n.attribStart*4*2,n.attribSize*2),_l24=new Float32Array(t.uvsFloat32.buffer,n.attribStart*4*2,n.attribSize*2),h=new Uint16Array(t.indicesUint16.buffer,n.start*2,n.size),u={vertexData:_a18,blendMode:e,indices:h,uvs:_l24,_batchRGB:wt.shared.setValue(o).toRgbArray(),_tintRGB:o,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[s]=u;}}},{key:"_renderBatched",value:function _renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(var e=0,i=this.batches.length;e<i;e++){var s=this.batches[e];s.worldAlpha=this.worldAlpha*s.alpha,t.plugins[this.pluginName].render(s);}}}},{key:"_renderDirect",value:function _renderDirect(t){var e=this._resolveDirectShader(t),i=this._geometry,s=this.worldAlpha,n=e.uniforms,o=i.drawCalls;n.translationMatrix=this.transform.worldTransform,wt.shared.setValue(this._tintColor).premultiply(s).toArray(n.tint),t.shader.bind(e),t.geometry.bind(i,e),t.state.set(this.state);for(var _a19=0,_l25=o.length;_a19<_l25;_a19++)this._renderDrawCallDirect(t,i.drawCalls[_a19]);}},{key:"_renderDrawCallDirect",value:function _renderDrawCallDirect(t,e){var i=e.texArray,s=e.type,n=e.size,o=e.start,a=i.count;for(var _l26=0;_l26<a;_l26++)t.texture.bind(i.elements[_l26],_l26);t.geometry.draw(s,n,o);}},{key:"_resolveDirectShader",value:function _resolveDirectShader(t){var e=this.shader;var i=this.pluginName;if(!e){if(!ih[i]){var s=t.plugins[i].maxTextures,n=new Int32Array(s);for(var _l27=0;_l27<s;_l27++)n[_l27]=_l27;var o={tint:new Float32Array([1,1,1,1]),translationMatrix:new Rt(),"default":We.from({uSamplers:n},!0)},_a20=t.plugins[i]._shader.program;ih[i]=new dr(_a20,o);}e=ih[i];}return e;}},{key:"_calculateBounds",value:function _calculateBounds(){this.finishPoly();var t=this._geometry;if(!t.graphicsData.length)return;var _t$bounds=t.bounds,e=_t$bounds.minX,i=_t$bounds.minY,s=_t$bounds.maxX,n=_t$bounds.maxY;this._bounds.addFrame(this.transform,e,i,s,n);}},{key:"containsPoint",value:function containsPoint(t){return this.worldTransform.applyInverse(t,Go._TEMP_POINT),this._geometry.containsPoint(Go._TEMP_POINT);}},{key:"calculateTints",value:function calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(var t=0;t<this.batches.length;t++){var e=this.batches[t];e._tintRGB=wt.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber();}}}},{key:"calculateVertices",value:function calculateVertices(){var t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;var e=this.transform.worldTransform,i=e.a,s=e.b,n=e.c,o=e.d,a=e.tx,l=e.ty,h=this._geometry.points,u=this.vertexData;var c=0;for(var d=0;d<h.length;d+=2){var p=h[d],f=h[d+1];u[c++]=i*p+n*f+a,u[c++]=o*f+s*p+l;}}},{key:"closePath",value:function closePath(){var t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this;}},{key:"setMatrix",value:function setMatrix(t){return this._matrix=t,this;}},{key:"beginHole",value:function beginHole(){return this.finishPoly(),this._holeMode=!0,this;}},{key:"endHole",value:function endHole(){return this.finishPoly(),this._holeMode=!1,this;}},{key:"destroy",value:function destroy(t){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,_get(_getPrototypeOf(Go.prototype),"destroy",this).call(this,t);}}]);return Go;}(Ye);sh.curves=os,sh._TEMP_POINT=new bt();var Ws=sh;var Hw=/*#__PURE__*/function(){function Hw(t,e){_classCallCheck(this,Hw);this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0;}_createClass(Hw,[{key:"update",value:function update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;var e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++;}}]);return Hw;}();var nh=new bt(),yp=new di(),_p=/*#__PURE__*/function(_Ye3){_inherits(Rm,_Ye3);var _super61=_createSuper(Rm);function Rm(t,e,i){var _this107;var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:rr.TRIANGLES;_classCallCheck(this,Rm);_this107=_super61.call(this),_this107.geometry=t,_this107.shader=e,_this107.state=i||cr.for2d(),_this107.drawMode=s,_this107.start=0,_this107.size=0,_this107.uvs=null,_this107.indices=null,_this107.vertexData=new Float32Array(1),_this107.vertexDirty=-1,_this107._transformID=-1,_this107._roundPixels=j.ROUND_PIXELS,_this107.batchUvs=null;return _this107;}_createClass(Rm,[{key:"geometry",get:function get(){return this._geometry;},set:function set(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1);}},{key:"uvBuffer",get:function get(){return this.geometry.buffers[1];}},{key:"verticesBuffer",get:function get(){return this.geometry.buffers[0];}},{key:"material",get:function get(){return this.shader;},set:function set(t){this.shader=t;}},{key:"blendMode",get:function get(){return this.state.blendMode;},set:function set(t){this.state.blendMode=t;}},{key:"roundPixels",get:function get(){return this._roundPixels;},set:function set(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t;}},{key:"tint",get:function get(){return"tint"in this.shader?this.shader.tint:null;},set:function set(t){this.shader.tint=t;}},{key:"tintValue",get:function get(){return this.shader.tintValue;}},{key:"texture",get:function get(){return"texture"in this.shader?this.shader.texture:null;},set:function set(t){this.shader.texture=t;}},{key:"_render",value:function _render(t){var e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===rr.TRIANGLES&&e.length<Rm.BATCHABLE_SIZE*2?this._renderToBatch(t):this._renderDefault(t);}},{key:"_renderDefault",value:function _renderDefault(t){var e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount);}},{key:"_renderToBatch",value:function _renderToBatch(t){var e=this.geometry,i=this.shader;i.uvMatrix&&(i.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=i._tintRGB,this._texture=i.texture;var s=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[s]),t.plugins[s].render(this);}},{key:"calculateVertices",value:function calculateVertices(){var t=this.geometry.buffers[0],e=t.data,i=t._updateID;if(i===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));var s=this.transform.worldTransform,n=s.a,o=s.b,a=s.c,l=s.d,h=s.tx,u=s.ty,c=this.vertexData;for(var d=0;d<c.length/2;d++){var p=e[d*2],f=e[d*2+1];c[d*2]=n*p+a*f+h,c[d*2+1]=o*p+l*f+u;}if(this._roundPixels){var _d6=j.RESOLUTION;for(var _p7=0;_p7<c.length;++_p7)c[_p7]=Math.round(c[_p7]*_d6)/_d6;}this.vertexDirty=i;}},{key:"calculateUvs",value:function calculateUvs(){var t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new Hw(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data);}},{key:"_calculateBounds",value:function _calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length);}},{key:"containsPoint",value:function containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,nh);var e=this.geometry.getBuffer("aVertexPosition").data,i=yp.points,s=this.geometry.getIndex().data,n=s.length,o=this.drawMode===4?3:1;for(var _a21=0;_a21+2<n;_a21+=o){var _l28=s[_a21]*2,h=s[_a21+1]*2,u=s[_a21+2]*2;if(i[0]=e[_l28],i[1]=e[_l28+1],i[2]=e[h],i[3]=e[h+1],i[4]=e[u],i[5]=e[u+1],yp.contains(nh.x,nh.y))return!0;}return!1;}},{key:"destroy",value:function destroy(t){_get(_getPrototypeOf(Rm.prototype),"destroy",this).call(this,t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null;}}]);return Rm;}(Ye);_p.BATCHABLE_SIZE=100;var vp=_p;var Vw=/*#__PURE__*/function(_kr4){_inherits(Vw,_kr4);var _super62=_createSuper(Vw);function Vw(t,e,i){var _this108;_classCallCheck(this,Vw);_this108=_super62.call(this);var s=new Vt(t),n=new Vt(e,!0),o=new Vt(i,!0,!0);_this108.addAttribute("aVertexPosition",s,2,!1,tt.FLOAT).addAttribute("aTextureCoord",n,2,!1,tt.FLOAT).addIndex(o),_this108._updateId=-1;return _this108;}_createClass(Vw,[{key:"vertexDirtyId",get:function get(){return this.buffers[0]._updateID;}}]);return Vw;}(kr);var Xw="varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n",zw="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n";var xp=/*#__PURE__*/function(_dr2){_inherits(xp,_dr2);var _super63=_createSuper(xp);function xp(t,e){var _this109;_classCallCheck(this,xp);var i={uSampler:t,alpha:1,uTextureMatrix:Rt.IDENTITY,uColor:new Float32Array([1,1,1,1])};e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e),e.uniforms&&Object.assign(i,e.uniforms),_this109=_super63.call(this,e.program||Cr.from(zw,Xw),i),_this109._colorDirty=!1,_this109.uvMatrix=new mf(t),_this109.batchable=e.program===void 0,_this109.pluginName=e.pluginName,_this109._tintColor=new wt(e.tint),_this109._tintRGB=_this109._tintColor.toLittleEndianNumber(),_this109._colorDirty=!0,_this109.alpha=e.alpha;return _this109;}_createClass(xp,[{key:"texture",get:function get(){return this.uniforms.uSampler;},set:function set(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t);}},{key:"alpha",get:function get(){return this._alpha;},set:function set(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0);}},{key:"tint",get:function get(){return this._tintColor.value;},set:function set(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0);}},{key:"tintValue",get:function get(){return this._tintColor.toNumber();}},{key:"update",value:function update(){if(this._colorDirty){this._colorDirty=!1;var t=this.texture.baseTexture.alphaMode;wt.shared.setValue(this._tintColor).premultiply(this._alpha,t).toArray(this.uniforms.uColor);}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord);}}]);return xp;}(dr);var bp=/*#__PURE__*/function(){function bp(t,e,i){_classCallCheck(this,bp);this.geometry=new kr(),this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(var s=0;s<t.length;++s){var n=t[s];n={attributeName:n.attributeName,size:n.size,uploadFunction:n.uploadFunction,type:n.type||tt.FLOAT,offset:n.offset},e[s]?this.dynamicProperties.push(n):this.staticProperties.push(n);}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers();}_createClass(bp,[{key:"initBuffers",value:function initBuffers(){var t=this.geometry;var e=0;this.indexBuffer=new Vt(db(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(var o=0;o<this.dynamicProperties.length;++o){var _a22=this.dynamicProperties[o];_a22.offset=e,e+=_a22.size,this.dynamicStride+=_a22.size;}var i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new Vt(this.dynamicData,!1,!1);var s=0;this.staticStride=0;for(var _o16=0;_o16<this.staticProperties.length;++_o16){var _a23=this.staticProperties[_o16];_a23.offset=s,s+=_a23.size,this.staticStride+=_a23.size;}var n=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(n),this.staticDataUint32=new Uint32Array(n),this.staticBuffer=new Vt(this.staticData,!0,!1);for(var _o17=0;_o17<this.dynamicProperties.length;++_o17){var _a24=this.dynamicProperties[_o17];t.addAttribute(_a24.attributeName,this.dynamicBuffer,0,_a24.type===tt.UNSIGNED_BYTE,_a24.type,this.dynamicStride*4,_a24.offset*4);}for(var _o18=0;_o18<this.staticProperties.length;++_o18){var _a25=this.staticProperties[_o18];t.addAttribute(_a25.attributeName,this.staticBuffer,0,_a25.type===tt.UNSIGNED_BYTE,_a25.type,this.staticStride*4,_a25.offset*4);}}},{key:"uploadDynamic",value:function uploadDynamic(t,e,i){for(var s=0;s<this.dynamicProperties.length;s++){var n=this.dynamicProperties[s];n.uploadFunction(t,e,i,n.type===tt.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,n.offset);}this.dynamicBuffer._updateID++;}},{key:"uploadStatic",value:function uploadStatic(t,e,i){for(var s=0;s<this.staticProperties.length;s++){var n=this.staticProperties[s];n.uploadFunction(t,e,i,n.type===tt.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,n.offset);}this.staticBuffer._updateID++;}},{key:"destroy",value:function destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy();}}]);return bp;}();var Ww="varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",Yw="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n";var Ep=/*#__PURE__*/function(_Qn2){_inherits(Ep,_Qn2);var _super64=_createSuper(Ep);function Ep(t){var _this110;_classCallCheck(this,Ep);_this110=_super64.call(this,t),_this110.shader=null,_this110.properties=null,_this110.tempMatrix=new Rt(),_this110.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:_this110.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:_this110.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:_this110.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:_this110.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:tt.UNSIGNED_BYTE,uploadFunction:_this110.uploadTint,offset:0}],_this110.shader=dr.from(Yw,Ww,{}),_this110.state=cr.for2d();return _this110;}_createClass(Ep,[{key:"render",value:function render(t){var e=t.children,i=t._maxSize,s=t._batchSize,n=this.renderer;var o=e.length;if(o===0)return;o>i&&!t.autoResize&&(o=i);var a=t._buffers;a||(a=t._buffers=this.generateBuffers(t));var l=e[0]._texture.baseTexture,h=l.alphaMode>0;this.state.blendMode=Bd(t.blendMode,h),n.state.set(this.state);var u=n.gl,c=t.worldTransform.copyTo(this.tempMatrix);c.prepend(n.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=c.toArray(!0),this.shader.uniforms.uColor=wt.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,h).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=l,this.renderer.shader.bind(this.shader);var d=!1;for(var p=0,f=0;p<o;p+=s,f+=1){var m=o-p;m>s&&(m=s),f>=a.length&&a.push(this._generateOneMoreBuffer(t));var y=a[f];y.uploadDynamic(e,p,m);var _=t._bufferUpdateIDs[f]||0;d=d||y._updateID<_,d&&(y._updateID=t._updateID,y.uploadStatic(e,p,m)),n.geometry.bind(y.geometry),u.drawElements(u.TRIANGLES,m*6,u.UNSIGNED_SHORT,0);}}},{key:"generateBuffers",value:function generateBuffers(t){var e=[],i=t._maxSize,s=t._batchSize,n=t._properties;for(var o=0;o<i;o+=s)e.push(new bp(this.properties,n,s));return e;}},{key:"_generateOneMoreBuffer",value:function _generateOneMoreBuffer(t){var e=t._batchSize,i=t._properties;return new bp(this.properties,i,e);}},{key:"uploadVertices",value:function uploadVertices(t,e,i,s,n,o){var a=0,l=0,h=0,u=0;for(var c=0;c<i;++c){var d=t[e+c],p=d._texture,f=d.scale.x,m=d.scale.y,y=p.trim,_=p.orig;y?(l=y.x-d.anchor.x*_.width,a=l+y.width,u=y.y-d.anchor.y*_.height,h=u+y.height):(a=_.width*(1-d.anchor.x),l=_.width*-d.anchor.x,h=_.height*(1-d.anchor.y),u=_.height*-d.anchor.y),s[o]=l*f,s[o+1]=u*m,s[o+n]=a*f,s[o+n+1]=u*m,s[o+n*2]=a*f,s[o+n*2+1]=h*m,s[o+n*3]=l*f,s[o+n*3+1]=h*m,o+=n*4;}}},{key:"uploadPosition",value:function uploadPosition(t,e,i,s,n,o){for(var _a26=0;_a26<i;_a26++){var _l29=t[e+_a26].position;s[o]=_l29.x,s[o+1]=_l29.y,s[o+n]=_l29.x,s[o+n+1]=_l29.y,s[o+n*2]=_l29.x,s[o+n*2+1]=_l29.y,s[o+n*3]=_l29.x,s[o+n*3+1]=_l29.y,o+=n*4;}}},{key:"uploadRotation",value:function uploadRotation(t,e,i,s,n,o){for(var _a27=0;_a27<i;_a27++){var _l30=t[e+_a27].rotation;s[o]=_l30,s[o+n]=_l30,s[o+n*2]=_l30,s[o+n*3]=_l30,o+=n*4;}}},{key:"uploadUvs",value:function uploadUvs(t,e,i,s,n,o){for(var _a28=0;_a28<i;++_a28){var _l31=t[e+_a28]._texture._uvs;_l31?(s[o]=_l31.x0,s[o+1]=_l31.y0,s[o+n]=_l31.x1,s[o+n+1]=_l31.y1,s[o+n*2]=_l31.x2,s[o+n*2+1]=_l31.y2,s[o+n*3]=_l31.x3,s[o+n*3+1]=_l31.y3,o+=n*4):(s[o]=0,s[o+1]=0,s[o+n]=0,s[o+n+1]=0,s[o+n*2]=0,s[o+n*2+1]=0,s[o+n*3]=0,s[o+n*3+1]=0,o+=n*4);}}},{key:"uploadTint",value:function uploadTint(t,e,i,s,n,o){for(var _a29=0;_a29<i;++_a29){var _l32=t[e+_a29],h=wt.shared.setValue(_l32._tintRGB).toPremultiplied(_l32.alpha,_l32.texture.baseTexture.alphaMode>0);s[o]=h,s[o+n]=h,s[o+n*2]=h,s[o+n*3]=h,o+=n*4;}}},{key:"destroy",value:function destroy(){_get(_getPrototypeOf(Ep.prototype),"destroy",this).call(this),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null;}}]);return Ep;}(Qn);Ep.extension={name:"particle",type:W.RendererPlugin},K.add(Ep);var To=function(r){return r[r.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",r[r.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",r;}(To||{});var wo={willReadFrequently:!0},pr=/*#__PURE__*/function(){function J(t,e,i,s,n,o,a,l,h){_classCallCheck(this,J);this.text=t,this.style=e,this.width=i,this.height=s,this.lines=n,this.lineWidths=o,this.lineHeight=a,this.maxLineWidth=l,this.fontProperties=h;}_createClass(J,null,[{key:"experimentalLetterSpacingSupported",get:function get(){var t=J._experimentalLetterSpacingSupported;if(t!==void 0){var e=j.ADAPTER.getCanvasRenderingContext2D().prototype;t=J._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e;}return t;}},{key:"measureText",value:function measureText(t,e,i){var _i32;var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:J._canvas;i=(_i32=i)!==null&&_i32!==void 0?_i32:e.wordWrap;var n=e.toFontString(),o=J.measureFont(n);o.fontSize===0&&(o.fontSize=e.fontSize,o.ascent=e.fontSize);var a=s.getContext("2d",wo);a.font=n;var l=(i?J.wordWrap(t,e,s):t).split(/(?:\r\n|\r|\n)/),h=new Array(l.length);var u=0;for(var f=0;f<l.length;f++){var m=J._measureText(l[f],e.letterSpacing,a);h[f]=m,u=Math.max(u,m);}var c=u+e.strokeThickness;e.dropShadow&&(c+=e.dropShadowDistance);var d=e.lineHeight||o.fontSize+e.strokeThickness;var p=Math.max(d,o.fontSize+e.strokeThickness*2)+e.leading+(l.length-1)*(d+e.leading);return e.dropShadow&&(p+=e.dropShadowDistance),new J(t,e,c,p,l,h,d+e.leading,u,o);}},{key:"_measureText",value:function _measureText(t,e,i){var s=!1;J.experimentalLetterSpacingSupported&&(J.experimentalLetterSpacing?(i.letterSpacing="".concat(e,"px"),i.textLetterSpacing="".concat(e,"px"),s=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));var n=i.measureText(t).width;return n>0&&(s?n-=e:n+=(J.graphemeSegmenter(t).length-1)*e),n;}},{key:"wordWrap",value:function wordWrap(t,e){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:J._canvas;var s=i.getContext("2d",wo);var n=0,o="",a="";var l=Object.create(null),h=e.letterSpacing,u=e.whiteSpace,c=J.collapseSpaces(u),d=J.collapseNewlines(u);var p=!c;var f=e.wordWrapWidth+h,m=J.tokenize(t);for(var y=0;y<m.length;y++){var _=m[y];if(J.isNewline(_)){if(!d){a+=J.addLine(o),p=!c,o="",n=0;continue;}_=" ";}if(c){var g=J.isBreakingSpace(_),x=J.isBreakingSpace(o[o.length-1]);if(g&&x)continue;}var v=J.getFromCache(_,h,l,s);if(v>f){if(o!==""&&(a+=J.addLine(o),o="",n=0),J.canBreakWords(_,e.breakWords)){var _g9=J.wordWrapSplit(_);for(var _x50=0;_x50<_g9.length;_x50++){var b=_g9[_x50],S=b,w=1;for(;_g9[_x50+w];){var N=_g9[_x50+w];if(!J.canBreakChars(S,N,_,_x50,e.breakWords))b+=N;else break;S=N,w++;}_x50+=w-1;var T=J.getFromCache(b,h,l,s);T+n>f&&(a+=J.addLine(o),p=!1,o="",n=0),o+=b,n+=T;}}else{o.length>0&&(a+=J.addLine(o),o="",n=0);var _g10=y===m.length-1;a+=J.addLine(_,!_g10),p=!1,o="",n=0;}}else v+n>f&&(p=!1,a+=J.addLine(o),o="",n=0),(o.length>0||!J.isBreakingSpace(_)||p)&&(o+=_,n+=v);}return a+=J.addLine(o,!1),a;}},{key:"addLine",value:function addLine(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!0;return t=J.trimRight(t),t=e?"".concat(t,"\n"):t,t;}},{key:"getFromCache",value:function getFromCache(t,e,i,s){var n=i[t];return typeof n!="number"&&(n=J._measureText(t,e,s)+e,i[t]=n),n;}},{key:"collapseSpaces",value:function collapseSpaces(t){return t==="normal"||t==="pre-line";}},{key:"collapseNewlines",value:function collapseNewlines(t){return t==="normal";}},{key:"trimRight",value:function trimRight(t){if(typeof t!="string")return"";for(var e=t.length-1;e>=0;e--){var i=t[e];if(!J.isBreakingSpace(i))break;t=t.slice(0,-1);}return t;}},{key:"isNewline",value:function isNewline(t){return typeof t!="string"?!1:J._newlines.includes(t.charCodeAt(0));}},{key:"isBreakingSpace",value:function isBreakingSpace(t,e){return typeof t!="string"?!1:J._breakingSpaces.includes(t.charCodeAt(0));}},{key:"tokenize",value:function tokenize(t){var e=[];var i="";if(typeof t!="string")return e;for(var s=0;s<t.length;s++){var n=t[s],o=t[s+1];if(J.isBreakingSpace(n,o)||J.isNewline(n)){i!==""&&(e.push(i),i=""),e.push(n);continue;}i+=n;}return i!==""&&e.push(i),e;}},{key:"canBreakWords",value:function canBreakWords(t,e){return e;}},{key:"canBreakChars",value:function canBreakChars(t,e,i,s,n){return!0;}},{key:"wordWrapSplit",value:function wordWrapSplit(t){return J.graphemeSegmenter(t);}},{key:"measureFont",value:function measureFont(t){if(J._fonts[t])return J._fonts[t];var e={ascent:0,descent:0,fontSize:0},i=J._canvas,s=J._context;s.font=t;var n=J.METRICS_STRING+J.BASELINE_SYMBOL,o=Math.ceil(s.measureText(n).width);var a=Math.ceil(s.measureText(J.BASELINE_SYMBOL).width);var l=Math.ceil(J.HEIGHT_MULTIPLIER*a);if(a=a*J.BASELINE_MULTIPLIER|0,o===0||l===0)return J._fonts[t]=e,e;i.width=o,i.height=l,s.fillStyle="#f00",s.fillRect(0,0,o,l),s.font=t,s.textBaseline="alphabetic",s.fillStyle="#000",s.fillText(n,0,a);var h=s.getImageData(0,0,o,l).data,u=h.length,c=o*4;var d=0,p=0,f=!1;for(d=0;d<a;++d){for(var m=0;m<c;m+=4)if(h[p+m]!==255){f=!0;break;}if(!f)p+=c;else break;}for(e.ascent=a-d,p=u-c,f=!1,d=l;d>a;--d){for(var _m12=0;_m12<c;_m12+=4)if(h[p+_m12]!==255){f=!0;break;}if(!f)p-=c;else break;}return e.descent=d-a,e.fontSize=e.ascent+e.descent,J._fonts[t]=e,e;}},{key:"clearMetrics",value:function clearMetrics(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";t?delete J._fonts[t]:J._fonts={};}},{key:"_canvas",get:function get(){var t;if(!J.__canvas){var e;try{var i=new OffscreenCanvas(0,0);if((t=i.getContext("2d",wo))!=null&&t.measureText)return J.__canvas=i,i;e=j.ADAPTER.createCanvas();}catch(_unused20){e=j.ADAPTER.createCanvas();}e.width=e.height=10,J.__canvas=e;}return J.__canvas;}},{key:"_context",get:function get(){return J.__context||(J.__context=J._canvas.getContext("2d",wo)),J.__context;}}]);return J;}();pr.METRICS_STRING="|ÉqÅ",pr.BASELINE_SYMBOL="M",pr.BASELINE_MULTIPLIER=1.4,pr.HEIGHT_MULTIPLIER=2,pr.graphemeSegmenter=function(){if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){var _r8=new Intl.Segmenter();return function(t){return _toConsumableArray(_r8.segment(t)).map(function(e){return e.segment;});};}return function(r){return _toConsumableArray(r);};}(),pr.experimentalLetterSpacing=!1,pr._fonts={},pr._newlines=[10,13],pr._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var Vr=pr;var jw=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Tp=/*#__PURE__*/function(){function Qs(t){_classCallCheck(this,Qs);this.styleID=0,this.reset(),ah(this,t,t);}_createClass(Qs,[{key:"clone",value:function clone(){var t={};return ah(t,this,Qs.defaultStyle),new Qs(t);}},{key:"reset",value:function reset(){ah(this,Qs.defaultStyle,Qs.defaultStyle);}},{key:"align",get:function get(){return this._align;},set:function set(t){this._align!==t&&(this._align=t,this.styleID++);}},{key:"breakWords",get:function get(){return this._breakWords;},set:function set(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++);}},{key:"dropShadow",get:function get(){return this._dropShadow;},set:function set(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++);}},{key:"dropShadowAlpha",get:function get(){return this._dropShadowAlpha;},set:function set(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++);}},{key:"dropShadowAngle",get:function get(){return this._dropShadowAngle;},set:function set(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++);}},{key:"dropShadowBlur",get:function get(){return this._dropShadowBlur;},set:function set(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++);}},{key:"dropShadowColor",get:function get(){return this._dropShadowColor;},set:function set(t){var e=oh(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++);}},{key:"dropShadowDistance",get:function get(){return this._dropShadowDistance;},set:function set(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++);}},{key:"fill",get:function get(){return this._fill;},set:function set(t){var e=oh(t);this._fill!==e&&(this._fill=e,this.styleID++);}},{key:"fillGradientType",get:function get(){return this._fillGradientType;},set:function set(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++);}},{key:"fillGradientStops",get:function get(){return this._fillGradientStops;},set:function set(t){qw(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++);}},{key:"fontFamily",get:function get(){return this._fontFamily;},set:function set(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++);}},{key:"fontSize",get:function get(){return this._fontSize;},set:function set(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++);}},{key:"fontStyle",get:function get(){return this._fontStyle;},set:function set(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++);}},{key:"fontVariant",get:function get(){return this._fontVariant;},set:function set(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++);}},{key:"fontWeight",get:function get(){return this._fontWeight;},set:function set(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++);}},{key:"letterSpacing",get:function get(){return this._letterSpacing;},set:function set(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++);}},{key:"lineHeight",get:function get(){return this._lineHeight;},set:function set(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++);}},{key:"leading",get:function get(){return this._leading;},set:function set(t){this._leading!==t&&(this._leading=t,this.styleID++);}},{key:"lineJoin",get:function get(){return this._lineJoin;},set:function set(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++);}},{key:"miterLimit",get:function get(){return this._miterLimit;},set:function set(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++);}},{key:"padding",get:function get(){return this._padding;},set:function set(t){this._padding!==t&&(this._padding=t,this.styleID++);}},{key:"stroke",get:function get(){return this._stroke;},set:function set(t){var e=oh(t);this._stroke!==e&&(this._stroke=e,this.styleID++);}},{key:"strokeThickness",get:function get(){return this._strokeThickness;},set:function set(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++);}},{key:"textBaseline",get:function get(){return this._textBaseline;},set:function set(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++);}},{key:"trim",get:function get(){return this._trim;},set:function set(t){this._trim!==t&&(this._trim=t,this.styleID++);}},{key:"whiteSpace",get:function get(){return this._whiteSpace;},set:function set(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++);}},{key:"wordWrap",get:function get(){return this._wordWrap;},set:function set(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++);}},{key:"wordWrapWidth",get:function get(){return this._wordWrapWidth;},set:function set(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++);}},{key:"toFontString",value:function toFontString(){var t=typeof this.fontSize=="number"?"".concat(this.fontSize,"px"):this.fontSize;var e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(var i=e.length-1;i>=0;i--){var s=e[i].trim();!/([\"\'])[^\'\"]+\1/.test(s)&&!jw.includes(s)&&(s="\"".concat(s,"\"")),e[i]=s;}return"".concat(this.fontStyle," ").concat(this.fontVariant," ").concat(this.fontWeight," ").concat(t," ").concat(e.join(","));}}]);return Qs;}();Tp.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:To.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};var Xr=Tp;function oh(r){var t=wt.shared,e=function e(i){var s=t.setValue(i);return s.alpha===1?s.toHex():s.toRgbaString();};return Array.isArray(r)?r.map(e):e(r);}function qw(r,t){if(!Array.isArray(r)||!Array.isArray(t)||r.length!==t.length)return!1;for(var e=0;e<r.length;++e)if(r[e]!==t[e])return!1;return!0;}function ah(r,t,e){for(var i in e)Array.isArray(t[i])?r[i]=t[i].slice():r[i]=t[i];}var Kw={texture:!0,children:!1,baseTexture:!0},wp=/*#__PURE__*/function(_ts){_inherits(Mh,_ts);var _super65=_createSuper(Mh);function Mh(t,e,i){var _Mh$defaultResolution;var _this111;_classCallCheck(this,Mh);var s=!1;i||(i=j.ADAPTER.createCanvas(),s=!0),i.width=3,i.height=3;var n=Z.from(i);n.orig=new pt(),n.trim=new pt(),_this111=_super65.call(this,n),_this111._ownCanvas=s,_this111.canvas=i,_this111.context=i.getContext("2d",{willReadFrequently:!0}),_this111._resolution=(_Mh$defaultResolution=Mh.defaultResolution)!==null&&_Mh$defaultResolution!==void 0?_Mh$defaultResolution:j.RESOLUTION,_this111._autoResolution=Mh.defaultAutoResolution,_this111._text=null,_this111._style=null,_this111._styleListener=null,_this111._font="",_this111.text=t,_this111.style=e,_this111.localStyleID=-1;return _this111;}_createClass(Mh,[{key:"updateText",value:function updateText(t){var e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();var i=this.context,s=Vr.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),n=s.width,o=s.height,a=s.lines,l=s.lineHeight,h=s.lineWidths,u=s.maxLineWidth,c=s.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,n)+e.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,o)+e.padding*2)*this._resolution),i.scale(this._resolution,this._resolution),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.font=this._font,i.lineWidth=e.strokeThickness,i.textBaseline=e.textBaseline,i.lineJoin=e.lineJoin,i.miterLimit=e.miterLimit;var d,p;var f=e.dropShadow?2:1;for(var m=0;m<f;++m){var y=e.dropShadow&&m===0,_=y?Math.ceil(Math.max(1,o)+e.padding*2):0,v=_*this._resolution;if(y){i.fillStyle="black",i.strokeStyle="black";var x=e.dropShadowColor,b=e.dropShadowBlur*this._resolution,S=e.dropShadowDistance*this._resolution;i.shadowColor=wt.shared.setValue(x).setAlpha(e.dropShadowAlpha).toRgbaString(),i.shadowBlur=b,i.shadowOffsetX=Math.cos(e.dropShadowAngle)*S,i.shadowOffsetY=Math.sin(e.dropShadowAngle)*S+v;}else i.fillStyle=this._generateFillStyle(e,a,s),i.strokeStyle=e.stroke,i.shadowColor="black",i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0;var g=(l-c.fontSize)/2;l-c.fontSize<0&&(g=0);for(var _x51=0;_x51<a.length;_x51++)d=e.strokeThickness/2,p=e.strokeThickness/2+_x51*l+c.ascent+g,e.align==="right"?d+=u-h[_x51]:e.align==="center"&&(d+=(u-h[_x51])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(a[_x51],d+e.padding,p+e.padding-_,!0),e.fill&&this.drawLetterSpacing(a[_x51],d+e.padding,p+e.padding-_);}this.updateTexture();}},{key:"drawLetterSpacing",value:function drawLetterSpacing(t,e,i){var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:!1;var n=this._style.letterSpacing;var o=!1;if(Vr.experimentalLetterSpacingSupported&&(Vr.experimentalLetterSpacing?(this.context.letterSpacing="".concat(n,"px"),this.context.textLetterSpacing="".concat(n,"px"),o=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),n===0||o){s?this.context.strokeText(t,e,i):this.context.fillText(t,e,i);return;}var a=e;var l=Vr.graphemeSegmenter(t);var h=this.context.measureText(t).width,u=0;for(var c=0;c<l.length;++c){var d=l[c];s?this.context.strokeText(d,a,i):this.context.fillText(d,a,i);var p="";for(var f=c+1;f<l.length;++f)p+=l[f];u=this.context.measureText(p).width,a+=h-u+n,h=u;}}},{key:"updateTexture",value:function updateTexture(){var t=this.canvas;if(this._style.trim){var o=gb(t);o.data&&(t.width=o.width,t.height=o.height,this.context.putImageData(o.data,0,0));}var e=this._texture,i=this._style,s=i.trim?0:i.padding,n=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-s,e.trim.y=-s,e.orig.width=e._frame.width-s*2,e.orig.height=e._frame.height-s*2,this._onTextureUpdate(),n.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1;}},{key:"_render",value:function _render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),_get(_getPrototypeOf(Mh.prototype),"_render",this).call(this,t);}},{key:"updateTransform",value:function updateTransform(){this.updateText(!0),_get(_getPrototypeOf(Mh.prototype),"updateTransform",this).call(this);}},{key:"getBounds",value:function getBounds(t,e){return this.updateText(!0),this._textureID===-1&&(t=!1),_get(_getPrototypeOf(Mh.prototype),"getBounds",this).call(this,t,e);}},{key:"getLocalBounds",value:function getLocalBounds(t){return this.updateText(!0),_get(_getPrototypeOf(Mh.prototype),"getLocalBounds",this).call(this,t);}},{key:"_calculateBounds",value:function _calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData);}},{key:"_generateFillStyle",value:function _generateFillStyle(t,e,i){var s=t.fill;if(Array.isArray(s)){if(s.length===1)return s[0];}else return s;var n;var o=t.dropShadow?t.dropShadowDistance:0,a=t.padding||0,l=this.canvas.width/this._resolution-o-a*2,h=this.canvas.height/this._resolution-o-a*2,u=s.slice(),c=t.fillGradientStops.slice();if(!c.length){var d=u.length+1;for(var p=1;p<d;++p)c.push(p/d);}if(u.unshift(s[0]),c.unshift(0),u.push(s[s.length-1]),c.push(1),t.fillGradientType===To.LINEAR_VERTICAL){n=this.context.createLinearGradient(l/2,a,l/2,h+a);var _d7=i.fontProperties.fontSize+t.strokeThickness;for(var _p8=0;_p8<e.length;_p8++){var f=i.lineHeight*(_p8-1)+_d7,m=i.lineHeight*_p8;var y=m;_p8>0&&f>m&&(y=(m+f)/2);var _=m+_d7,v=i.lineHeight*(_p8+1);var g=_;_p8+1<e.length&&v<_&&(g=(_+v)/2);var x=(g-y)/h;for(var b=0;b<u.length;b++){var S=0;typeof c[b]=="number"?S=c[b]:S=b/u.length;var w=Math.min(1,Math.max(0,y/h+S*x));w=Number(w.toFixed(5)),n.addColorStop(w,u[b]);}}}else{n=this.context.createLinearGradient(a,h/2,l+a,h/2);var _d8=u.length+1;var _p9=1;for(var _f8=0;_f8<u.length;_f8++){var _m13=void 0;typeof c[_f8]=="number"?_m13=c[_f8]:_m13=_p9/_d8,n.addColorStop(_m13,u[_f8]),_p9++;}}return n;}},{key:"destroy",value:function destroy(t){typeof t=="boolean"&&(t={children:t}),t=Object.assign({},Kw,t),_get(_getPrototypeOf(Mh.prototype),"destroy",this).call(this,t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null;}},{key:"width",get:function get(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width;},set:function set(t){this.updateText(!0);var e=Fr(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t;}},{key:"height",get:function get(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height;},set:function set(t){this.updateText(!0);var e=Fr(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t;}},{key:"style",get:function get(){return this._style;},set:function set(t){t=t||{},t instanceof Xr?this._style=t:this._style=new Xr(t),this.localStyleID=-1,this.dirty=!0;}},{key:"text",get:function get(){return this._text;},set:function set(t){var _t21;t=String((_t21=t)!==null&&_t21!==void 0?_t21:""),this._text!==t&&(this._text=t,this.dirty=!0);}},{key:"resolution",get:function get(){return this._resolution;},set:function set(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0);}}],[{key:"experimentalLetterSpacing",get:function get(){return Vr.experimentalLetterSpacing;},set:function set(t){gt("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),Vr.experimentalLetterSpacing=t;}}]);return Mh;}(ts);wp.defaultAutoResolution=!0;var Ap=wp;var Zw=/*#__PURE__*/function(){function Zw(t){_classCallCheck(this,Zw);this.maxItemsPerFrame=t,this.itemsLeft=0;}_createClass(Zw,[{key:"beginFrame",value:function beginFrame(){this.itemsLeft=this.maxItemsPerFrame;}},{key:"allowedToUpload",value:function allowedToUpload(){return this.itemsLeft-->0;}}]);return Zw;}();function Qw(r,t){var i;var e=!1;if((i=r==null?void 0:r._textures)!=null&&i.length){for(var s=0;s<r._textures.length;s++)if(r._textures[s]instanceof Z){var n=r._textures[s].baseTexture;t.includes(n)||(t.push(n),e=!0);}}return e;}function Jw(r,t){if(r.baseTexture instanceof ft){var e=r.baseTexture;return t.includes(e)||t.push(e),!0;}return!1;}function tA(r,t){if(r._texture&&r._texture instanceof Z){var e=r._texture.baseTexture;return t.includes(e)||t.push(e),!0;}return!1;}function eA(r,t){return t instanceof Ap?(t.updateText(!0),!0):!1;}function rA(r,t){if(t instanceof Xr){var e=t.toFontString();return Vr.measureFont(e),!0;}return!1;}function iA(r,t){if(r instanceof Ap){t.includes(r.style)||t.push(r.style),t.includes(r)||t.push(r);var e=r._texture.baseTexture;return t.includes(e)||t.push(e),!0;}return!1;}function sA(r,t){return r instanceof Xr?(t.includes(r)||t.push(r),!0):!1;}var Sp=/*#__PURE__*/function(){function Mm(t){var _this112=this;_classCallCheck(this,Mm);this.limiter=new Zw(Mm.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){_this112.queue&&_this112.prepareItems();},this.registerFindHook(iA),this.registerFindHook(sA),this.registerFindHook(Qw),this.registerFindHook(Jw),this.registerFindHook(tA),this.registerUploadHook(eA),this.registerUploadHook(rA);}_createClass(Mm,[{key:"upload",value:function upload(t){var _this113=this;return new Promise(function(e){t&&_this113.add(t),_this113.queue.length?(_this113.completes.push(e),_this113.ticking||(_this113.ticking=!0,Me.system.addOnce(_this113.tick,_this113,bi.UTILITY))):e();});}},{key:"tick",value:function tick(){setTimeout(this.delayedTick,0);}},{key:"prepareItems",value:function prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var t=this.queue[0];var e=!1;if(t&&!t._destroyed){for(var i=0,s=this.uploadHooks.length;i<s;i++)if(this.uploadHooks[i](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break;}}e||this.queue.shift();}if(this.queue.length)Me.system.addOnce(this.tick,this,bi.UTILITY);else{this.ticking=!1;var _t22=this.completes.slice(0);this.completes.length=0;for(var _e16=0,_i33=_t22.length;_e16<_i33;_e16++)_t22[_e16]();}}},{key:"registerFindHook",value:function registerFindHook(t){return t&&this.addHooks.push(t),this;}},{key:"registerUploadHook",value:function registerUploadHook(t){return t&&this.uploadHooks.push(t),this;}},{key:"add",value:function add(t){for(var e=0,i=this.addHooks.length;e<i&&!this.addHooks[e](t,this.queue);e++);if(t instanceof Ye)for(var _e17=t.children.length-1;_e17>=0;_e17--)this.add(t.children[_e17]);return this;}},{key:"destroy",value:function destroy(){this.ticking&&Me.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null;}}]);return Mm;}();Sp.uploadsPerFrame=4;var lh=Sp;Object.defineProperties(j,{UPLOADS_PER_FRAME:{get:function get(){return lh.uploadsPerFrame;},set:function set(r){gt("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),lh.uploadsPerFrame=r;}}});function Cp(r,t){return t instanceof ft?(t._glTextures[r.CONTEXT_UID]||r.texture.bind(t),!0):!1;}function nA(r,t){if(!(t instanceof Ws))return!1;var e=t.geometry;t.finishPoly(),e.updateBatches();var i=e.batches;for(var s=0;s<i.length;s++){var n=i[s].style.texture;n&&Cp(r,n.baseTexture);}return e.batchable||r.geometry.bind(e,t._resolveDirectShader(r)),!0;}function oA(r,t){return r instanceof Ws?(t.push(r),!0):!1;}var Ip=/*#__PURE__*/function(_lh){_inherits(Ip,_lh);var _super66=_createSuper(Ip);function Ip(t){var _this114;_classCallCheck(this,Ip);_this114=_super66.call(this,t),_this114.uploadHookHelper=_this114.renderer,_this114.registerFindHook(oA),_this114.registerUploadHook(Cp),_this114.registerUploadHook(nA);return _this114;}return _createClass(Ip);}(lh);Ip.extension={name:"prepare",type:W.RendererSystem},K.add(Ip);var aA="#version 300 es\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nin vec2 vTextureCoord;\n\nout vec4 fragmentColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0\n\n    fragmentColor = texSample * uColor;\n}\n",lA="#version 300 es\n#define SHADER_NAME Tiling-Sprite-300\n\nprecision lowp float;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nout vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n",hA="#version 100\n#ifdef GL_EXT_shader_texture_lod\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    #ifdef GL_EXT_shader_texture_lod\n        vec4 texSample = unclamped == coord\n            ? texture2D(uSampler, coord) \n            : texture2DLodEXT(uSampler, coord, 0);\n    #else\n        vec4 texSample = texture2D(uSampler, coord);\n    #endif\n\n    gl_FragColor = texSample * uColor;\n}\n",Rp="#version 100\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n",uA="#version 100\n#define SHADER_NAME Tiling-Sprite-Simple-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n";var Ao=new Rt();var Mp=/*#__PURE__*/function(_Qn3){_inherits(Mp,_Qn3);var _super67=_createSuper(Mp);function Mp(t){var _this115;_classCallCheck(this,Mp);_this115=_super67.call(this,t),t.runners.contextChange.add(_assertThisInitialized(_this115)),_this115.quad=new uf(),_this115.state=cr.for2d();return _this115;}_createClass(Mp,[{key:"contextChange",value:function contextChange(){var t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=dr.from(Rp,uA,e),this.shader=t.context.webGLVersion>1?dr.from(lA,aA,e):dr.from(Rp,hA,e);}},{key:"render",value:function render(t){var e=this.renderer,i=this.quad;var s=i.vertices;s[0]=s[6]=t._width*-t.anchor.x,s[1]=s[3]=t._height*-t.anchor.y,s[2]=s[4]=t._width*(1-t.anchor.x),s[5]=s[7]=t._height*(1-t.anchor.y);var n=t.uvRespectAnchor?t.anchor.x:0,o=t.uvRespectAnchor?t.anchor.y:0;s=i.uvs,s[0]=s[6]=-n,s[1]=s[3]=-o,s[2]=s[4]=1-n,s[5]=s[7]=1-o,i.invalidate();var a=t._texture,l=a.baseTexture,h=l.alphaMode>0,u=t.tileTransform.localTransform,c=t.uvMatrix;var d=l.isPowerOfTwo&&a.frame.width===l.width&&a.frame.height===l.height;d&&(l._glTextures[e.CONTEXT_UID]?d=l.wrapMode!==Dr.CLAMP:l.wrapMode===Dr.CLAMP&&(l.wrapMode=Dr.REPEAT));var p=d?this.simpleShader:this.shader,f=a.width,m=a.height,y=t._width,_=t._height;Ao.set(u.a*f/y,u.b*f/_,u.c*m/y,u.d*m/_,u.tx/y,u.ty/_),Ao.invert(),d?Ao.prepend(c.mapCoord):(p.uniforms.uMapCoord=c.mapCoord.toArray(!0),p.uniforms.uClampFrame=c.uClampFrame,p.uniforms.uClampOffset=c.uClampOffset),p.uniforms.uTransform=Ao.toArray(!0),p.uniforms.uColor=wt.shared.setValue(t.tint).premultiply(t.worldAlpha,h).toArray(p.uniforms.uColor),p.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),p.uniforms.uSampler=a,e.shader.bind(p),e.geometry.bind(i),this.state.blendMode=Bd(t.blendMode,h),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0);}}]);return Mp;}(Qn);Mp.extension={name:"tilingSprite",type:W.RendererPlugin},K.add(Mp);var Pp=/*#__PURE__*/function(){function Js(t,e,i){_classCallCheck(this,Js);this.linkedSheets=[],(t instanceof ft||t instanceof Z)&&(t={texture:t,data:e,resolutionFilename:i});var _t23=t,s=_t23.texture,n=_t23.data,_t23$resolutionFilena=_t23.resolutionFilename,o=_t23$resolutionFilena===void 0?null:_t23$resolutionFilena,_t23$cachePrefix=_t23.cachePrefix,a=_t23$cachePrefix===void 0?"":_t23$cachePrefix;this.cachePrefix=a,this._texture=s instanceof Z?s:null,this.baseTexture=s instanceof ft?s:this._texture.baseTexture,this.textures={},this.animations={},this.data=n;var l=this.baseTexture.resource;this.resolution=this._updateResolution(o||(l?l.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null;}_createClass(Js,[{key:"_updateResolution",value:function _updateResolution(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var e=this.data.meta.scale;var i=Ar(t,null);return i===null&&(i=typeof e=="number"?e:parseFloat(e!==null&&e!==void 0?e:"1")),i!==1&&this.baseTexture.setResolution(i),i;}},{key:"parse",value:function parse(){var _this116=this;return new Promise(function(t){_this116._callback=t,_this116._batchIndex=0,_this116._frameKeys.length<=Js.BATCH_SIZE?(_this116._processFrames(0),_this116._processAnimations(),_this116._parseComplete()):_this116._nextBatch();});}},{key:"_processFrames",value:function _processFrames(t){var e=t;var i=Js.BATCH_SIZE;for(;e-t<i&&e<this._frameKeys.length;){var s=this._frameKeys[e],n=this._frames[s],o=n.frame;if(o){var _a30=null,_l33=null;var h=n.trimmed!==!1&&n.sourceSize?n.sourceSize:n.frame,u=new pt(0,0,Math.floor(h.w)/this.resolution,Math.floor(h.h)/this.resolution);n.rotated?_a30=new pt(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):_a30=new pt(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),n.trimmed!==!1&&n.spriteSourceSize&&(_l33=new pt(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[s]=new Z(this.baseTexture,_a30,u,_l33,n.rotated?2:0,n.anchor,n.borders),Z.addToCache(this.textures[s],this.cachePrefix+s.toString());}e++;}}},{key:"_processAnimations",value:function _processAnimations(){var t=this.data.animations||{};for(var e in t){this.animations[e]=[];for(var i=0;i<t[e].length;i++){var s=t[e][i];this.animations[e].push(this.textures[s]);}}}},{key:"_parseComplete",value:function _parseComplete(){var t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures);}},{key:"_nextBatch",value:function _nextBatch(){var _this117=this;this._processFrames(this._batchIndex*Js.BATCH_SIZE),this._batchIndex++,setTimeout(function(){_this117._batchIndex*Js.BATCH_SIZE<_this117._frameKeys.length?_this117._nextBatch():(_this117._processAnimations(),_this117._parseComplete());},0);}},{key:"destroy",value:function destroy(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!1;var e;for(var i in this.textures)this.textures[i].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&((e=this._texture)==null||e.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[];}}]);return Js;}();Pp.BATCH_SIZE=1e3;var Op=Pp;var cA=["jpg","png","jpeg","avif","webp","s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"];function Np(r,t,e){var i={};if(r.forEach(function(s){i[s]=t;}),Object.keys(t.textures).forEach(function(s){i["".concat(t.cachePrefix).concat(s)]=t.textures[s];}),!e){var s=se.dirname(r[0]);t.linkedSheets.forEach(function(n,o){Object.assign(i,Np(["".concat(s,"/").concat(t.data.meta.related_multi_packs[o])],n,!0));});}return i;}var dA={extension:W.Asset,cache:{test:function test(r){return r instanceof Op;},getCacheableAssets:function getCacheableAssets(r,t){return Np(r,t,!1);}},resolver:{test:function test(r){var t=r.split("?")[0].split("."),e=t.pop(),i=t.pop();return e==="json"&&cA.includes(i);},parse:function parse(r){var _ref140;var e;var t=r.split(".");return{resolution:parseFloat((_ref140=(e=j.RETINA_PREFIX.exec(r))==null?void 0:e[1])!==null&&_ref140!==void 0?_ref140:"1"),format:t[t.length-2],src:r};}},loader:{name:"spritesheetLoader",extension:{type:W.LoadParser,priority:Ke.Normal},testParse:function testParse(r,t){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee52(){return _regeneratorRuntime().wrap(function _callee52$(_context52){while(1)switch(_context52.prev=_context52.next){case 0:return _context52.abrupt("return",se.extname(t.src).toLowerCase()===".json"&&!!r.frames);case 1:case"end":return _context52.stop();}},_callee52);}))();},parse:function parse(r,t,e){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee53(){var _ref142;var u,c,_ref141,i,s,n,o,a,d,l,h,_d9,_iterator19,_step19,f,m,p;return _regeneratorRuntime().wrap(function _callee53$(_context53){while(1)switch(_context53.prev=_context53.next){case 0:_ref141=(_ref142=t==null?void 0:t.data)!==null&&_ref142!==void 0?_ref142:{},i=_ref141.texture,s=_ref141.imageFilename,n=_ref141.cachePrefix;o=se.dirname(t.src);o&&o.lastIndexOf("/")!==o.length-1&&(o+="/");if(!(i&&i.baseTexture)){_context53.next=7;break;}a=i;_context53.next=12;break;case 7:d=Yl(o+(s!==null&&s!==void 0?s:r.meta.image),t.src);_context53.next=10;return e.load([d]);case 10:_context53.t0=d;a=_context53.sent[_context53.t0];case 12:l=new Op({texture:a.baseTexture,data:r,resolutionFilename:t.src,cachePrefix:n});_context53.next=15;return l.parse();case 15:h=(u=r==null?void 0:r.meta)==null?void 0:u.related_multi_packs;if(!Array.isArray(h)){_context53.next=41;break;}_d9=[];_iterator19=_createForOfIteratorHelper(h);_context53.prev=19;_iterator19.s();case 21:if((_step19=_iterator19.n()).done){_context53.next=29;break;}f=_step19.value;if(!(typeof f!="string")){_context53.next=25;break;}return _context53.abrupt("continue",27);case 25:m=o+f;(c=t.data)!=null&&c.ignoreMultiPack||(m=Yl(m,t.src),_d9.push(e.load({src:m,data:{ignoreMultiPack:!0}})));case 27:_context53.next=21;break;case 29:_context53.next=34;break;case 31:_context53.prev=31;_context53.t1=_context53["catch"](19);_iterator19.e(_context53.t1);case 34:_context53.prev=34;_iterator19.f();return _context53.finish(34);case 37:_context53.next=39;return Promise.all(_d9);case 39:p=_context53.sent;l.linkedSheets=p,p.forEach(function(f){f.linkedSheets=[l].concat(l.linkedSheets.filter(function(m){return m!==f;}));});case 41:return _context53.abrupt("return",l);case 42:case"end":return _context53.stop();}},_callee53,null,[[19,31,34,37]]);}))();},unload:function unload(r){r.destroy(!0);}}};K.add(dA);var So=/*#__PURE__*/_createClass(function So(){_classCallCheck(this,So);this.info=[],this.common=[],this.page=[],this["char"]=[],this.kerning=[],this.distanceField=[];});var Co=/*#__PURE__*/function(){function Co(){_classCallCheck(this,Co);}_createClass(Co,null,[{key:"test",value:function test(t){return typeof t=="string"&&t.startsWith("info face=");}},{key:"parse",value:function parse(t){var e=t.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],"char":[],chars:[],kerning:[],kernings:[],distanceField:[]};for(var n in e){var o=e[n].match(/^[a-z]+/gm)[0],_a31=e[n].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),_l34={};for(var h in _a31){var u=_a31[h].split("="),c=u[0],d=u[1].replace(/"/gm,""),p=parseFloat(d),f=isNaN(p)?d:p;_l34[c]=f;}i[o].push(_l34);}var s=new So();return i.info.forEach(function(n){return s.info.push({face:n.face,size:parseInt(n.size,10)});}),i.common.forEach(function(n){return s.common.push({lineHeight:parseInt(n.lineHeight,10)});}),i.page.forEach(function(n){return s.page.push({id:parseInt(n.id,10),file:n.file});}),i["char"].forEach(function(n){return s["char"].push({id:parseInt(n.id,10),page:parseInt(n.page,10),x:parseInt(n.x,10),y:parseInt(n.y,10),width:parseInt(n.width,10),height:parseInt(n.height,10),xoffset:parseInt(n.xoffset,10),yoffset:parseInt(n.yoffset,10),xadvance:parseInt(n.xadvance,10)});}),i.kerning.forEach(function(n){return s.kerning.push({first:parseInt(n.first,10),second:parseInt(n.second,10),amount:parseInt(n.amount,10)});}),i.distanceField.forEach(function(n){return s.distanceField.push({distanceRange:parseInt(n.distanceRange,10),fieldType:n.fieldType});}),s;}}]);return Co;}();var hh=/*#__PURE__*/function(){function hh(){_classCallCheck(this,hh);}_createClass(hh,null,[{key:"test",value:function test(t){var e=t;return typeof t!="string"&&"getElementsByTagName"in t&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null;}},{key:"parse",value:function parse(t){var e=new So(),i=t.getElementsByTagName("info"),s=t.getElementsByTagName("common"),n=t.getElementsByTagName("page"),o=t.getElementsByTagName("char"),a=t.getElementsByTagName("kerning"),l=t.getElementsByTagName("distanceField");for(var h=0;h<i.length;h++)e.info.push({face:i[h].getAttribute("face"),size:parseInt(i[h].getAttribute("size"),10)});for(var _h14=0;_h14<s.length;_h14++)e.common.push({lineHeight:parseInt(s[_h14].getAttribute("lineHeight"),10)});for(var _h15=0;_h15<n.length;_h15++)e.page.push({id:parseInt(n[_h15].getAttribute("id"),10)||0,file:n[_h15].getAttribute("file")});for(var _h16=0;_h16<o.length;_h16++){var u=o[_h16];e["char"].push({id:parseInt(u.getAttribute("id"),10),page:parseInt(u.getAttribute("page"),10)||0,x:parseInt(u.getAttribute("x"),10),y:parseInt(u.getAttribute("y"),10),width:parseInt(u.getAttribute("width"),10),height:parseInt(u.getAttribute("height"),10),xoffset:parseInt(u.getAttribute("xoffset"),10),yoffset:parseInt(u.getAttribute("yoffset"),10),xadvance:parseInt(u.getAttribute("xadvance"),10)});}for(var _h17=0;_h17<a.length;_h17++)e.kerning.push({first:parseInt(a[_h17].getAttribute("first"),10),second:parseInt(a[_h17].getAttribute("second"),10),amount:parseInt(a[_h17].getAttribute("amount"),10)});for(var _h18=0;_h18<l.length;_h18++)e.distanceField.push({fieldType:l[_h18].getAttribute("fieldType"),distanceRange:parseInt(l[_h18].getAttribute("distanceRange"),10)});return e;}}]);return hh;}();var uh=/*#__PURE__*/function(){function uh(){_classCallCheck(this,uh);}_createClass(uh,null,[{key:"test",value:function test(t){return typeof t=="string"&&t.includes("<font>")?hh.test(j.ADAPTER.parseXML(t)):!1;}},{key:"parse",value:function parse(t){return hh.parse(j.ADAPTER.parseXML(t));}}]);return uh;}();var ch=[Co,hh,uh];function fA(r){for(var t=0;t<ch.length;t++)if(ch[t].test(r))return ch[t];return null;}function pA(r,t,e,i,s,n){var o=e.fill;if(Array.isArray(o)){if(o.length===1)return o[0];}else return o;var a;var l=e.dropShadow?e.dropShadowDistance:0,h=e.padding||0,u=r.width/i-l-h*2,c=r.height/i-l-h*2,d=o.slice(),p=e.fillGradientStops.slice();if(!p.length){var f=d.length+1;for(var m=1;m<f;++m)p.push(m/f);}if(d.unshift(o[0]),p.unshift(0),d.push(o[o.length-1]),p.push(1),e.fillGradientType===To.LINEAR_VERTICAL){a=t.createLinearGradient(u/2,h,u/2,c+h);var _f9=0;var _m14=(n.fontProperties.fontSize+e.strokeThickness)/c;for(var y=0;y<s.length;y++){var _=n.lineHeight*y;for(var v=0;v<d.length;v++){var g=0;typeof p[v]=="number"?g=p[v]:g=v/d.length;var x=_/c+g*_m14;var b=Math.max(_f9,x);b=Math.min(b,1),a.addColorStop(b,d[v]),_f9=b;}}}else{a=t.createLinearGradient(h,c/2,u+h,c/2);var _f10=d.length+1;var _m15=1;for(var _y7=0;_y7<d.length;_y7++){var _4=void 0;typeof p[_y7]=="number"?_4=p[_y7]:_4=_m15/_f10,a.addColorStop(_4,d[_y7]),_m15++;}}return a;}function mA(r,t,e,i,s,n,o){var a=e.text,l=e.fontProperties;t.translate(i,s),t.scale(n,n);var h=o.strokeThickness/2,u=-(o.strokeThickness/2);if(t.font=o.toFontString(),t.lineWidth=o.strokeThickness,t.textBaseline=o.textBaseline,t.lineJoin=o.lineJoin,t.miterLimit=o.miterLimit,t.fillStyle=pA(r,t,o,n,[a],e),t.strokeStyle=o.stroke,o.dropShadow){var c=o.dropShadowColor,d=o.dropShadowBlur*n,p=o.dropShadowDistance*n;t.shadowColor=wt.shared.setValue(c).setAlpha(o.dropShadowAlpha).toRgbaString(),t.shadowBlur=d,t.shadowOffsetX=Math.cos(o.dropShadowAngle)*p,t.shadowOffsetY=Math.sin(o.dropShadowAngle)*p;}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;o.stroke&&o.strokeThickness&&t.strokeText(a,h,u+e.lineHeight-l.descent),o.fill&&t.fillText(a,h,u+e.lineHeight-l.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)";}function Io(r){return r.codePointAt?r.codePointAt(0):r.charCodeAt(0);}function Dp(r){return Array.from?Array.from(r):r.split("");}function gA(r){typeof r=="string"&&(r=[r]);var t=[];for(var e=0,i=r.length;e<i;e++){var s=r[e];if(Array.isArray(s)){if(s.length!==2)throw new Error("[BitmapFont]: Invalid character range length, expecting 2 got ".concat(s.length,"."));var n=s[0].charCodeAt(0),o=s[1].charCodeAt(0);if(o<n)throw new Error("[BitmapFont]: Invalid character range.");for(var _a32=n,_l35=o;_a32<=_l35;_a32++)t.push(String.fromCharCode(_a32));}else t.push.apply(t,_toConsumableArray(Dp(s)));}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t;}var zr=/*#__PURE__*/function(){function yr(t,e,i){var _ref143;_classCallCheck(this,yr);var u;var _t$info=_slicedToArray(t.info,1),s=_t$info[0],_t$common=_slicedToArray(t.common,1),n=_t$common[0],_t$page=_slicedToArray(t.page,1),o=_t$page[0],_t$distanceField=_slicedToArray(t.distanceField,1),a=_t$distanceField[0],l=Ar(o.file),h={};this._ownsTextures=i,this.font=s.face,this.size=s.size,this.lineHeight=n.lineHeight/l,this.chars={},this.pageTextures=h;for(var c=0;c<t.page.length;c++){var _t$page$c=t.page[c],d=_t$page$c.id,p=_t$page$c.file;h[d]=e instanceof Array?e[c]:e[p],a!=null&&a.fieldType&&a.fieldType!=="none"&&(h[d].baseTexture.alphaMode=Ce.NO_PREMULTIPLIED_ALPHA,h[d].baseTexture.mipmap=ir.OFF);}for(var _c14=0;_c14<t["char"].length;_c14++){var _t$char$_c=t["char"][_c14],_d10=_t$char$_c.id,_p10=_t$char$_c.page;var _t$char$_c2=t["char"][_c14],f=_t$char$_c2.x,m=_t$char$_c2.y,y=_t$char$_c2.width,_=_t$char$_c2.height,v=_t$char$_c2.xoffset,g=_t$char$_c2.yoffset,x=_t$char$_c2.xadvance;f/=l,m/=l,y/=l,_/=l,v/=l,g/=l,x/=l;var b=new pt(f+h[_p10].frame.x/l,m+h[_p10].frame.y/l,y,_);this.chars[_d10]={xOffset:v,yOffset:g,xAdvance:x,kerning:{},texture:new Z(h[_p10].baseTexture,b),page:_p10};}for(var _c15=0;_c15<t.kerning.length;_c15++){var _t$kerning$_c=t.kerning[_c15],_d11=_t$kerning$_c.first,_p11=_t$kerning$_c.second,_f11=_t$kerning$_c.amount;_d11/=l,_p11/=l,_f11/=l,this.chars[_p11]&&(this.chars[_p11].kerning[_d11]=_f11);}this.distanceFieldRange=a==null?void 0:a.distanceRange,this.distanceFieldType=(_ref143=(u=a==null?void 0:a.fieldType)==null?void 0:u.toLowerCase())!==null&&_ref143!==void 0?_ref143:"none";}_createClass(yr,[{key:"destroy",value:function destroy(){for(var t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(var _t24 in this.pageTextures)this._ownsTextures&&this.pageTextures[_t24].destroy(!0),this.pageTextures[_t24]=null;this.chars=null,this.pageTextures=null;}}],[{key:"install",value:function install(t,e,i){var s;if(t instanceof So)s=t;else{var o=fA(t);if(!o)throw new Error("Unrecognized data format for font.");s=o.parse(t);}e instanceof Z&&(e=[e]);var n=new yr(s,e,i);return yr.available[n.font]=n,n;}},{key:"uninstall",value:function uninstall(t){var e=yr.available[t];if(!e)throw new Error("No font found named '".concat(t,"'"));e.destroy(),delete yr.available[t];}},{key:"from",value:function from(t,e,i){if(!t)throw new Error("[BitmapFont] Property `name` is required.");var _Object$assign=Object.assign({},yr.defaultOptions,i),s=_Object$assign.chars,n=_Object$assign.padding,o=_Object$assign.resolution,a=_Object$assign.textureWidth,l=_Object$assign.textureHeight,h=_objectWithoutProperties(_Object$assign,_excluded6),u=gA(s),c=e instanceof Xr?e:new Xr(e),d=a,p=new So();p.info[0]={face:c.fontFamily,size:c.fontSize},p.common[0]={lineHeight:c.fontSize};var f=0,m=0,y,_,v,g=0;var x=[];for(var S=0;S<u.length;S++){y||(y=j.ADAPTER.createCanvas(),y.width=a,y.height=l,_=y.getContext("2d"),v=new ft(y,_objectSpread({resolution:o},h)),x.push(new Z(v)),p.page.push({id:x.length-1,file:""}));var w=u[S],T=Vr.measureText(w,c,!1,y),N=T.width,F=Math.ceil(T.height),z=Math.ceil((c.fontStyle==="italic"?2:1)*N);if(m>=l-F*o){if(m===0)throw new Error("[BitmapFont] textureHeight ".concat(l,"px is too small (fontFamily: '").concat(c.fontFamily,"', fontSize: ").concat(c.fontSize,"px, char: '").concat(w,"')"));--S,y=null,_=null,v=null,m=0,f=0,g=0;continue;}if(g=Math.max(F+T.fontProperties.descent,g),z*o+f>=d){if(f===0)throw new Error("[BitmapFont] textureWidth ".concat(a,"px is too small (fontFamily: '").concat(c.fontFamily,"', fontSize: ").concat(c.fontSize,"px, char: '").concat(w,"')"));--S,m+=g*o,m=Math.ceil(m),f=0,g=0;continue;}mA(y,_,T,f,m,o,c);var C=Io(T.text);p["char"].push({id:C,page:x.length-1,x:f/o,y:m/o,width:z,height:F,xoffset:0,yoffset:0,xadvance:N-(c.dropShadow?c.dropShadowDistance:0)-(c.stroke?c.strokeThickness:0)}),f+=(z+2*n)*o,f=Math.ceil(f);}if(!(i!=null&&i.skipKerning))for(var _S2=0,_w3=u.length;_S2<_w3;_S2++){var _T2=u[_S2];for(var _N=0;_N<_w3;_N++){var _F=u[_N],_z=_.measureText(_T2).width,_C2=_.measureText(_F).width,E=_.measureText(_T2+_F).width-(_z+_C2);E&&p.kerning.push({first:Io(_T2),second:Io(_F),amount:E});}}var b=new yr(p,x,!0);return yr.available[t]!==void 0&&yr.uninstall(t),yr.available[t]=b,b;}}]);return yr;}();zr.ALPHA=[["a","z"],["A","Z"]," "],zr.NUMERIC=[["0","9"]],zr.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],zr.ASCII=[[" ","~"]],zr.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:zr.ALPHANUMERIC},zr.available={};var Wr=zr;var yA="// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\n// Tint\r\nuniform vec4 uColor;\r\n\r\n// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r\nuniform float uFWidth;\r\n\r\nvoid main(void) {\r\n\r\n  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r\n  vec4 texColor = texture2D(uSampler, vTextureCoord);\r\n\r\n  // MSDF\r\n  float median = texColor.r + texColor.g + texColor.b -\r\n                  min(texColor.r, min(texColor.g, texColor.b)) -\r\n                  max(texColor.r, max(texColor.g, texColor.b));\r\n  // SDF\r\n  median = min(median, texColor.a);\r\n\r\n  float screenPxDistance = uFWidth * (median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n  if (median < 0.01) {\r\n    alpha = 0.0;\r\n  } else if (median > 0.99) {\r\n    alpha = 1.0;\r\n  }\r\n\r\n  // Gamma correction for coverage-like alpha\r\n  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r\n  float gamma = mix(1.0, 1.0 / 2.2, luma);\r\n  float coverage = pow(uColor.a * alpha, gamma);  \r\n\r\n  // NPM Textures, NPM outputs\r\n  gl_FragColor = vec4(uColor.rgb, coverage);\r\n}\r\n",_A="// Mesh material default fragment\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform mat3 uTextureMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n\r\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r\n}\r\n";var Lp=[],Bp=[],Fp=[],vA=/*#__PURE__*/function(_Ye4){_inherits(Pm,_Ye4);var _super68=_createSuper(Pm);function Pm(t){var _this118;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,Pm);_this118=_super68.call(this);var _Object$assign2=Object.assign({},Pm.styleDefaults,e),i=_Object$assign2.align,s=_Object$assign2.tint,n=_Object$assign2.maxWidth,o=_Object$assign2.letterSpacing,a=_Object$assign2.fontName,l=_Object$assign2.fontSize;if(!Wr.available[a])throw new Error("Missing BitmapFont \"".concat(a,"\""));_this118._activePagesMeshData=[],_this118._textWidth=0,_this118._textHeight=0,_this118._align=i,_this118._tintColor=new wt(s),_this118._font=void 0,_this118._fontName=a,_this118._fontSize=l,_this118.text=t,_this118._maxWidth=n,_this118._maxLineHeight=0,_this118._letterSpacing=o,_this118._anchor=new Sr(function(){_this118.dirty=!0;},_assertThisInitialized(_this118),0,0),_this118._roundPixels=j.ROUND_PIXELS,_this118.dirty=!0,_this118._resolution=j.RESOLUTION,_this118._autoResolution=!0,_this118._textureCache={};return _this118;}_createClass(Pm,[{key:"updateText",value:function updateText(){var z;var t=Wr.available[this._fontName],e=this.fontSize,i=e/t.size,s=new bt(),n=[],o=[],a=[],l=this._text.replace(/(?:\r\n|\r)/g,"\n")||" ",h=Dp(l),u=this._maxWidth*t.size/e,c=t.distanceFieldType==="none"?Lp:Bp;var d=null,p=0,f=0,m=0,y=-1,_=0,v=0,g=0,x=0;for(var C=0;C<h.length;C++){var E=h[C],I=Io(E);if(/(?:\s)/.test(E)&&(y=C,_=p,x++),E==="\r"||E==="\n"){o.push(p),a.push(-1),f=Math.max(f,p),++m,++v,s.x=0,s.y+=t.lineHeight,d=null,x=0;continue;}var P=t.chars[I];if(!P)continue;d&&P.kerning[d]&&(s.x+=P.kerning[d]);var $=Fp.pop()||{texture:Z.EMPTY,line:0,charCode:0,prevSpaces:0,position:new bt()};$.texture=P.texture,$.line=m,$.charCode=I,$.position.x=Math.round(s.x+P.xOffset+this._letterSpacing/2),$.position.y=Math.round(s.y+P.yOffset),$.prevSpaces=x,n.push($),p=$.position.x+Math.max(P.xAdvance-P.xOffset,P.texture.orig.width),s.x+=P.xAdvance+this._letterSpacing,g=Math.max(g,P.yOffset+P.texture.height),d=I,y!==-1&&u>0&&s.x>u&&(++v,Ki(n,1+y-v,1+C-y),C=y,y=-1,o.push(_),a.push(n.length>0?n[n.length-1].prevSpaces:0),f=Math.max(f,_),m++,s.x=0,s.y+=t.lineHeight,d=null,x=0);}var b=h[h.length-1];b!=="\r"&&b!=="\n"&&(/(?:\s)/.test(b)&&(p=_),o.push(p),f=Math.max(f,p),a.push(-1));var S=[];for(var _C3=0;_C3<=m;_C3++){var _E2=0;this._align==="right"?_E2=f-o[_C3]:this._align==="center"?_E2=(f-o[_C3])/2:this._align==="justify"&&(_E2=a[_C3]<0?0:(f-o[_C3])/a[_C3]),S.push(_E2);}var w=n.length,T={},N=[],F=this._activePagesMeshData;c.push.apply(c,_toConsumableArray(F));for(var _C4=0;_C4<w;_C4++){var _E3=n[_C4].texture,_I=_E3.baseTexture.uid;if(!T[_I]){var _P=c.pop();if(!_P){var k=new Vw();var G=void 0,st=void 0;t.distanceFieldType==="none"?(G=new xp(Z.EMPTY),st=at.NORMAL):(G=new xp(Z.EMPTY,{program:Cr.from(_A,yA),uniforms:{uFWidth:0}}),st=at.NORMAL_NPM);var M=new vp(k,G);M.blendMode=st,_P={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:M,vertices:null,uvs:null,indices:null};}_P.index=0,_P.indexCount=0,_P.vertexCount=0,_P.uvsCount=0,_P.total=0;var _$2=this._textureCache;_$2[_I]=_$2[_I]||new Z(_E3.baseTexture),_P.mesh.texture=_$2[_I],_P.mesh.tint=this._tintColor.value,N.push(_P),T[_I]=_P;}T[_I].total++;}for(var _C5=0;_C5<F.length;_C5++)N.includes(F[_C5])||this.removeChild(F[_C5].mesh);for(var _C6=0;_C6<N.length;_C6++)N[_C6].mesh.parent!==this&&this.addChild(N[_C6].mesh);this._activePagesMeshData=N;for(var _C7 in T){var _E4=T[_C7],_I2=_E4.total;if(!(((z=_E4.indices)==null?void 0:z.length)>6*_I2)||_E4.vertices.length<vp.BATCHABLE_SIZE*2)_E4.vertices=new Float32Array(4*2*_I2),_E4.uvs=new Float32Array(4*2*_I2),_E4.indices=new Uint16Array(6*_I2);else{var _P2=_E4.total,_$3=_E4.vertices;for(var _k3=_P2*4*2;_k3<_$3.length;_k3++)_$3[_k3]=0;}_E4.mesh.size=6*_I2;}for(var _C8=0;_C8<w;_C8++){var _E5=n[_C8];var _I3=_E5.position.x+S[_E5.line]*(this._align==="justify"?_E5.prevSpaces:1);this._roundPixels&&(_I3=Math.round(_I3));var _P3=_I3*i,_$4=_E5.position.y*i,_k4=_E5.texture,_G2=T[_k4.baseTexture.uid],_st=_k4.frame,_M=_k4._uvs,L=_G2.index++;_G2.indices[L*6+0]=0+L*4,_G2.indices[L*6+1]=1+L*4,_G2.indices[L*6+2]=2+L*4,_G2.indices[L*6+3]=0+L*4,_G2.indices[L*6+4]=2+L*4,_G2.indices[L*6+5]=3+L*4,_G2.vertices[L*8+0]=_P3,_G2.vertices[L*8+1]=_$4,_G2.vertices[L*8+2]=_P3+_st.width*i,_G2.vertices[L*8+3]=_$4,_G2.vertices[L*8+4]=_P3+_st.width*i,_G2.vertices[L*8+5]=_$4+_st.height*i,_G2.vertices[L*8+6]=_P3,_G2.vertices[L*8+7]=_$4+_st.height*i,_G2.uvs[L*8+0]=_M.x0,_G2.uvs[L*8+1]=_M.y0,_G2.uvs[L*8+2]=_M.x1,_G2.uvs[L*8+3]=_M.y1,_G2.uvs[L*8+4]=_M.x2,_G2.uvs[L*8+5]=_M.y2,_G2.uvs[L*8+6]=_M.x3,_G2.uvs[L*8+7]=_M.y3;}this._textWidth=f*i,this._textHeight=(s.y+t.lineHeight)*i;for(var _C9 in T){var _E6=T[_C9];if(this.anchor.x!==0||this.anchor.y!==0){var _k5=0;var _G3=this._textWidth*this.anchor.x,_st2=this._textHeight*this.anchor.y;for(var _M2=0;_M2<_E6.total;_M2++)_E6.vertices[_k5++]-=_G3,_E6.vertices[_k5++]-=_st2,_E6.vertices[_k5++]-=_G3,_E6.vertices[_k5++]-=_st2,_E6.vertices[_k5++]-=_G3,_E6.vertices[_k5++]-=_st2,_E6.vertices[_k5++]-=_G3,_E6.vertices[_k5++]-=_st2;}this._maxLineHeight=g*i;var _I4=_E6.mesh.geometry.getBuffer("aVertexPosition"),_P4=_E6.mesh.geometry.getBuffer("aTextureCoord"),_$5=_E6.mesh.geometry.getIndex();_I4.data=_E6.vertices,_P4.data=_E6.uvs,_$5.data=_E6.indices,_I4.update(),_P4.update(),_$5.update();}for(var _C10=0;_C10<n.length;_C10++)Fp.push(n[_C10]);this._font=t,this.dirty=!1;}},{key:"updateTransform",value:function updateTransform(){this.validate(),this.containerUpdateTransform();}},{key:"_render",value:function _render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);var _Wr$available$this$_f=Wr.available[this._fontName],e=_Wr$available$this$_f.distanceFieldRange,i=_Wr$available$this$_f.distanceFieldType,s=_Wr$available$this$_f.size;if(i!=="none"){var _this$worldTransform=this.worldTransform,n=_this$worldTransform.a,o=_this$worldTransform.b,_a33=_this$worldTransform.c,_l36=_this$worldTransform.d,h=Math.sqrt(n*n+o*o),u=Math.sqrt(_a33*_a33+_l36*_l36),c=(Math.abs(h)+Math.abs(u))/2,d=this.fontSize/s,p=t._view.resolution;var _iterator20=_createForOfIteratorHelper(this._activePagesMeshData),_step20;try{for(_iterator20.s();!(_step20=_iterator20.n()).done;){var f=_step20.value;f.mesh.shader.uniforms.uFWidth=c*e*d*p;}}catch(err){_iterator20.e(err);}finally{_iterator20.f();}}_get(_getPrototypeOf(Pm.prototype),"_render",this).call(this,t);}},{key:"getLocalBounds",value:function getLocalBounds(){return this.validate(),_get(_getPrototypeOf(Pm.prototype),"getLocalBounds",this).call(this);}},{key:"validate",value:function validate(){var t=Wr.available[this._fontName];if(!t)throw new Error("Missing BitmapFont \"".concat(this._fontName,"\""));this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText();}},{key:"tint",get:function get(){return this._tintColor.value;},set:function set(t){if(this.tint!==t){this._tintColor.setValue(t);for(var e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t;}}},{key:"align",get:function get(){return this._align;},set:function set(t){this._align!==t&&(this._align=t,this.dirty=!0);}},{key:"fontName",get:function get(){return this._fontName;},set:function set(t){if(!Wr.available[t])throw new Error("Missing BitmapFont \"".concat(t,"\""));this._fontName!==t&&(this._fontName=t,this.dirty=!0);}},{key:"fontSize",get:function get(){var _this$_fontSize;return(_this$_fontSize=this._fontSize)!==null&&_this$_fontSize!==void 0?_this$_fontSize:Wr.available[this._fontName].size;},set:function set(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0);}},{key:"anchor",get:function get(){return this._anchor;},set:function set(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t);}},{key:"text",get:function get(){return this._text;},set:function set(t){var _t25;t=String((_t25=t)!==null&&_t25!==void 0?_t25:""),this._text!==t&&(this._text=t,this.dirty=!0);}},{key:"maxWidth",get:function get(){return this._maxWidth;},set:function set(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0);}},{key:"maxLineHeight",get:function get(){return this.validate(),this._maxLineHeight;}},{key:"textWidth",get:function get(){return this.validate(),this._textWidth;}},{key:"letterSpacing",get:function get(){return this._letterSpacing;},set:function set(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0);}},{key:"roundPixels",get:function get(){return this._roundPixels;},set:function set(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0);}},{key:"textHeight",get:function get(){return this.validate(),this._textHeight;}},{key:"resolution",get:function get(){return this._resolution;},set:function set(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0);}},{key:"destroy",value:function destroy(t){var e=this._textureCache,i=Wr.available[this._fontName].distanceFieldType==="none"?Lp:Bp;i.push.apply(i,_toConsumableArray(this._activePagesMeshData));var _iterator21=_createForOfIteratorHelper(this._activePagesMeshData),_step21;try{for(_iterator21.s();!(_step21=_iterator21.n()).done;){var _s10=_step21.value;this.removeChild(_s10.mesh);}}catch(err){_iterator21.e(err);}finally{_iterator21.f();}this._activePagesMeshData=[],i.filter(function(s){return e[s.mesh.texture.baseTexture.uid];}).forEach(function(s){s.mesh.texture=Z.EMPTY;});for(var s in e)e[s].destroy(),delete e[s];this._font=null,this._tintColor=null,this._textureCache=null,_get(_getPrototypeOf(Pm.prototype),"destroy",this).call(this,t);}}]);return Pm;}(Ye);vA.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};var xA=[".xml",".fnt"],bA={extension:{type:W.LoadParser,priority:Ke.Normal},name:"loadBitmapFont",test:function test(r){return xA.includes(se.extname(r).toLowerCase());},testParse:function testParse(r){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee54(){return _regeneratorRuntime().wrap(function _callee54$(_context54){while(1)switch(_context54.prev=_context54.next){case 0:return _context54.abrupt("return",Co.test(r)||uh.test(r));case 1:case"end":return _context54.stop();}},_callee54);}))();},parse:function parse(r,t,e){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee55(){var i,s,n,o,h,u,c,a,l;return _regeneratorRuntime().wrap(function _callee55$(_context55){while(1)switch(_context55.prev=_context55.next){case 0:i=Co.test(r)?Co.parse(r):uh.parse(r),s=t.src,n=i.page,o=[];for(h=0;h<n.length;++h){u=n[h].file;c=se.join(se.dirname(s),u);c=Yl(c,s),o.push(c);}_context55.next=4;return e.load(o);case 4:a=_context55.sent;l=o.map(function(h){return a[h];});return _context55.abrupt("return",Wr.install(i,l,!0));case 7:case"end":return _context55.stop();}},_callee55);}))();},load:function load(r,t){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee56(){return _regeneratorRuntime().wrap(function _callee56$(_context56){while(1)switch(_context56.prev=_context56.next){case 0:_context56.next=2;return j.ADAPTER.fetch(r);case 2:return _context56.abrupt("return",_context56.sent.text());case 3:case"end":return _context56.stop();}},_callee56);}))();},unload:function unload(r){r.destroy();}};K.add(bA);var dh=/*#__PURE__*/function(_Xr){_inherits(cs,_Xr);var _super69=_createSuper(cs);function cs(){var _this119;_classCallCheck(this,cs);_this119=_super69.apply(this,arguments),_this119._fonts=[],_this119._overrides=[],_this119._stylesheet="",_this119.fontsDirty=!1;return _this119;}_createClass(cs,[{key:"cleanFonts",value:function cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(function(t){URL.revokeObjectURL(t.src),t.refs--,t.refs===0&&(t.fontFace&&document.fonts["delete"](t.fontFace),delete cs.availableFonts[t.originalUrl]);}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0);}},{key:"loadFont",value:function loadFont(t){var _this120=this;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var i=cs.availableFonts;if(i[t]){var s=i[t];return this._fonts.push(s),s.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve();}return j.ADAPTER.fetch(t).then(function(s){return s.blob();}).then(/*#__PURE__*/function(){var _ref144=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee57(s){return _regeneratorRuntime().wrap(function _callee57$(_context57){while(1)switch(_context57.prev=_context57.next){case 0:return _context57.abrupt("return",new Promise(function(n,o){var a=URL.createObjectURL(s),l=new FileReader();l.onload=function(){return n([a,l.result]);},l.onerror=o,l.readAsDataURL(s);}));case 1:case"end":return _context57.stop();}},_callee57);}));return function(_x52){return _ref144.apply(this,arguments);};}()).then(/*#__PURE__*/function(){var _ref146=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee58(_ref145){var _ref147,s,n,o,a;return _regeneratorRuntime().wrap(function _callee58$(_context58){while(1)switch(_context58.prev=_context58.next){case 0:_ref147=_slicedToArray(_ref145,2),s=_ref147[0],n=_ref147[1];o=Object.assign({family:se.basename(t,se.extname(t)),weight:"normal",style:"normal",display:"auto",src:s,dataSrc:n,refs:1,originalUrl:t,fontFace:null},e);i[t]=o,_this120._fonts.push(o),_this120.styleID++;a=new FontFace(o.family,"url(".concat(o.src,")"),{weight:o.weight,style:o.style,display:o.display});o.fontFace=a;_context58.next=7;return a.load();case 7:document.fonts.add(a);_context58.next=10;return document.fonts.ready;case 10:_this120.styleID++;_this120.fontsDirty=!0;case 12:case"end":return _context58.stop();}},_callee58);}));return function(_x53){return _ref146.apply(this,arguments);};}());}},{key:"addOverride",value:function addOverride(){var _this121=this,_this$_overrides;for(var _len12=arguments.length,t=new Array(_len12),_key12=0;_key12<_len12;_key12++){t[_key12]=arguments[_key12];}var e=t.filter(function(i){return!_this121._overrides.includes(i);});e.length>0&&((_this$_overrides=this._overrides).push.apply(_this$_overrides,_toConsumableArray(e)),this.styleID++);}},{key:"removeOverride",value:function removeOverride(){var _this122=this;for(var _len13=arguments.length,t=new Array(_len13),_key13=0;_key13<_len13;_key13++){t[_key13]=arguments[_key13];}var e=t.filter(function(i){return _this122._overrides.includes(i);});e.length>0&&(this._overrides=this._overrides.filter(function(i){return!e.includes(i);}),this.styleID++);}},{key:"toCSS",value:function toCSS(t){return["transform: scale(".concat(t,")"),"transform-origin: top left","display: inline-block","color: ".concat(this.normalizeColor(this.fill)),"font-size: ".concat(this.fontSize,"px"),"font-family: ".concat(this.fontFamily),"font-weight: ".concat(this.fontWeight),"font-style: ".concat(this.fontStyle),"font-variant: ".concat(this.fontVariant),"letter-spacing: ".concat(this.letterSpacing,"px"),"text-align: ".concat(this.align),"padding: ".concat(this.padding,"px"),"white-space: ".concat(this.whiteSpace)].concat(_toConsumableArray(this.lineHeight?["line-height: ".concat(this.lineHeight,"px")]:[]),_toConsumableArray(this.wordWrap?["word-wrap: ".concat(this.breakWords?"break-all":"break-word"),"max-width: ".concat(this.wordWrapWidth,"px")]:[]),_toConsumableArray(this.strokeThickness?["-webkit-text-stroke-width: ".concat(this.strokeThickness,"px"),"-webkit-text-stroke-color: ".concat(this.normalizeColor(this.stroke)),"text-stroke-width: ".concat(this.strokeThickness,"px"),"text-stroke-color: ".concat(this.normalizeColor(this.stroke)),"paint-order: stroke"]:[]),_toConsumableArray(this.dropShadow?[this.dropShadowToCSS()]:[]),_toConsumableArray(this._overrides)).join(";");}},{key:"toGlobalCSS",value:function toGlobalCSS(){return this._fonts.reduce(function(t,e){return"".concat(t,"\n            @font-face {\n                font-family: \"").concat(e.family,"\";\n                src: url('").concat(e.dataSrc,"');\n                font-weight: ").concat(e.weight,";\n                font-style: ").concat(e.style,";\n                font-display: ").concat(e.display,";\n            }");},this._stylesheet);}},{key:"stylesheet",get:function get(){return this._stylesheet;},set:function set(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++);}},{key:"normalizeColor",value:function normalizeColor(t){return Array.isArray(t)&&(t=ub(t)),typeof t=="number"?hb(t):t;}},{key:"dropShadowToCSS",value:function dropShadowToCSS(){var t=this.normalizeColor(this.dropShadowColor);var e=this.dropShadowAlpha,i=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),s=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&e<1&&(t+=(e*255|0).toString(16).padStart(2,"0"));var n="".concat(i,"px ").concat(s,"px");return this.dropShadowBlur>0?"text-shadow: ".concat(n," ").concat(this.dropShadowBlur,"px ").concat(t):"text-shadow: ".concat(n," ").concat(t);}},{key:"reset",value:function reset(){Object.assign(this,cs.defaultOptions);}},{key:"onBeforeDraw",value:function onBeforeDraw(){var t=this.fontsDirty;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise(function(e){return setTimeout(e,100);}):Promise.resolve();}},{key:"isSafari",get:function get(){var _j$ADAPTER$getNavigat=j.ADAPTER.getNavigator(),t=_j$ADAPTER$getNavigat.userAgent;return /^((?!chrome|android).)*safari/i.test(t);}},{key:"fillGradientStops",get:function get(){return _get(_getPrototypeOf(cs.prototype),"fillGradientStops",this);},set:function set(t){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText");}},{key:"fillGradientType",get:function get(){return _get(_getPrototypeOf(cs.prototype),"fillGradientType",this);},set:function set(t){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText");}},{key:"miterLimit",get:function get(){return _get(_getPrototypeOf(cs.prototype),"miterLimit",this);},set:function set(t){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText");}},{key:"trim",get:function get(){return _get(_getPrototypeOf(cs.prototype),"trim",this);},set:function set(t){console.warn("[HTMLTextStyle] trim is not supported by HTMLText");}},{key:"textBaseline",get:function get(){return _get(_getPrototypeOf(cs.prototype),"textBaseline",this);},set:function set(t){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText");}},{key:"leading",get:function get(){return _get(_getPrototypeOf(cs.prototype),"leading",this);},set:function set(t){console.warn("[HTMLTextStyle] leading is not supported by HTMLText");}},{key:"lineJoin",get:function get(){return _get(_getPrototypeOf(cs.prototype),"lineJoin",this);},set:function set(t){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText");}}],[{key:"from",value:function from(t){return new cs(Object.keys(cs.defaultOptions).reduce(function(e,i){return _objectSpread(_objectSpread({},e),{},_defineProperty({},i,t[i]));},{}));}}]);return cs;}(Xr);dh.availableFonts={},dh.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};var fh=dh;var Ro=/*#__PURE__*/function(_ts2){_inherits(ds,_ts2);var _super70=_createSuper(ds);function ds(){var _ds$defaultResolution;var _this123;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,ds);_this123=_super70.call(this,Z.EMPTY),_this123._text=null,_this123._style=null,_this123._autoResolution=!0,_this123.localStyleID=-1,_this123.dirty=!1,_this123._updateID=0,_this123.ownsStyle=!1;var i=new Image(),s=Z.from(i,{scaleMode:j.SCALE_MODE,resourceOptions:{autoLoad:!1}});s.orig=new pt(),s.trim=new pt(),_this123.texture=s;var n="http://www.w3.org/2000/svg",o="http://www.w3.org/1999/xhtml",a=document.createElementNS(n,"svg"),l=document.createElementNS(n,"foreignObject"),h=document.createElementNS(o,"div"),u=document.createElementNS(o,"style");l.setAttribute("width","10000"),l.setAttribute("height","10000"),l.style.overflow="hidden",a.appendChild(l),_this123.maxWidth=ds.defaultMaxWidth,_this123.maxHeight=ds.defaultMaxHeight,_this123._domElement=h,_this123._styleElement=u,_this123._svgRoot=a,_this123._foreignObject=l,_this123._foreignObject.appendChild(u),_this123._foreignObject.appendChild(h),_this123._image=i,_this123._loadImage=new Image(),_this123._autoResolution=ds.defaultAutoResolution,_this123._resolution=(_ds$defaultResolution=ds.defaultResolution)!==null&&_ds$defaultResolution!==void 0?_ds$defaultResolution:j.RESOLUTION,_this123.text=t,_this123.style=e;return _this123;}_createClass(ds,[{key:"measureText",value:function measureText(t){var u,c;var _Object$assign3=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t),e=_Object$assign3.text,i=_Object$assign3.style,s=_Object$assign3.resolution;Object.assign(this._domElement,{innerHTML:e,style:i.toCSS(s)}),this._styleElement.textContent=i.toGlobalCSS(),document.body.appendChild(this._svgRoot);var n=this._domElement.getBoundingClientRect();this._svgRoot.remove();var o=n.width,a=n.height;(o>this.maxWidth||a>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");var l=Math.min(this.maxWidth,Math.ceil(o)),h=Math.min(this.maxHeight,Math.ceil(a));return this._svgRoot.setAttribute("width",l.toString()),this._svgRoot.setAttribute("height",h.toString()),e!==this._text&&(this._domElement.innerHTML=this._text),i!==this._style&&(Object.assign(this._domElement,{style:(u=this._style)==null?void 0:u.toCSS(s)}),this._styleElement.textContent=(c=this._style)==null?void 0:c.toGlobalCSS()),{width:l+i.padding*2,height:h+i.padding*2};}},{key:"updateText",value:function(){var _updateText=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee60(){var _this124=this;var t,e,i,s,_this$measureText,n,o,a,_args60=arguments;return _regeneratorRuntime().wrap(function _callee60$(_context60){while(1)switch(_context60.prev=_context60.next){case 0:t=_args60.length>0&&_args60[0]!==undefined?_args60[0]:!0;e=this.style,i=this._image,s=this._loadImage;if(!(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)){_context60.next=4;break;}return _context60.abrupt("return");case 4:_this$measureText=this.measureText(),n=_this$measureText.width,o=_this$measureText.height;i.width=s.width=Math.ceil(Math.max(1,n)),i.height=s.height=Math.ceil(Math.max(1,o)),this._updateID++;a=this._updateID;_context60.next=9;return new Promise(function(l){s.onload=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee59(){return _regeneratorRuntime().wrap(function _callee59$(_context59){while(1)switch(_context59.prev=_context59.next){case 0:if(!(a<_this124._updateID)){_context59.next=3;break;}l();return _context59.abrupt("return");case 3:_context59.next=5;return e.onBeforeDraw();case 5:i.src=s.src;s.onload=null;s.src="";_this124.updateTexture();l();case 10:case"end":return _context59.stop();}},_callee59);}));var h=new XMLSerializer().serializeToString(_this124._svgRoot);s.src="data:image/svg+xml;charset=utf8,".concat(encodeURIComponent(h));});case 9:case"end":return _context60.stop();}},_callee60,this);}));function updateText(){return _updateText.apply(this,arguments);}return updateText;}()},{key:"source",get:function get(){return this._image;}},{key:"updateTexture",value:function updateTexture(){var t=this.style,e=this.texture,i=this._image,s=this.resolution,n=t.padding,o=e.baseTexture;e.trim.width=e._frame.width=i.width/s,e.trim.height=e._frame.height=i.height/s,e.trim.x=-n,e.trim.y=-n,e.orig.width=e._frame.width-n*2,e.orig.height=e._frame.height-n*2,this._onTextureUpdate(),o.setRealSize(i.width,i.height,s),this.dirty=!1;}},{key:"_render",value:function _render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),_get(_getPrototypeOf(ds.prototype),"_render",this).call(this,t);}},{key:"_renderCanvas",value:function _renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),_get(_getPrototypeOf(ds.prototype),"_renderCanvas",this).call(this,t);}},{key:"getLocalBounds",value:function getLocalBounds(t){return this.updateText(!0),_get(_getPrototypeOf(ds.prototype),"getLocalBounds",this).call(this,t);}},{key:"_calculateBounds",value:function _calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData);}},{key:"_onStyleChange",value:function _onStyleChange(){this.dirty=!0;}},{key:"destroy",value:function destroy(t){var i,s,n,o,a;typeof t=="boolean"&&(t={children:t}),t=Object.assign({},ds.defaultDestroyOptions,t),_get(_getPrototypeOf(ds.prototype),"destroy",this).call(this,t);var e=null;this.ownsStyle&&((i=this._style)==null||i.cleanFonts()),this._style=e,(s=this._svgRoot)==null||s.remove(),this._svgRoot=e,(n=this._domElement)==null||n.remove(),this._domElement=e,(o=this._foreignObject)==null||o.remove(),this._foreignObject=e,(a=this._styleElement)==null||a.remove(),this._styleElement=e,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=e,this._image.src="",this._image=e;}},{key:"width",get:function get(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution;},set:function set(t){this.updateText(!0);var e=Fr(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t;}},{key:"height",get:function get(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution;},set:function set(t){this.updateText(!0);var e=Fr(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t;}},{key:"style",get:function get(){return this._style;},set:function set(t){this._style!==t&&(t=t||{},t instanceof fh?(this.ownsStyle=!1,this._style=t):t instanceof Xr?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=fh.from(t)):(this.ownsStyle=!0,this._style=new fh(t)),this.localStyleID=-1,this.dirty=!0);}},{key:"text",get:function get(){return this._text;},set:function set(t){t=String(t===""||t===null||t===void 0?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0);}},{key:"resolution",get:function get(){return this._resolution;},set:function set(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0);}},{key:"sanitiseText",value:function sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;");}}]);return ds;}(ts);Ro.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},Ro.defaultMaxWidth=2024,Ro.defaultMaxHeight=2024,Ro.defaultAutoResolution=!0;var EA=16777215,TA=.25,wA=16777215,AA=1,SA=1.5;var Yr=!1,Ys;var ph=function ph(r){var t={tint:r!=null&&r.fill?new wt(r.fill).toNumber():EA,alpha:(r==null?void 0:r.fillOpacity)!==void 0?Math.min(r.fillOpacity,1):String(r==null?void 0:r.fill).toLowerCase().startsWith("rgba(")?new wt(r==null?void 0:r.fill).alpha:TA},e={tint:r!=null&&r.stroke?new wt(r.stroke).toNumber():wA,alpha:(r==null?void 0:r.strokeOpacity)!==void 0?Math.min(r.strokeOpacity,1):String(r==null?void 0:r.stroke).toLowerCase().startsWith("rgba(")?new wt(r==null?void 0:r.stroke).alpha:AA,lineWidth:(r==null?void 0:r.strokeWidth)===void 0?SA:r.strokeWidth};return{fillStyle:t,strokeStyle:e};},Mo=function Mo(r){return function(t,e,i){var _ph=ph(i),s=_ph.fillStyle,n=_ph.strokeStyle,o=new Ws();o.beginFill(16777215),r(e,o),o.endFill(),o.tint=s.tint,o.alpha=s.alpha,t.addChild(o);var a=new Ws(),l=n.lineWidth===1?1:n.lineWidth/Ys;return a.lineStyle(l,16777215,1,.5,n.lineWidth===1),r(e,a),a.tint=n.tint||16777215,a.alpha=n.alpha,t.addChild(a),{fill:o,stroke:a,strokeWidth:n.lineWidth};};},CA=Mo(function(r,t){var _r$geometry2=r.geometry,e=_r$geometry2.x,i=_r$geometry2.y,s=_r$geometry2.w,n=_r$geometry2.h;t.drawRect(e,i,s,n);}),IA=Mo(function(r,t){var _r$geometry3=r.geometry,e=_r$geometry3.cx,i=_r$geometry3.cy,s=_r$geometry3.rx,n=_r$geometry3.ry;t.drawEllipse(e,i,s,n);}),RA=Mo(function(r,t){var e=r.geometry.points.reduce(function(i,s){return[].concat(_toConsumableArray(i),_toConsumableArray(s));},[]);t.drawPolygon(e);}),MA=Mo(function(r,t){var e=function e(i){return i.points.reduce(function(s,n){return[].concat(_toConsumableArray(s),_toConsumableArray(n));},[]);};r.geometry.polygons.forEach(function(i){var _i$rings2=_toArray(i.rings),s=_i$rings2[0],n=_i$rings2.slice(1);t.drawPolygon(e(s)),n.forEach(function(o){t.beginHole(),t.drawPolygon(e(o)),t.endHole();});});}),Up=function Up(r){var t=r.viewport.getContainerSize().x;return r.viewport.getZoom(!0)*t/r.world.getContentFactor();},kp=function kp(r,t,e,i){return function(){var s=r.viewport.viewportToImageRectangle(r.viewport.getBounds(!0)),n=Up(r);(n!==Ys||!Yr)&&(Yr=!0,e.forEach(function(_ref149){var d=_ref149.stroke,p=_ref149.strokeWidth;var f=d.geometry.graphicsData[0].lineStyle;p>1?(Yr=n===Ys,f.width=p/n,f["native"]=!1,d.geometry.invalidate()):p===1&&!f["native"]&&(f.width=1,f["native"]=!0,d.geometry.invalidate());})),Ys=n;var o=r.viewport.getFlip();var a=Math.PI*r.viewport.getRotation(!0)/180;a<0&&(a+=2*Math.PI),a>2*Math.PI&&(a-=2*Math.PI);var l=o?r.viewport._containerInnerSize.x+s.x*n:-s.x*n,h=-s.y*n;var u,c;a>0&&a<=Math.PI/2?(u=s.height*n,c=0):a>Math.PI/2&&a<=Math.PI?(u=s.width*n,c=s.height*n):a>Math.PI&&a<=Math.PI*1.5?(u=0,c=s.width*n):(u=0,c=0),t.position.x=u+l*Math.cos(a)-h*Math.sin(a),t.position.y=c+l*Math.sin(a)+h*Math.cos(a),t.scale.set(o?-n:n,n),t.rotation=a,i.render(t);};},PA=function PA(r,t){var e=new Ws(),i=Lf({width:t.width,height:t.height,backgroundAlpha:0,view:t,antialias:!0,resolution:2}),s=new Map();var n=new Set(),o,a;Ys=Up(r);var l=function l(g,x){Yr=!1;var b=g.target.selector,S=typeof a=="function"?a(g,x):a;var w;b.type===vt.RECTANGLE?w=CA(e,b,S):b.type===vt.POLYGON?w=RA(e,b,S):b.type===vt.ELLIPSE?w=IA(e,b,S):b.type===vt.MULTIPOLYGLON?w=MA(e,b,S):console.warn("Unsupported shape type: ".concat(b.type)),w&&s.set(g.id,_objectSpread({annotation:g},w));},h=function h(g){var x=s.get(g.id);x&&(s["delete"](g.id),x.fill.destroy(),x.stroke.destroy());},u=function u(g,x,b){Yr=!1;var S=s.get(g.id);S&&(s["delete"](g.id),S.fill.destroy(),S.stroke.destroy(),l(x,b));},c=function c(g,x){var b=s.get(g);b&&(s["delete"](g),b.fill.destroy(),b.stroke.destroy(),l(b.annotation,x));},d=function d(g,x){i.resize(g,x),i.render(e);},p=function p(g){Yr=!1;var x=e.children;s.forEach(function(_ref150){var b=_ref150.fill,S=_ref150.stroke,w=_ref150.annotation;var T=g?n.has(w.id)||g(w):!0;T&&!x.includes(b)?(e.addChild(b),e.addChild(S)):!T&&x.includes(b)&&(e.removeChild(b),e.removeChild(S));}),i.render(e);},f=function f(g){o!==g&&(o&&c(o,{selected:n.has(o)}),g&&c(g,{selected:n.has(g),hovered:!0}),o=g,i.render(e));},m=function m(g){var x=g.selected.map(function(w){return w.id;}),b=x.filter(function(w){return!n.has(w);}),S=_toConsumableArray(n).filter(function(w){return!x.includes(w);});[].concat(_toConsumableArray(b),_toConsumableArray(S)).forEach(function(w){return c(w,{selected:x.includes(w),hovered:w===o});}),n=new Set(x),i.render(e);},y=function y(g){if(typeof g=="function")s.forEach(function(_ref151,T){var x=_ref151.annotation,b=_ref151.fill,S=_ref151.stroke,w=_ref151.strokeWidth;w>1&&(Yr=!1);var N={selected:n.has(x.id),hovered:o===x.id},_ph2=ph(g(x,N)),F=_ph2.fillStyle,z=_ph2.strokeStyle;b.tint=F.tint,b.alpha=F.alpha,S.tint=z.tint||16777215,S.alpha=z.alpha,s.set(x.id,{annotation:x,fill:b,stroke:S,strokeWidth:z.lineWidth});});else{var _ph3=ph(g),x=_ph3.fillStyle,b=_ph3.strokeStyle;b.lineWidth>1&&(Yr=!1),s.forEach(function(_ref152,F){var S=_ref152.annotation,w=_ref152.fill,T=_ref152.stroke,N=_ref152.strokeWidth;w.tint=x.tint,w.alpha=x.alpha,T.tint=b.tint||16777215,T.alpha=b.alpha,s.set(S.id,{annotation:S,fill:w,stroke:T,strokeWidth:b.lineWidth});});}a=g,i.render(e),kp(r,e,s,i)();},_=function _(g){g?t.classList.remove("hidden"):t.classList.add("hidden");};return{addAnnotation:l,destroy:function destroy(){return i.destroy();},redraw:kp(r,e,s,i),removeAnnotation:h,resize:d,setFilter:p,setHovered:f,setSelected:m,setStyle:y,setVisible:_,updateAnnotation:u};};function OA(r,t,e){var i,s,n=t.filter,o=t.state,a=t.style,l=t.viewer,_t$visible2=t.visible,h=_t$visible2===void 0?!0:_t$visible2;var _o19=o,u=_o19.store,c=_o19.hover,d=_o19.selection,p=_o19.viewport;fn(r,c,function(S){return e(11,i=S);}),fn(r,d,function(S){return e(8,s=S);});var f=yn();var m,y;var _=function _(S){var w=new de.Point(S.x,S.y),_l$viewport$pointFrom=l.viewport.pointFromPixel(w),T=_l$viewport$pointFrom.x,N=_l$viewport$pointFrom.y;return l.viewport.viewportToImageCoordinates(T,N);},v=function v(S){var _S$position=S.position,w=_S$position.x,T=_S$position.y;y={x:w,y:T};},g=function g(S){return function(w){var _ref153=_(new de.Point(w.offsetX,w.offsetY)),T=_ref153.x,N=_ref153.y,F=u.getAt(T,N);F&&(!n||n(F))?(S.classList.add("hover"),i!==F.id&&(c.set(F.id),m.setHovered(F.id))):(S.classList.remove("hover"),i&&(c.set(void 0),m.setHovered(void 0)));};},x=function x(S){if(!y)return;var w=S.originalEvent,_S$position2=S.position,T=_S$position2.x,N=_S$position2.y,F=T-y.x,z=N-y.y;if(Math.sqrt(F*F+z*z)<5){var _ref154=_(S.position),E=_ref154.x,I=_ref154.y,P=u.getAt(E,I);P?f("click",{originalEvent:w,annotation:P}):f("click",{originalEvent:w});}y=void 0;};var b;return gn(function(){var P;var _l$canvas=l.canvas,S=_l$canvas.offsetWidth,w=_l$canvas.offsetHeight,T=document.createElement("canvas");T.width=S,T.height=w,T.className="a9s-gl-canvas",(P=l.element.querySelector(".openseadragon-canvas"))==null||P.appendChild(T),e(7,m=PA(l,T));var N=g(T);T.addEventListener("pointermove",N);var F=new ResizeObserver(function($){try{var _$$0$contentRect=$[0].contentRect,k=_$$0$contentRect.width,G=_$$0$contentRect.height;T.width=k,T.height=G,m.resize(k,G);}catch(_unused21){console.warn("WebGL canvas already disposed");}});F.observe(T);var z=function z(){var $=l.viewport.getBounds();b=l.viewport.viewportToImageRectangle($);var _b3=b,k=_b3.x,G=_b3.y,st=_b3.width,M=_b3.height,L=u.getIntersecting(k,G,st,M);p.set(L.map(function(V){return V.id;}));};l.addHandler("canvas-press",v),l.addHandler("canvas-release",x),l.addHandler("update-viewport",m.redraw),l.addHandler("animation-finish",z);var C=function C($){return $.filter(function(k){return Ge(k);});},E=function E($){return Ge($.oldValue)&&Ge($.newValue);},I=function I($){var _$$changes=$.changes,k=_$$changes.created,G=_$$changes.updated,st=_$$changes.deleted;if(C(k||[]).forEach(function(M){return m.addAnnotation(M);}),C(st||[]).forEach(function(M){return m.removeAnnotation(M);}),(G||[]).filter(function(M){return E(M);}).forEach(function(_ref155){var M=_ref155.oldValue,L=_ref155.newValue;return m.updateAnnotation(M,L);}),b){var _b4=b,M=_b4.x,L=_b4.y,V=_b4.width,rt=_b4.height,Q=u.getIntersecting(M,L,V,rt);p.set(Q.map(function(X){return X.id;}));}else p.set(u.all().map(function(M){return M.id;}));m.redraw();};return u.observe(I),function(){var $;T.removeEventListener("pointermove",N),F.disconnect(),l.removeHandler("canvas-press",v),l.removeHandler("canvas-release",x),l.removeHandler("update-viewport",m.redraw),l.removeHandler("animation-finish",z),u.unobserve(I),m.destroy(),($=T.parentNode)==null||$.removeChild(T);};}),r.$$set=function(S){"filter"in S&&e(2,n=S.filter),"state"in S&&e(3,o=S.state),"style"in S&&e(4,a=S.style),"viewer"in S&&e(5,l=S.viewer),"visible"in S&&e(6,h=S.visible);},r.$$.update=function(){r.$$.dirty&132&&(m==null||m.setFilter(n)),r.$$.dirty&384&&(m==null||m.setSelected(s)),r.$$.dirty&144&&(m==null||m.setStyle(a)),r.$$.dirty&192&&(m==null||m.setVisible(h));},[c,d,n,o,a,l,h,m,s];}var NA=/*#__PURE__*/function(_re){_inherits(NA,_re);var _super71=_createSuper(NA);function NA(t){var _this125;_classCallCheck(this,NA);_this125=_super71.call(this),ee(_assertThisInitialized(_this125),t,OA,null,Wt,{filter:2,state:3,style:4,viewer:5,visible:6});return _this125;}return _createClass(NA);}(re);var ce=[];for(var _r9=0;_r9<256;++_r9)ce.push((_r9+256).toString(16).slice(1));function DA(r){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return(ce[r[t+0]]+ce[r[t+1]]+ce[r[t+2]]+ce[r[t+3]]+"-"+ce[r[t+4]]+ce[r[t+5]]+"-"+ce[r[t+6]]+ce[r[t+7]]+"-"+ce[r[t+8]]+ce[r[t+9]]+"-"+ce[r[t+10]]+ce[r[t+11]]+ce[r[t+12]]+ce[r[t+13]]+ce[r[t+14]]+ce[r[t+15]]).toLowerCase();}var mh;var LA=new Uint8Array(16);function BA(){if(!mh){if((typeof crypto==="undefined"?"undefined":_typeof(crypto))>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");mh=crypto.getRandomValues.bind(crypto);}return mh(LA);}var Gp={randomUUID:(typeof crypto==="undefined"?"undefined":_typeof(crypto))<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function FA(r,t,e){var _ref156,_r$random4;var s;if(Gp.randomUUID&&!r)return Gp.randomUUID();r=r||{};var i=(_ref156=(_r$random4=r.random)!==null&&_r$random4!==void 0?_r$random4:(s=r.rng)==null?void 0:s.call(r))!==null&&_ref156!==void 0?_ref156:BA();if(i.length<16)throw new Error("Random bytes length must be >= 16");return i[6]=i[6]&15|64,i[8]=i[8]&63|128,DA(i);}var jr=function(r){return r.ELLIPSE="ELLIPSE",r.MULTIPOLYGLON="MULTIPOLYGON",r.POLYGON="POLYGON",r.RECTANGLE="RECTANGLE",r;}(jr||{});var Po=function Po(r,t){return t;},Oo=function Oo(r){var t=1/0,e=1/0,i=-1/0,s=-1/0;return r.forEach(function(_ref157){var _ref158=_slicedToArray(_ref157,2),n=_ref158[0],o=_ref158[1];t=Math.min(t,n),e=Math.min(e,o),i=Math.max(i,n),s=Math.max(s,o);}),{minX:t,minY:e,maxX:i,maxY:s};},gh=function gh(r){var t=0,e=r.length-1;for(var i=0;i<r.length;i++)t+=(r[e][0]+r[i][0])*(r[e][1]-r[i][1]),e=i;return Math.abs(.5*t);},yh=function yh(r,t,e){var i=!1;for(var s=0,n=r.length-1;s<r.length;n=s++){var o=r[s][0],_a34=r[s][1],_l37=r[n][0],h=r[n][1];_a34>e!=h>e&&t<(_l37-o)*(e-_a34)/(h-_a34)+o&&(i=!i);}return i;},UA=function UA(r){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!0;var e="M ";return r.forEach(function(_ref159,n){var _ref160=_slicedToArray(_ref159,2),i=_ref160[0],s=_ref160[1];n===0?e+="".concat(i,",").concat(s):e+=" L ".concat(i,",").concat(s);}),t&&(e+=" Z"),e;},kA={area:function area(r){return Math.PI*r.geometry.rx*r.geometry.ry;},intersects:function intersects(r,t,e){var _r$geometry4=r.geometry,i=_r$geometry4.cx,s=_r$geometry4.cy,n=_r$geometry4.rx,o=_r$geometry4.ry,a=0,l=Math.cos(a),h=Math.sin(a),u=t-i,c=e-s,d=l*u+h*c,p=h*u-l*c;return d*d/(n*n)+p*p/(o*o)<=1;}};Po(jr.ELLIPSE,kA);var GA={area:function area(r){var t=r.geometry.polygons;return t.reduce(function(e,i){var _i$rings3=_toArray(i.rings),s=_i$rings3[0],n=_i$rings3.slice(1),o=gh(s.points),a=n.reduce(function(l,h){return l+gh(h.points);},0);return e+o-a;},0);},intersects:function intersects(r,t,e){var i=r.geometry.polygons;var _iterator22=_createForOfIteratorHelper(i),_step22;try{for(_iterator22.s();!(_step22=_iterator22.n()).done;){var s=_step22.value;var _s$rings2=_toArray(s.rings),n=_s$rings2[0],o=_s$rings2.slice(1);if(yh(n.points,t,e)){var _a35=!1;var _iterator23=_createForOfIteratorHelper(o),_step23;try{for(_iterator23.s();!(_step23=_iterator23.n()).done;){var _l38=_step23.value;if(yh(_l38.points,t,e)){_a35=!0;break;}}}catch(err){_iterator23.e(err);}finally{_iterator23.f();}if(!_a35)return!0;}}}catch(err){_iterator22.e(err);}finally{_iterator22.f();}return!1;}},$A=function $A(r){var t=r.reduce(function(e,i){return[].concat(_toConsumableArray(e),_toConsumableArray(i.rings[0].points));},[]);return Oo(t);},No=function No(r){return r.rings.map(function(e){return UA(e.points);}).join(" ");};Po(jr.MULTIPOLYGLON,GA);var HA={area:function area(r){var t=r.geometry.points;return gh(t);},intersects:function intersects(r,t,e){var i=r.geometry.points;return yh(i,t,e);}};Po(jr.POLYGON,HA);var VA={area:function area(r){return r.geometry.w*r.geometry.h;},intersects:function intersects(r,t,e){return t>=r.geometry.x&&t<=r.geometry.x+r.geometry.w&&e>=r.geometry.y&&e<=r.geometry.y+r.geometry.h;}};Po(jr.RECTANGLE,VA);var jt=" ";function XA(r){var t="";Array.isArray(r)||(r=[r]);for(var e=0;e<r.length;e++){var i=r[e];if(i.type===U.CLOSE_PATH)t+="z";else if(i.type===U.HORIZ_LINE_TO)t+=(i.relative?"h":"H")+i.x;else if(i.type===U.VERT_LINE_TO)t+=(i.relative?"v":"V")+i.y;else if(i.type===U.MOVE_TO)t+=(i.relative?"m":"M")+i.x+jt+i.y;else if(i.type===U.LINE_TO)t+=(i.relative?"l":"L")+i.x+jt+i.y;else if(i.type===U.CURVE_TO)t+=(i.relative?"c":"C")+i.x1+jt+i.y1+jt+i.x2+jt+i.y2+jt+i.x+jt+i.y;else if(i.type===U.SMOOTH_CURVE_TO)t+=(i.relative?"s":"S")+i.x2+jt+i.y2+jt+i.x+jt+i.y;else if(i.type===U.QUAD_TO)t+=(i.relative?"q":"Q")+i.x1+jt+i.y1+jt+i.x+jt+i.y;else if(i.type===U.SMOOTH_QUAD_TO)t+=(i.relative?"t":"T")+i.x+jt+i.y;else if(i.type===U.ARC)t+=(i.relative?"a":"A")+i.rX+jt+i.rY+jt+i.xRot+jt+ +i.lArcFlag+jt+ +i.sweepFlag+jt+i.x+jt+i.y;else throw new Error("Unexpected command type \"".concat(i==null?void 0:i.type,"\" at index ").concat(e,"."));}return t;}function _h(_ref161,e){var _ref162=_slicedToArray(_ref161,2),r=_ref162[0],t=_ref162[1];return[r*Math.cos(e)-t*Math.sin(e),r*Math.sin(e)+t*Math.cos(e)];}function Qe(){for(var _len14=arguments.length,r=new Array(_len14),_key14=0;_key14<_len14;_key14++){r[_key14]=arguments[_key14];}for(var t=0;t<r.length;t++)if(typeof r[t]!="number")throw new Error("assertNumbers arguments[".concat(t,"] is not a number. ").concat(_typeof(r[t])," == typeof ").concat(r[t]));return!0;}var qr=Math.PI;function vh(r,t,e){r.lArcFlag=r.lArcFlag===0?0:1,r.sweepFlag=r.sweepFlag===0?0:1;var i=r.rX,s=r.rY;var n=r.x,o=r.y;if(Math.abs(i)<1e-10||Math.abs(s)<1e-10){r.rX=0,r.rY=0,r.cX=(t+n)/2,r.cY=(e+o)/2,r.phi1=0,r.phi2=0;return;}i=Math.abs(r.rX),s=Math.abs(r.rY);var a=r.xRot/180*qr,_h19=_h([(t-n)/2,(e-o)/2],-a),_h20=_slicedToArray(_h19,2),l=_h20[0],h=_h20[1],u=Math.pow(l,2)/Math.pow(i,2)+Math.pow(h,2)/Math.pow(s,2);1<u&&(i*=Math.sqrt(u),s*=Math.sqrt(u)),r.rX=i,r.rY=s;var c=Math.pow(i,2)*Math.pow(h,2)+Math.pow(s,2)*Math.pow(l,2),d=(r.lArcFlag!==r.sweepFlag?1:-1)*Math.sqrt(Math.max(0,(Math.pow(i,2)*Math.pow(s,2)-c)/c)),p=i*h/s*d,f=-s*l/i*d,m=_h([p,f],a);r.cX=m[0]+(t+n)/2,r.cY=m[1]+(e+o)/2,r.phi1=Math.atan2((h-f)/s,(l-p)/i),r.phi2=Math.atan2((-h-f)/s,(-l-p)/i),r.sweepFlag===0&&r.phi2>r.phi1&&(r.phi2-=2*qr),r.sweepFlag===1&&r.phi2<r.phi1&&(r.phi2+=2*qr),r.phi1*=180/qr,r.phi2*=180/qr;}function $p(r,t,e){Qe(r,t,e);var i=r*r+t*t-e*e;if(0>i)return[];if(i===0)return[[r*e/(r*r+t*t),t*e/(r*r+t*t)]];var s=Math.sqrt(i);return[[(r*e+t*s)/(r*r+t*t),(t*e-r*s)/(r*r+t*t)],[(r*e-t*s)/(r*r+t*t),(t*e+r*s)/(r*r+t*t)]];}var Ai=Math.PI/180;function Hp(r,t,e){return(1-e)*r+e*t;}function Vp(r,t,e,i){return r+Math.cos(i/180*qr)*t+Math.sin(i/180*qr)*e;}function Xp(r,t,e,i){var n=t-r,o=e-t,a=i-e,l=3*n+3*a-6*o,h=(o-n)*6,u=3*n;return Math.abs(l)<1e-6?Math.abs(h)<1e-6?[]:[-u/h]:zA(h/l,u/l,1e-6);}function zp(r,t,e,i,s){var n=1-s,o=n*n*n,a=3*n*n*s,l=3*n*s*s,h=s*s*s;return r*o+t*a+e*l+i*h;}function zA(r,t){var e=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1e-6;var i=r*r/4-t;if(i<-e)return[];if(i<=e)return[-r/2];var s=Math.sqrt(i);return[-(r/2)-s,-(r/2)+s];}function WA(r,t,e){r.cX||vh(r,t,e);var i=r.xRot/180*qr;if(Math.abs(r.rX)<1e-10||Math.abs(r.rY)<1e-10)return[{relative:r.relative,type:U.CURVE_TO,x1:t+(r.x-t)/3,y1:e+(r.y-e)/3,x2:t+2*(r.x-t)/3,y2:e+2*(r.y-e)/3,x:r.x,y:r.y}];var s=Math.min(r.phi1,r.phi2),n=Math.max(r.phi1,r.phi2),o=n-s,a=Math.ceil(o/90),l=new Array(a);var h=t,u=e;var c=function c(d,p){var _h21=_h([d*r.rX,p*r.rY],i),_h22=_slicedToArray(_h21,2),f=_h22[0],m=_h22[1];return[r.cX+f,r.cY+m];};for(var d=0;d<a;d++){var p=Hp(r.phi1,r.phi2,d/a),f=Hp(r.phi1,r.phi2,(d+1)/a),m=f-p,y=4/3*Math.tan(m*Ai/4),_=Math.cos(p*Ai)-y*Math.sin(p*Ai),v=Math.sin(p*Ai)+y*Math.cos(p*Ai),g=Math.cos(f*Ai),x=Math.sin(f*Ai),b=g+y*x,S=x-y*g,w=c(_,v),T=c(b,S),N=c(g,x),F={relative:r.relative,type:U.CURVE_TO,x:N[0],y:N[1],x1:w[0],y1:w[1],x2:T[0],y2:T[1]};r.relative&&(F.x1-=h,F.y1-=u,F.x2-=h,F.y2-=u,F.x-=h,F.y-=u),h=N[0],u=N[1],l[d]=F;}return l;}function xh(r,t,e){var i=t[0]-r[0],s=t[1]-r[1],n=e[0]-r[0],o=e[1]-r[1],a=i*o-s*n;if(!(Math.abs(a)<1e-10))return!1;var h=i*n+s*o,u=i*i+s*s,c=n*n+o*o;return 0<=h&&h<=c&&u<=c;}function YA(r){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!0;if(r.length<2)return r;var e=qt.INFO(function(n,o,a){var _n$x2,_n$y2,_n$relative2;return _objectSpread(_objectSpread({},n),{},{x:(_n$x2=n.x)!==null&&_n$x2!==void 0?_n$x2:o,y:(_n$y2=n.y)!==null&&_n$y2!==void 0?_n$y2:a,relative:(_n$relative2=n.relative)!==null&&_n$relative2!==void 0?_n$relative2:!1});}),i=[];var s=[];var _iterator24=_createForOfIteratorHelper(r),_step24;try{for(_iterator24.s();!(_step24=_iterator24.n()).done;){var n=_step24.value;var o=e(n);o.type===U.MOVE_TO&&s.length>0&&(t?i.push.apply(i,_toConsumableArray(Do(s))):i.unshift.apply(i,_toConsumableArray(Do(s))),s=[]),s.push(o);}}catch(err){_iterator24.e(err);}finally{_iterator24.f();}return s.length>0&&(t?i.push.apply(i,_toConsumableArray(Do(s))):i.unshift.apply(i,_toConsumableArray(Do(s)))),i;}function Do(r){var s;var t=((s=r[r.length-1])==null?void 0:s.type)===U.CLOSE_PATH,e=t?r.length-2:r.length-1,i=[{type:U.MOVE_TO,relative:!1,x:r[e].x,y:r[e].y}];for(var n=e;n>0;n--){var o=r[n],_a36=r[n-1];if(o.relative)throw new Error("Relative command are not supported convert first with `toAbs()`");switch(o.type){case U.HORIZ_LINE_TO:i.push({type:U.HORIZ_LINE_TO,relative:!1,x:_a36.x});break;case U.VERT_LINE_TO:i.push({type:U.VERT_LINE_TO,relative:!1,y:_a36.y});break;case U.LINE_TO:case U.MOVE_TO:i.push({type:U.LINE_TO,relative:!1,x:_a36.x,y:_a36.y});break;case U.CURVE_TO:i.push({type:U.CURVE_TO,relative:!1,x:_a36.x,y:_a36.y,x1:o.x2,y1:o.y2,x2:o.x1,y2:o.y1});break;case U.SMOOTH_CURVE_TO:throw new Error("Unsupported command: S (smooth cubic bezier)");case U.SMOOTH_QUAD_TO:throw new Error("Unsupported command: T (smooth quadratic bezier)");case U.ARC:throw new Error("Unsupported command: A (arc)");case U.QUAD_TO:throw new Error("Unsupported command: Q (quadratic bezier)");}}return t&&i.push({type:U.CLOSE_PATH}),i;}function jA(){var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1e13;Qe(r);function t(e){return Math.round(e*r)/r;}return function(i){return"x1"in i&&_typeof(i.x1)<"u"&&(i.x1=t(i.x1)),"y1"in i&&_typeof(i.y1)<"u"&&(i.y1=t(i.y1)),"x2"in i&&_typeof(i.x2)<"u"&&(i.x2=t(i.x2)),"y2"in i&&_typeof(i.y2)<"u"&&(i.y2=t(i.y2)),"x"in i&&_typeof(i.x)<"u"&&(i.x=t(i.x)),"y"in i&&_typeof(i.y)<"u"&&(i.y=t(i.y)),"rX"in i&&_typeof(i.rX)<"u"&&(i.rX=t(i.rX)),"rY"in i&&_typeof(i.rY)<"u"&&(i.rY=t(i.rY)),i;};}function Wp(){return Je(function(r,t,e){return r.relative&&(_typeof(r.x1)<"u"&&(r.x1+=t),_typeof(r.y1)<"u"&&(r.y1+=e),_typeof(r.x2)<"u"&&(r.x2+=t),_typeof(r.y2)<"u"&&(r.y2+=e),_typeof(r.x)<"u"&&(r.x+=t),_typeof(r.y)<"u"&&(r.y+=e),r.relative=!1),r;});}function qA(){return Je(function(r,t,e){return r.relative||(_typeof(r.x1)<"u"&&(r.x1-=t),_typeof(r.y1)<"u"&&(r.y1-=e),_typeof(r.x2)<"u"&&(r.x2-=t),_typeof(r.y2)<"u"&&(r.y2-=e),_typeof(r.x)<"u"&&(r.x-=t),_typeof(r.y)<"u"&&(r.y-=e),r.relative=!0),r;});}function KA(){var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!0;var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!0;var e=arguments.length>2&&arguments[2]!==undefined?arguments[2]:!0;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:!0;return Je(function(s,n,o,a,l){if(isNaN(a)&&!(s.type&U.MOVE_TO))throw new Error("path must start with moveto");if(t&&s.type&U.HORIZ_LINE_TO&&(s.type=U.LINE_TO,s.y=s.relative?0:o),e&&s.type&U.VERT_LINE_TO&&(s.type=U.LINE_TO,s.x=s.relative?0:n),r&&s.type&U.CLOSE_PATH&&(s.type=U.LINE_TO,s.x=s.relative?a-n:a,s.y=s.relative?l-o:l),s.type&U.ARC&&(s.rX===0||s.rY===0)&&(s.type=U.LINE_TO,delete s.rX,delete s.rY,delete s.xRot,delete s.lArcFlag,delete s.sweepFlag),i&&s.type&U.QUAD_TO){var h=[n,o],u=s.relative?[n+s.x1,o+s.y1]:[s.x1,s.y1],c=s.relative?[n+s.x,o+s.y]:[s.x,s.y];xh(h,u,c)&&(s.type=U.LINE_TO,delete s.x1,delete s.y1);}if(i&&s.type&U.CURVE_TO){var _h23=[n,o],_u7=s.relative?[n+s.x1,o+s.y1]:[s.x1,s.y1],_c16=s.relative?[n+s.x2,o+s.y2]:[s.x2,s.y2],d=s.relative?[n+s.x,o+s.y]:[s.x,s.y];xh(_h23,_u7,d)&&xh(_h23,_c16,d)&&(s.type=U.LINE_TO,delete s.x1,delete s.y1,delete s.x2,delete s.y2);}return s;});}function Yp(){var r=NaN,t=NaN,e=NaN,i=NaN;return Je(function(s,n,o){return s.type&U.SMOOTH_CURVE_TO&&(s.type=U.CURVE_TO,r=isNaN(r)?n:r,t=isNaN(t)?o:t,s.x1=s.relative?n-r:2*n-r,s.y1=s.relative?o-t:2*o-t),s.type&U.CURVE_TO?(r=s.relative?n+s.x2:s.x2,t=s.relative?o+s.y2:s.y2):(r=NaN,t=NaN),s.type&U.SMOOTH_QUAD_TO&&(s.type=U.QUAD_TO,e=isNaN(e)?n:e,i=isNaN(i)?o:i,s.x1=s.relative?n-e:2*n-e,s.y1=s.relative?o-i:2*o-i),s.type&U.QUAD_TO?(e=s.relative?n+s.x1:s.x1,i=s.relative?o+s.y1:s.y1):(e=NaN,i=NaN),s;});}function jp(){var r=NaN,t=NaN;return Je(function(e,i,s){if(e.type&U.SMOOTH_QUAD_TO&&(e.type=U.QUAD_TO,r=isNaN(r)?i:r,t=isNaN(t)?s:t,e.x1=e.relative?i-r:2*i-r,e.y1=e.relative?s-t:2*s-t),e.type&U.QUAD_TO){r=e.relative?i+e.x1:e.x1,t=e.relative?s+e.y1:e.y1;var n=e.x1,o=e.y1;e.type=U.CURVE_TO,e.x1=((e.relative?0:i)+n*2)/3,e.y1=((e.relative?0:s)+o*2)/3,e.x2=(e.x+n*2)/3,e.y2=(e.y+o*2)/3;}else r=NaN,t=NaN;return e;});}function Je(r){var t=0,e=0,i=NaN,s=NaN;return function(o){if(isNaN(i)&&!(o.type&U.MOVE_TO))throw new Error("path must start with moveto");var a=r(o,t,e,i,s);return o.type&U.CLOSE_PATH&&(t=i,e=s),"x"in o&&_typeof(o.x)<"u"&&(t=o.relative?t+o.x:o.x),"y"in o&&_typeof(o.y)<"u"&&(e=o.relative?e+o.y:o.y),o.type&U.MOVE_TO&&(i=t,s=e),a;};}function ZA(){var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;Qe(r);var t=NaN,e=NaN,i=NaN,s=NaN;return Je(function(n,o,a,l,h){var u=Math.abs;var c=!1,d=0,p=0;if(n.type&U.SMOOTH_CURVE_TO&&(d=isNaN(t)?0:o-t,p=isNaN(e)?0:a-e),n.type&(U.CURVE_TO|U.SMOOTH_CURVE_TO)?(t=n.relative?o+n.x2:n.x2,e=n.relative?a+n.y2:n.y2):(t=NaN,e=NaN),n.type&U.SMOOTH_QUAD_TO?(i=isNaN(i)?o:2*o-i,s=isNaN(s)?a:2*a-s):n.type&U.QUAD_TO?(i=n.relative?o+n.x1:n.x1,s=n.relative?a+n.y1:n.y2):(i=NaN,s=NaN),n.type&U.LINE_COMMANDS||n.type&U.ARC&&(n.rX===0||n.rY===0||!n.lArcFlag)||n.type&U.CURVE_TO||n.type&U.SMOOTH_CURVE_TO||n.type&U.QUAD_TO||n.type&U.SMOOTH_QUAD_TO){var f=_typeof(n.x)>"u"?0:n.relative?n.x:n.x-o,m=_typeof(n.y)>"u"?0:n.relative?n.y:n.y-a;d=isNaN(i)?_typeof(n.x1)>"u"?d:n.relative?n.x:n.x1-o:i-o,p=isNaN(s)?_typeof(n.y1)>"u"?p:n.relative?n.y:n.y1-a:s-a;var y=_typeof(n.x2)>"u"?0:n.relative?n.x:n.x2-o,_=_typeof(n.y2)>"u"?0:n.relative?n.y:n.y2-a;u(f)<=r&&u(m)<=r&&u(d)<=r&&u(p)<=r&&u(y)<=r&&u(_)<=r&&(c=!0);}return n.type&U.CLOSE_PATH&&u(o-l)<=r&&u(a-h)<=r&&(c=!0),c?[]:n;});}function Kr(r,t,e,i,s,n){return Qe(r,t,e,i,s,n),Je(function(o,a,l,h){var u=o.x1,c=o.x2,d=o.relative&&!isNaN(h),p=_typeof(o.x)<"u"?o.x:d?0:a,f=_typeof(o.y)<"u"?o.y:d?0:l;o.type&U.HORIZ_LINE_TO&&t!==0&&(o.type=U.LINE_TO,o.y=o.relative?0:l),o.type&U.VERT_LINE_TO&&e!==0&&(o.type=U.LINE_TO,o.x=o.relative?0:a),_typeof(o.x)<"u"&&(o.x=o.x*r+f*e+(d?0:s)),_typeof(o.y)<"u"&&(o.y=p*t+o.y*i+(d?0:n)),_typeof(o.x1)<"u"&&(o.x1=o.x1*r+o.y1*e+(d?0:s)),_typeof(o.y1)<"u"&&(o.y1=u*t+o.y1*i+(d?0:n)),_typeof(o.x2)<"u"&&(o.x2=o.x2*r+o.y2*e+(d?0:s)),_typeof(o.y2)<"u"&&(o.y2=c*t+o.y2*i+(d?0:n));function m(_){return _*_;}var y=r*i-t*e;if(_typeof(o.xRot)<"u"&&(r!==1||t!==0||e!==0||i!==1))if(y===0)delete o.rX,delete o.rY,delete o.xRot,delete o.lArcFlag,delete o.sweepFlag,o.type=U.LINE_TO;else{var _=o.xRot*Math.PI/180,v=Math.sin(_),g=Math.cos(_),x=1/m(o.rX),b=1/m(o.rY),S=m(g)*x+m(v)*b,w=2*v*g*(x-b),T=m(v)*x+m(g)*b,N=S*i*i-w*t*i+T*t*t,F=w*(r*i+t*e)-2*(S*e*i+T*r*t),z=S*e*e-w*r*e+T*r*r,C=(Math.atan2(F,N-z)+Math.PI)%Math.PI/2,E=Math.sin(C),I=Math.cos(C);o.rX=Math.abs(y)/Math.sqrt(N*m(I)+F*E*I+z*m(E)),o.rY=Math.abs(y)/Math.sqrt(N*m(E)-F*E*I+z*m(I)),o.xRot=C*180/Math.PI;}return _typeof(o.sweepFlag)<"u"&&0>y&&(o.sweepFlag=+!o.sweepFlag),o;});}function QA(r){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var e=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;Qe(r,t,e);var i=Math.sin(r),s=Math.cos(r);return Kr(s,i,-i,s,t-t*s+e*i,e-t*i-e*s);}function JA(r){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return Qe(r,t),Kr(1,0,0,1,r,t);}function tS(r){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:r;return Qe(r,t),Kr(r,0,0,t,0,0);}function eS(r){return Qe(r),Kr(1,0,Math.tan(r),1,0,0);}function rS(r){return Qe(r),Kr(1,Math.tan(r),0,1,0,0);}function iS(){var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;return Qe(r),Kr(-1,0,0,1,r,0);}function sS(){var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;return Qe(r),Kr(1,0,0,-1,0,r);}function nS(){return Je(function(r,t,e){return U.ARC===r.type?WA(r,r.relative?0:t,r.relative?0:e):r;});}function oS(){return Je(function(r,t,e){return r.relative&&(t=0,e=0),U.ARC===r.type&&vh(r,t,e),r;});}function qp(){return function(r){return _objectSpread({},r);};}function aS(){var r=qp(),t=Wp(),e=jp(),i=Yp(),s=Je(function(n,o,a){var l=i(e(t(r(n))));function h(c){c>s.maxX&&(s.maxX=c),c<s.minX&&(s.minX=c);}function u(c){c>s.maxY&&(s.maxY=c),c<s.minY&&(s.minY=c);}if(l.type&U.DRAWING_COMMANDS&&(h(o),u(a)),l.type&U.HORIZ_LINE_TO&&h(l.x),l.type&U.VERT_LINE_TO&&u(l.y),l.type&U.LINE_TO&&(h(l.x),u(l.y)),l.type&U.CURVE_TO){h(l.x),u(l.y);var c=Xp(o,l.x1,l.x2,l.x);var _iterator25=_createForOfIteratorHelper(c),_step25;try{for(_iterator25.s();!(_step25=_iterator25.n()).done;){var p=_step25.value;0<p&&1>p&&h(zp(o,l.x1,l.x2,l.x,p));}}catch(err){_iterator25.e(err);}finally{_iterator25.f();}var d=Xp(a,l.y1,l.y2,l.y);var _iterator26=_createForOfIteratorHelper(d),_step26;try{for(_iterator26.s();!(_step26=_iterator26.n()).done;){var _p12=_step26.value;0<_p12&&1>_p12&&u(zp(a,l.y1,l.y2,l.y,_p12));}}catch(err){_iterator26.e(err);}finally{_iterator26.f();}}if(l.type&U.ARC){h(l.x),u(l.y),vh(l,o,a);var _c17=l.xRot/180*Math.PI,_d12=Math.cos(_c17)*l.rX,_p13=Math.sin(_c17)*l.rX,f=-Math.sin(_c17)*l.rY,m=Math.cos(_c17)*l.rY,_ref163=l.phi1<l.phi2?[l.phi1,l.phi2]:-180>l.phi2?[l.phi2+360,l.phi1+360]:[l.phi2,l.phi1],_ref164=_slicedToArray(_ref163,2),y=_ref164[0],_=_ref164[1],v=function v(_ref165){var _ref166=_slicedToArray(_ref165,2),b=_ref166[0],S=_ref166[1];var T=Math.atan2(S,b)*180/Math.PI;return T<y?T+360:T;},g=$p(f,-_d12,0).map(v);var _iterator27=_createForOfIteratorHelper(g),_step27;try{for(_iterator27.s();!(_step27=_iterator27.n()).done;){var b=_step27.value;b>y&&b<_&&h(Vp(l.cX,_d12,f,b));}}catch(err){_iterator27.e(err);}finally{_iterator27.f();}var x=$p(m,-_p13,0).map(v);var _iterator28=_createForOfIteratorHelper(x),_step28;try{for(_iterator28.s();!(_step28=_iterator28.n()).done;){var _b5=_step28.value;_b5>y&&_b5<_&&u(Vp(l.cY,_p13,m,_b5));}}catch(err){_iterator28.e(err);}finally{_iterator28.f();}}return n;});return s.minX=1/0,s.maxX=-1/0,s.minY=1/0,s.maxY=-1/0,s;}var qt={ROUND:jA,TO_ABS:Wp,TO_REL:qA,NORMALIZE_HVZ:KA,NORMALIZE_ST:Yp,QT_TO_C:jp,INFO:Je,SANITIZE:ZA,MATRIX:Kr,ROTATE:QA,TRANSLATE:JA,SCALE:tS,SKEW_X:eS,SKEW_Y:rS,X_AXIS_SYMMETRY:iS,Y_AXIS_SYMMETRY:sS,A_TO_C:nS,ANNOTATE_ARCS:oS,CLONE:qp,CALCULATE_BOUNDS:aS,REVERSE_PATH:YA};var Kp=/*#__PURE__*/function(){function Kp(){_classCallCheck(this,Kp);}_createClass(Kp,[{key:"round",value:function round(t){return this.transform(qt.ROUND(t));}},{key:"toAbs",value:function toAbs(){return this.transform(qt.TO_ABS());}},{key:"toRel",value:function toRel(){return this.transform(qt.TO_REL());}},{key:"normalizeHVZ",value:function normalizeHVZ(t,e,i){return this.transform(qt.NORMALIZE_HVZ(t,e,i));}},{key:"normalizeST",value:function normalizeST(){return this.transform(qt.NORMALIZE_ST());}},{key:"qtToC",value:function qtToC(){return this.transform(qt.QT_TO_C());}},{key:"aToC",value:function aToC(){return this.transform(qt.A_TO_C());}},{key:"sanitize",value:function sanitize(t){return this.transform(qt.SANITIZE(t));}},{key:"translate",value:function translate(t,e){return this.transform(qt.TRANSLATE(t,e));}},{key:"scale",value:function scale(t,e){return this.transform(qt.SCALE(t,e));}},{key:"rotate",value:function rotate(t,e,i){return this.transform(qt.ROTATE(t,e,i));}},{key:"matrix",value:function matrix(t,e,i,s,n,o){return this.transform(qt.MATRIX(t,e,i,s,n,o));}},{key:"skewX",value:function skewX(t){return this.transform(qt.SKEW_X(t));}},{key:"skewY",value:function skewY(t){return this.transform(qt.SKEW_Y(t));}},{key:"xSymmetry",value:function xSymmetry(t){return this.transform(qt.X_AXIS_SYMMETRY(t));}},{key:"ySymmetry",value:function ySymmetry(t){return this.transform(qt.Y_AXIS_SYMMETRY(t));}},{key:"annotateArcs",value:function annotateArcs(){return this.transform(qt.ANNOTATE_ARCS());}}]);return Kp;}();var lS=function lS(r){return r===" "||r==="	"||r==="\r"||r==="\n";},Zp=function Zp(r){return 48<=r.charCodeAt(0)&&r.charCodeAt(0)<=57;};var hS=/*#__PURE__*/function(_Kp){_inherits(hS,_Kp);var _super72=_createSuper(hS);function hS(){var _this126;_classCallCheck(this,hS);_this126=_super72.call(this);Pt(_assertThisInitialized(_this126),"curNumber","");Pt(_assertThisInitialized(_this126),"curCommandType",-1);Pt(_assertThisInitialized(_this126),"curCommandRelative",!1);Pt(_assertThisInitialized(_this126),"canParseCommandOrComma",!0);Pt(_assertThisInitialized(_this126),"curNumberHasExp",!1);Pt(_assertThisInitialized(_this126),"curNumberHasExpDigits",!1);Pt(_assertThisInitialized(_this126),"curNumberHasDecimal",!1);Pt(_assertThisInitialized(_this126),"curArgs",[]);return _this126;}_createClass(hS,[{key:"finish",value:function finish(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];if(this.parse(" ",e),this.curArgs.length!==0||!this.canParseCommandOrComma)throw new SyntaxError("Unterminated command at the path end.");return e;}},{key:"parse",value:function parse(e){var _this127=this;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var s=function s(n){i.push(n),_this127.curArgs.length=0,_this127.canParseCommandOrComma=!0;};for(var n=0;n<e.length;n++){var o=e[n],_a37=this.curCommandType===U.ARC&&(this.curArgs.length===3||this.curArgs.length===4)&&this.curNumber.length===1&&(this.curNumber==="0"||this.curNumber==="1"),_l39=Zp(o)&&(this.curNumber==="0"&&o==="0"||_a37);if(Zp(o)&&!_l39){this.curNumber+=o,this.curNumberHasExpDigits=this.curNumberHasExp;continue;}if(o==="e"||o==="E"){this.curNumber+=o,this.curNumberHasExp=!0;continue;}if((o==="-"||o==="+")&&this.curNumberHasExp&&!this.curNumberHasExpDigits){this.curNumber+=o;continue;}if(o==="."&&!this.curNumberHasExp&&!this.curNumberHasDecimal&&!_a37){this.curNumber+=o,this.curNumberHasDecimal=!0;continue;}if(this.curNumber&&this.curCommandType!==-1){var h=Number(this.curNumber);if(isNaN(h))throw new SyntaxError("Invalid number ending at ".concat(n));if(this.curCommandType===U.ARC){if(this.curArgs.length===0||this.curArgs.length===1){if(0>h)throw new SyntaxError("Expected positive number, got \"".concat(h,"\" at index \"").concat(n,"\""));}else if((this.curArgs.length===3||this.curArgs.length===4)&&this.curNumber!=="0"&&this.curNumber!=="1")throw new SyntaxError("Expected a flag, got \"".concat(this.curNumber,"\" at index \"").concat(n,"\""));}this.curArgs.push(h),this.curArgs.length===uS[this.curCommandType]&&(U.HORIZ_LINE_TO===this.curCommandType?s({type:U.HORIZ_LINE_TO,relative:this.curCommandRelative,x:h}):U.VERT_LINE_TO===this.curCommandType?s({type:U.VERT_LINE_TO,relative:this.curCommandRelative,y:h}):this.curCommandType===U.MOVE_TO||this.curCommandType===U.LINE_TO||this.curCommandType===U.SMOOTH_QUAD_TO?(s({type:this.curCommandType,relative:this.curCommandRelative,x:this.curArgs[0],y:this.curArgs[1]}),U.MOVE_TO===this.curCommandType&&(this.curCommandType=U.LINE_TO)):this.curCommandType===U.CURVE_TO?s({type:U.CURVE_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x2:this.curArgs[2],y2:this.curArgs[3],x:this.curArgs[4],y:this.curArgs[5]}):this.curCommandType===U.SMOOTH_CURVE_TO?s({type:U.SMOOTH_CURVE_TO,relative:this.curCommandRelative,x2:this.curArgs[0],y2:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===U.QUAD_TO?s({type:U.QUAD_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===U.ARC&&s({type:U.ARC,relative:this.curCommandRelative,rX:this.curArgs[0],rY:this.curArgs[1],xRot:this.curArgs[2],lArcFlag:this.curArgs[3],sweepFlag:this.curArgs[4],x:this.curArgs[5],y:this.curArgs[6]})),this.curNumber="",this.curNumberHasExpDigits=!1,this.curNumberHasExp=!1,this.curNumberHasDecimal=!1,this.canParseCommandOrComma=!0;}if(!lS(o)){if(o===","&&this.canParseCommandOrComma){this.canParseCommandOrComma=!1;continue;}if(o==="+"||o==="-"||o==="."){this.curNumber=o,this.curNumberHasDecimal=o===".";continue;}if(_l39){this.curNumber=o,this.curNumberHasDecimal=!1;continue;}if(this.curArgs.length!==0)throw new SyntaxError("Unterminated command at index ".concat(n,"."));if(!this.canParseCommandOrComma)throw new SyntaxError("Unexpected character \"".concat(o,"\" at index ").concat(n,". Command cannot follow comma"));if(this.canParseCommandOrComma=!1,o==="z"||o==="Z"){i.push({type:U.CLOSE_PATH}),this.canParseCommandOrComma=!0,this.curCommandType=-1;continue;}else if(o==="h"||o==="H")this.curCommandType=U.HORIZ_LINE_TO,this.curCommandRelative=o==="h";else if(o==="v"||o==="V")this.curCommandType=U.VERT_LINE_TO,this.curCommandRelative=o==="v";else if(o==="m"||o==="M")this.curCommandType=U.MOVE_TO,this.curCommandRelative=o==="m";else if(o==="l"||o==="L")this.curCommandType=U.LINE_TO,this.curCommandRelative=o==="l";else if(o==="c"||o==="C")this.curCommandType=U.CURVE_TO,this.curCommandRelative=o==="c";else if(o==="s"||o==="S")this.curCommandType=U.SMOOTH_CURVE_TO,this.curCommandRelative=o==="s";else if(o==="q"||o==="Q")this.curCommandType=U.QUAD_TO,this.curCommandRelative=o==="q";else if(o==="t"||o==="T")this.curCommandType=U.SMOOTH_QUAD_TO,this.curCommandRelative=o==="t";else if(o==="a"||o==="A")this.curCommandType=U.ARC,this.curCommandRelative=o==="a";else throw new SyntaxError("Unexpected character \"".concat(o,"\" at index ").concat(n,"."));}}return i;}},{key:"transform",value:function transform(e){return Object.create(this,{parse:{value:function value(s){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var o=Object.getPrototypeOf(this).parse.call(this,s);var _iterator29=_createForOfIteratorHelper(o),_step29;try{for(_iterator29.s();!(_step29=_iterator29.n()).done;){var _a38=_step29.value;var _l40=e(_a38);Array.isArray(_l40)?n.push.apply(n,_toConsumableArray(_l40)):n.push(_l40);}}catch(err){_iterator29.e(err);}finally{_iterator29.f();}return n;}}});}}]);return hS;}(Kp);var At=/*#__PURE__*/function(_Kp2){_inherits(At,_Kp2);var _super73=_createSuper(At);function At(e){var _this128;_classCallCheck(this,At);_this128=_super73.call(this);Pt(_assertThisInitialized(_this128),"commands");typeof e=="string"?_this128.commands=At.parse(e):_this128.commands=e;return _this128;}_createClass(At,[{key:"encode",value:function encode(){return At.encode(this.commands);}},{key:"getBounds",value:function getBounds(){var e=qt.CALCULATE_BOUNDS();return this.transform(e),e;}},{key:"transform",value:function transform(e){var i=[];var _iterator30=_createForOfIteratorHelper(this.commands),_step30;try{for(_iterator30.s();!(_step30=_iterator30.n()).done;){var s=_step30.value;var n=e(s);Array.isArray(n)?i.push.apply(i,_toConsumableArray(n)):i.push(n);}}catch(err){_iterator30.e(err);}finally{_iterator30.f();}return this.commands=i,this;}},{key:"reverse",value:function reverse(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!0;return this.commands=qt.REVERSE_PATH(this.commands,e),this;}}],[{key:"encode",value:function encode(e){return XA(e);}},{key:"parse",value:function parse(e){var i=new hS(),s=[];return i.parse(e,s),i.finish(s),s;}}]);return At;}(Kp);Pt(At,"CLOSE_PATH",1),Pt(At,"MOVE_TO",2),Pt(At,"HORIZ_LINE_TO",4),Pt(At,"VERT_LINE_TO",8),Pt(At,"LINE_TO",16),Pt(At,"CURVE_TO",32),Pt(At,"SMOOTH_CURVE_TO",64),Pt(At,"QUAD_TO",128),Pt(At,"SMOOTH_QUAD_TO",256),Pt(At,"ARC",512),Pt(At,"LINE_COMMANDS",At.LINE_TO|At.HORIZ_LINE_TO|At.VERT_LINE_TO),Pt(At,"DRAWING_COMMANDS",At.HORIZ_LINE_TO|At.VERT_LINE_TO|At.LINE_TO|At.CURVE_TO|At.SMOOTH_CURVE_TO|At.QUAD_TO|At.SMOOTH_QUAD_TO|At.ARC);var U=At;var uS=(_uS={},_defineProperty(_uS,U.MOVE_TO,2),_defineProperty(_uS,U.LINE_TO,2),_defineProperty(_uS,U.HORIZ_LINE_TO,1),_defineProperty(_uS,U.VERT_LINE_TO,1),_defineProperty(_uS,U.CLOSE_PATH,0),_defineProperty(_uS,U.QUAD_TO,4),_defineProperty(_uS,U.SMOOTH_QUAD_TO,2),_defineProperty(_uS,U.CURVE_TO,6),_defineProperty(_uS,U.SMOOTH_CURVE_TO,4),_defineProperty(_uS,U.ARC,7),_uS);function Qp(r,t,e){var i=r.slice();return i[10]=t[e],i[12]=e,i;}function Jp(r){var t,e;return t=new ls({props:{x:r[10][0],y:r[10][1],scale:r[3]}}),t.$on("pointerdown",function(){Kt(r[9]("HANDLE-".concat(r[12])))&&r[9]("HANDLE-".concat(r[12])).apply(this,arguments);}),{c:function c(){Ht(t.$$.fragment);},m:function m(i,s){Ft(t,i,s),e=!0;},p:function p(i,s){r=i;var n={};s&16&&(n.x=r[10][0]),s&16&&(n.y=r[10][1]),s&8&&(n.scale=r[3]),t.$set(n);},i:function i(_i34){e||(q(t.$$.fragment,_i34),e=!0);},o:function o(i){et(t.$$.fragment,i),e=!1;},d:function d(i){Ut(t,i);}};}function cS(r){var t,e,i,s,n,o,a,l,h,u,c,d=Se(r[4].points),_p14=[];for(var m=0;m<d.length;m+=1)_p14[m]=Jp(Qp(r,d,m));var f=function f(m){return et(_p14[m],1,1,function(){_p14[m]=null;});};return{c:function c(){t=xt("polygon"),s=Ve(),n=xt("polygon"),a=Ve();for(var _m16=0;_m16<_p14.length;_m16+=1)_p14[_m16].c();l=Re(),R(t,"class","a9s-outer"),R(t,"style",e=r[1]?"display:none;":void 0),R(t,"points",i=r[4].points.map(tm).join(" ")),R(n,"class","a9s-inner a9s-shape-handle"),R(n,"style",r[1]),R(n,"points",o=r[4].points.map(em).join(" "));},m:function m(_m17,y){ct(_m17,t,y),ct(_m17,s,y),ct(_m17,n,y),ct(_m17,a,y);for(var _=0;_<_p14.length;_+=1)_p14[_]&&_p14[_].m(_m17,y);ct(_m17,l,y),h=!0,u||(c=[Zt(t,"pointerdown",function(){Kt(r[9]("SHAPE"))&&r[9]("SHAPE").apply(this,arguments);}),Zt(n,"pointerdown",function(){Kt(r[9]("SHAPE"))&&r[9]("SHAPE").apply(this,arguments);})],u=!0);},p:function p(m,y){if(r=m,(!h||y&2&&e!==(e=r[1]?"display:none;":void 0))&&R(t,"style",e),(!h||y&16&&i!==(i=r[4].points.map(tm).join(" ")))&&R(t,"points",i),(!h||y&2)&&R(n,"style",r[1]),(!h||y&16&&o!==(o=r[4].points.map(em).join(" ")))&&R(n,"points",o),y&536){d=Se(r[4].points);var _;for(_=0;_<d.length;_+=1){var v=Qp(r,d,_);_p14[_]?(_p14[_].p(v,y),q(_p14[_],1)):(_p14[_]=Jp(v),_p14[_].c(),q(_p14[_],1),_p14[_].m(l.parentNode,l));}for(ge(),_=d.length;_<_p14.length;_+=1)f(_);ye();}},i:function i(m){if(!h){for(var y=0;y<d.length;y+=1)q(_p14[y]);h=!0;}},o:function o(m){_p14=_p14.filter(Boolean);for(var y=0;y<_p14.length;y+=1)et(_p14[y]);h=!1;},d:function d(m){m&&(ht(t),ht(s),ht(n),ht(a),ht(l)),ii(_p14,m),u=!1,er(c);}};}function dS(r){var t,e;return t=new bh({props:{shape:r[0],transform:r[2],editor:r[5],$$slots:{"default":[cS,function(_ref167){var i=_ref167.grab;return{9:i};},function(_ref168){var i=_ref168.grab;return i?512:0;}]},$$scope:{ctx:r}}}),t.$on("change",r[6]),t.$on("grab",r[7]),t.$on("release",r[8]),{c:function c(){Ht(t.$$.fragment);},m:function m(i,s){Ft(t,i,s),e=!0;},p:function p(i,_ref169){var _ref170=_slicedToArray(_ref169,1),s=_ref170[0];var n={};s&1&&(n.shape=i[0]),s&4&&(n.transform=i[2]),s&8730&&(n.$$scope={dirty:s,ctx:i}),t.$set(n);},i:function i(_i35){e||(q(t.$$.fragment,_i35),e=!0);},o:function o(i){et(t.$$.fragment,i),e=!1;},d:function d(i){Ut(t,i);}};}var tm=function tm(r){return r.join(",");},em=function em(r){return r.join(",");};function fS(r,t,e){var i,s=t.shape,n=t.computedStyle,o=t.transform,_t$viewportScale5=t.viewportScale,a=_t$viewportScale5===void 0?1:_t$viewportScale5;var l=function l(d,p,f){var m;var y=d.geometry;p==="SHAPE"?m=y.points.map(function(_ref171){var _ref172=_slicedToArray(_ref171,2),v=_ref172[0],g=_ref172[1];return[v+f[0],g+f[1]];}):m=y.points.map(function(_ref173,x){var _ref174=_slicedToArray(_ref173,2),v=_ref174[0],g=_ref174[1];return p==="HANDLE-".concat(x)?[v+f[0],g+f[1]]:[v,g];});var _=Oo(m);return _objectSpread(_objectSpread({},d),{},{geometry:{points:m,bounds:_}});};function h(d){De.call(this,r,d);}function u(d){De.call(this,r,d);}function c(d){De.call(this,r,d);}return r.$$set=function(d){"shape"in d&&e(0,s=d.shape),"computedStyle"in d&&e(1,n=d.computedStyle),"transform"in d&&e(2,o=d.transform),"viewportScale"in d&&e(3,a=d.viewportScale);},r.$$.update=function(){r.$$.dirty&1&&e(4,i=s.geometry);},[s,n,o,a,i,l,h,u,c];}var pS=/*#__PURE__*/function(_re2){_inherits(pS,_re2);var _super74=_createSuper(pS);function pS(t){var _this129;_classCallCheck(this,pS);_this129=_super74.call(this),ee(_assertThisInitialized(_this129),t,fS,dS,Wt,{shape:0,computedStyle:1,transform:2,viewportScale:3});return _this129;}return _createClass(pS);}(re);var mS=(typeof window==="undefined"?"undefined":_typeof(window))>"u"||(typeof navigator==="undefined"?"undefined":_typeof(navigator))>"u"?!1:"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;function gS(r){var t,e,i,s,n,o;return{c:function c(){t=xt("rect"),R(t,"class",e=pn("a9s-handle ".concat(r[8]["class"]||"").trim())+" svelte-1sgkh33"),R(t,"x",i=r[0]-r[5]/2),R(t,"y",s=r[1]-r[5]/2),R(t,"width",r[5]),R(t,"height",r[5]);},m:function m(a,l){ct(a,t,l),n||(o=Zt(t,"pointerdown",r[11]),n=!0);},p:function p(a,l){l&256&&e!==(e=pn("a9s-handle ".concat(a[8]["class"]||"").trim())+" svelte-1sgkh33")&&R(t,"class",e),l&33&&i!==(i=a[0]-a[5]/2)&&R(t,"x",i),l&34&&s!==(s=a[1]-a[5]/2)&&R(t,"y",s),l&32&&R(t,"width",a[5]),l&32&&R(t,"height",a[5]);},d:function d(a){a&&ht(t),n=!1,o();}};}function yS(r){var t,e,i,s,n,o,a,l,h;return{c:function c(){t=xt("g"),e=xt("circle"),s=xt("rect"),R(e,"cx",r[0]),R(e,"cy",r[1]),R(e,"r",i=r[3]/r[2]),R(e,"class","a9s-touch-halo svelte-1sgkh33"),mn(e,"touched",r[4]),R(s,"class",n=pn("a9s-handle ".concat(r[8]["class"]||"").trim())+" svelte-1sgkh33"),R(s,"x",o=r[0]-r[5]/2),R(s,"y",a=r[1]-r[5]/2),R(s,"width",r[5]),R(s,"height",r[5]),R(t,"class","a9s-touch-handle");},m:function m(u,c){ct(u,t,c),Ae(t,e),Ae(t,s),l||(h=[Zt(e,"pointerdown",r[10]),Zt(e,"pointerdown",r[6]),Zt(e,"pointerup",r[7]),Zt(s,"pointerdown",r[9]),Zt(s,"pointerdown",r[6]),Zt(s,"pointerup",r[7])],l=!0);},p:function p(u,c){c&1&&R(e,"cx",u[0]),c&2&&R(e,"cy",u[1]),c&12&&i!==(i=u[3]/u[2])&&R(e,"r",i),c&16&&mn(e,"touched",u[4]),c&256&&n!==(n=pn("a9s-handle ".concat(u[8]["class"]||"").trim())+" svelte-1sgkh33")&&R(s,"class",n),c&33&&o!==(o=u[0]-u[5]/2)&&R(s,"x",o),c&34&&a!==(a=u[1]-u[5]/2)&&R(s,"y",a),c&32&&R(s,"width",u[5]),c&32&&R(s,"height",u[5]);},d:function d(u){u&&ht(t),l=!1,er(h);}};}function _S(r){var t;function e(n,o){return mS?yS:gS;}var s=e()(r);return{c:function c(){s.c(),t=Re();},m:function m(n,o){s.m(n,o),ct(n,t,o);},p:function p(n,_ref175){var _ref176=_slicedToArray(_ref175,1),o=_ref176[0];s.p(n,o);},i:me,o:me,d:function d(n){n&&ht(t),s.d(n);}};}function vS(r,t,e){var i,_t26=t,s=_t26.x,_t27=t,n=_t27.y,_t28=t,o=_t28.scale,_t29=t,_t29$radius=_t29.radius,a=_t29$radius===void 0?30:_t29$radius,l=!1;var h=function h(f){f.pointerType==="touch"&&e(4,l=!0);},u=function u(){return e(4,l=!1);};function c(f){De.call(this,r,f);}function d(f){De.call(this,r,f);}function p(f){De.call(this,r,f);}return r.$$set=function(f){e(8,t=pa(pa({},t),rc(f))),"x"in f&&e(0,s=f.x),"y"in f&&e(1,n=f.y),"scale"in f&&e(2,o=f.scale),"radius"in f&&e(3,a=f.radius);},r.$$.update=function(){r.$$.dirty&4&&e(5,i=10/o);},t=rc(t),[s,n,o,a,l,i,h,u,t,c,d,p];}var ls=/*#__PURE__*/function(_re3){_inherits(ls,_re3);var _super75=_createSuper(ls);function ls(t){var _this130;_classCallCheck(this,ls);_this130=_super75.call(this),ee(_assertThisInitialized(_this130),t,vS,_S,Wt,{x:0,y:1,scale:2,radius:3});return _this130;}return _createClass(ls);}(re);function xS(r){var t,e,i,s,n,o,a,l,h,u,_c18,d,p,f,m,y,_,v,g,x,b,S,w,T,N,F,z,C,E,I,P,$,k,G,st,M,L,V,rt,Q,X,_t,St;return G=new ls({props:{"class":"a9s-corner-handle-topleft",x:r[4].x,y:r[4].y,scale:r[3]}}),G.$on("pointerdown",function(){Kt(r[9]("TOP_LEFT"))&&r[9]("TOP_LEFT").apply(this,arguments);}),M=new ls({props:{"class":"a9s-corner-handle-topright",x:r[4].x+r[4].w,y:r[4].y,scale:r[3]}}),M.$on("pointerdown",function(){Kt(r[9]("TOP_RIGHT"))&&r[9]("TOP_RIGHT").apply(this,arguments);}),V=new ls({props:{"class":"a9s-corner-handle-bottomright",x:r[4].x+r[4].w,y:r[4].y+r[4].h,scale:r[3]}}),V.$on("pointerdown",function(){Kt(r[9]("BOTTOM_RIGHT"))&&r[9]("BOTTOM_RIGHT").apply(this,arguments);}),Q=new ls({props:{"class":"a9s-corner-handle-bottomleft",x:r[4].x,y:r[4].y+r[4].h,scale:r[3]}}),Q.$on("pointerdown",function(){Kt(r[9]("BOTTOM_LEFT"))&&r[9]("BOTTOM_LEFT").apply(this,arguments);}),{c:function c(){t=xt("rect"),a=Ve(),l=xt("rect"),p=Ve(),f=xt("rect"),v=Ve(),g=xt("rect"),w=Ve(),T=xt("rect"),C=Ve(),E=xt("rect"),k=Ve(),Ht(G.$$.fragment),st=Ve(),Ht(M.$$.fragment),L=Ve(),Ht(V.$$.fragment),rt=Ve(),Ht(Q.$$.fragment),R(t,"class","a9s-outer"),R(t,"style",e=r[1]?"display:none;":void 0),R(t,"x",i=r[4].x),R(t,"y",s=r[4].y),R(t,"width",n=r[4].w),R(t,"height",o=r[4].h),R(l,"class","a9s-inner a9s-shape-handle"),R(l,"style",r[1]),R(l,"x",h=r[4].x),R(l,"y",u=r[4].y),R(l,"width",_c18=r[4].w),R(l,"height",d=r[4].h),R(f,"class","a9s-edge-handle a9s-edge-handle-top"),R(f,"x",m=r[4].x),R(f,"y",y=r[4].y),R(f,"height",1),R(f,"width",_=r[4].w),R(g,"class","a9s-edge-handle a9s-edge-handle-right"),R(g,"x",x=r[4].x+r[4].w),R(g,"y",b=r[4].y),R(g,"height",S=r[4].h),R(g,"width",1),R(T,"class","a9s-edge-handle a9s-edge-handle-bottom"),R(T,"x",N=r[4].x),R(T,"y",F=r[4].y+r[4].h),R(T,"height",1),R(T,"width",z=r[4].w),R(E,"class","a9s-edge-handle a9s-edge-handle-left"),R(E,"x",I=r[4].x),R(E,"y",P=r[4].y),R(E,"height",$=r[4].h),R(E,"width",1);},m:function m(O,D){ct(O,t,D),ct(O,a,D),ct(O,l,D),ct(O,p,D),ct(O,f,D),ct(O,v,D),ct(O,g,D),ct(O,w,D),ct(O,T,D),ct(O,C,D),ct(O,E,D),ct(O,k,D),Ft(G,O,D),ct(O,st,D),Ft(M,O,D),ct(O,L,D),Ft(V,O,D),ct(O,rt,D),Ft(Q,O,D),X=!0,_t||(St=[Zt(t,"pointerdown",function(){Kt(r[9]("SHAPE"))&&r[9]("SHAPE").apply(this,arguments);}),Zt(l,"pointerdown",function(){Kt(r[9]("SHAPE"))&&r[9]("SHAPE").apply(this,arguments);}),Zt(f,"pointerdown",function(){Kt(r[9]("TOP"))&&r[9]("TOP").apply(this,arguments);}),Zt(g,"pointerdown",function(){Kt(r[9]("RIGHT"))&&r[9]("RIGHT").apply(this,arguments);}),Zt(T,"pointerdown",function(){Kt(r[9]("BOTTOM"))&&r[9]("BOTTOM").apply(this,arguments);}),Zt(E,"pointerdown",function(){Kt(r[9]("LEFT"))&&r[9]("LEFT").apply(this,arguments);})],_t=!0);},p:function p(O,D){r=O,(!X||D&2&&e!==(e=r[1]?"display:none;":void 0))&&R(t,"style",e),(!X||D&16&&i!==(i=r[4].x))&&R(t,"x",i),(!X||D&16&&s!==(s=r[4].y))&&R(t,"y",s),(!X||D&16&&n!==(n=r[4].w))&&R(t,"width",n),(!X||D&16&&o!==(o=r[4].h))&&R(t,"height",o),(!X||D&2)&&R(l,"style",r[1]),(!X||D&16&&h!==(h=r[4].x))&&R(l,"x",h),(!X||D&16&&u!==(u=r[4].y))&&R(l,"y",u),(!X||D&16&&_c18!==(_c18=r[4].w))&&R(l,"width",_c18),(!X||D&16&&d!==(d=r[4].h))&&R(l,"height",d),(!X||D&16&&m!==(m=r[4].x))&&R(f,"x",m),(!X||D&16&&y!==(y=r[4].y))&&R(f,"y",y),(!X||D&16&&_!==(_=r[4].w))&&R(f,"width",_),(!X||D&16&&x!==(x=r[4].x+r[4].w))&&R(g,"x",x),(!X||D&16&&b!==(b=r[4].y))&&R(g,"y",b),(!X||D&16&&S!==(S=r[4].h))&&R(g,"height",S),(!X||D&16&&N!==(N=r[4].x))&&R(T,"x",N),(!X||D&16&&F!==(F=r[4].y+r[4].h))&&R(T,"y",F),(!X||D&16&&z!==(z=r[4].w))&&R(T,"width",z),(!X||D&16&&I!==(I=r[4].x))&&R(E,"x",I),(!X||D&16&&P!==(P=r[4].y))&&R(E,"y",P),(!X||D&16&&$!==($=r[4].h))&&R(E,"height",$);var ut={};D&16&&(ut.x=r[4].x),D&16&&(ut.y=r[4].y),D&8&&(ut.scale=r[3]),G.$set(ut);var lt={};D&16&&(lt.x=r[4].x+r[4].w),D&16&&(lt.y=r[4].y),D&8&&(lt.scale=r[3]),M.$set(lt);var Et={};D&16&&(Et.x=r[4].x+r[4].w),D&16&&(Et.y=r[4].y+r[4].h),D&8&&(Et.scale=r[3]),V.$set(Et);var Tt={};D&16&&(Tt.x=r[4].x),D&16&&(Tt.y=r[4].y+r[4].h),D&8&&(Tt.scale=r[3]),Q.$set(Tt);},i:function i(O){X||(q(G.$$.fragment,O),q(M.$$.fragment,O),q(V.$$.fragment,O),q(Q.$$.fragment,O),X=!0);},o:function o(O){et(G.$$.fragment,O),et(M.$$.fragment,O),et(V.$$.fragment,O),et(Q.$$.fragment,O),X=!1;},d:function d(O){O&&(ht(t),ht(a),ht(l),ht(p),ht(f),ht(v),ht(g),ht(w),ht(T),ht(C),ht(E),ht(k),ht(st),ht(L),ht(rt)),Ut(G,O),Ut(M,O),Ut(V,O),Ut(Q,O),_t=!1,er(St);}};}function bS(r){var t,e;return t=new bh({props:{shape:r[0],transform:r[2],editor:r[5],$$slots:{"default":[xS,function(_ref177){var i=_ref177.grab;return{9:i};},function(_ref178){var i=_ref178.grab;return i?512:0;}]},$$scope:{ctx:r}}}),t.$on("grab",r[6]),t.$on("change",r[7]),t.$on("release",r[8]),{c:function c(){Ht(t.$$.fragment);},m:function m(i,s){Ft(t,i,s),e=!0;},p:function p(i,_ref179){var _ref180=_slicedToArray(_ref179,1),s=_ref180[0];var n={};s&1&&(n.shape=i[0]),s&4&&(n.transform=i[2]),s&1562&&(n.$$scope={dirty:s,ctx:i}),t.$set(n);},i:function i(_i36){e||(q(t.$$.fragment,_i36),e=!0);},o:function o(i){et(t.$$.fragment,i),e=!1;},d:function d(i){Ut(t,i);}};}function ES(r,t,e){var i,s=t.shape,n=t.computedStyle,o=t.transform,_t$viewportScale6=t.viewportScale,a=_t$viewportScale6===void 0?1:_t$viewportScale6;var l=function l(d,p,f){var m=d.geometry.bounds;var _ref181=[m.minX,m.minY],y=_ref181[0],_=_ref181[1],_ref182=[m.maxX,m.maxY],v=_ref182[0],g=_ref182[1];var _f12=_slicedToArray(f,2),x=_f12[0],b=_f12[1];if(p==="SHAPE")y+=x,v+=x,_+=b,g+=b;else{switch(p){case"TOP":case"TOP_LEFT":case"TOP_RIGHT":{_+=b;break;}case"BOTTOM":case"BOTTOM_LEFT":case"BOTTOM_RIGHT":{g+=b;break;}}switch(p){case"LEFT":case"TOP_LEFT":case"BOTTOM_LEFT":{y+=x;break;}case"RIGHT":case"TOP_RIGHT":case"BOTTOM_RIGHT":{v+=x;break;}}}var S=Math.min(y,v),w=Math.min(_,g),T=Math.abs(v-y),N=Math.abs(g-_);return _objectSpread(_objectSpread({},d),{},{geometry:{x:S,y:w,w:T,h:N,bounds:{minX:S,minY:w,maxX:S+T,maxY:w+N}}});};function h(d){De.call(this,r,d);}function u(d){De.call(this,r,d);}function c(d){De.call(this,r,d);}return r.$$set=function(d){"shape"in d&&e(0,s=d.shape),"computedStyle"in d&&e(1,n=d.computedStyle),"transform"in d&&e(2,o=d.transform),"viewportScale"in d&&e(3,a=d.viewportScale);},r.$$.update=function(){r.$$.dirty&1&&e(4,i=s.geometry);},[s,n,o,a,i,l,h,u,c];}var TS=/*#__PURE__*/function(_re4){_inherits(TS,_re4);var _super76=_createSuper(TS);function TS(t){var _this131;_classCallCheck(this,TS);_this131=_super76.call(this),ee(_assertThisInitialized(_this131),t,ES,bS,Wt,{shape:0,computedStyle:1,transform:2,viewportScale:3});return _this131;}return _createClass(TS);}(re);function rm(r,t,e){var i=r.slice();return i[10]=t[e],i[12]=e,i;}function im(r,t,e){var i=r.slice();return i[13]=t[e],i[15]=e,i;}function sm(r,t,e){var i=r.slice();return i[16]=t[e],i[18]=e,i;}function nm(r){var t,e;return t=new ls({props:{x:r[16][0],y:r[16][1],scale:r[3]}}),t.$on("pointerdown",function(){Kt(r[9]("HANDLE-".concat(r[12],"-").concat(r[15],"-").concat(r[18])))&&r[9]("HANDLE-".concat(r[12],"-").concat(r[15],"-").concat(r[18])).apply(this,arguments);}),{c:function c(){Ht(t.$$.fragment);},m:function m(i,s){Ft(t,i,s),e=!0;},p:function p(i,s){r=i;var n={};s&16&&(n.x=r[16][0]),s&16&&(n.y=r[16][1]),s&8&&(n.scale=r[3]),t.$set(n);},i:function i(_i37){e||(q(t.$$.fragment,_i37),e=!0);},o:function o(i){et(t.$$.fragment,i),e=!1;},d:function d(i){Ut(t,i);}};}function om(r){var t,e,_i38=Se(r[13].points),s=[];for(var o=0;o<_i38.length;o+=1)s[o]=nm(sm(r,_i38,o));var n=function n(o){return et(s[o],1,1,function(){s[o]=null;});};return{c:function c(){for(var _o20=0;_o20<s.length;_o20+=1)s[_o20].c();t=Re();},m:function m(o,a){for(var _l41=0;_l41<s.length;_l41+=1)s[_l41]&&s[_l41].m(o,a);ct(o,t,a),e=!0;},p:function p(o,a){if(a&536){_i38=Se(o[13].points);var _l42;for(_l42=0;_l42<_i38.length;_l42+=1){var h=sm(o,_i38,_l42);s[_l42]?(s[_l42].p(h,a),q(s[_l42],1)):(s[_l42]=nm(h),s[_l42].c(),q(s[_l42],1),s[_l42].m(t.parentNode,t));}for(ge(),_l42=_i38.length;_l42<s.length;_l42+=1)n(_l42);ye();}},i:function i(o){if(!e){for(var _a39=0;_a39<_i38.length;_a39+=1)q(s[_a39]);e=!0;}},o:function o(_o21){s=s.filter(Boolean);for(var _a40=0;_a40<s.length;_a40+=1)et(s[_a40]);e=!1;},d:function d(o){o&&ht(t),ii(s,o);}};}function am(r){var t,e,i,s,n,o,a,l,h,u=Se(r[10].rings),_c19=[];for(var p=0;p<u.length;p+=1)_c19[p]=om(im(r,u,p));var d=function d(p){return et(_c19[p],1,1,function(){_c19[p]=null;});};return{c:function c(){t=xt("g"),e=xt("path"),n=xt("path");for(var _p15=0;_p15<_c19.length;_p15+=1)_c19[_p15].c();R(e,"class","a9s-outer"),R(e,"style",i=r[1]?"display:none;":void 0),R(e,"fill-rule","evenodd"),R(e,"d",s=No(r[10])),R(n,"class","a9s-inner"),R(n,"style",r[1]),R(n,"fill-rule","evenodd"),R(n,"d",o=No(r[10]));},m:function m(p,f){ct(p,t,f),Ae(t,e),Ae(t,n);for(var m=0;m<_c19.length;m+=1)_c19[m]&&_c19[m].m(t,null);a=!0,l||(h=[Zt(e,"pointerdown",function(){Kt(r[9]("SHAPE"))&&r[9]("SHAPE").apply(this,arguments);}),Zt(n,"pointerdown",function(){Kt(r[9]("SHAPE"))&&r[9]("SHAPE").apply(this,arguments);})],l=!0);},p:function p(_p16,f){if(r=_p16,(!a||f&2&&i!==(i=r[1]?"display:none;":void 0))&&R(e,"style",i),(!a||f&16&&s!==(s=No(r[10])))&&R(e,"d",s),(!a||f&2)&&R(n,"style",r[1]),(!a||f&16&&o!==(o=No(r[10])))&&R(n,"d",o),f&536){u=Se(r[10].rings);var m;for(m=0;m<u.length;m+=1){var y=im(r,u,m);_c19[m]?(_c19[m].p(y,f),q(_c19[m],1)):(_c19[m]=om(y),_c19[m].c(),q(_c19[m],1),_c19[m].m(t,null));}for(ge(),m=u.length;m<_c19.length;m+=1)d(m);ye();}},i:function i(p){if(!a){for(var f=0;f<u.length;f+=1)q(_c19[f]);a=!0;}},o:function o(p){_c19=_c19.filter(Boolean);for(var f=0;f<_c19.length;f+=1)et(_c19[f]);a=!1;},d:function d(p){p&&ht(t),ii(_c19,p),l=!1,er(h);}};}function wS(r){var t,e,_i39=Se(r[4].polygons),s=[];for(var o=0;o<_i39.length;o+=1)s[o]=am(rm(r,_i39,o));var n=function n(o){return et(s[o],1,1,function(){s[o]=null;});};return{c:function c(){for(var _o22=0;_o22<s.length;_o22+=1)s[_o22].c();t=Re();},m:function m(o,a){for(var _l43=0;_l43<s.length;_l43+=1)s[_l43]&&s[_l43].m(o,a);ct(o,t,a),e=!0;},p:function p(o,a){if(a&538){_i39=Se(o[4].polygons);var _l44;for(_l44=0;_l44<_i39.length;_l44+=1){var h=rm(o,_i39,_l44);s[_l44]?(s[_l44].p(h,a),q(s[_l44],1)):(s[_l44]=am(h),s[_l44].c(),q(s[_l44],1),s[_l44].m(t.parentNode,t));}for(ge(),_l44=_i39.length;_l44<s.length;_l44+=1)n(_l44);ye();}},i:function i(o){if(!e){for(var _a41=0;_a41<_i39.length;_a41+=1)q(s[_a41]);e=!0;}},o:function o(_o23){s=s.filter(Boolean);for(var _a42=0;_a42<s.length;_a42+=1)et(s[_a42]);e=!1;},d:function d(o){o&&ht(t),ii(s,o);}};}function AS(r){var t,e;return t=new bh({props:{shape:r[0],transform:r[2],editor:r[5],$$slots:{"default":[wS,function(_ref183){var i=_ref183.grab;return{9:i};},function(_ref184){var i=_ref184.grab;return i?512:0;}]},$$scope:{ctx:r}}}),t.$on("change",r[6]),t.$on("grab",r[7]),t.$on("release",r[8]),{c:function c(){Ht(t.$$.fragment);},m:function m(i,s){Ft(t,i,s),e=!0;},p:function p(i,_ref185){var _ref186=_slicedToArray(_ref185,1),s=_ref186[0];var n={};s&1&&(n.shape=i[0]),s&4&&(n.transform=i[2]),s&524826&&(n.$$scope={dirty:s,ctx:i}),t.$set(n);},i:function i(_i40){e||(q(t.$$.fragment,_i40),e=!0);},o:function o(i){et(t.$$.fragment,i),e=!1;},d:function d(i){Ut(t,i);}};}function SS(r,t,e){var i,s=t.shape,n=t.computedStyle,o=t.transform,_t$viewportScale7=t.viewportScale,a=_t$viewportScale7===void 0?1:_t$viewportScale7;var l=function l(d,p,f){var m=d.geometry.polygons;var y;if(p==="SHAPE")y=m.map(function(_){var v=_.rings.map(function(x,b){return{points:x.points.map(function(w,T){return[w[0]+f[0],w[1]+f[1]];})};}),g=Oo(v[0].points);return{rings:v,bounds:g};});else{var _p$split$map3=p.split("-").map(function(b){return parseInt(b);}),_p$split$map4=_slicedToArray(_p$split$map3,4),_=_p$split$map4[0],v=_p$split$map4[1],g=_p$split$map4[2],x=_p$split$map4[3];y=m.map(function(b,S){if(S===v){var w=b.rings.map(function(N,F){return F===g?{points:N.points.map(function(C,E){return E===x?[C[0]+f[0],C[1]+f[1]]:C;})}:N;}),T=Oo(w[0].points);return{rings:w,bounds:T};}else return b;});}return _objectSpread(_objectSpread({},d),{},{geometry:{polygons:y,bounds:$A(y)}});};function h(d){De.call(this,r,d);}function u(d){De.call(this,r,d);}function c(d){De.call(this,r,d);}return r.$$set=function(d){"shape"in d&&e(0,s=d.shape),"computedStyle"in d&&e(1,n=d.computedStyle),"transform"in d&&e(2,o=d.transform),"viewportScale"in d&&e(3,a=d.viewportScale);},r.$$.update=function(){r.$$.dirty&1&&e(4,i=s.geometry);},[s,n,o,a,i,l,h,u,c];}var CS=/*#__PURE__*/function(_re5){_inherits(CS,_re5);var _super77=_createSuper(CS);function CS(t){var _this132;_classCallCheck(this,CS);_this132=_super77.call(this),ee(_assertThisInitialized(_this132),t,SS,AS,Wt,{shape:0,computedStyle:1,transform:2,viewportScale:3});return _this132;}return _createClass(CS);}(re);jr.RECTANGLE,jr.POLYGON,jr.MULTIPOLYGLON;var IS=function IS(r){return{};},lm=function lm(r){return{grab:r[0]};};function RS(r){var t,e,i,s;var n=r[7]["default"],_o24=Zu(n,r,r[6],lm);return{c:function c(){t=xt("g"),_o24&&_o24.c(),R(t,"class","a9s-annotation selected");},m:function m(a,l){ct(a,t,l),_o24&&_o24.m(t,null),e=!0,i||(s=[Zt(t,"pointerup",r[2]),Zt(t,"pointermove",r[1])],i=!0);},p:function p(a,_ref187){var _ref188=_slicedToArray(_ref187,1),l=_ref188[0];_o24&&_o24.p&&(!e||l&64)&&tc(_o24,n,a,a[6],e?Ju(n,a[6],l,IS):ec(a[6]),lm);},i:function i(a){e||(q(_o24,a),e=!0);},o:function o(a){et(_o24,a),e=!1;},d:function d(a){a&&ht(t),_o24&&_o24.d(a),i=!1,er(s);}};}function MS(r,t,e){var _t$$$slots2=t.$$slots,i=_t$$$slots2===void 0?{}:_t$$$slots2,s=t.$$scope;var n=yn();var o=t.shape,a=t.editor,l=t.transform,h,u,c;var d=function d(m){return function(y){h=m,u=l.elementToImage(y.offsetX,y.offsetY),c=o,y.target.setPointerCapture(y.pointerId),n("grab",y);};},p=function p(m){if(h){var _l$elementToImage3=l.elementToImage(m.offsetX,m.offsetY),_l$elementToImage4=_slicedToArray(_l$elementToImage3,2),y=_l$elementToImage4[0],_=_l$elementToImage4[1],v=[y-u[0],_-u[1]];e(3,o=a(c,h,v)),n("change",o);}},f=function f(m){m.target.releasePointerCapture(m.pointerId),h=void 0,c=o,n("release",m);};return r.$$set=function(m){"shape"in m&&e(3,o=m.shape),"editor"in m&&e(4,a=m.editor),"transform"in m&&e(5,l=m.transform),"$$scope"in m&&e(6,s=m.$$scope);},[d,p,f,o,a,l,s,i];}var bh=/*#__PURE__*/function(_re6){_inherits(bh,_re6);var _super78=_createSuper(bh);function bh(t){var _this133;_classCallCheck(this,bh);_this133=_super78.call(this),ee(_assertThisInitialized(_this133),t,MS,RS,Wt,{shape:3,editor:4,transform:5});return _this133;}return _createClass(bh);}(re);var PS=function PS(r,t){var e=typeof t=="function"?t(r):t;if(e){var i=e.fill,s=e.fillOpacity,n=e.stroke,o=e.strokeWidth,_a43=e.strokeOpacity;var _l45="";return i&&(_l45+="fill:".concat(i,";"),_l45+="fill-opacity:".concat(s||"0.25",";")),n&&(_l45+="stroke:".concat(n,";"),_l45+="stroke-width:".concat(o||"1",";"),_l45+="stroke-opacity:".concat(_a43||"1",";")),_l45;}};function OS(r,t,e){var i;var s=yn();var n=t.annotation,o=t.editor,a=t.style,l=t.target,h=t.transform,u=t.viewportScale,c;return gn(function(){return e(6,c=new o({target:l,props:{shape:n.target.selector,computedStyle:i,transform:h,viewportScale:u}})),c.$on("change",function(d){c.$$set({shape:d.detail}),s("change",d.detail);}),c.$on("grab",function(d){return s("grab",d.detail);}),c.$on("release",function(d){return s("release",d.detail);}),function(){c.$destroy();};}),r.$$set=function(d){"annotation"in d&&e(0,n=d.annotation),"editor"in d&&e(1,o=d.editor),"style"in d&&e(2,a=d.style),"target"in d&&e(3,l=d.target),"transform"in d&&e(4,h=d.transform),"viewportScale"in d&&e(5,u=d.viewportScale);},r.$$.update=function(){r.$$.dirty&5&&e(7,i=PS(n,a)),r.$$.dirty&65&&n&&(c==null||c.$set({shape:n.target.selector})),r.$$.dirty&80&&c&&c.$set({transform:h}),r.$$.dirty&96&&c&&c.$set({viewportScale:u}),r.$$.dirty&192&&c&&i&&c.$set({computedStyle:i});},[n,o,a,l,h,u,c,i];}var NS=/*#__PURE__*/function(_re7){_inherits(NS,_re7);var _super79=_createSuper(NS);function NS(t){var _this134;_classCallCheck(this,NS);_this134=_super79.call(this),ee(_assertThisInitialized(_this134),t,OS,null,Wt,{annotation:0,editor:1,style:2,target:3,transform:4,viewportScale:5});return _this134;}return _createClass(NS);}(re);(typeof navigator==="undefined"?"undefined":_typeof(navigator))>"u"?!1:navigator.userAgent.indexOf("Mac OS X")!==-1;var hm=function hm(r,t,e,i){if(!i)return r;if(t.shiftKey||t.ctrlKey||t.metaKey){var n=(e.selected||[]).map(function(o){return o.id;});return n.includes(r)?n.filter(function(o){return o!==r;}):[].concat(_toConsumableArray(n),[r]);}else return r;},DS=function DS(r){return{transform:r&2,scale:r&1};},um=function um(r){return{transform:r[1],scale:r[0]};};function LS(r){var t;var e=r[4]["default"],_i41=Zu(e,r,r[3],um);return{c:function c(){_i41&&_i41.c();},m:function m(s,n){_i41&&_i41.m(s,n),t=!0;},p:function p(s,_ref189){var _ref190=_slicedToArray(_ref189,1),n=_ref190[0];_i41&&_i41.p&&(!t||n&11)&&tc(_i41,e,s,s[3],t?Ju(e,s[3],n,DS):ec(s[3]),um);},i:function i(s){t||(q(_i41,s),t=!0);},o:function o(s){et(_i41,s),t=!1;},d:function d(s){_i41&&_i41.d(s);}};}function BS(r,t,e){var _t$$$slots3=t.$$slots,i=_t$$$slots3===void 0?{}:_t$$$slots3,s=t.$$scope,n=t.viewer,o=1,a;var l=function l(){var h=n.viewport.getContainerSize().x,u=n.viewport.getZoom(!0),c=n.viewport.getFlip(),d=n.viewport.pixelFromPoint(new de.Point(0,0),!0);c&&(d.x=h-d.x);var p=u*h/n.world.getContentFactor(),f=c?-p:p,m=n.viewport.getRotation(!0);e(1,a="translate(".concat(d.x,", ").concat(d.y,") scale(").concat(f,", ").concat(p,") rotate(").concat(m,")")),e(0,o=u*h/n.world.getContentFactor());};return gn(function(){return n.addHandler("update-viewport",l),function(){n.removeHandler("update-viewport",l);};}),r.$$set=function(h){"viewer"in h&&e(2,n=h.viewer),"$$scope"in h&&e(3,s=h.$$scope);},[o,a,n,s,i];}var Eh=/*#__PURE__*/function(_re8){_inherits(Eh,_re8);var _super80=_createSuper(Eh);function Eh(t){var _this135;_classCallCheck(this,Eh);_this135=_super80.call(this),ee(_assertThisInitialized(_this135),t,BS,LS,Wt,{viewer:2});return _this135;}return _createClass(Eh);}(re);function FS(r,t,e){var i=yn();var s=t.drawingMode,n=t.target,o=t.tool,a=t.transform,l=t.viewer,h=t.viewportScale,u;return gn(function(){var c=n.closest("svg"),d=[],p=function p(f,m,y){if(c==null||c.addEventListener(f,m,y),d.push(function(){return c==null?void 0:c.removeEventListener(f,m,y);}),f==="pointerup"||f==="dblclick"){var _=function _(g){var x=g.originalEvent;m(x);},v=f==="pointerup"?"canvas-click":"canvas-double-click";l.addHandler(v,_),d.push(function(){return l.removeHandler(v,_);});}else if(f==="pointermove"){var _5=function _5(v){var g=v.originalEvent;m(g);};l.addHandler("canvas-drag",_5),d.push(function(){return l.removeHandler("canvas-drag",_5);});}};return e(6,u=new o({target:n,props:{addEventListener:p,drawingMode:s,transform:a,viewportScale:h}})),u.$on("create",function(f){return i("create",f.detail);}),function(){d.forEach(function(f){return f();}),u.$destroy();};}),r.$$set=function(c){"drawingMode"in c&&e(0,s=c.drawingMode),"target"in c&&e(1,n=c.target),"tool"in c&&e(2,o=c.tool),"transform"in c&&e(3,a=c.transform),"viewer"in c&&e(4,l=c.viewer),"viewportScale"in c&&e(5,h=c.viewportScale);},r.$$.update=function(){r.$$.dirty&72&&u&&u.$set({transform:a}),r.$$.dirty&96&&u&&u.$set({viewportScale:h});},[s,n,o,a,l,h,u];}var US=/*#__PURE__*/function(_re9){_inherits(US,_re9);var _super81=_createSuper(US);function US(t){var _this136;_classCallCheck(this,US);_this136=_super81.call(this),ee(_assertThisInitialized(_this136),t,FS,null,Wt,{drawingMode:0,target:1,tool:2,transform:3,viewer:4,viewportScale:5});return _this136;}return _createClass(US);}(re);function cm(r,t,e){var i=r.slice();i[36]=t[e];var s=i[15](i[36].target.selector);return i[37]=s,i;}function kS(r){var t="".concat(r[2],"-").concat(r[5]),e,_i42,s=dm(r);return{c:function c(){s.c(),e=Re();},m:function m(n,o){s.m(n,o),ct(n,e,o),_i42=!0;},p:function p(n,o){o[0]&36&&Wt(t,t="".concat(n[2],"-").concat(n[5]))?(ge(),et(s,1,1,me),ye(),s=dm(n),s.c(),q(s,1),s.m(e.parentNode,e)):s.p(n,o);},i:function i(n){_i42||(q(s),_i42=!0);},o:function o(n){et(s),_i42=!1;},d:function d(n){n&&ht(e),s.d(n);}};}function GS(r){var t,e,_i43=Se(r[7].filter(r[26])),s=[];for(var o=0;o<_i43.length;o+=1)s[o]=mm(cm(r,_i43,o));var n=function n(o){return et(s[o],1,1,function(){s[o]=null;});};return{c:function c(){for(var _o25=0;_o25<s.length;_o25+=1)s[_o25].c();t=Re();},m:function m(o,a){for(var _l46=0;_l46<s.length;_l46+=1)s[_l46]&&s[_l46].m(o,a);ct(o,t,a),e=!0;},p:function p(o,a){if(a[0]&48322|a[1]&16){_i43=Se(o[7].filter(o[26]));var _l47;for(_l47=0;_l47<_i43.length;_l47+=1){var h=cm(o,_i43,_l47);s[_l47]?(s[_l47].p(h,a),q(s[_l47],1)):(s[_l47]=mm(h),s[_l47].c(),q(s[_l47],1),s[_l47].m(t.parentNode,t));}for(ge(),_l47=_i43.length;_l47<s.length;_l47+=1)n(_l47);ye();}},i:function i(o){if(!e){for(var _a44=0;_a44<_i43.length;_a44+=1)q(s[_a44]);e=!0;}},o:function o(_o26){s=s.filter(Boolean);for(var _a45=0;_a45<s.length;_a45+=1)et(s[_a45]);e=!1;},d:function d(o){o&&ht(t),ii(s,o);}};}function dm(r){var t,e;return t=new US({props:{target:r[6],tool:r[8],drawingMode:r[4],transform:{elementToImage:r[10]},viewer:r[3],viewportScale:r[35]}}),t.$on("create",r[14]),{c:function c(){Ht(t.$$.fragment);},m:function m(i,s){Ft(t,i,s),e=!0;},p:function p(i,s){var n={};s[0]&64&&(n.target=i[6]),s[0]&256&&(n.tool=i[8]),s[0]&16&&(n.drawingMode=i[4]),s[0]&8&&(n.viewer=i[3]),s[1]&16&&(n.viewportScale=i[35]),t.$set(n);},i:function i(_i44){e||(q(t.$$.fragment,_i44),e=!0);},o:function o(i){et(t.$$.fragment,i),e=!1;},d:function d(i){Ut(t,i);}};}function fm(r){var t=r[36].id,e,_i45,s=pm(r);return{c:function c(){s.c(),e=Re();},m:function m(n,o){s.m(n,o),ct(n,e,o),_i45=!0;},p:function p(n,o){o[0]&128&&Wt(t,t=n[36].id)?(ge(),et(s,1,1,me),ye(),s=pm(n),s.c(),q(s,1),s.m(e.parentNode,e)):s.p(n,o);},i:function i(n){_i45||(q(s),_i45=!0);},o:function o(n){et(s),_i45=!1;},d:function d(n){n&&ht(e),s.d(n);}};}function pm(r){var t,e;return t=new NS({props:{target:r[6],editor:r[15](r[36].target.selector),annotation:r[36],style:r[1],transform:{elementToImage:r[10]},viewportScale:r[35]}}),t.$on("grab",r[11]),t.$on("change",function(){Kt(r[13](r[36]))&&r[13](r[36]).apply(this,arguments);}),t.$on("release",r[12]),{c:function c(){Ht(t.$$.fragment);},m:function m(i,s){Ft(t,i,s),e=!0;},p:function p(i,s){r=i;var n={};s[0]&64&&(n.target=r[6]),s[0]&128&&(n.editor=r[15](r[36].target.selector)),s[0]&128&&(n.annotation=r[36]),s[0]&2&&(n.style=r[1]),s[1]&16&&(n.viewportScale=r[35]),t.$set(n);},i:function i(_i46){e||(q(t.$$.fragment,_i46),e=!0);},o:function o(i){et(t.$$.fragment,i),e=!1;},d:function d(i){Ut(t,i);}};}function mm(r){var t,e,_i47=r[37]&&fm(r);return{c:function c(){_i47&&_i47.c(),t=Re();},m:function m(s,n){_i47&&_i47.m(s,n),ct(s,t,n),e=!0;},p:function p(s,n){s[37]?_i47?(_i47.p(s,n),n[0]&128&&q(_i47,1)):(_i47=fm(s),_i47.c(),q(_i47,1),_i47.m(t.parentNode,t)):_i47&&(ge(),et(_i47,1,1,function(){_i47=null;}),ye());},i:function i(s){e||(q(_i47),e=!0);},o:function o(s){et(_i47),e=!1;},d:function d(s){s&&ht(t),_i47&&_i47.d(s);}};}function $S(r){var t,e,i,s,n,_o27;var a=[GS,kS],l=[];function h(u,c){var d;return u[6]&&((d=u[7])==null?void 0:d.length)===1?0:u[6]&&u[8]&&u[0]?1:-1;}return~(i=h(r))&&(s=l[i]=a[i](r)),{c:function c(){t=xt("svg"),e=xt("g"),s&&s.c(),R(e,"transform",n=r[34]),R(e,"class","svelte-190cqdf"),R(t,"class","a9s-annotationlayer a9s-osd-drawinglayer svelte-190cqdf"),mn(t,"drawing",r[0]);},m:function m(u,c){ct(u,t,c),Ae(t,e),~i&&l[i].m(e,null),r[27](e),_o27=!0;},p:function p(u,c){var d=i;i=h(u),i===d?~i&&l[i].p(u,c):(s&&(ge(),et(l[d],1,1,function(){l[d]=null;}),ye()),~i?(s=l[i],s?s.p(u,c):(s=l[i]=a[i](u),s.c()),q(s,1),s.m(e,null)):s=null),(!_o27||c[1]&8&&n!==(n=u[34]))&&R(e,"transform",n),(!_o27||c[0]&1)&&mn(t,"drawing",u[0]);},i:function i(u){_o27||(q(s),_o27=!0);},o:function o(u){et(s),_o27=!1;},d:function d(u){u&&ht(t),~i&&l[i].d(),r[27](null);}};}function HS(r){var t,e;return t=new Eh({props:{viewer:r[3],$$slots:{"default":[$S,function(_ref191){var i=_ref191.transform,s=_ref191.scale;return{34:i,35:s};},function(_ref192){var i=_ref192.transform,s=_ref192.scale;return[0,(i?8:0)|(s?16:0)];}]},$$scope:{ctx:r}}}),{c:function c(){Ht(t.$$.fragment);},m:function m(i,s){Ft(t,i,s),e=!0;},p:function p(i,s){var n={};s[0]&8&&(n.viewer=i[3]),s[0]&511|s[1]&536&&(n.$$scope={dirty:s,ctx:i}),t.$set(n);},i:function i(_i48){e||(q(t.$$.fragment,_i48),e=!0);},o:function o(i){et(t.$$.fragment,i),e=!1;},d:function d(i){Ut(t,i);}};}function VS(r,t,e){var i,s,n,o,a=t.drawingEnabled,l=t.filter,h=t.multiSelect,u=t.preferredDrawingMode,c=t.state,_t$style2=t.style,d=_t$style2===void 0?void 0:_t$style2,_t$toolName2=t.toolName,p=_t$toolName2===void 0?hn()[0]:_t$toolName2,f=t.user,m=t.viewer,y=0;var _=function _(){return e(5,y+=1);},v=function v(){return p;},g=function g(){return a;};navigator.userAgent.match(/firefox|fxios/i);var x;var _c20=c,b=_c20.store,S=_c20.selection,w=_c20.hover;fn(r,S,function(M){return e(25,o=M);});var T,N,F;var z=function z(M){b.unobserve(T);var L=M.filter(function(_ref193){var V=_ref193.editable;return V;}).map(function(_ref194){var V=_ref194.id;return V;});L.length>0?(e(7,N=L.map(function(V){return b.getAnnotation(V);})),T=function T(V){var rt=V.changes.updated;e(7,N=(rt||[]).map(function(Q){return Q.newValue;}));},b.observe(T,{annotations:L}),m.forceRedraw()):e(7,N=void 0);},C=function C(M,L){var _m$viewport$viewerEle=m.viewport.viewerElementToImageCoordinates(new de.Point(M,L)),V=_m$viewport$viewerEle.x,rt=_m$viewport$viewerEle.y;return[V,rt];},E=function E(M){m.setMouseNavEnabled(!1),F=M.timeStamp;},I=function I(M){if(m.setMouseNavEnabled(!0),performance.now()-(F||0)<300){var _M$detail=M.detail,V=_M$detail.offsetX,rt=_M$detail.offsetY,_C11=C(V,rt),_C12=_slicedToArray(_C11,2),Q=_C12[0],X=_C12[1],_t=b.getAt(Q,X);if(_t&&(!l||l(_t))&&!N.find(function(O){return O.id===_t.id;})){w.set(_t.id);var O=hm(_t.id,M.detail,S,h);S.userSelect(O);}}},P=function P(M){return function(L){var X;var V=M.target,rt=10*60*1e3,Q=((X=V.creator)==null?void 0:X.id)!==f.id||!V.created||new Date().getTime()-V.created.getTime()>rt;b.updateTarget(_objectSpread(_objectSpread({},V),{},{selector:L.detail,created:Q?V.created:new Date(),updated:Q?new Date():void 0,updatedBy:Q?f:void 0}));};},$=function $(M){var L=FA(),V={id:L,bodies:[],target:{annotation:L,selector:M.detail,creator:f,created:new Date()}};b.addAnnotation(V),S.setSelected(V.id),m.setMouseNavEnabled(!0);},k=function k(M){return bu(M);},G=function G(M){return Ge(M);};function st(M){_n[M?"unshift":"push"](function(){x=M,e(6,x);});}return r.$$set=function(M){"drawingEnabled"in M&&e(0,a=M.drawingEnabled),"filter"in M&&e(16,l=M.filter),"multiSelect"in M&&e(17,h=M.multiSelect),"preferredDrawingMode"in M&&e(18,u=M.preferredDrawingMode),"state"in M&&e(19,c=M.state),"style"in M&&e(1,d=M.style),"toolName"in M&&e(2,p=M.toolName),"user"in M&&e(20,f=M.user),"viewer"in M&&e(3,m=M.viewer);},r.$$.update=function(){var _ref195;r.$$.dirty[0]&4&&e(8,(_ref195=un(p)||{tool:void 0,opts:void 0},i=_ref195.tool,s=_ref195.opts,_ref195),i,(e(24,s),e(2,p))),r.$$.dirty[0]&17039360&&e(4,n=(s==null?void 0:s.drawingMode)||u),r.$$.dirty[0]&25&&(a&&n==="drag"?m.setMouseNavEnabled(!1):m.setMouseNavEnabled(!0)),r.$$.dirty[0]&1&&a&&S.clear(),r.$$.dirty[0]&33554457&&o.selected.length===0&&n==="drag"&&a&&m.setMouseNavEnabled(!1),r.$$.dirty[0]&33554432&&z(o.selected);},[a,d,p,m,n,y,x,N,i,S,C,E,I,P,$,k,l,h,u,c,f,_,v,g,s,o,G,st];}var XS=/*#__PURE__*/function(_re10){_inherits(XS,_re10);var _super82=_createSuper(XS);function XS(t){var _this137;_classCallCheck(this,XS);_this137=_super82.call(this),ee(_assertThisInitialized(_this137),t,VS,HS,Wt,{drawingEnabled:0,filter:16,multiSelect:17,preferredDrawingMode:18,state:19,style:1,toolName:2,user:20,viewer:3,cancelDrawing:21,getDrawingTool:22,isDrawingEnabled:23},null,[-1,-1]);return _this137;}_createClass(XS,[{key:"cancelDrawing",get:function get(){return this.$$.ctx[21];}},{key:"getDrawingTool",get:function get(){return this.$$.ctx[22];}},{key:"isDrawingEnabled",get:function get(){return this.$$.ctx[23];}}]);return XS;}(re);function zS(r){var t,e,i,s,n,o,a,l=r[2].appearance.label+"",h,u,_c21,d;return{c:function c(){t=xt("g"),e=xt("rect"),a=xt("text"),h=ma(l),R(e,"class","a9s-presence-label-bg svelte-1rehw2p"),R(e,"x",r[0]),R(e,"y",i=r[1]-18/r[3]),R(e,"height",s=18/r[3]),R(e,"fill",n=r[2].appearance.color),R(e,"stroke",o=r[2].appearance.color),R(a,"font-size",u=12/r[3]),R(a,"x",_c21=r[0]+Math.round(5/r[3])),R(a,"y",d=r[1]-5/r[3]),R(a,"class","svelte-1rehw2p"),R(t,"class","a9s-presence-label");},m:function m(p,f){ct(p,t,f),Ae(t,e),Ae(t,a),Ae(a,h),r[6](t);},p:function p(_p17,_ref196){var _ref197=_slicedToArray(_ref196,1),f=_ref197[0];f&1&&R(e,"x",_p17[0]),f&10&&i!==(i=_p17[1]-18/_p17[3])&&R(e,"y",i),f&8&&s!==(s=18/_p17[3])&&R(e,"height",s),f&4&&n!==(n=_p17[2].appearance.color)&&R(e,"fill",n),f&4&&o!==(o=_p17[2].appearance.color)&&R(e,"stroke",o),f&4&&l!==(l=_p17[2].appearance.label+"")&&c0(h,l),f&8&&u!==(u=12/_p17[3])&&R(a,"font-size",u),f&9&&_c21!==(_c21=_p17[0]+Math.round(5/_p17[3]))&&R(a,"x",_c21),f&10&&d!==(d=_p17[1]-5/_p17[3])&&R(a,"y",d);},i:me,o:me,d:function d(p){p&&ht(t),r[6](null);}};}function WS(r,t,e){var i=t.x,s=t.y,n=t.user,o=t.scale,_t$hAlign=t.hAlign,a=_t$hAlign===void 0?null:_t$hAlign,l;var h=function h(c){var d=l.querySelector("text"),p=l.querySelector("rect"),f=d.getBBox().width+10/c;a==="CENTER"&&l.setAttribute("style","transform: translateX(-".concat(f/2,"px)")),p.setAttribute("width","".concat(f));};function u(c){_n[c?"unshift":"push"](function(){l=c,e(4,l);});}return r.$$set=function(c){"x"in c&&e(0,i=c.x),"y"in c&&e(1,s=c.y),"user"in c&&e(2,n=c.user),"scale"in c&&e(3,o=c.scale),"hAlign"in c&&e(5,a=c.hAlign);},r.$$.update=function(){r.$$.dirty&24&&l&&h(o);},[i,s,n,o,l,a,u];}var gm=/*#__PURE__*/function(_re11){_inherits(gm,_re11);var _super83=_createSuper(gm);function gm(t){var _this138;_classCallCheck(this,gm);_this138=_super83.call(this),ee(_assertThisInitialized(_this138),t,WS,zS,Wt,{x:0,y:1,user:2,scale:3,hAlign:5});return _this138;}return _createClass(gm);}(re);function YS(r){var t,e,i,s,n,_o28;return e=new gm({props:{scale:r[1],user:r[0],x:r[3][0],y:r[3][1],hAlign:"CENTER"}}),{c:function c(){t=xt("g"),Ht(e.$$.fragment),i=xt("polygon"),R(i,"class","a9s-presence-shape a9s-presence-polygon svelte-fgq4n0"),R(i,"stroke",s=r[0].appearance.color),R(i,"fill","transparent"),R(i,"points",n=r[2].points.map(ym).join(" ")),R(t,"class","a9s-presence-overlay");},m:function m(a,l){ct(a,t,l),Ft(e,t,null),Ae(t,i),_o28=!0;},p:function p(a,_ref198){var _ref199=_slicedToArray(_ref198,1),l=_ref199[0];var h={};l&2&&(h.scale=a[1]),l&1&&(h.user=a[0]),l&8&&(h.x=a[3][0]),l&8&&(h.y=a[3][1]),e.$set(h),(!_o28||l&1&&s!==(s=a[0].appearance.color))&&R(i,"stroke",s),(!_o28||l&4&&n!==(n=a[2].points.map(ym).join(" ")))&&R(i,"points",n);},i:function i(a){_o28||(q(e.$$.fragment,a),_o28=!0);},o:function o(a){et(e.$$.fragment,a),_o28=!1;},d:function d(a){a&&ht(t),Ut(e);}};}var ym=function ym(r){return r.join(",");};function jS(r,t,e){var i,s,n=t.annotation,o=t.user,a=t.scale;var l=function l(h){var _h$points=_toArray(h.points),u=_h$points[0],c=_h$points.slice(1);return c.forEach(function(_ref200){var _ref201=_slicedToArray(_ref200,2),d=_ref201[0],p=_ref201[1];p<u[1]&&(u=[d,p]);}),u;};return r.$$set=function(h){"annotation"in h&&e(4,n=h.annotation),"user"in h&&e(0,o=h.user),"scale"in h&&e(1,a=h.scale);},r.$$.update=function(){r.$$.dirty&16&&e(2,i=n.target.selector.geometry),r.$$.dirty&4&&e(3,s=l(i));},[o,a,i,s,n];}var qS=/*#__PURE__*/function(_re12){_inherits(qS,_re12);var _super84=_createSuper(qS);function qS(t){var _this139;_classCallCheck(this,qS);_this139=_super84.call(this),ee(_assertThisInitialized(_this139),t,jS,YS,Wt,{annotation:4,user:0,scale:1});return _this139;}return _createClass(qS);}(re);function KS(r){var t,e,i,s,n,o,a,l,h;return e=new gm({props:{scale:r[1],user:r[0],x:r[2].x,y:r[2].y}}),{c:function c(){t=xt("g"),Ht(e.$$.fragment),i=xt("rect"),R(i,"class","a9s-presence-shape a9s-presence-rectangle svelte-gze948"),R(i,"stroke",s=r[0].appearance.color),R(i,"fill","transparent"),R(i,"x",n=r[2].x),R(i,"y",o=r[2].y),R(i,"width",a=r[2].w),R(i,"height",l=r[2].h),R(t,"class","a9s-presence-overlay");},m:function m(u,c){ct(u,t,c),Ft(e,t,null),Ae(t,i),h=!0;},p:function p(u,_ref202){var _ref203=_slicedToArray(_ref202,1),c=_ref203[0];var d={};c&2&&(d.scale=u[1]),c&1&&(d.user=u[0]),c&4&&(d.x=u[2].x),c&4&&(d.y=u[2].y),e.$set(d),(!h||c&1&&s!==(s=u[0].appearance.color))&&R(i,"stroke",s),(!h||c&4&&n!==(n=u[2].x))&&R(i,"x",n),(!h||c&4&&o!==(o=u[2].y))&&R(i,"y",o),(!h||c&4&&a!==(a=u[2].w))&&R(i,"width",a),(!h||c&4&&l!==(l=u[2].h))&&R(i,"height",l);},i:function i(u){h||(q(e.$$.fragment,u),h=!0);},o:function o(u){et(e.$$.fragment,u),h=!1;},d:function d(u){u&&ht(t),Ut(e);}};}function ZS(r,t,e){var i,s=t.annotation,n=t.user,o=t.scale;return r.$$set=function(a){"annotation"in a&&e(3,s=a.annotation),"user"in a&&e(0,n=a.user),"scale"in a&&e(1,o=a.scale);},r.$$.update=function(){r.$$.dirty&8&&e(2,i=s.target.selector.geometry);},[n,o,i,s];}var QS=/*#__PURE__*/function(_re13){_inherits(QS,_re13);var _super85=_createSuper(QS);function QS(t){var _this140;_classCallCheck(this,QS);_this140=_super85.call(this),ee(_assertThisInitialized(_this140),t,ZS,KS,Wt,{annotation:3,user:0,scale:1});return _this140;}return _createClass(QS);}(re);var JS=ic.Boolean;function _m(r,t,e){var i=r.slice();return i[8]=t[e],i;}function vm(r){var t,e;return t=new Eh({props:{viewer:r[0],$$slots:{"default":[rC,function(_ref204){var i=_ref204.transform,s=_ref204.scale;return{6:i,7:s};},function(_ref205){var i=_ref205.transform,s=_ref205.scale;return(i?64:0)|(s?128:0);}]},$$scope:{ctx:r}}}),{c:function c(){Ht(t.$$.fragment);},m:function m(i,s){Ft(t,i,s),e=!0;},p:function p(i,s){var n={};s&1&&(n.viewer=i[0]),s&2244&&(n.$$scope={dirty:s,ctx:i}),t.$set(n);},i:function i(_i49){e||(q(t.$$.fragment,_i49),e=!0);},o:function o(i){et(t.$$.fragment,i),e=!1;},d:function d(i){Ut(t,i);}};}function xm(r){var t,e,_i50=Se(r[2]),s=[];for(var o=0;o<_i50.length;o+=1)s[o]=bm(_m(r,_i50,o));var n=function n(o){return et(s[o],1,1,function(){s[o]=null;});};return{c:function c(){for(var _o29=0;_o29<s.length;_o29+=1)s[_o29].c();t=Re();},m:function m(o,a){for(var _l48=0;_l48<s.length;_l48+=1)s[_l48]&&s[_l48].m(o,a);ct(o,t,a),e=!0;},p:function p(o,a){if(a&132){_i50=Se(o[2]);var _l49;for(_l49=0;_l49<_i50.length;_l49+=1){var h=_m(o,_i50,_l49);s[_l49]?(s[_l49].p(h,a),q(s[_l49],1)):(s[_l49]=bm(h),s[_l49].c(),q(s[_l49],1),s[_l49].m(t.parentNode,t));}for(ge(),_l49=_i50.length;_l49<s.length;_l49+=1)n(_l49);ye();}},i:function i(o){if(!e){for(var _a46=0;_a46<_i50.length;_a46+=1)q(s[_a46]);e=!0;}},o:function o(_o30){s=s.filter(JS);for(var _a47=0;_a47<s.length;_a47+=1)et(s[_a47]);e=!1;},d:function d(o){o&&ht(t),ii(s,o);}};}function tC(r){var t,e;return t=new qS({props:{annotation:r[8].annotation,user:r[8].selectedBy,scale:r[7]}}),{c:function c(){Ht(t.$$.fragment);},m:function m(i,s){Ft(t,i,s),e=!0;},p:function p(i,s){var n={};s&4&&(n.annotation=i[8].annotation),s&4&&(n.user=i[8].selectedBy),s&128&&(n.scale=i[7]),t.$set(n);},i:function i(_i51){e||(q(t.$$.fragment,_i51),e=!0);},o:function o(i){et(t.$$.fragment,i),e=!1;},d:function d(i){Ut(t,i);}};}function eC(r){var t,e;return t=new QS({props:{annotation:r[8].annotation,user:r[8].selectedBy,scale:r[7]}}),{c:function c(){Ht(t.$$.fragment);},m:function m(i,s){Ft(t,i,s),e=!0;},p:function p(i,s){var n={};s&4&&(n.annotation=i[8].annotation),s&4&&(n.user=i[8].selectedBy),s&128&&(n.scale=i[7]),t.$set(n);},i:function i(_i52){e||(q(t.$$.fragment,_i52),e=!0);},o:function o(i){et(t.$$.fragment,i),e=!1;},d:function d(i){Ut(t,i);}};}function bm(r){var t,e,i,s;var n=[eC,tC],o=[];function a(l,h){return l[8].annotation.target.selector.type===vt.RECTANGLE?0:l[8].annotation.target.selector.type===vt.POLYGON?1:-1;}return~(t=a(r))&&(e=o[t]=n[t](r)),{c:function c(){e&&e.c(),i=Re();},m:function m(l,h){~t&&o[t].m(l,h),ct(l,i,h),s=!0;},p:function p(l,h){var u=t;t=a(l),t===u?~t&&o[t].p(l,h):(e&&(ge(),et(o[u],1,1,function(){o[u]=null;}),ye()),~t?(e=o[t],e?e.p(l,h):(e=o[t]=n[t](l),e.c()),q(e,1),e.m(i.parentNode,i)):e=null);},i:function i(l){s||(q(e),s=!0);},o:function o(l){et(e),s=!1;},d:function d(l){l&&ht(i),~t&&o[t].d(l);}};}function rC(r){var t,e,i,s,n=r[2].length>0&&xm(r);return{c:function c(){t=xt("svg"),e=xt("g"),n&&n.c(),R(e,"transform",i=r[6]),R(t,"class","a9s-osd-presencelayer svelte-1krwc4m");},m:function m(o,a){ct(o,t,a),Ae(t,e),n&&n.m(e,null),s=!0;},p:function p(o,a){o[2].length>0?n?(n.p(o,a),a&4&&q(n,1)):(n=xm(o),n.c(),q(n,1),n.m(e,null)):n&&(ge(),et(n,1,1,function(){n=null;}),ye()),(!s||a&64&&i!==(i=o[6]))&&R(e,"transform",i);},i:function i(o){s||(q(n),s=!0);},o:function o(_o31){et(n),s=!1;},d:function d(o){o&&ht(t),n&&n.d();}};}function iC(r){var t=!!r[1],e,_i53,s=t&&vm(r);return{c:function c(){s&&s.c(),e=Re();},m:function m(n,o){s&&s.m(n,o),ct(n,e,o),_i53=!0;},p:function p(n,_ref206){var _ref207=_slicedToArray(_ref206,1),o=_ref207[0];o&2&&(t=!!n[1]),t?s?(s.p(n,o),o&2&&q(s,1)):(s=vm(n),s.c(),q(s,1),s.m(e.parentNode,e)):s&&(ge(),et(s,1,1,function(){s=null;}),ye());},i:function i(n){_i53||(q(s),_i53=!0);},o:function o(n){et(s),_i53=!1;},d:function d(n){n&&ht(e),s&&s.d(n);}};}function sC(r,t,e){var i=t.store,s=t.viewer,n=t.provider,o=[],a;var l=function l(h,u){e(2,o=[].concat(_toConsumableArray(o.filter(function(_ref208){var c=_ref208.selectedBy;return c.presenceKey!==h.presenceKey;})),_toConsumableArray((u||[]).map(function(c){return{annotation:i.getAnnotation(c),selectedBy:h};}))).filter(function(_ref209){var c=_ref209.annotation;return c||console.warn("Selection event on unknown annotation"),!!c;})),a&&i.unobserve(a),a=function a(c){var _c$changes=c.changes,d=_c$changes.deleted,p=_c$changes.updated,f=new Set((d||[]).map(function(y){return y.id;})),m=o.filter(function(_ref210){var y=_ref210.annotation;return!f.has(y.id);}).map(function(y){var _=(p||[]).find(function(v){return v.oldValue.id===y.annotation.id;});return _?{selectedBy:y.selectedBy,annotation:_.newValue}:y;});e(2,o=m);},i.observe(a,{annotations:o.map(function(c){return c.annotation.id;})});};return f0(function(){a&&i.unobserve(a);}),r.$$set=function(h){"store"in h&&e(3,i=h.store),"viewer"in h&&e(0,s=h.viewer),"provider"in h&&e(1,n=h.provider);},r.$$.update=function(){r.$$.dirty&2&&n&&n.on("selectionChange",l);},[s,n,o,i];}var nC=/*#__PURE__*/function(_re14){_inherits(nC,_re14);var _super86=_createSuper(nC);function nC(t){var _this141;_classCallCheck(this,nC);_this141=_super86.call(this),ee(_assertThisInitialized(_this141),t,sC,iC,Wt,{store:3,viewer:0,provider:1});return _this141;}return _createClass(nC);}(re);function oC(r){var t,e,i,s,n;return{c:function c(){t=xt("rect"),R(t,"x",e=r[0].x),R(t,"y",i=r[0].y),R(t,"width",s=r[0].w),R(t,"height",n=r[0].h);},m:function m(o,a){ct(o,t,a);},p:function p(o,_ref211){var _ref212=_slicedToArray(_ref211,1),a=_ref212[0];a&1&&e!==(e=o[0].x)&&R(t,"x",e),a&1&&i!==(i=o[0].y)&&R(t,"y",i),a&1&&s!==(s=o[0].w)&&R(t,"width",s),a&1&&n!==(n=o[0].h)&&R(t,"height",n);},i:me,o:me,d:function d(o){o&&ht(t);}};}function aC(r,t,e){var i,s=t.annotation;return r.$$set=function(n){"annotation"in n&&e(1,s=n.annotation);},r.$$.update=function(){r.$$.dirty&2&&e(0,i=s.target.selector.geometry);},[i,s];}var lC=/*#__PURE__*/function(_re15){_inherits(lC,_re15);var _super87=_createSuper(lC);function lC(t){var _this142;_classCallCheck(this,lC);_this142=_super87.call(this),ee(_assertThisInitialized(_this142),t,aC,oC,Wt,{annotation:1});return _this142;}return _createClass(lC);}(re);function hC(r){var t,e;return{c:function c(){t=xt("polygon"),R(t,"points",e=r[0].points.map(Em).join(" "));},m:function m(i,s){ct(i,t,s);},p:function p(i,_ref213){var _ref214=_slicedToArray(_ref213,1),s=_ref214[0];s&1&&e!==(e=i[0].points.map(Em).join(" "))&&R(t,"points",e);},i:me,o:me,d:function d(i){i&&ht(t);}};}var Em=function Em(r){return r.join(",");};function uC(r,t,e){var i,s=t.annotation;return r.$$set=function(n){"annotation"in n&&e(1,s=n.annotation);},r.$$.update=function(){r.$$.dirty&2&&e(0,i=s.target.selector.geometry);},[i,s];}var cC=/*#__PURE__*/function(_re16){_inherits(cC,_re16);var _super88=_createSuper(cC);function cC(t){var _this143;_classCallCheck(this,cC);_this143=_super88.call(this),ee(_assertThisInitialized(_this143),t,uC,hC,Wt,{annotation:1});return _this143;}return _createClass(cC);}(re);function dC(r){var t,e,i,s,n;return{c:function c(){t=xt("ellipse"),R(t,"cx",e=r[0].cx),R(t,"cy",i=r[0].cy),R(t,"rx",s=r[0].rx),R(t,"ry",n=r[0].ry);},m:function m(o,a){ct(o,t,a);},p:function p(o,_ref215){var _ref216=_slicedToArray(_ref215,1),a=_ref216[0];a&1&&e!==(e=o[0].cx)&&R(t,"cx",e),a&1&&i!==(i=o[0].cy)&&R(t,"cy",i),a&1&&s!==(s=o[0].rx)&&R(t,"rx",s),a&1&&n!==(n=o[0].ry)&&R(t,"ry",n);},i:me,o:me,d:function d(o){o&&ht(t);}};}function fC(r,t,e){var i,s=t.annotation;return r.$$set=function(n){"annotation"in n&&e(1,s=n.annotation);},r.$$.update=function(){r.$$.dirty&2&&e(0,i=s.target.selector.geometry);},[i,s];}var pC=/*#__PURE__*/function(_re17){_inherits(pC,_re17);var _super89=_createSuper(pC);function pC(t){var _this144;_classCallCheck(this,pC);_this144=_super89.call(this),ee(_assertThisInitialized(_this144),t,fC,dC,Wt,{annotation:1});return _this144;}return _createClass(pC);}(re);var mC=ic.Boolean;function Tm(r,t,e){var i=r.slice();return i[10]=t[e],i;}function wm(r){var t,e;return t=new Eh({props:{viewer:r[0],$$slots:{"default":[vC,function(_ref217){var i=_ref217.transform;return{9:i};},function(_ref218){var i=_ref218.transform;return i?512:0;}]},$$scope:{ctx:r}}}),{c:function c(){Ht(t.$$.fragment);},m:function m(i,s){Ft(t,i,s),e=!0;},p:function p(i,s){var n={};s&1&&(n.viewer=i[0]),s&8710&&(n.$$scope={dirty:s,ctx:i}),t.$set(n);},i:function i(_i54){e||(q(t.$$.fragment,_i54),e=!0);},o:function o(i){et(t.$$.fragment,i),e=!1;},d:function d(i){Ut(t,i);}};}function gC(r){var t,e;return t=new pC({props:{annotation:r[10]}}),{c:function c(){Ht(t.$$.fragment);},m:function m(i,s){Ft(t,i,s),e=!0;},p:function p(i,s){var n={};s&2&&(n.annotation=i[10]),t.$set(n);},i:function i(_i55){e||(q(t.$$.fragment,_i55),e=!0);},o:function o(i){et(t.$$.fragment,i),e=!1;},d:function d(i){Ut(t,i);}};}function yC(r){var t,e;return t=new cC({props:{annotation:r[10]}}),{c:function c(){Ht(t.$$.fragment);},m:function m(i,s){Ft(t,i,s),e=!0;},p:function p(i,s){var n={};s&2&&(n.annotation=i[10]),t.$set(n);},i:function i(_i56){e||(q(t.$$.fragment,_i56),e=!0);},o:function o(i){et(t.$$.fragment,i),e=!1;},d:function d(i){Ut(t,i);}};}function _C(r){var t,e;return t=new lC({props:{annotation:r[10]}}),{c:function c(){Ht(t.$$.fragment);},m:function m(i,s){Ft(t,i,s),e=!0;},p:function p(i,s){var n={};s&2&&(n.annotation=i[10]),t.$set(n);},i:function i(_i57){e||(q(t.$$.fragment,_i57),e=!0);},o:function o(i){et(t.$$.fragment,i),e=!1;},d:function d(i){Ut(t,i);}};}function Am(r){var t,e,i,s;var n=[_C,yC,gC],o=[];function a(l,h){return l[10].target.selector.type===vt.RECTANGLE?0:l[10].target.selector.type===vt.POLYGON?1:l[10].target.selector.type===vt.ELLIPSE?2:-1;}return~(t=a(r))&&(e=o[t]=n[t](r)),{c:function c(){e&&e.c(),i=Re();},m:function m(l,h){~t&&o[t].m(l,h),ct(l,i,h),s=!0;},p:function p(l,h){var u=t;t=a(l),t===u?~t&&o[t].p(l,h):(e&&(ge(),et(o[u],1,1,function(){o[u]=null;}),ye()),~t?(e=o[t],e?e.p(l,h):(e=o[t]=n[t](l),e.c()),q(e,1),e.m(i.parentNode,i)):e=null);},i:function i(l){s||(q(e),s=!0);},o:function o(l){et(e),s=!1;},d:function d(l){l&&ht(i),~t&&o[t].d(l);}};}function vC(r){var t,e,i,s,n,o,a,l,h,u,_c22,d,_p18,f,m=Se(r[1].filter(r[6])),y=[];for(var v=0;v<m.length;v+=1)y[v]=Am(Tm(r,m,v));var _=function _(v){return et(y[v],1,1,function(){y[v]=null;});};return{c:function c(){var v,g,x,b;t=xt("svg"),e=xt("g"),i=xt("rect"),l=xt("rect");for(var S=0;S<y.length;S+=1)y[S].c();R(i,"class","a9s-union-bg svelte-n2zwns"),R(i,"x",s=(v=r[2])==null?void 0:v.minX),R(i,"y",n=(g=r[2])==null?void 0:g.minY),R(i,"width",o=r[2]?r[2].maxX-r[2].minX:0),R(i,"height",a=r[2]?r[2].maxY-r[2].minY:0),R(l,"class","a9s-union-fg svelte-n2zwns"),R(l,"x",h=(x=r[2])==null?void 0:x.minX),R(l,"y",u=(b=r[2])==null?void 0:b.minY),R(l,"width",_c22=r[2]?r[2].maxX-r[2].minX:0),R(l,"height",d=r[2]?r[2].maxY-r[2].minY:0),R(e,"transform",_p18=r[9]),R(t,"class","a9s-osd-selectionlayer svelte-n2zwns");},m:function m(v,g){ct(v,t,g),Ae(t,e),Ae(e,i),Ae(e,l);for(var x=0;x<y.length;x+=1)y[x]&&y[x].m(e,null);f=!0;},p:function p(v,g){var x,b,S,w;if((!f||g&4&&s!==(s=(x=v[2])==null?void 0:x.minX))&&R(i,"x",s),(!f||g&4&&n!==(n=(b=v[2])==null?void 0:b.minY))&&R(i,"y",n),(!f||g&4&&o!==(o=v[2]?v[2].maxX-v[2].minX:0))&&R(i,"width",o),(!f||g&4&&a!==(a=v[2]?v[2].maxY-v[2].minY:0))&&R(i,"height",a),(!f||g&4&&h!==(h=(S=v[2])==null?void 0:S.minX))&&R(l,"x",h),(!f||g&4&&u!==(u=(w=v[2])==null?void 0:w.minY))&&R(l,"y",u),(!f||g&4&&_c22!==(_c22=v[2]?v[2].maxX-v[2].minX:0))&&R(l,"width",_c22),(!f||g&4&&d!==(d=v[2]?v[2].maxY-v[2].minY:0))&&R(l,"height",d),g&2){m=Se(v[1].filter(v[6]));var T;for(T=0;T<m.length;T+=1){var N=Tm(v,m,T);y[T]?(y[T].p(N,g),q(y[T],1)):(y[T]=Am(N),y[T].c(),q(y[T],1),y[T].m(e,null));}for(ge(),T=m.length;T<y.length;T+=1)_(T);ye();}(!f||g&512&&_p18!==(_p18=v[9]))&&R(e,"transform",_p18);},i:function i(v){if(!f){for(var g=0;g<m.length;g+=1)q(y[g]);f=!0;}},o:function o(v){y=y.filter(mC);for(var g=0;g<y.length;g+=1)et(y[g]);f=!1;},d:function d(v){v&&ht(t),ii(y,v);}};}function xC(r){var t=!!r[2],e,_i58,s=t&&wm(r);return{c:function c(){s&&s.c(),e=Re();},m:function m(n,o){s&&s.m(n,o),ct(n,e,o),_i58=!0;},p:function p(n,_ref219){var _ref220=_slicedToArray(_ref219,1),o=_ref220[0];o&4&&(t=!!n[2]),t?s?(s.p(n,o),o&4&&q(s,1)):(s=wm(n),s.c(),q(s,1),s.m(e.parentNode,e)):s&&(ge(),et(s,1,1,function(){s=null;}),ye());},i:function i(n){_i58||(q(s),_i58=!0);},o:function o(n){et(s),_i58=!1;},d:function d(n){n&&ht(e),s&&s.d(n);}};}function bC(r,t,e){var i,s,n,o=t.state,a=t.viewer;var _o32=o,l=_o32.store,_o33=o,h=_o33.selection;fn(r,h,function(d){return e(5,n=d);});var u=function u(d){var p=-1/0,f=-1/0,m=1/0,y=1/0;var _iterator31=_createForOfIteratorHelper(d.filter(function(v){return Ge(v);})),_step31;try{for(_iterator31.s();!(_step31=_iterator31.n()).done;){var _=_step31.value;var v=_.target.selector.geometry.bounds;v.maxX>p&&(p=v.maxX),v.maxY>f&&(f=v.maxY),v.minX<m&&(m=v.minX),v.minY<y&&(y=v.minY);}}catch(err){_iterator31.e(err);}finally{_iterator31.f();}return a.forceRedraw(),{maxX:p,maxY:f,minX:m,minY:y};},c=function c(d){return Ge(d);};return r.$$set=function(d){"state"in d&&e(4,o=d.state),"viewer"in d&&e(0,a=d.viewer);},r.$$.update=function(){r.$$.dirty&32&&e(1,i=n.selected.map(function(_ref221){var d=_ref221.id;return l.getAnnotation(d);})),r.$$.dirty&2&&e(2,s=i.length>1?u(i):void 0);},[a,i,s,h,o,n,c];}var EC=/*#__PURE__*/function(_re18){_inherits(EC,_re18);var _super90=_createSuper(EC);function EC(t){var _this145;_classCallCheck(this,EC);_this145=_super90.call(this),ee(_assertThisInitialized(_this145),t,bC,xC,Wt,{state:4,viewer:0});return _this145;}return _createClass(EC);}(re);var Sm=function Sm(r,t){t==="auto"?r.addHandler("open",function(e){var i=r.world.getItemCount();r.world.getItemAt(i-1).addOnceHandler("fully-loaded-change",function(n){var o=n.fullyLoaded;if(o){var _a48=r.canvas.querySelector("canvas"),_l50=Xu(_a48);r.element.setAttribute("data-theme",_l50);}});}):r.element.setAttribute("data-theme",t);},Cm=function Cm(r,t,e){return function(i){var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var n=typeof i=="string"?i:i.id,o=t.getAnnotation(n);if(!o||!Ge(o))return;var a=r.container.getBoundingClientRect(),l=s.padding;var _ref222=l?Array.isArray(l)?l:[l,l,l,l]:[0,0,0,0],_ref223=_slicedToArray(_ref222,4),h=_ref223[0],u=_ref223[1],c=_ref223[2],d=_ref223[3];h=h/a.height,u=u/a.width,c=c/a.height,d=d/a.width;var _o$target$selector$ge=o.target.selector.geometry.bounds,p=_o$target$selector$ge.minX,f=_o$target$selector$ge.minY,m=_o$target$selector$ge.maxX,y=_o$target$selector$ge.maxY,_=m-p,v=y-f,g=p-d*_,x=f-h*v,b=_+(u+d)*_,S=v+(h+c)*v,w=r.viewport.imageToViewportRectangle(g,x,b,S);r.viewport[e](w,s.immediately);};},TC=function TC(r,t){return Cm(r,t,"fitBounds");},wC=function wC(r,t){return Cm(r,t,"fitBoundsWithConstraints");},AC=function AC(r){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var e=Wu(t,{drawingEnabled:!1,drawingMode:fu?"drag":"click",userSelectAction:$o.EDIT,theme:"light"}),i=Vu(e),s=i.hover,n=i.selection,o=i.store,a=Wm(o,e.initialHistory),l=Ym(i,a,e.adapter,e.autoSave);var h=eg(),u=e.drawingEnabled,c=e.drawingMode,d=e.modalSelect;var p=ju(a,r.element),f=new NA({target:r.element,props:{state:i,viewer:r,style:e.style,filter:void 0}}),m=new nC({target:r.element.querySelector(".openseadragon-canvas"),props:{provider:void 0,store:o,viewer:r}}),y=new XS({target:r.element.querySelector(".openseadragon-canvas"),props:{drawingEnabled:!!u,filter:void 0,multiSelect:e.multiSelect,preferredDrawingMode:c,state:i,style:e.style,user:h,viewer:r}}),_=new EC({target:r.element.querySelector(".openseadragon-canvas"),props:{state:i,viewer:r}});f.$on("click",function(L){var _L$detail=L.detail,V=_L$detail.originalEvent,rt=_L$detail.annotation,Q=function Q(X){return hm(X.id,V,n,e.multiSelect);};d?n.isEmpty()&&rt&&n.userSelect(Q(rt),V):rt&&!(c==="click"&&u)?n.userSelect(Q(rt),V):n.isEmpty()||n.clear();}),r.element.addEventListener("pointerdown",function(L){if(s.current){var V=o.getAnnotation(s.current);l.emit("clickAnnotation",V,L);}}),Sm(r,e.theme);var v=qm(i,a,e.adapter),g=function g(){return y.cancelDrawing();},x=function x(){f.$destroy(),m.$destroy(),y.$destroy(),_.$destroy(),p.destroy(),a.destroy();},b=TC(r,o),S=wC(r,o),w=function w(){return y.getDrawingTool();},T=function T(){return h;},N=function N(){return y.isDrawingEnabled();},F=function F(L,V,rt){return Cu(L,V,rt);},z=function z(L,V){return Eu(L,V);},C=function C(L){if(!un(L))throw"No drawing tool named ".concat(L);y.$set({toolName:L});},E=function E(L){u=L,y.$set({drawingEnabled:L});},I=function I(L){f.$set({filter:L}),y.$set({filter:L});},P=function P(L){return d=L;},$=function $(L){f.$set({style:L}),y.$set({style:L});},k=function k(L){return m.$set({provider:L});},G=function G(L){return Sm(r,L);},st=function st(L){h=L,y.$set({user:L});},M=function M(L){return f.$set({visible:L});};return _objectSpread(_objectSpread({},v),{},{cancelDrawing:g,destroy:x,fitBounds:b,fitBoundsWithConstraints:S,getDrawingTool:w,getUser:T,isDrawingEnabled:N,listDrawingTools:hn,on:l.on,off:l.off,registerDrawingTool:F,registerShapeEditor:z,setDrawingEnabled:E,setDrawingTool:C,setFilter:I,setModalSelect:P,setPresenceProvider:k,setStyle:$,setTheme:G,setUser:st,setVisible:M,state:i,viewer:r});};Gt.ShapeType=vt,Gt.UserSelectAction=$o,Gt.W3CImageFormat=Hy,Gt.chainStyles=Oy,Gt.computeStyle=Py,Gt.createBody=Fm,Gt.createImageAnnotator=a0,Gt.createOSDAnnotator=AC,Gt.defaultColorProvider=ig,Object.defineProperty(Gt,Symbol.toStringTag,{value:"Module"});});
